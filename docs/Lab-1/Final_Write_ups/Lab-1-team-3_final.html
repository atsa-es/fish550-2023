<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zoe Rand, Madison Shipley, Emma Timmins-Schiffman">

<title>Fish 550 Spring 2023 - 5&nbsp; Team 3 - Lab 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" rel="next">
<link href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-1/Lab1-ARIMA.html">Forecasting with ARIMA models</a></li><li class="breadcrumb-item"><a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#question-your-team-will-address" id="toc-question-your-team-will-address" class="nav-link" data-scroll-target="#question-your-team-will-address">Question your team will address</a></li>
  <li><a href="#initial-plan" id="toc-initial-plan" class="nav-link" data-scroll-target="#initial-plan">Initial plan</a></li>
  <li><a href="#what-we-actually-did" id="toc-what-we-actually-did" class="nav-link" data-scroll-target="#what-we-actually-did">What we actually did</a>
  <ul class="collapse">
  <li><a href="#sockeye-combined-regions" id="toc-sockeye-combined-regions" class="nav-link" data-scroll-target="#sockeye-combined-regions">Sockeye: Combined Regions</a></li>
  <li><a href="#assess-how-well-forecasting-performs-for-sockeye-returns-by-region" id="toc-assess-how-well-forecasting-performs-for-sockeye-returns-by-region" class="nav-link" data-scroll-target="#assess-how-well-forecasting-performs-for-sockeye-returns-by-region">Assess how well forecasting performs for sockeye returns by region</a></li>
  <li><a href="#chum-regional" id="toc-chum-regional" class="nav-link" data-scroll-target="#chum-regional">Chum: Regional</a></li>
  <li><a href="#pink-combined-regions" id="toc-pink-combined-regions" class="nav-link" data-scroll-target="#pink-combined-regions">Pink: Combined Regions</a></li>
  </ul></li>
  <li><a href="#pinks-regional-considerations" id="toc-pinks-regional-considerations" class="nav-link" data-scroll-target="#pinks-regional-considerations">Pinks: Regional Considerations</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#sockeye" id="toc-sockeye" class="nav-link" data-scroll-target="#sockeye">Sockeye:</a></li>
  <li><a href="#chum" id="toc-chum" class="nav-link" data-scroll-target="#chum">Chum:</a></li>
  <li><a href="#pink" id="toc-pink" class="nav-link" data-scroll-target="#pink">Pink:</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#description-of-each-team-members-contributions" id="toc-description-of-each-team-members-contributions" class="nav-link" data-scroll-target="#description-of-each-team-members-contributions">Description of each team member’s contributions</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-1/Final_Write_ups/Lab-1-team-3_final.Rmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-1/Final_Write_ups/Lab-1-team-3_final.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lab 1 Forecasting with ARIMA models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zoe Rand, Madison Shipley, Emma Timmins-Schiffman </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/eli.holmes/Documents/GitHub/fish550-2023</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'cowplot'

The following object is masked from 'package:lubridate':

    stamp</code></pre>
</div>
</div>
<section id="data" class="level1">
<h1>Data</h1>
<p>We chose to work with all data to compare ability of the ARIMA models to forecast across different patterns of population dynamics and different sizes of training data sets.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ruggerone_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-1"</span>, <span class="st">"Data_Images"</span>, <span class="st">"ruggerone_data.rds"</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#The above code was not working for me, so I've added this in temporarily (MS)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ruggerone_data &lt;- readRDS("C:/GitHub/fish550-2023/Lab-1/Data_Images/ruggerone_data.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="question-your-team-will-address" class="level1">
<h1>Question your team will address</h1>
<ol type="1">
<li>If we approached these data as stock managers, how confident could we be in projected return data 5, 10, or 20 years into the future?</li>
<li>What types of population patterns are ARIMA models best suited for?</li>
<li>Is one species or region “easier” to forecast than others?</li>
</ol>
</section>
<section id="initial-plan" class="level1">
<h1>Initial plan</h1>
<p>For each species we will subset by region and test for stationarity. Then for forecast levels of 5, 10, and 20 years for each region, we will run auto-arima. We will look at forecasts and accuracy using RMSE to determine what level of for asting could be appropriate when considering management utility.</p>
<p>We will pick a couple of regions for each species to demonstrate ACF and PACF, and look through model results for any residuals.</p>
</section>
<section id="what-we-actually-did" class="level1">
<h1>What we actually did</h1>
<p>It was harder to compare models across species and regions than we assumed. We created functions to help streamline this process. Also after researching forecast accuracy metrics, we decided to use MASE as a metric instead of RMSE. It was difficult to decipher why some regions were more easily forecasted and others returned unreliable results. Additionally, each species had different dynamics, and some variable methods were applied in order to find a model that worked.</p>
<section id="sockeye-combined-regions" class="level2">
<h2 class="anchored" data-anchor-id="sockeye-combined-regions">Sockeye: Combined Regions</h2>
<p>Subset and format the data to analyze just sockeye.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>SockByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"japan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"sockeye"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'species', 'region'. You can override using
the `.groups` argument.</code></pre>
</div>
</div>
<p>Create a time series object and train the data on the first 59 years of data; forecast the last 5 years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sockeye.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(SockByRegion<span class="sc">$</span>lnreturns, <span class="at">start=</span>SockByRegion<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>train.sockeye<span class="ot">&lt;-</span><span class="fu">window</span>(sockeye.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>test.sockeye<span class="ot">&lt;-</span><span class="fu">window</span>(sockeye.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Assess the ACF and PACF of the training data set.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Look at the options for fitting an ARIMA to the data and then choose a final model. The best model for both of these is ARIMA(0,1,2); however, a comparison with other models suggests that ARIMA(1,1,1) is also a good fit with AIC within 0.3 of the ARIMA(0,1,2). The full dataset requires differencing (d=1).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sockeye, <span class="at">trace=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(2,1,2) with drift         : Inf
 ARIMA(0,1,0) with drift         : 61.95027
 ARIMA(1,1,0) with drift         : 60.11204
 ARIMA(0,1,1) with drift         : 57.27974
 ARIMA(0,1,0)                    : 59.87487
 ARIMA(1,1,1) with drift         : Inf
 ARIMA(0,1,2) with drift         : 57.23854
 ARIMA(1,1,2) with drift         : Inf
 ARIMA(0,1,3) with drift         : Inf
 ARIMA(1,1,3) with drift         : Inf
 ARIMA(0,1,2)                    : 55.53198
 ARIMA(0,1,1)                    : 55.33664
 ARIMA(1,1,1)                    : 55.19379
 ARIMA(1,1,0)                    : 57.99975
 ARIMA(2,1,1)                    : 57.46972
 ARIMA(1,1,2)                    : 57.48549
 ARIMA(2,1,0)                    : 58.91271
 ARIMA(2,1,2)                    : Inf

 Best model: ARIMA(1,1,1)                    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit.final.sock<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sockeye, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the 5 year forecast for the last part of the dataset compared to the actual data. The real data are represented by the black dots; the forecast is represented by the black line.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assess-how-well-forecasting-performs-for-sockeye-returns-by-region" class="level2">
<h2 class="anchored" data-anchor-id="assess-how-well-forecasting-performs-for-sockeye-returns-by-region">Assess how well forecasting performs for sockeye returns by region</h2>
<p>Create objects needed for plotting.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(SockByRegion<span class="sc">$</span>region)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"Washington"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot ACF and PACF for each region.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  Sockdat<span class="ot">&lt;-</span>SockByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Sockdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Sockdat<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ACF plots</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>PACF plots</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Fit ARIMA models to each region.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  Sockdat<span class="ot">&lt;-</span>SockByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Sockdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Sockdat<span class="sc">$</span>year[<span class="dv">1</span>]) <span class="co">#this assumes the first year in data is the start of the time series (they are in order) </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, <span class="dv">1952</span>, cutoff)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">#auto arima picked the best model</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>      newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>RegionModsSock<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Extract MASE for comparisons of models across regions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>RegionMASESock<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsSock, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>RegionBestModSock<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsSock, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ResultsTableSock<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestModSock, <span class="at">MASE =</span> RegionMASESock)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How well does auto.arima do in choosing a model? Is it different from what we would choose looking at ACF and PACF? For Cook Inlet, auto.arima selected ARIMA(4,1,1), but PACF has a significant lag at 6 and ACF trails off.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sock.ci<span class="ot">&lt;-</span><span class="fu">subset</span>(SockByRegion, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ci.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(sock.ci<span class="sc">$</span>lnreturns, <span class="at">start=</span>sock.ci<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ndiffs</span>(ci.ts, <span class="at">test=</span><span class="st">'adf'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ndiffs</span>(ci.ts, <span class="at">test=</span><span class="st">'kpss'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>test.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ci.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">forecast</span>(ci.final5, <span class="at">h=</span><span class="dv">5</span>), test.ci5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME      RMSE       MAE       MPE     MAPE      MASE
Training set 0.02471079 0.3370305 0.2702999 -38.06705 62.87923 0.8967555
Test set     0.34919358 0.4082214 0.3491936  17.84353 17.84353 1.1584957
                     ACF1 Theil's U
Training set  0.008040561        NA
Test set     -0.080588177  1.829245</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MASE is just above 1</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(train.ci5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(train.ci5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#select ARIMA (6,1,0)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fit.ci2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.ci5, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">include.mean=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">forecast</span>(fit, <span class="at">h=</span><span class="dv">5</span>), test.ci5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME      RMSE       MAE       MPE     MAPE      MASE
Training set 0.03439583 0.3641608 0.2787817 -40.97753 65.59960 0.9248951
Test set     0.29776606 0.3308204 0.2977661  15.30517 15.30517 0.9878781
                     ACF1 Theil's U
Training set -0.007356741        NA
Test set      0.206715703  1.669537</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#MASE is very high for the test set.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are the plots comparing the two models for Cook Inlet. The plots look very similar, but the forecast differs a bit for the last 2 years.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="chum-regional" class="level2">
<h2 class="anchored" data-anchor-id="chum-regional">Chum: Regional</h2>
<p>Looking at data:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Getting a subset of the data (removing regions with no data):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#removing Korea Japan because there's no data</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ChumByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"japan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"chum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'species', 'region'. You can override using
the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ChumByRegion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   species, region [1]
  species region  year total lnreturns
  &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 chum    ci      1952 1.25     0.226 
2 chum    ci      1953 1.44     0.363 
3 chum    ci      1954 1.93     0.656 
4 chum    ci      1955 0.957   -0.0436
5 chum    ci      1956 2.11     0.748 
6 chum    ci      1957 2.76     1.01  </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#making sure all the regions cover all the years (or at least start and end)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">startyear =</span> <span class="fu">min</span>(year), <span class="at">endyear =</span> <span class="fu">max</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   region startyear endyear
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1 ci          1952    2015
 2 e_kam       1952    2015
 3 kod         1952    2015
 4 m_i         1952    2015
 5 nbc         1952    2015
 6 pws         1952    2015
 7 s_pen       1952    2015
 8 sbc         1952    2015
 9 seak        1952    2015
10 w_kam       1952    2015
11 wa          1952    2015
12 wak         1952    2015</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#all start in 1952 and end in 2015</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Creating tibble to loop through:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#regions vector</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(ChumByRegion<span class="sc">$</span>region)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#regions key</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"Washington"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions <span class="co">#for plotting</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast levels</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#all combinations</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function for ACF and PACF</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF and PACF</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  Chumdat<span class="ot">&lt;-</span>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Chumdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Chumdat<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through regions/levels</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF plots for each region</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#function for ARIMA models</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#This function takes a region and forecast level, subsets the data according to these parameters, then sets up the time series object, and the test and train sets. It uses auto.arima to find the "best" model and then this is checked by comparing other models with DeltaAICc &lt; 2 and the number of parameters. If auto.arima picked a the model with the lowest AIC and the fewest parameters, it forecasts using this model and checks forecast accuracy with MASE. If not, it refits the model using Arima and the simpler model, and then checks forecast accuracy with this.</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  Chumdat<span class="ot">&lt;-</span>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Chumdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Chumdat<span class="sc">$</span>year[<span class="dv">1</span>]) <span class="co">#this assumes the first year in data is the start of the time series (they are in order) </span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, <span class="dv">1952</span>, cutoff)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>      <span class="co">#auto arima picked the best model</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>      <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>      newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>RegionModsChum<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>RegionMASEChum<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsChum, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>RegionBestModChum<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsChum, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#combine into tables</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>ResultsTableChum<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestModChum, <span class="at">MASE =</span> RegionMASEChum)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ResultsTableChum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">regions</th>
<th style="text-align: right;">forecastlevels</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">MASE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ci</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ARIMA(1,1,1)</td>
<td style="text-align: right;">0.4232248</td>
</tr>
<tr class="even">
<td style="text-align: left;">ci</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">ARIMA(1,1,1)</td>
<td style="text-align: right;">0.3650863</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ci</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">ARIMA(0,0,2) with non-zero mean</td>
<td style="text-align: right;">1.3678453</td>
</tr>
<tr class="even">
<td style="text-align: left;">e_kam</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ARIMA(1,0,0) with non-zero mean</td>
<td style="text-align: right;">2.0352335</td>
</tr>
<tr class="odd">
<td style="text-align: left;">e_kam</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">ARIMA(1,0,0) with non-zero mean</td>
<td style="text-align: right;">1.6504750</td>
</tr>
<tr class="even">
<td style="text-align: left;">e_kam</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">ARIMA(1,0,0) with non-zero mean</td>
<td style="text-align: right;">1.4845904</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="pink-combined-regions" class="level2">
<h2 class="anchored" data-anchor-id="pink-combined-regions">Pink: Combined Regions</h2>
<p>Subset the data to look at pink salmon only.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter by species (Pink)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> ruggerone_data <span class="sc">%&gt;%</span>  </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"pink"</span> <span class="sc">&amp;</span> region<span class="sc">==</span><span class="st">"ci"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log.returns =</span> <span class="fu">log</span>(returns)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, log.returns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot by region</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ruggerone_data <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"pink"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(returns))) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"pink salmon log abundance by region"</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that there is no data in Korea, and WA has a lot of 0 values and very low returns. We will filter these regions out. All 0 values (-Inf in log space) were removed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>PinkByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"wa"</span>) <span class="sc">%&gt;%</span><span class="co">#Remove WA too, it's trouble </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">ifelse</span>(lnreturns <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">NA</span>, lnreturns)) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"pink"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'species', 'region'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 768 × 5
# Groups:   species, region [12]
  species region  year total lnreturns
  &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 pink    ci      1952  4.36     1.47 
2 pink    ci      1953  1.30     0.264
3 pink    ci      1954  4.67     1.54 
4 pink    ci      1955  2.67     0.981
5 pink    ci      1956  3.57     1.27 
# ℹ 763 more rows</code></pre>
</div>
</div>
<p>Identify start and end years for each region.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">startyear =</span> <span class="fu">min</span>(year), <span class="at">endyear =</span> <span class="fu">max</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   region startyear endyear
   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1 ci          1952    2015
 2 e_kam       1952    2015
 3 japan       1952    2015
 4 kod         1952    2015
 5 m_i         1952    2015
 6 nbc         1952    2015
 7 pws         1952    2015
 8 s_pen       1952    2015
 9 sbc         1952    2015
10 seak        1952    2015
11 w_kam       1952    2015
12 wak         1952    2015</code></pre>
</div>
</div>
<p>The next step is to ID Stationarity with all the pink data. Lets plot the data in aggregate.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>PinkByRegion <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Next, a time series object was created and we look at the ACF and PACF</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>total.pink<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>pink.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink<span class="sc">$</span>lntotal, </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">start=</span>total.pink<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts)) <span class="co">#something odd happened between 1990 and 2005</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts)) <span class="co">#ruh roh, ACF correlation for entire series </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The ACF looks like there is a lot of corelation, that’s probably because Pinks have a very consistent two year cycle.</p>
<p>Let’s try a forecast model to see what happens.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's train and test with a 10 year period</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>train.pink<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>test.pink<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink, <span class="at">trace=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(2,1,2) with drift         : Inf
 ARIMA(0,1,0) with drift         : 44.48651
 ARIMA(1,1,0) with drift         : -0.8966894
 ARIMA(0,1,1) with drift         : 18.15923
 ARIMA(0,1,0)                    : 42.45004
 ARIMA(2,1,0) with drift         : -1.222687
 ARIMA(3,1,0) with drift         : -2.155628
 ARIMA(4,1,0) with drift         : 0.3831016
 ARIMA(3,1,1) with drift         : 0.2902468
 ARIMA(2,1,1) with drift         : Inf
 ARIMA(4,1,1) with drift         : Inf
 ARIMA(3,1,0)                    : -4.270823
 ARIMA(2,1,0)                    : -3.360303
 ARIMA(4,1,0)                    : -1.841485
 ARIMA(3,1,1)                    : -1.889482
 ARIMA(2,1,1)                    : Inf
 ARIMA(4,1,1)                    : 0.4019518

 Best model: ARIMA(3,1,0)                    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fit.final.pink<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">#30 year forcast, not so believeable</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>fit.final.pink <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The best model was the ARIMA(3,1,0), but the forecast doesn’t look particularly great.</p>
<p>Given the life history of pink salmon, let’s parse the data set into two pieces, even and odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years: Totals </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years: Totals </span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Trends</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>) <span class="sc">+</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Total Pinks (Even Years)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Total Pinks (Odd Years)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-33-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s look at the ACF and PACF for even years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years -- Total</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>total.pink_even<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>pink.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink_even<span class="sc">$</span>lntotal, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">start=</span>total.pink<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts_even)) <span class="co">#Looks pretty stationary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts_even)) <span class="co">#This looks much better</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The differences and the ACF plots here look better than the aggregate data set. Let’s look at a forcast.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Train and test for a 10 year period</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>train.pink_even<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2004</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>test.pink_even<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_even, <span class="at">trace=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(2,1,2) with drift         : Inf
 ARIMA(0,1,0) with drift         : 2.346942
 ARIMA(1,1,0) with drift         : 4.419114
 ARIMA(0,1,1) with drift         : 4.222938
 ARIMA(0,1,0)                    : 0.1554815
 ARIMA(1,1,1) with drift         : Inf

 Best model: ARIMA(0,1,0)                    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fit.final.pink_even<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_even, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>fit.final.pink_even <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink_even))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#That is a straight line..... not very good.....</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The best model was the ARIMA(0,1,0) model. But the forcast doesn’t capture the trend.</p>
<p>Let’s repeat the next steps for odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years -- Total</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>total.pink_odd<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>pink.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink_odd<span class="sc">$</span>lntotal, </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start=</span>total.pink_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts_odd)) <span class="co">#Looks pretty stationary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts_odd)) <span class="co">#This also looks better</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These look stationary and the ACF looks better.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Train and test for a 10 year period</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>train.pink_odd<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>test.pink_odd<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_odd, <span class="at">trace=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(2,1,2) with drift         : Inf
 ARIMA(0,1,0) with drift         : 4.01998
 ARIMA(1,1,0) with drift         : 5.551776
 ARIMA(0,1,1) with drift         : 4.461601
 ARIMA(0,1,0)                    : 1.771054
 ARIMA(1,1,1) with drift         : Inf

 Best model: ARIMA(0,1,0)                    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fit.final.pink_odd<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_odd, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>fit.final.pink_odd <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink_odd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The best model was the ARIMA(0,1,0) model. But the forcast for only odd years also doesn’t capture the trend.</p>
</section>
</section>
<section id="pinks-regional-considerations" class="level1">
<h1>Pinks: Regional Considerations</h1>
<p>Because of pink salmon life history, for regional models, models with even and odd years were considered separately.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years First </span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Differenced plots for all Regions </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_total =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(total))) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> diff_total)) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in Total Returns"</span>) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Diff by Region (Even Years)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggfortify::ggstat_acf(method = "ma", na.action = na.pass)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Odd Years First </span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Differenced plots for all Regions </span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_total =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(total))) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> diff_total)) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in Total Returns"</span>) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Diff by Region (Odd Years)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To test stationarity outside the auto.arima function , the ADF and KPSS tests were compared for all years, and even and odd years. Note for the ADF null hypothesis is that the system is non-stationary (we want to reject), and the KPSS test null hypothesis is that there is stationarity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Augmented Dicky Fuller </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts, <span class="at">k=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tseries::adf.test(pink.ts, k = 0): p-value smaller than printed
p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  pink.ts
Dickey-Fuller = -6.7912, Lag order = 0, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts_even, <span class="at">k=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  pink.ts_even
Dickey-Fuller = -2.7882, Lag order = 0, p-value = 0.2688
alternative hypothesis: stationary</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts_odd, <span class="at">k=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  pink.ts_odd
Dickey-Fuller = -3.3957, Lag order = 0, p-value = 0.07573
alternative hypothesis: stationary</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tseries::kpss.test(pink.ts, null = c("Level", "Trend")): p-value
smaller than printed p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    KPSS Test for Level Stationarity

data:  pink.ts
KPSS Level = 1.2192, Truncation lag parameter = 3, p-value = 0.01</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts_even, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    KPSS Test for Level Stationarity

data:  pink.ts_even
KPSS Level = 0.64625, Truncation lag parameter = 3, p-value = 0.01843</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts_odd, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    KPSS Test for Level Stationarity

data:  pink.ts_odd
KPSS Level = 0.64278, Truncation lag parameter = 3, p-value = 0.01875</code></pre>
</div>
</div>
<p>A complication is that the data sets split by even and odd years were not passing the tests of stationarity. Perhaps other steps should have been taken.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Functions for Regional ACF and PACF </span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#======================================================</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>ACFandPACF_even<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>ACFandPACF_odd<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) <span class="co">#set Frequency for 0.5</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2014</span><span class="sc">-</span>forelevel</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2014</span>)</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb90-58"><a href="#cb90-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb90-59"><a href="#cb90-59" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a>FitModFunction_even<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-72"><a href="#cb90-72" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) <span class="co">#set Frequency for 0.5</span></span>
<span id="cb90-73"><a href="#cb90-73" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2014</span><span class="sc">-</span>forelevel</span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2014</span>)</span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb90-84"><a href="#cb90-84" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb90-85"><a href="#cb90-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb90-86"><a href="#cb90-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-87"><a href="#cb90-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb90-88"><a href="#cb90-88" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb90-89"><a href="#cb90-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb90-90"><a href="#cb90-90" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb90-91"><a href="#cb90-91" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb90-92"><a href="#cb90-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb90-93"><a href="#cb90-93" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb90-94"><a href="#cb90-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-95"><a href="#cb90-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-96"><a href="#cb90-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-97"><a href="#cb90-97" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb90-98"><a href="#cb90-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb90-99"><a href="#cb90-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb90-100"><a href="#cb90-100" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-101"><a href="#cb90-101" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb90-102"><a href="#cb90-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb90-103"><a href="#cb90-103" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb90-104"><a href="#cb90-104" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-105"><a href="#cb90-105" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-106"><a href="#cb90-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-107"><a href="#cb90-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-108"><a href="#cb90-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb90-109"><a href="#cb90-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-110"><a href="#cb90-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-111"><a href="#cb90-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-112"><a href="#cb90-112" aria-hidden="true" tabindex="-1"></a>FitModFunction_odd<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb90-113"><a href="#cb90-113" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb90-114"><a href="#cb90-114" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb90-115"><a href="#cb90-115" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb90-116"><a href="#cb90-116" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) </span>
<span id="cb90-117"><a href="#cb90-117" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb90-118"><a href="#cb90-118" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb90-119"><a href="#cb90-119" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb90-120"><a href="#cb90-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-121"><a href="#cb90-121" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb90-122"><a href="#cb90-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb90-123"><a href="#cb90-123" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb90-124"><a href="#cb90-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb90-125"><a href="#cb90-125" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-126"><a href="#cb90-126" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb90-127"><a href="#cb90-127" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb90-128"><a href="#cb90-128" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb90-129"><a href="#cb90-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb90-130"><a href="#cb90-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-131"><a href="#cb90-131" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb90-132"><a href="#cb90-132" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb90-133"><a href="#cb90-133" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb90-134"><a href="#cb90-134" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb90-135"><a href="#cb90-135" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb90-136"><a href="#cb90-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb90-137"><a href="#cb90-137" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb90-138"><a href="#cb90-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-139"><a href="#cb90-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-140"><a href="#cb90-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-141"><a href="#cb90-141" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb90-142"><a href="#cb90-142" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb90-143"><a href="#cb90-143" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb90-144"><a href="#cb90-144" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-145"><a href="#cb90-145" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb90-146"><a href="#cb90-146" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb90-147"><a href="#cb90-147" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb90-148"><a href="#cb90-148" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-149"><a href="#cb90-149" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb90-150"><a href="#cb90-150" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-151"><a href="#cb90-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-152"><a href="#cb90-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb90-153"><a href="#cb90-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-154"><a href="#cb90-154" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-155"><a href="#cb90-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-156"><a href="#cb90-156" aria-hidden="true" tabindex="-1"></a><span class="co">#================================================================</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next step is to then define the regions</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#regions vector</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(PinkByRegion<span class="sc">$</span>region)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#regions key</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Japan"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions <span class="co">#for plotting</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through regions/levels</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>DiagPlots_even<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF_even)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots_even)<span class="ot">&lt;-</span>regions</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>DiagPlots_odd<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF_odd)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots_odd)<span class="ot">&lt;-</span>regions   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lets look at the regional breakdowns of ACF and PACF, first for all years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The ACFs for regions show different levels of lag or total correlation. Let’s look for even years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_even[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_even[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And then for odd years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_odd[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_odd[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The next step is to look at the ARIMA models for regions by all years, even and odd years, and define forecast levels. Let’s start with all years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast levels</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#all combinations</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#================================================</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co">#All</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>RegionMods<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co"># head(RegionMods_even)</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co"># names(RegionMods_even)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s consider even years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>RegionMods_even<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction_even, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RegionMods_even)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$ci
$ci$Fit
Series: train 
ARIMA(0,1,0) 

sigma^2 = 0.3224:  log likelihood = -23.88
AIC=49.77   AICc=49.92   BIC=51.1

$ci$MASE
[1] 0.3602762

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,1,0)                      55.48062 55.48062        0 0, 1, 0    0


$ci
$ci$Fit
Series: train 
ARIMA(0,1,0) 

sigma^2 = 0.3052:  log likelihood = -21.47
AIC=44.93   AICc=45.1   BIC=46.19

$ci$MASE
[1] 1.243461

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,1,0)                      55.48062 55.48062        0 0, 1, 0    0


$ci
$ci$Fit
Series: train 
ARIMA(0,1,0) 

sigma^2 = 0.2563:  log likelihood = -15.5
AIC=33.01   AICc=33.22   BIC=34.05

$ci$MASE
[1] 0.3950404

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,1,0)                      55.48062 55.48062        0 0, 1, 0    0


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,0,0) with non-zero mean 

Coefficients:
        mean
      2.6102
s.e.  0.1257

sigma^2 = 0.4743:  log likelihood = -29.83
AIC=63.65   AICc=64.11   BIC=66.39

$e_kam$MASE
[1] 0.2398603

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,0,0) with non-zero mean   71.15545 71.15545  0.43946 0, 0, 0    0
2  ARIMA(1,0,0) with non-zero mean   72.55604 72.55604  1.84005 1, 0, 0    1
3  ARIMA(0,0,1) with non-zero mean   70.71599 70.71599  0.00000 0, 0, 1    1
4  ARIMA(1,0,1) with non-zero mean   72.39343 72.39343  1.67744 1, 0, 1    2
5  ARIMA(0,0,2) with non-zero mean   71.53128 71.53128  0.81529 0, 0, 2    2


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,0,0) with non-zero mean 

Coefficients:
        mean
      2.5867
s.e.  0.1318

sigma^2 = 0.4873:  log likelihood = -28.1
AIC=60.19   AICc=60.69   BIC=62.79

$e_kam$MASE
[1] 0.219349

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,0,0) with non-zero mean   71.15545 71.15545  0.43946 0, 0, 0    0
2  ARIMA(1,0,0) with non-zero mean   72.55604 72.55604  1.84005 1, 0, 0    1
3  ARIMA(0,0,1) with non-zero mean   70.71599 70.71599  0.00000 0, 0, 1    1
4  ARIMA(1,0,1) with non-zero mean   72.39343 72.39343  1.67744 1, 0, 1    2
5  ARIMA(0,0,2) with non-zero mean   71.53128 71.53128  0.81529 0, 0, 2    2


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,0,0) with non-zero mean 

Coefficients:
        mean
      2.6917
s.e.  0.1209

sigma^2 = 0.337:  log likelihood = -18.74
AIC=41.48   AICc=42.12   BIC=43.67

$e_kam$MASE
[1] 0.2382605

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(0,0,0) with non-zero mean   71.15545 71.15545  0.43946 0, 0, 0    0
2  ARIMA(1,0,0) with non-zero mean   72.55604 72.55604  1.84005 1, 0, 0    1
3  ARIMA(0,0,1) with non-zero mean   70.71599 70.71599  0.00000 0, 0, 1    1
4  ARIMA(1,0,1) with non-zero mean   72.39343 72.39343  1.67744 1, 0, 1    2
5  ARIMA(0,0,2) with non-zero mean   71.53128 71.53128  0.81529 0, 0, 2    2</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(RegionMods_even) #should be three for each region</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s consider odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd </span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>RegionMods_odd<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction_odd, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RegionMods_odd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$ci
$ci$Fit
Series: train 
ARIMA(1,0,0) with zero mean 

Coefficients:
         ar1
      0.6039
s.e.  0.1467

sigma^2 = 0.4057:  log likelihood = -27.79
AIC=59.57   AICc=60.03   BIC=62.31

$ci$MASE
[1] 2.144842

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,0,0) with non-zero mean    75.3159 75.31590  0.36364 1, 0, 0    1
2  ARIMA(1,0,0) with zero mean       74.95226 74.95226  0.00000 1, 0, 0    1


$ci
$ci$Fit
Series: train 
ARIMA(1,0,0) with zero mean 

Coefficients:
         ar1
      0.6037
s.e.  0.1610

sigma^2 = 0.4189:  log likelihood = -26.28
AIC=56.57   AICc=57.07   BIC=59.16

$ci$MASE
[1] 1.555645

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,0,0) with non-zero mean    75.3159 75.31590  0.36364 1, 0, 0    1
2  ARIMA(1,0,0) with zero mean       74.95226 74.95226  0.00000 1, 0, 0    1


$ci
$ci$Fit
Series: train 
ARIMA(1,0,0) with zero mean 

Coefficients:
         ar1
      0.6430
s.e.  0.1528

sigma^2 = 0.3645:  log likelihood = -19.87
AIC=43.74   AICc=44.37   BIC=45.93

$ci$MASE
[1] 1.425649

$ci$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,0,0) with non-zero mean    75.3159 75.31590  0.36364 1, 0, 0    1
2  ARIMA(1,0,0) with zero mean       74.95226 74.95226  0.00000 1, 0, 0    1


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,1,0) 

sigma^2 = 0.1936:  log likelihood = -16.75
AIC=35.49   AICc=35.65   BIC=36.82

$e_kam$MASE
[1] 0.1721234

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,1,0) with drift           60.55848 60.55848  1.02617 1, 1, 0    2
2  ARIMA(0,1,0)                      59.53231 59.53231  0.00000 0, 1, 0    0


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,0,1) with non-zero mean 

Coefficients:
         ma1    mean
      0.5514  3.9961
s.e.  0.1250  0.1117

sigma^2 = 0.1551:  log likelihood = -12.29
AIC=30.59   AICc=31.63   BIC=34.48

$e_kam$MASE
[1] 0.2364036

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,1,0) with drift           60.55848 60.55848  1.02617 1, 1, 0    2
2  ARIMA(0,1,0)                      59.53231 59.53231  0.00000 0, 1, 0    0


$e_kam
$e_kam$Fit
Series: train 
ARIMA(0,0,1) with non-zero mean 

Coefficients:
         ma1    mean
      0.5404  3.9140
s.e.  0.1481  0.1168

sigma^2 = 0.1433:  log likelihood = -8.97
AIC=23.94   AICc=25.28   BIC=27.21

$e_kam$MASE
[1] 0.1918676

$e_kam$Bm
                                 V1        V2      AIC DeltaAIC     Mod npar
1  ARIMA(1,1,0) with drift           60.55848 60.55848  1.02617 1, 1, 0    2
2  ARIMA(0,1,0)                      59.53231 59.53231  0.00000 0, 1, 0    0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#names(RegionMods_odd) #should be three for each region</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, we’re extracting the MASE and creating our final model tables</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#getting MASE</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co">#All</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>RegionMASE<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>RegionBestMod<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>RegionMASE_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_even, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>RegionBestMod_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_even, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>RegionMASE_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_odd, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>RegionBestMod_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_odd, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co">#combine into tables</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>ResultsTable<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod, <span class="at">MASE =</span> RegionMASE)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>ResultsTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 4
   regions forecastlevels Model                            MASE
   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt;
 1 ci                   5 ARIMA(2,0,0) with non-zero mean 0.460
 2 ci                  10 ARIMA(2,0,0) with non-zero mean 0.549
 3 ci                  20 ARIMA(1,0,1) with non-zero mean 0.711
 4 e_kam                5 ARIMA(2,0,0) with non-zero mean 0.134
 5 e_kam               10 ARIMA(2,0,0) with non-zero mean 0.111
 6 e_kam               20 ARIMA(2,0,0) with non-zero mean 0.196
 7 japan                5 ARIMA(0,0,0) with non-zero mean 0.744
 8 japan               10 ARIMA(0,0,0) with non-zero mean 0.901
 9 japan               20 ARIMA(0,1,1)                    0.853
10 kod                  5 ARIMA(0,1,1) with drift         0.221
# ℹ 26 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#even</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>ResultsTable_even<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod_even, <span class="at">MASE =</span> RegionMASE_even)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>ResultsTable_even</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 4
   regions forecastlevels Model                            MASE
   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt;
 1 ci                   5 ARIMA(0,1,0)                    0.360
 2 ci                  10 ARIMA(0,1,0)                    1.24 
 3 ci                  20 ARIMA(0,1,0)                    0.395
 4 e_kam                5 ARIMA(0,0,0) with non-zero mean 0.240
 5 e_kam               10 ARIMA(0,0,0) with non-zero mean 0.219
 6 e_kam               20 ARIMA(0,0,0) with non-zero mean 0.238
 7 japan                5 ARIMA(0,1,0)                    0.743
 8 japan               10 ARIMA(0,1,0)                    0.500
 9 japan               20 ARIMA(1,0,0) with non-zero mean 0.731
10 kod                  5 ARIMA(0,0,0) with non-zero mean 0.155
# ℹ 26 more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>ResultsTable_odd<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod_odd, <span class="at">MASE =</span> RegionMASE_odd)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>ResultsTable_odd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 4
   regions forecastlevels Model                            MASE
   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt;
 1 ci                   5 ARIMA(1,0,0) with zero mean     2.14 
 2 ci                  10 ARIMA(1,0,0) with zero mean     1.56 
 3 ci                  20 ARIMA(1,0,0) with zero mean     1.43 
 4 e_kam                5 ARIMA(0,1,0)                    0.172
 5 e_kam               10 ARIMA(0,0,1) with non-zero mean 0.236
 6 e_kam               20 ARIMA(0,0,1) with non-zero mean 0.192
 7 japan                5 ARIMA(1,1,0)                    0.898
 8 japan               10 ARIMA(0,1,0)                    0.557
 9 japan               20 ARIMA(1,0,0) with non-zero mean 0.550
10 kod                  5 ARIMA(0,1,0)                    0.124
# ℹ 26 more rows</code></pre>
</div>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="sockeye" class="level2">
<h2 class="anchored" data-anchor-id="sockeye">Sockeye:</h2>
<p>Plot MASE for three different forecast periods - 5, 10, and 20 years - across all regions. MASE &lt; 1 is a “good” value.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>None of the ARIMA models performed well for the forecasts of 20 years of data. Below is a comparison of the three lengths of forecasted data for South British Columbia where MASE was below 1 for the 5 year forecast but &gt;1 for the 10 and 20 year forecasts.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>sock.sbc<span class="ot">&lt;-</span><span class="fu">subset</span>(SockByRegion, region<span class="sc">==</span><span class="st">'sbc'</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>sbc.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(sock.sbc<span class="sc">$</span>lnreturns, <span class="at">start=</span>sock.sbc<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5, 10, and 20 year forecasts</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>train.sbc5<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>test.sbc5<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>sbc.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>train.sbc10<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>test.sbc10<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>sbc.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>train.sbc20<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>test.sbc20<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>sbc.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are plots of the three forecast scenarios for sockeye in South British Columbia.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-51-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-51-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at stationarity:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestModSock, <span class="cf">function</span>(x){</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Sockeye)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For Sockeye, 6 regions required differencing for all of the three subsets of the data (3 forecasting levels). Two regions required differencing for one subset of the data; four regions were stationary at any level of subsetting.</p>
<p>None of the regional models for the 5-year forecast had autocorrelation in the residuals based on the results of the Ljung-Box test (p-value &gt; 0.05).</p>
</section>
<section id="chum" class="level2">
<h2 class="anchored" data-anchor-id="chum">Chum:</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTableChum) <span class="sc">+</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Chum"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Many of the 5 and 10 year forecasts for Chum seem to perform well across regions. Models fit to data in Russia do the worst at forecasting in that region. Additionally, forecasts are poor across the different numbers of years tested in E. Kamachatka, SE Alaska and W. Kamachatka.</p>
<p>20 year forecast for Kodiak:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>chum.kod<span class="ot">&lt;-</span><span class="fu">subset</span>(ChumByRegion, region<span class="sc">==</span><span class="st">'kod'</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>chum.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(chum.kod<span class="sc">$</span>lnreturns, <span class="at">start=</span>chum.kod<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">#test datasets for plotting</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>test.kod20<span class="ot">&lt;-</span><span class="fu">window</span>(chum.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(RegionModsChum[[<span class="dv">9</span>]]<span class="sc">$</span>Fit, <span class="at">h =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.kod20))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>10 year forecast for Russia:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>chum.russ<span class="ot">&lt;-</span><span class="fu">subset</span>(ChumByRegion, region<span class="sc">==</span><span class="st">'m_i'</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>chum.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(chum.russ<span class="sc">$</span>lnreturns, <span class="at">start=</span>chum.russ<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">#test datasets for plotting</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>test.russ10<span class="ot">&lt;-</span><span class="fu">window</span>(chum.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(RegionModsChum[[<span class="dv">11</span>]]<span class="sc">$</span>Fit, <span class="at">h =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.russ10))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It looks like returns really increase at the end of the time series in this region, which is likely why ARIMA models don’t forecast this well.</p>
<p>Looking at stationarity:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestModChum, <span class="cf">function</span>(x){</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Chum)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For Chum, time series for 5 of the regions were stationary (using tests from auto.arima) and 7 required 1 difference to be stationary.</p>
<p>There was significant autocorrelation (based on Ljung-Box test) in 4 of the regional models for Chum:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>ac_mods_chum<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">31</span>, <span class="dv">32</span>) <span class="co">#indexes of models with autocorrelated residuals</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_chum)){</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTableChum<span class="sc">$</span>regions[ac_mods_chum[i]]], ResultsTableChum<span class="sc">$</span>forecastlevels[ac_mods_chum[i]]))</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkresiduals</span>(RegionModsChum[[ac_mods_chum[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SE Alaska 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,0,0) with non-zero mean
Q* = 25.498, df = 9, p-value = 0.002467

Model df: 1.   Total lags used: 10

[1] "SE Alaska 20"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(1,0,0) with non-zero mean
Q* = 15.578, df = 8, p-value = 0.04884

Model df: 1.   Total lags used: 9

[1] "NA 5"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-57-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1)
Q* = 35.287, df = 9, p-value = 5.302e-05

Model df: 1.   Total lags used: 10

[1] "NA 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-57-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1)
Q* = 34.843, df = 9, p-value = 6.35e-05

Model df: 1.   Total lags used: 10</code></pre>
</div>
</div>
<p>This suggests that ARIMA models may not be the best fit in this instance.</p>
</section>
<section id="pink" class="level2">
<h2 class="anchored" data-anchor-id="pink">Pink:</h2>
<p>Plot MASE for three different forecast periods - 5, 10, and 20 years - across all regions. MASE &lt; 1 is a “good” value.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable) <span class="sc">+</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks all Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable_even) <span class="sc">+</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks Even Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable_odd) <span class="sc">+</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks Odd Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-58-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Despite the MASE fits seeming pretty good for the pink model runs some of the forecasts were underwhelming. Two regions were considered for forcasts, Cook Inlet, and SE Alaska with models that included for all years, even years, and odd years.</p>
<p>The first region, Cook Inlet, performed poorly (relative to some of the other regions) when looking at MASE values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cook Inlet</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>pink.ci<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>ci.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>train.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>test.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>ci.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>train.ci10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>test.ci10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>ci.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>train.ci20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>test.ci20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>ci.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years</span></span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>pink.ci_even<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_even, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>ci.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci_even<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci_even<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a>train.ci_even5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>test.ci_even5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>ci_even.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a>train.ci_even10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a>test.ci_even10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a>ci_even.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>train.ci_even20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a>test.ci_even20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a>ci_even.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb126-43"><a href="#cb126-43" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years</span></span>
<span id="cb126-44"><a href="#cb126-44" aria-hidden="true" tabindex="-1"></a>pink.ci_odd<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_odd, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb126-45"><a href="#cb126-45" aria-hidden="true" tabindex="-1"></a>ci.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci_odd<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb126-46"><a href="#cb126-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-47"><a href="#cb126-47" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb126-48"><a href="#cb126-48" aria-hidden="true" tabindex="-1"></a>train.ci_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2009</span>)</span>
<span id="cb126-49"><a href="#cb126-49" aria-hidden="true" tabindex="-1"></a>test.ci_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-50"><a href="#cb126-50" aria-hidden="true" tabindex="-1"></a>ci_odd.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-51"><a href="#cb126-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-52"><a href="#cb126-52" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb126-53"><a href="#cb126-53" aria-hidden="true" tabindex="-1"></a>train.ci_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb126-54"><a href="#cb126-54" aria-hidden="true" tabindex="-1"></a>test.ci_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-55"><a href="#cb126-55" aria-hidden="true" tabindex="-1"></a>ci_odd.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb126-56"><a href="#cb126-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-57"><a href="#cb126-57" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb126-58"><a href="#cb126-58" aria-hidden="true" tabindex="-1"></a>train.ci_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb126-59"><a href="#cb126-59" aria-hidden="true" tabindex="-1"></a>test.ci_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1997</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb126-60"><a href="#cb126-60" aria-hidden="true" tabindex="-1"></a>ci_odd.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at forcast plots for the best performing models that consider all data, even years, and odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plots</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> ci.final5 <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci5))</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>plot_10 <span class="ot">&lt;-</span> ci.final10 <span class="sc">%&gt;%</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci10))</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>plot_20 <span class="ot">&lt;-</span> ci.final20 <span class="sc">%&gt;%</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci20))</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>plot_even_5 <span class="ot">&lt;-</span> ci_even.final5 <span class="sc">%&gt;%</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even5))</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>plot_even_10 <span class="ot">&lt;-</span> ci_even.final10 <span class="sc">%&gt;%</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even10))</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>plot_even_20 <span class="ot">&lt;-</span> ci_even.final20 <span class="sc">%&gt;%</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even20))</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>plot_odd_5 <span class="ot">&lt;-</span> ci_odd.final5 <span class="sc">%&gt;%</span></span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd5))</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>plot_odd_10 <span class="ot">&lt;-</span> ci_odd.final10 <span class="sc">%&gt;%</span></span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd10))</span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>plot_odd_20 <span class="ot">&lt;-</span> ci_odd.final20 <span class="sc">%&gt;%</span></span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd20))</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_5, plot_10, plot_20, plot_even_5, plot_even_10, plot_even_20, plot_odd_5, plot_odd_10, plot_odd_20, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>None of the models fit well. Let’s look at one more region.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#SE AK</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>pink.seak<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>seak.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>train.seak5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>test.seak5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>seak.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>train.seak10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>test.seak10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>seak.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>train.seak20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>test.seak20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>seak.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>pink.seak_even<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_even, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>seak.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak_even<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak_even<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>train.seak_even5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>test.seak_even5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">2012</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>seak_even.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>train.seak_even10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2004</span>)</span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>test.seak_even10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>seak_even.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>train.seak_even20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1994</span>)</span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a>test.seak_even20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>seak_even.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a>pink.seak_odd<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_odd, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a>seak.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak_odd<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a>train.seak_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2009</span>)</span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a>test.seak_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a>seak_odd.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a>train.seak_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a>test.seak_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a>seak_odd.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a>train.seak_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a>test.seak_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1997</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a>seak_odd.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at forcast plots for the best performing models that consider all data, even years, and odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plots </span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> seak.final5 <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak5))</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>plot_10 <span class="ot">&lt;-</span> seak.final10 <span class="sc">%&gt;%</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak10))</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>plot_20 <span class="ot">&lt;-</span> seak.final20 <span class="sc">%&gt;%</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak20))</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>plot_even_5 <span class="ot">&lt;-</span> seak_even.final5 <span class="sc">%&gt;%</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even5))</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>plot_even_10 <span class="ot">&lt;-</span> seak_even.final10 <span class="sc">%&gt;%</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even10))</span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>plot_even_20 <span class="ot">&lt;-</span> seak_even.final20 <span class="sc">%&gt;%</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even20))</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>plot_odd_5 <span class="ot">&lt;-</span> seak_odd.final5 <span class="sc">%&gt;%</span></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd5))</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>plot_odd_10 <span class="ot">&lt;-</span> seak_odd.final10 <span class="sc">%&gt;%</span></span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd10))</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>plot_odd_20 <span class="ot">&lt;-</span> seak_odd.final20 <span class="sc">%&gt;%</span></span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd20))</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_5, plot_10, plot_20, plot_even_5, plot_even_10, plot_even_20, plot_odd_5, plot_odd_10, plot_odd_20, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These models were all pretty flat and also didn’t seem to capture the trends particularly well.</p>
<p>Next, the number of models that had a differencing was plotted for all years, even years, and odd years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years </span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod, <span class="cf">function</span>(x){</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-All Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>Ndiff_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod_even, <span class="cf">function</span>(x){</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff_even, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-Even Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-63-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>Ndiff_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod_odd, <span class="cf">function</span>(x){</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff_odd, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-Odd Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-63-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When considering models that used all data, five regions needed differencing. In models that considered even years only, six regions needed differencing. In models that considered odd years only, ten regions needed differencing.</p>
<p>Finally we’re going to look at some residuals for models that displayed autocorraltion based on Ljung-Box test. There were only</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Residuals </span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">29</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink)){</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable<span class="sc">$</span>regions[ac_mods_Pink[i]]], ResultsTable_even<span class="sc">$</span>forecastlevels[ac_mods_Pink[i]]))</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(RegionMods[[ac_mods_Pink[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Kodiak 5"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1) with drift
Q* = 12.949, df = 5, p-value = 0.02386

Model df: 1.   Total lags used: 6

[1] "Kodiak 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1) with drift
Q* = 13.668, df = 4, p-value = 0.008432

Model df: 1.   Total lags used: 5

[1] "Russia 20"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,0,0) with non-zero mean
Q* = 13.669, df = 4, p-value = 0.008429

Model df: 0.   Total lags used: 4

[1] "SE Alaska 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1) with drift
Q* = 7.1988, df = 4, p-value = 0.1257

Model df: 1.   Total lags used: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink_even<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">20</span>) </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink_even)){</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable_even<span class="sc">$</span>regions[ac_mods_Pink_even[i]]], ResultsTable_even<span class="sc">$</span>forecastlevels[ac_mods_Pink_even[i]]))</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(RegionMods_even[[ac_mods_Pink_even[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Prince William Sound 5"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,0,0) with non-zero mean
Q* = 19.847, df = 6, p-value = 0.002949

Model df: 0.   Total lags used: 6

[1] "Prince William Sound 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,0,0) with non-zero mean
Q* = 11.944, df = 5, p-value = 0.03556

Model df: 0.   Total lags used: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink_odd<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">8</span>) </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink_odd)){</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable_odd<span class="sc">$</span>regions[ac_mods_Pink_odd[i]]], ResultsTable_odd<span class="sc">$</span>forecastlevels[ac_mods_Pink_odd[i]]))</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkresiduals</span>(RegionMods_odd[[ac_mods_Pink_odd[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Japan 10"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-1-team-3_final_files/figure-html/unnamed-chunk-64-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,0)
Q* = 11.71, df = 5, p-value = 0.03899

Model df: 0.   Total lags used: 5</code></pre>
</div>
</div>
<p>#———————————————————————</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>Comparing the models across the three forecasts for SBC underlines that the data chosen for a forecast matters. Not only is the estimated ARIMA a better fit for a shorter forecast (and is trained on more data), but the training data for the model for the 20 year forecast is not stationary so the ARIMA parameters are very different from the parameters estimated for the 5 and 10 year forecasts.</p>
<p>For sockeye, six regions had at least one forecast with a well performing model (MASE &lt; 1); however, six regions did not have MASE &lt; 1 for even the 5 year forecast model. None of the 20 year forecasts resulted in MASE &lt; 1. This suggests that our data are so stochastic that it is difficult to forecast more than 5 years into the future. Another hypothesis could be that the training data set isn’t long enough to generate a good model for the 20 year forecast, but from looking at the data we think the large inter-year variability in returns makes it difficult to fit an accurate model. In general, the models that fit the data better (lower MASE) tended to include differencing and were more likely to have higher order parameters.</p>
<p>Models fit to Chum do better than models fit to Sockeye. There may be something about the patterns of chum population fluctuations that are more amenable to being modeled with ARIMA.</p>
<p>Model fits to pink depended on data assumptions given their cyclic life history, and while the MASE results were lower than the other stock, ARIMA models are likely not the appropriate method for assessing or predicting pinnk returns with any level of certainty.</p>
</section>
<section id="description-of-each-team-members-contributions" class="level1">
<h1>Description of each team member’s contributions</h1>
<p>All team members helped decide on the goal and ran the analyses for the individual species and all regions. All team members wrote the code and created the results for one species. ZR researched approaches for measuring accuracy of forecasts and created functions to run the ARIMA models over multiple regions and select the best model (even if it was different than selected by auto.arima). ETS and MS modified this code to work with their own species. All team members helped write and edit the report.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb146" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Team 3 - Lab 1</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Lab 1 Forecasting with ARIMA models</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Zoe Rand, Madison Shipley, Emma Timmins-Schiffman"</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE, error=FALSE, }</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>We chose to work with all data to compare ability of the ARIMA models to forecast across different patterns of population dynamics and different sizes of training data sets.</span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>ruggerone_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-1"</span>, <span class="st">"Data_Images"</span>, <span class="st">"ruggerone_data.rds"</span>))</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a><span class="co">#The above code was not working for me, so I've added this in temporarily (MS)</span></span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a><span class="co">#ruggerone_data &lt;- readRDS("C:/GitHub/fish550-2023/Lab-1/Data_Images/ruggerone_data.rds")</span></span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-36"><a href="#cb146-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-37"><a href="#cb146-37" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question your team will address</span></span>
<span id="cb146-38"><a href="#cb146-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-39"><a href="#cb146-39" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>If we approached these data as stock managers, how confident could we be in projected return data 5, 10, or 20 years into the future?</span>
<span id="cb146-40"><a href="#cb146-40" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>What types of population patterns are ARIMA models best suited for?</span>
<span id="cb146-41"><a href="#cb146-41" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Is one species or region "easier" to forecast than others?</span>
<span id="cb146-42"><a href="#cb146-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-43"><a href="#cb146-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Initial plan</span></span>
<span id="cb146-44"><a href="#cb146-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-45"><a href="#cb146-45" aria-hidden="true" tabindex="-1"></a>For each species we will subset by region and test for stationarity. Then for forecast levels of 5, 10, and 20 years for each region, we will run auto-arima. We will look at forecasts and accuracy using RMSE to determine what level of for asting could be appropriate when considering management utility.</span>
<span id="cb146-46"><a href="#cb146-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-47"><a href="#cb146-47" aria-hidden="true" tabindex="-1"></a>We will pick a couple of regions for each species to demonstrate ACF and PACF, and look through model results for any residuals.</span>
<span id="cb146-48"><a href="#cb146-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-49"><a href="#cb146-49" aria-hidden="true" tabindex="-1"></a><span class="fu"># What we actually did</span></span>
<span id="cb146-50"><a href="#cb146-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-51"><a href="#cb146-51" aria-hidden="true" tabindex="-1"></a>It was harder to compare models across species and regions than we assumed. We created functions to help streamline this process. Also after researching forecast accuracy metrics, we decided to use MASE as a metric instead of RMSE. It was difficult to decipher why some regions were more easily forecasted and others returned unreliable results. Additionally, each species had different dynamics, and some variable methods were applied in order to find a model that worked. </span>
<span id="cb146-52"><a href="#cb146-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-53"><a href="#cb146-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sockeye: Combined Regions</span></span>
<span id="cb146-54"><a href="#cb146-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-55"><a href="#cb146-55" aria-hidden="true" tabindex="-1"></a>Subset and format the data to analyze just sockeye.</span>
<span id="cb146-56"><a href="#cb146-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-57"><a href="#cb146-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE}</span></span>
<span id="cb146-58"><a href="#cb146-58" aria-hidden="true" tabindex="-1"></a>SockByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb146-59"><a href="#cb146-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"japan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-60"><a href="#cb146-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-61"><a href="#cb146-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb146-62"><a href="#cb146-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-63"><a href="#cb146-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb146-64"><a href="#cb146-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"sockeye"</span>)</span>
<span id="cb146-65"><a href="#cb146-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-66"><a href="#cb146-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-67"><a href="#cb146-67" aria-hidden="true" tabindex="-1"></a>Create a time series object and train the data on the first 59 years of data; forecast the last 5 years.</span>
<span id="cb146-68"><a href="#cb146-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-71"><a href="#cb146-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-72"><a href="#cb146-72" aria-hidden="true" tabindex="-1"></a>sockeye.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(SockByRegion<span class="sc">$</span>lnreturns, <span class="at">start=</span>SockByRegion<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-73"><a href="#cb146-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-74"><a href="#cb146-74" aria-hidden="true" tabindex="-1"></a>train.sockeye<span class="ot">&lt;-</span><span class="fu">window</span>(sockeye.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-75"><a href="#cb146-75" aria-hidden="true" tabindex="-1"></a>test.sockeye<span class="ot">&lt;-</span><span class="fu">window</span>(sockeye.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-76"><a href="#cb146-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-77"><a href="#cb146-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-78"><a href="#cb146-78" aria-hidden="true" tabindex="-1"></a>Assess the ACF and PACF of the training data set.</span>
<span id="cb146-79"><a href="#cb146-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-80"><a href="#cb146-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-81"><a href="#cb146-81" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(train.sockeye)</span>
<span id="cb146-82"><a href="#cb146-82" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(train.sockeye)</span>
<span id="cb146-83"><a href="#cb146-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-84"><a href="#cb146-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-85"><a href="#cb146-85" aria-hidden="true" tabindex="-1"></a>Look at the options for fitting an ARIMA to the data and then choose a final model. The best model for both of these is ARIMA(0,1,2); however, a comparison with other models suggests that ARIMA(1,1,1) is also a good fit with AIC within 0.3 of the ARIMA(0,1,2). The full dataset requires differencing (d=1).</span>
<span id="cb146-86"><a href="#cb146-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-89"><a href="#cb146-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-90"><a href="#cb146-90" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sockeye, <span class="at">trace=</span>T)</span>
<span id="cb146-91"><a href="#cb146-91" aria-hidden="true" tabindex="-1"></a>fit.final.sock<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sockeye, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-92"><a href="#cb146-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-93"><a href="#cb146-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-94"><a href="#cb146-94" aria-hidden="true" tabindex="-1"></a>Plot the 5 year forecast for the last part of the dataset compared to the actual data. The real data are represented by the black dots; the forecast is represented by the black line.</span>
<span id="cb146-95"><a href="#cb146-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-96"><a href="#cb146-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-97"><a href="#cb146-97" aria-hidden="true" tabindex="-1"></a>fit.final.sock <span class="sc">%&gt;%</span></span>
<span id="cb146-98"><a href="#cb146-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-99"><a href="#cb146-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.sockeye))</span>
<span id="cb146-100"><a href="#cb146-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-101"><a href="#cb146-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-102"><a href="#cb146-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assess how well forecasting performs for sockeye returns by region</span></span>
<span id="cb146-103"><a href="#cb146-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-104"><a href="#cb146-104" aria-hidden="true" tabindex="-1"></a>Create objects needed for plotting.</span>
<span id="cb146-105"><a href="#cb146-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-108"><a href="#cb146-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-109"><a href="#cb146-109" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(SockByRegion<span class="sc">$</span>region)</span>
<span id="cb146-110"><a href="#cb146-110" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb146-111"><a href="#cb146-111" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"Washington"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb146-112"><a href="#cb146-112" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions</span>
<span id="cb146-113"><a href="#cb146-113" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb146-114"><a href="#cb146-114" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span>
<span id="cb146-115"><a href="#cb146-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-116"><a href="#cb146-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-117"><a href="#cb146-117" aria-hidden="true" tabindex="-1"></a>Plot ACF and PACF for each region.</span>
<span id="cb146-118"><a href="#cb146-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-119"><a href="#cb146-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results='hide'}</span></span>
<span id="cb146-120"><a href="#cb146-120" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb146-121"><a href="#cb146-121" aria-hidden="true" tabindex="-1"></a>  Sockdat<span class="ot">&lt;-</span>SockByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-122"><a href="#cb146-122" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-123"><a href="#cb146-123" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Sockdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Sockdat<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-124"><a href="#cb146-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb146-125"><a href="#cb146-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-126"><a href="#cb146-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-127"><a href="#cb146-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-130"><a href="#cb146-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-131"><a href="#cb146-131" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb146-132"><a href="#cb146-132" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span>
<span id="cb146-133"><a href="#cb146-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-134"><a href="#cb146-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-135"><a href="#cb146-135" aria-hidden="true" tabindex="-1"></a>ACF plots</span>
<span id="cb146-136"><a href="#cb146-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-137"><a href="#cb146-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-138"><a href="#cb146-138" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-139"><a href="#cb146-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-140"><a href="#cb146-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-141"><a href="#cb146-141" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-142"><a href="#cb146-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-143"><a href="#cb146-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-144"><a href="#cb146-144" aria-hidden="true" tabindex="-1"></a>PACF plots</span>
<span id="cb146-145"><a href="#cb146-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-146"><a href="#cb146-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-147"><a href="#cb146-147" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-148"><a href="#cb146-148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-149"><a href="#cb146-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-150"><a href="#cb146-150" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-151"><a href="#cb146-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-152"><a href="#cb146-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-153"><a href="#cb146-153" aria-hidden="true" tabindex="-1"></a>Fit ARIMA models to each region.</span>
<span id="cb146-154"><a href="#cb146-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-157"><a href="#cb146-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-158"><a href="#cb146-158" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb146-159"><a href="#cb146-159" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb146-160"><a href="#cb146-160" aria-hidden="true" tabindex="-1"></a>  Sockdat<span class="ot">&lt;-</span>SockByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-161"><a href="#cb146-161" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-162"><a href="#cb146-162" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Sockdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Sockdat<span class="sc">$</span>year[<span class="dv">1</span>]) <span class="co">#this assumes the first year in data is the start of the time series (they are in order) </span></span>
<span id="cb146-163"><a href="#cb146-163" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb146-164"><a href="#cb146-164" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, <span class="dv">1952</span>, cutoff)</span>
<span id="cb146-165"><a href="#cb146-165" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb146-166"><a href="#cb146-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-167"><a href="#cb146-167" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb146-168"><a href="#cb146-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-169"><a href="#cb146-169" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb146-170"><a href="#cb146-170" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb146-171"><a href="#cb146-171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb146-172"><a href="#cb146-172" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-173"><a href="#cb146-173" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb146-174"><a href="#cb146-174" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb146-175"><a href="#cb146-175" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb146-176"><a href="#cb146-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb146-177"><a href="#cb146-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-178"><a href="#cb146-178" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb146-179"><a href="#cb146-179" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb146-180"><a href="#cb146-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb146-181"><a href="#cb146-181" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-182"><a href="#cb146-182" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb146-183"><a href="#cb146-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb146-184"><a href="#cb146-184" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb146-185"><a href="#cb146-185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-186"><a href="#cb146-186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-187"><a href="#cb146-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-188"><a href="#cb146-188" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb146-189"><a href="#cb146-189" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb146-190"><a href="#cb146-190" aria-hidden="true" tabindex="-1"></a>      <span class="co">#auto arima picked the best model</span></span>
<span id="cb146-191"><a href="#cb146-191" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-192"><a href="#cb146-192" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb146-193"><a href="#cb146-193" aria-hidden="true" tabindex="-1"></a>      <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb146-194"><a href="#cb146-194" aria-hidden="true" tabindex="-1"></a>      newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb146-195"><a href="#cb146-195" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-196"><a href="#cb146-196" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-197"><a href="#cb146-197" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-198"><a href="#cb146-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-199"><a href="#cb146-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb146-200"><a href="#cb146-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-201"><a href="#cb146-201" aria-hidden="true" tabindex="-1"></a>RegionModsSock<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-202"><a href="#cb146-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-203"><a href="#cb146-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-204"><a href="#cb146-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-205"><a href="#cb146-205" aria-hidden="true" tabindex="-1"></a>Extract MASE for comparisons of models across regions.</span>
<span id="cb146-206"><a href="#cb146-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-209"><a href="#cb146-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-210"><a href="#cb146-210" aria-hidden="true" tabindex="-1"></a>RegionMASESock<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsSock, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb146-211"><a href="#cb146-211" aria-hidden="true" tabindex="-1"></a>RegionBestModSock<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsSock, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb146-212"><a href="#cb146-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-213"><a href="#cb146-213" aria-hidden="true" tabindex="-1"></a>ResultsTableSock<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestModSock, <span class="at">MASE =</span> RegionMASESock)</span>
<span id="cb146-214"><a href="#cb146-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-215"><a href="#cb146-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-216"><a href="#cb146-216" aria-hidden="true" tabindex="-1"></a>How well does auto.arima do in choosing a model? Is it different from what we would choose looking at ACF and PACF? For Cook Inlet, auto.arima selected ARIMA(4,1,1), but PACF has a significant lag at 6 and ACF trails off.</span>
<span id="cb146-217"><a href="#cb146-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-220"><a href="#cb146-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-221"><a href="#cb146-221" aria-hidden="true" tabindex="-1"></a>sock.ci<span class="ot">&lt;-</span><span class="fu">subset</span>(SockByRegion, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb146-222"><a href="#cb146-222" aria-hidden="true" tabindex="-1"></a>ci.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(sock.ci<span class="sc">$</span>lnreturns, <span class="at">start=</span>sock.ci<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-223"><a href="#cb146-223" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ndiffs</span>(ci.ts, <span class="at">test=</span><span class="st">'adf'</span>)</span>
<span id="cb146-224"><a href="#cb146-224" aria-hidden="true" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">ndiffs</span>(ci.ts, <span class="at">test=</span><span class="st">'kpss'</span>)</span>
<span id="cb146-225"><a href="#cb146-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-226"><a href="#cb146-226" aria-hidden="true" tabindex="-1"></a>train.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-227"><a href="#cb146-227" aria-hidden="true" tabindex="-1"></a>test.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-228"><a href="#cb146-228" aria-hidden="true" tabindex="-1"></a>ci.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-229"><a href="#cb146-229" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">forecast</span>(ci.final5, <span class="at">h=</span><span class="dv">5</span>), test.ci5)</span>
<span id="cb146-230"><a href="#cb146-230" aria-hidden="true" tabindex="-1"></a><span class="co">#MASE is just above 1</span></span>
<span id="cb146-231"><a href="#cb146-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-232"><a href="#cb146-232" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(train.ci5)</span>
<span id="cb146-233"><a href="#cb146-233" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(train.ci5)</span>
<span id="cb146-234"><a href="#cb146-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-235"><a href="#cb146-235" aria-hidden="true" tabindex="-1"></a><span class="co">#select ARIMA (6,1,0)</span></span>
<span id="cb146-236"><a href="#cb146-236" aria-hidden="true" tabindex="-1"></a>fit.ci2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.ci5, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">include.mean=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-237"><a href="#cb146-237" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">forecast</span>(fit, <span class="at">h=</span><span class="dv">5</span>), test.ci5)</span>
<span id="cb146-238"><a href="#cb146-238" aria-hidden="true" tabindex="-1"></a><span class="co">#MASE is very high for the test set.</span></span>
<span id="cb146-239"><a href="#cb146-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-240"><a href="#cb146-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-241"><a href="#cb146-241" aria-hidden="true" tabindex="-1"></a>Here are the plots comparing the two models for Cook Inlet. The plots look very similar, but the forecast differs a bit for the last 2 years.</span>
<span id="cb146-242"><a href="#cb146-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-243"><a href="#cb146-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-244"><a href="#cb146-244" aria-hidden="true" tabindex="-1"></a>ci.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-245"><a href="#cb146-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-246"><a href="#cb146-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci5))</span>
<span id="cb146-247"><a href="#cb146-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-248"><a href="#cb146-248" aria-hidden="true" tabindex="-1"></a>fit.ci2 <span class="sc">%&gt;%</span></span>
<span id="cb146-249"><a href="#cb146-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-250"><a href="#cb146-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci5))</span>
<span id="cb146-251"><a href="#cb146-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-252"><a href="#cb146-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-253"><a href="#cb146-253" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chum: Regional</span></span>
<span id="cb146-254"><a href="#cb146-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-255"><a href="#cb146-255" aria-hidden="true" tabindex="-1"></a>Looking at data:</span>
<span id="cb146-256"><a href="#cb146-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-257"><a href="#cb146-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb146-258"><a href="#cb146-258" aria-hidden="true" tabindex="-1"></a>ruggerone_data <span class="sc">%&gt;%</span> </span>
<span id="cb146-259"><a href="#cb146-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"chum"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-260"><a href="#cb146-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(returns))) <span class="sc">+</span> </span>
<span id="cb146-261"><a href="#cb146-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb146-262"><a href="#cb146-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"chum salmon log abundance by region"</span>) <span class="sc">+</span></span>
<span id="cb146-263"><a href="#cb146-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region)</span>
<span id="cb146-264"><a href="#cb146-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-265"><a href="#cb146-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-266"><a href="#cb146-266" aria-hidden="true" tabindex="-1"></a>Getting a subset of the data (removing regions with no data):</span>
<span id="cb146-267"><a href="#cb146-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-270"><a href="#cb146-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-271"><a href="#cb146-271" aria-hidden="true" tabindex="-1"></a><span class="co">#removing Korea Japan because there's no data</span></span>
<span id="cb146-272"><a href="#cb146-272" aria-hidden="true" tabindex="-1"></a>ChumByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb146-273"><a href="#cb146-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"japan"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-274"><a href="#cb146-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-275"><a href="#cb146-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb146-276"><a href="#cb146-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-277"><a href="#cb146-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb146-278"><a href="#cb146-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"chum"</span>)</span>
<span id="cb146-279"><a href="#cb146-279" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ChumByRegion)</span>
<span id="cb146-280"><a href="#cb146-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-281"><a href="#cb146-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-284"><a href="#cb146-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-285"><a href="#cb146-285" aria-hidden="true" tabindex="-1"></a><span class="co">#making sure all the regions cover all the years (or at least start and end)</span></span>
<span id="cb146-286"><a href="#cb146-286" aria-hidden="true" tabindex="-1"></a>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">startyear =</span> <span class="fu">min</span>(year), <span class="at">endyear =</span> <span class="fu">max</span>(year))</span>
<span id="cb146-287"><a href="#cb146-287" aria-hidden="true" tabindex="-1"></a><span class="co">#all start in 1952 and end in 2015</span></span>
<span id="cb146-288"><a href="#cb146-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-289"><a href="#cb146-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-290"><a href="#cb146-290" aria-hidden="true" tabindex="-1"></a>Creating tibble to loop through:</span>
<span id="cb146-291"><a href="#cb146-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-294"><a href="#cb146-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-295"><a href="#cb146-295" aria-hidden="true" tabindex="-1"></a><span class="co">#regions vector</span></span>
<span id="cb146-296"><a href="#cb146-296" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(ChumByRegion<span class="sc">$</span>region)</span>
<span id="cb146-297"><a href="#cb146-297" aria-hidden="true" tabindex="-1"></a><span class="co">#regions key</span></span>
<span id="cb146-298"><a href="#cb146-298" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb146-299"><a href="#cb146-299" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"Washington"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb146-300"><a href="#cb146-300" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions <span class="co">#for plotting</span></span>
<span id="cb146-301"><a href="#cb146-301" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast levels</span></span>
<span id="cb146-302"><a href="#cb146-302" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb146-303"><a href="#cb146-303" aria-hidden="true" tabindex="-1"></a><span class="co">#all combinations</span></span>
<span id="cb146-304"><a href="#cb146-304" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span>
<span id="cb146-305"><a href="#cb146-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-306"><a href="#cb146-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-307"><a href="#cb146-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-308"><a href="#cb146-308" aria-hidden="true" tabindex="-1"></a>Function for ACF and PACF</span>
<span id="cb146-309"><a href="#cb146-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-312"><a href="#cb146-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-313"><a href="#cb146-313" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF and PACF</span></span>
<span id="cb146-314"><a href="#cb146-314" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb146-315"><a href="#cb146-315" aria-hidden="true" tabindex="-1"></a>  Chumdat<span class="ot">&lt;-</span>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-316"><a href="#cb146-316" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-317"><a href="#cb146-317" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Chumdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Chumdat<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-318"><a href="#cb146-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb146-319"><a href="#cb146-319" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-320"><a href="#cb146-320" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through regions/levels</span></span>
<span id="cb146-321"><a href="#cb146-321" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb146-322"><a href="#cb146-322" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span>
<span id="cb146-323"><a href="#cb146-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-324"><a href="#cb146-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-327"><a href="#cb146-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-328"><a href="#cb146-328" aria-hidden="true" tabindex="-1"></a><span class="co">#ACF plots for each region</span></span>
<span id="cb146-329"><a href="#cb146-329" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-330"><a href="#cb146-330" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-331"><a href="#cb146-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-332"><a href="#cb146-332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-333"><a href="#cb146-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-334"><a href="#cb146-334" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb146-335"><a href="#cb146-335" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-336"><a href="#cb146-336" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-337"><a href="#cb146-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-338"><a href="#cb146-338" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-339"><a href="#cb146-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-340"><a href="#cb146-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-343"><a href="#cb146-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-344"><a href="#cb146-344" aria-hidden="true" tabindex="-1"></a><span class="co">#function for ARIMA models</span></span>
<span id="cb146-345"><a href="#cb146-345" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb146-346"><a href="#cb146-346" aria-hidden="true" tabindex="-1"></a>  <span class="co">#This function takes a region and forecast level, subsets the data according to these parameters, then sets up the time series object, and the test and train sets. It uses auto.arima to find the "best" model and then this is checked by comparing other models with DeltaAICc &lt; 2 and the number of parameters. If auto.arima picked a the model with the lowest AIC and the fewest parameters, it forecasts using this model and checks forecast accuracy with MASE. If not, it refits the model using Arima and the simpler model, and then checks forecast accuracy with this.</span></span>
<span id="cb146-347"><a href="#cb146-347" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb146-348"><a href="#cb146-348" aria-hidden="true" tabindex="-1"></a>  Chumdat<span class="ot">&lt;-</span>ChumByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-349"><a href="#cb146-349" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-350"><a href="#cb146-350" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Chumdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Chumdat<span class="sc">$</span>year[<span class="dv">1</span>]) <span class="co">#this assumes the first year in data is the start of the time series (they are in order) </span></span>
<span id="cb146-351"><a href="#cb146-351" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb146-352"><a href="#cb146-352" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, <span class="dv">1952</span>, cutoff)</span>
<span id="cb146-353"><a href="#cb146-353" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb146-354"><a href="#cb146-354" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-355"><a href="#cb146-355" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb146-356"><a href="#cb146-356" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-357"><a href="#cb146-357" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb146-358"><a href="#cb146-358" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb146-359"><a href="#cb146-359" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb146-360"><a href="#cb146-360" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-361"><a href="#cb146-361" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb146-362"><a href="#cb146-362" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb146-363"><a href="#cb146-363" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb146-364"><a href="#cb146-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb146-365"><a href="#cb146-365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-366"><a href="#cb146-366" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb146-367"><a href="#cb146-367" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb146-368"><a href="#cb146-368" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb146-369"><a href="#cb146-369" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-370"><a href="#cb146-370" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb146-371"><a href="#cb146-371" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb146-372"><a href="#cb146-372" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb146-373"><a href="#cb146-373" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-374"><a href="#cb146-374" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-375"><a href="#cb146-375" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-376"><a href="#cb146-376" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb146-377"><a href="#cb146-377" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb146-378"><a href="#cb146-378" aria-hidden="true" tabindex="-1"></a>      <span class="co">#auto arima picked the best model</span></span>
<span id="cb146-379"><a href="#cb146-379" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-380"><a href="#cb146-380" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb146-381"><a href="#cb146-381" aria-hidden="true" tabindex="-1"></a>      <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb146-382"><a href="#cb146-382" aria-hidden="true" tabindex="-1"></a>      newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb146-383"><a href="#cb146-383" aria-hidden="true" tabindex="-1"></a>      mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-384"><a href="#cb146-384" aria-hidden="true" tabindex="-1"></a>      res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-385"><a href="#cb146-385" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-386"><a href="#cb146-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-387"><a href="#cb146-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb146-388"><a href="#cb146-388" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-389"><a href="#cb146-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-390"><a href="#cb146-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-391"><a href="#cb146-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-394"><a href="#cb146-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-395"><a href="#cb146-395" aria-hidden="true" tabindex="-1"></a>RegionModsChum<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-396"><a href="#cb146-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-397"><a href="#cb146-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-400"><a href="#cb146-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-401"><a href="#cb146-401" aria-hidden="true" tabindex="-1"></a>RegionMASEChum<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsChum, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb146-402"><a href="#cb146-402" aria-hidden="true" tabindex="-1"></a>RegionBestModChum<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionModsChum, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb146-403"><a href="#cb146-403" aria-hidden="true" tabindex="-1"></a><span class="co">#combine into tables</span></span>
<span id="cb146-404"><a href="#cb146-404" aria-hidden="true" tabindex="-1"></a>ResultsTableChum<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestModChum, <span class="at">MASE =</span> RegionMASEChum)</span>
<span id="cb146-405"><a href="#cb146-405" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ResultsTableChum))</span>
<span id="cb146-406"><a href="#cb146-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-407"><a href="#cb146-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-408"><a href="#cb146-408" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pink: Combined Regions</span></span>
<span id="cb146-409"><a href="#cb146-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-410"><a href="#cb146-410" aria-hidden="true" tabindex="-1"></a>Subset the data to look at pink salmon only. </span>
<span id="cb146-413"><a href="#cb146-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-414"><a href="#cb146-414" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter by species (Pink)</span></span>
<span id="cb146-415"><a href="#cb146-415" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> ruggerone_data <span class="sc">%&gt;%</span>  </span>
<span id="cb146-416"><a href="#cb146-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"pink"</span> <span class="sc">&amp;</span> region<span class="sc">==</span><span class="st">"ci"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-417"><a href="#cb146-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log.returns =</span> <span class="fu">log</span>(returns)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-418"><a href="#cb146-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, log.returns)</span>
<span id="cb146-419"><a href="#cb146-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-420"><a href="#cb146-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-421"><a href="#cb146-421" aria-hidden="true" tabindex="-1"></a>Plot the data </span>
<span id="cb146-422"><a href="#cb146-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-425"><a href="#cb146-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-426"><a href="#cb146-426" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot by region</span></span>
<span id="cb146-427"><a href="#cb146-427" aria-hidden="true" tabindex="-1"></a>ruggerone_data <span class="sc">%&gt;%</span> </span>
<span id="cb146-428"><a href="#cb146-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">==</span><span class="st">"pink"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-429"><a href="#cb146-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(returns))) <span class="sc">+</span> </span>
<span id="cb146-430"><a href="#cb146-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb146-431"><a href="#cb146-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"pink salmon log abundance by region"</span>) <span class="sc">+</span></span>
<span id="cb146-432"><a href="#cb146-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region)</span>
<span id="cb146-433"><a href="#cb146-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-434"><a href="#cb146-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-435"><a href="#cb146-435" aria-hidden="true" tabindex="-1"></a>Note that there is no data in Korea, and WA has a lot of 0 values and very low returns. We will filter these regions out. All 0 values (-Inf in log space) were removed. </span>
<span id="cb146-436"><a href="#cb146-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-439"><a href="#cb146-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-440"><a href="#cb146-440" aria-hidden="true" tabindex="-1"></a>PinkByRegion<span class="ot">&lt;-</span>ruggerone_data <span class="sc">%&gt;%</span></span>
<span id="cb146-441"><a href="#cb146-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"korea"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-442"><a href="#cb146-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"wa"</span>) <span class="sc">%&gt;%</span><span class="co">#Remove WA too, it's trouble </span></span>
<span id="cb146-443"><a href="#cb146-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, region, year) <span class="sc">%&gt;%</span></span>
<span id="cb146-444"><a href="#cb146-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(returns, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-445"><a href="#cb146-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">log</span>(total)) <span class="sc">%&gt;%</span></span>
<span id="cb146-446"><a href="#cb146-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lnreturns =</span> <span class="fu">ifelse</span>(lnreturns <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">NA</span>, lnreturns)) <span class="sc">%&gt;%</span></span>
<span id="cb146-447"><a href="#cb146-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"pink"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb146-448"><a href="#cb146-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="dv">5</span>)</span>
<span id="cb146-449"><a href="#cb146-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-450"><a href="#cb146-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-451"><a href="#cb146-451" aria-hidden="true" tabindex="-1"></a>Identify start and end years for each region.</span>
<span id="cb146-454"><a href="#cb146-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-455"><a href="#cb146-455" aria-hidden="true" tabindex="-1"></a>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">startyear =</span> <span class="fu">min</span>(year), <span class="at">endyear =</span> <span class="fu">max</span>(year))</span>
<span id="cb146-456"><a href="#cb146-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-457"><a href="#cb146-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-458"><a href="#cb146-458" aria-hidden="true" tabindex="-1"></a> The next step is to ID Stationarity with all the pink data. Lets plot the data in aggregate.</span>
<span id="cb146-459"><a href="#cb146-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-462"><a href="#cb146-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-463"><a href="#cb146-463" aria-hidden="true" tabindex="-1"></a>PinkByRegion <span class="sc">%&gt;%</span></span>
<span id="cb146-464"><a href="#cb146-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-465"><a href="#cb146-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb146-466"><a href="#cb146-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb146-467"><a href="#cb146-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb146-468"><a href="#cb146-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb146-469"><a href="#cb146-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>)</span>
<span id="cb146-470"><a href="#cb146-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-471"><a href="#cb146-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-472"><a href="#cb146-472" aria-hidden="true" tabindex="-1"></a>Next, a time series object was created and we look at the ACF and PACF</span>
<span id="cb146-473"><a href="#cb146-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-476"><a href="#cb146-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-477"><a href="#cb146-477" aria-hidden="true" tabindex="-1"></a>total.pink<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span></span>
<span id="cb146-478"><a href="#cb146-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-479"><a href="#cb146-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb146-480"><a href="#cb146-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-481"><a href="#cb146-481" aria-hidden="true" tabindex="-1"></a>pink.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink<span class="sc">$</span>lntotal, </span>
<span id="cb146-482"><a href="#cb146-482" aria-hidden="true" tabindex="-1"></a>            <span class="at">start=</span>total.pink<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-483"><a href="#cb146-483" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts)) <span class="co">#something odd happened between 1990 and 2005</span></span>
<span id="cb146-484"><a href="#cb146-484" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts)) <span class="co">#ruh roh, ACF correlation for entire series </span></span>
<span id="cb146-485"><a href="#cb146-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-486"><a href="#cb146-486" aria-hidden="true" tabindex="-1"></a>The ACF looks like there is a lot of corelation, that's probably because </span>
<span id="cb146-487"><a href="#cb146-487" aria-hidden="true" tabindex="-1"></a>Pinks have a very consistent two year cycle.</span>
<span id="cb146-488"><a href="#cb146-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-489"><a href="#cb146-489" aria-hidden="true" tabindex="-1"></a>Let's try a forecast model to see what happens.</span>
<span id="cb146-492"><a href="#cb146-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-493"><a href="#cb146-493" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's train and test with a 10 year period</span></span>
<span id="cb146-494"><a href="#cb146-494" aria-hidden="true" tabindex="-1"></a>train.pink<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-495"><a href="#cb146-495" aria-hidden="true" tabindex="-1"></a>test.pink<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-496"><a href="#cb146-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-497"><a href="#cb146-497" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink, <span class="at">trace=</span>T)</span>
<span id="cb146-498"><a href="#cb146-498" aria-hidden="true" tabindex="-1"></a>fit.final.pink<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-499"><a href="#cb146-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-500"><a href="#cb146-500" aria-hidden="true" tabindex="-1"></a><span class="co">#30 year forcast, not so believeable</span></span>
<span id="cb146-501"><a href="#cb146-501" aria-hidden="true" tabindex="-1"></a>fit.final.pink <span class="sc">%&gt;%</span></span>
<span id="cb146-502"><a href="#cb146-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-503"><a href="#cb146-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink))</span>
<span id="cb146-504"><a href="#cb146-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-505"><a href="#cb146-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-506"><a href="#cb146-506" aria-hidden="true" tabindex="-1"></a>The best model was the ARIMA(3,1,0), but the forecast doesn't look particularly great. </span>
<span id="cb146-507"><a href="#cb146-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-508"><a href="#cb146-508" aria-hidden="true" tabindex="-1"></a>Given the life history of pink salmon, let's parse the data set into two pieces, even and odd years. </span>
<span id="cb146-509"><a href="#cb146-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-512"><a href="#cb146-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-513"><a href="#cb146-513" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years: Totals </span></span>
<span id="cb146-514"><a href="#cb146-514" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> </span>
<span id="cb146-515"><a href="#cb146-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb146-516"><a href="#cb146-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-517"><a href="#cb146-517" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years: Totals </span></span>
<span id="cb146-518"><a href="#cb146-518" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> </span>
<span id="cb146-519"><a href="#cb146-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb146-520"><a href="#cb146-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-521"><a href="#cb146-521" aria-hidden="true" tabindex="-1"></a><span class="co">#Trends</span></span>
<span id="cb146-522"><a href="#cb146-522" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb146-523"><a href="#cb146-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-524"><a href="#cb146-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb146-525"><a href="#cb146-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb146-526"><a href="#cb146-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb146-527"><a href="#cb146-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb146-528"><a href="#cb146-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>) <span class="sc">+</span></span>
<span id="cb146-529"><a href="#cb146-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Total Pinks (Even Years)'</span>)</span>
<span id="cb146-530"><a href="#cb146-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-531"><a href="#cb146-531" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb146-532"><a href="#cb146-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-533"><a href="#cb146-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span></span>
<span id="cb146-534"><a href="#cb146-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span><span class="fu">log</span>(total))) <span class="sc">+</span></span>
<span id="cb146-535"><a href="#cb146-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb146-536"><a href="#cb146-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Log (Returns)'</span>) <span class="sc">+</span></span>
<span id="cb146-537"><a href="#cb146-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year'</span>) <span class="sc">+</span></span>
<span id="cb146-538"><a href="#cb146-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">'Total Pinks (Odd Years)'</span>)</span>
<span id="cb146-539"><a href="#cb146-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-540"><a href="#cb146-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-541"><a href="#cb146-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-542"><a href="#cb146-542" aria-hidden="true" tabindex="-1"></a>Let's look at the ACF and PACF for even years:</span>
<span id="cb146-545"><a href="#cb146-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-546"><a href="#cb146-546" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years -- Total</span></span>
<span id="cb146-547"><a href="#cb146-547" aria-hidden="true" tabindex="-1"></a>total.pink_even<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb146-548"><a href="#cb146-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-549"><a href="#cb146-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb146-550"><a href="#cb146-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-551"><a href="#cb146-551" aria-hidden="true" tabindex="-1"></a>pink.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink_even<span class="sc">$</span>lntotal, </span>
<span id="cb146-552"><a href="#cb146-552" aria-hidden="true" tabindex="-1"></a>            <span class="at">start=</span>total.pink<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-553"><a href="#cb146-553" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts_even)) <span class="co">#Looks pretty stationary</span></span>
<span id="cb146-554"><a href="#cb146-554" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts_even)) <span class="co">#This looks much better</span></span>
<span id="cb146-555"><a href="#cb146-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-556"><a href="#cb146-556" aria-hidden="true" tabindex="-1"></a>The differences and the ACF plots here look better than the aggregate data set. Let's look at a forcast. </span>
<span id="cb146-557"><a href="#cb146-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-560"><a href="#cb146-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-561"><a href="#cb146-561" aria-hidden="true" tabindex="-1"></a><span class="co">#Train and test for a 10 year period</span></span>
<span id="cb146-562"><a href="#cb146-562" aria-hidden="true" tabindex="-1"></a>train.pink_even<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2004</span>)</span>
<span id="cb146-563"><a href="#cb146-563" aria-hidden="true" tabindex="-1"></a>test.pink_even<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-564"><a href="#cb146-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-565"><a href="#cb146-565" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_even, <span class="at">trace=</span>T)</span>
<span id="cb146-566"><a href="#cb146-566" aria-hidden="true" tabindex="-1"></a>fit.final.pink_even<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_even, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-567"><a href="#cb146-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-568"><a href="#cb146-568" aria-hidden="true" tabindex="-1"></a>fit.final.pink_even <span class="sc">%&gt;%</span></span>
<span id="cb146-569"><a href="#cb146-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-570"><a href="#cb146-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink_even))</span>
<span id="cb146-571"><a href="#cb146-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-572"><a href="#cb146-572" aria-hidden="true" tabindex="-1"></a><span class="co">#That is a straight line..... not very good.....</span></span>
<span id="cb146-573"><a href="#cb146-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-574"><a href="#cb146-574" aria-hidden="true" tabindex="-1"></a>The best model was the ARIMA(0,1,0) model. But the forcast doesn't capture the trend. </span>
<span id="cb146-575"><a href="#cb146-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-576"><a href="#cb146-576" aria-hidden="true" tabindex="-1"></a>Let's repeat the next steps for odd years. </span>
<span id="cb146-579"><a href="#cb146-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-580"><a href="#cb146-580" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years -- Total</span></span>
<span id="cb146-581"><a href="#cb146-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-582"><a href="#cb146-582" aria-hidden="true" tabindex="-1"></a>total.pink_odd<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb146-583"><a href="#cb146-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb146-584"><a href="#cb146-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lntotal=</span><span class="fu">log</span>(<span class="fu">sum</span>(total, <span class="at">na.rm=</span>T)))</span>
<span id="cb146-585"><a href="#cb146-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-586"><a href="#cb146-586" aria-hidden="true" tabindex="-1"></a>pink.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(total.pink_odd<span class="sc">$</span>lntotal, </span>
<span id="cb146-587"><a href="#cb146-587" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start=</span>total.pink_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-588"><a href="#cb146-588" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">diff</span>(pink.ts_odd)) <span class="co">#Looks pretty stationary</span></span>
<span id="cb146-589"><a href="#cb146-589" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">diff</span>(pink.ts_odd)) <span class="co">#This also looks better</span></span>
<span id="cb146-590"><a href="#cb146-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-591"><a href="#cb146-591" aria-hidden="true" tabindex="-1"></a>These look stationary and the ACF looks better.</span>
<span id="cb146-592"><a href="#cb146-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-595"><a href="#cb146-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-596"><a href="#cb146-596" aria-hidden="true" tabindex="-1"></a><span class="co">#Train and test for a 10 year period</span></span>
<span id="cb146-597"><a href="#cb146-597" aria-hidden="true" tabindex="-1"></a>train.pink_odd<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-598"><a href="#cb146-598" aria-hidden="true" tabindex="-1"></a>test.pink_odd<span class="ot">&lt;-</span><span class="fu">window</span>(pink.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-599"><a href="#cb146-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-600"><a href="#cb146-600" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_odd, <span class="at">trace=</span>T)</span>
<span id="cb146-601"><a href="#cb146-601" aria-hidden="true" tabindex="-1"></a>fit.final.pink_odd<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.pink_odd, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-602"><a href="#cb146-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-603"><a href="#cb146-603" aria-hidden="true" tabindex="-1"></a>fit.final.pink_odd <span class="sc">%&gt;%</span></span>
<span id="cb146-604"><a href="#cb146-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-605"><a href="#cb146-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.pink_odd))</span>
<span id="cb146-606"><a href="#cb146-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-607"><a href="#cb146-607" aria-hidden="true" tabindex="-1"></a>The best model was the ARIMA(0,1,0) model. But the forcast for only odd years also doesn't capture the trend. </span>
<span id="cb146-608"><a href="#cb146-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-609"><a href="#cb146-609" aria-hidden="true" tabindex="-1"></a><span class="fu"># Pinks: Regional Considerations </span></span>
<span id="cb146-610"><a href="#cb146-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-611"><a href="#cb146-611" aria-hidden="true" tabindex="-1"></a>Because of pink salmon life history, for regional models, models with even and odd years were considered separately. </span>
<span id="cb146-612"><a href="#cb146-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-615"><a href="#cb146-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-616"><a href="#cb146-616" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years First </span></span>
<span id="cb146-617"><a href="#cb146-617" aria-hidden="true" tabindex="-1"></a><span class="co">#Differenced plots for all Regions </span></span>
<span id="cb146-618"><a href="#cb146-618" aria-hidden="true" tabindex="-1"></a>PinkByRegion_even <span class="sc">%&gt;%</span></span>
<span id="cb146-619"><a href="#cb146-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb146-620"><a href="#cb146-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_total =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(total))) <span class="sc">%&gt;%</span></span>
<span id="cb146-621"><a href="#cb146-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> diff_total)) <span class="sc">+</span></span>
<span id="cb146-622"><a href="#cb146-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb146-623"><a href="#cb146-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb146-624"><a href="#cb146-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in Total Returns"</span>) <span class="sc">+</span></span>
<span id="cb146-625"><a href="#cb146-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb146-626"><a href="#cb146-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Diff by Region (Even Years)"</span>) </span>
<span id="cb146-627"><a href="#cb146-627" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ggfortify::ggstat_acf(method = "ma", na.action = na.pass)</span></span>
<span id="cb146-628"><a href="#cb146-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-629"><a href="#cb146-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Odd Years First </span></span>
<span id="cb146-630"><a href="#cb146-630" aria-hidden="true" tabindex="-1"></a><span class="co">#Differenced plots for all Regions </span></span>
<span id="cb146-631"><a href="#cb146-631" aria-hidden="true" tabindex="-1"></a>PinkByRegion_odd <span class="sc">%&gt;%</span></span>
<span id="cb146-632"><a href="#cb146-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb146-633"><a href="#cb146-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_total =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(total))) <span class="sc">%&gt;%</span></span>
<span id="cb146-634"><a href="#cb146-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> diff_total)) <span class="sc">+</span></span>
<span id="cb146-635"><a href="#cb146-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb146-636"><a href="#cb146-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb146-637"><a href="#cb146-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Difference in Total Returns"</span>) <span class="sc">+</span></span>
<span id="cb146-638"><a href="#cb146-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb146-639"><a href="#cb146-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Diff by Region (Odd Years)"</span>) </span>
<span id="cb146-640"><a href="#cb146-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-641"><a href="#cb146-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-642"><a href="#cb146-642" aria-hidden="true" tabindex="-1"></a>To test stationarity outside the auto.arima function , the ADF and KPSS tests were compared for all years, and even and odd years. Note for the ADF null hypothesis is that the system is non-stationary (we want to reject), and the KPSS test null hypothesis is that there is stationarity.</span>
<span id="cb146-643"><a href="#cb146-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-646"><a href="#cb146-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-647"><a href="#cb146-647" aria-hidden="true" tabindex="-1"></a><span class="co">#Augmented Dicky Fuller </span></span>
<span id="cb146-648"><a href="#cb146-648" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts, <span class="at">k=</span><span class="dv">0</span>)</span>
<span id="cb146-649"><a href="#cb146-649" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts_even, <span class="at">k=</span><span class="dv">0</span>)</span>
<span id="cb146-650"><a href="#cb146-650" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">adf.test</span>(pink.ts_odd, <span class="at">k=</span><span class="dv">0</span>)</span>
<span id="cb146-651"><a href="#cb146-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-652"><a href="#cb146-652" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span>
<span id="cb146-653"><a href="#cb146-653" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts_even, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span>
<span id="cb146-654"><a href="#cb146-654" aria-hidden="true" tabindex="-1"></a>tseries<span class="sc">::</span><span class="fu">kpss.test</span>(pink.ts_odd, <span class="at">null =</span> <span class="fu">c</span>(<span class="st">"Level"</span>, <span class="st">"Trend"</span>))</span>
<span id="cb146-655"><a href="#cb146-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-656"><a href="#cb146-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-657"><a href="#cb146-657" aria-hidden="true" tabindex="-1"></a>A complication is that the data sets split by even and odd years were not passing the tests of stationarity. Perhaps other steps should have been taken.</span>
<span id="cb146-658"><a href="#cb146-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-661"><a href="#cb146-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-662"><a href="#cb146-662" aria-hidden="true" tabindex="-1"></a><span class="co">#Functions for Regional ACF and PACF </span></span>
<span id="cb146-663"><a href="#cb146-663" aria-hidden="true" tabindex="-1"></a><span class="co">#======================================================</span></span>
<span id="cb146-664"><a href="#cb146-664" aria-hidden="true" tabindex="-1"></a>ACFandPACF<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb146-665"><a href="#cb146-665" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-666"><a href="#cb146-666" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-667"><a href="#cb146-667" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb146-668"><a href="#cb146-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb146-669"><a href="#cb146-669" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-670"><a href="#cb146-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-671"><a href="#cb146-671" aria-hidden="true" tabindex="-1"></a>ACFandPACF_even<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb146-672"><a href="#cb146-672" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-673"><a href="#cb146-673" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-674"><a href="#cb146-674" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb146-675"><a href="#cb146-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb146-676"><a href="#cb146-676" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-677"><a href="#cb146-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-678"><a href="#cb146-678" aria-hidden="true" tabindex="-1"></a>ACFandPACF_odd<span class="ot">&lt;-</span><span class="cf">function</span>(reg){</span>
<span id="cb146-679"><a href="#cb146-679" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-680"><a href="#cb146-680" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-681"><a href="#cb146-681" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>]) </span>
<span id="cb146-682"><a href="#cb146-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">acf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>), <span class="at">p =</span> <span class="fu">pacf</span>(datts, <span class="at">plot =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb146-683"><a href="#cb146-683" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-684"><a href="#cb146-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-685"><a href="#cb146-685" aria-hidden="true" tabindex="-1"></a>FitModFunction<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb146-686"><a href="#cb146-686" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb146-687"><a href="#cb146-687" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-688"><a href="#cb146-688" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-689"><a href="#cb146-689" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) <span class="co">#set Frequency for 0.5</span></span>
<span id="cb146-690"><a href="#cb146-690" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2014</span><span class="sc">-</span>forelevel</span>
<span id="cb146-691"><a href="#cb146-691" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb146-692"><a href="#cb146-692" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2014</span>)</span>
<span id="cb146-693"><a href="#cb146-693" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-694"><a href="#cb146-694" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb146-695"><a href="#cb146-695" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb146-696"><a href="#cb146-696" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb146-697"><a href="#cb146-697" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb146-698"><a href="#cb146-698" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-699"><a href="#cb146-699" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb146-700"><a href="#cb146-700" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb146-701"><a href="#cb146-701" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb146-702"><a href="#cb146-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb146-703"><a href="#cb146-703" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-704"><a href="#cb146-704" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb146-705"><a href="#cb146-705" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb146-706"><a href="#cb146-706" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb146-707"><a href="#cb146-707" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-708"><a href="#cb146-708" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb146-709"><a href="#cb146-709" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb146-710"><a href="#cb146-710" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb146-711"><a href="#cb146-711" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-712"><a href="#cb146-712" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-713"><a href="#cb146-713" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-714"><a href="#cb146-714" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb146-715"><a href="#cb146-715" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb146-716"><a href="#cb146-716" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb146-717"><a href="#cb146-717" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-718"><a href="#cb146-718" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb146-719"><a href="#cb146-719" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb146-720"><a href="#cb146-720" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb146-721"><a href="#cb146-721" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-722"><a href="#cb146-722" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-723"><a href="#cb146-723" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-724"><a href="#cb146-724" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-725"><a href="#cb146-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb146-726"><a href="#cb146-726" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-727"><a href="#cb146-727" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-728"><a href="#cb146-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-729"><a href="#cb146-729" aria-hidden="true" tabindex="-1"></a>FitModFunction_even<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb146-730"><a href="#cb146-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb146-731"><a href="#cb146-731" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_even <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-732"><a href="#cb146-732" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-733"><a href="#cb146-733" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) <span class="co">#set Frequency for 0.5</span></span>
<span id="cb146-734"><a href="#cb146-734" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2014</span><span class="sc">-</span>forelevel</span>
<span id="cb146-735"><a href="#cb146-735" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb146-736"><a href="#cb146-736" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2014</span>)</span>
<span id="cb146-737"><a href="#cb146-737" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-738"><a href="#cb146-738" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb146-739"><a href="#cb146-739" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb146-740"><a href="#cb146-740" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb146-741"><a href="#cb146-741" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb146-742"><a href="#cb146-742" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-743"><a href="#cb146-743" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb146-744"><a href="#cb146-744" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb146-745"><a href="#cb146-745" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb146-746"><a href="#cb146-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb146-747"><a href="#cb146-747" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-748"><a href="#cb146-748" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb146-749"><a href="#cb146-749" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb146-750"><a href="#cb146-750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb146-751"><a href="#cb146-751" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-752"><a href="#cb146-752" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb146-753"><a href="#cb146-753" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb146-754"><a href="#cb146-754" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb146-755"><a href="#cb146-755" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-756"><a href="#cb146-756" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-757"><a href="#cb146-757" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-758"><a href="#cb146-758" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb146-759"><a href="#cb146-759" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb146-760"><a href="#cb146-760" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb146-761"><a href="#cb146-761" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-762"><a href="#cb146-762" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb146-763"><a href="#cb146-763" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb146-764"><a href="#cb146-764" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb146-765"><a href="#cb146-765" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-766"><a href="#cb146-766" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-767"><a href="#cb146-767" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-768"><a href="#cb146-768" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-769"><a href="#cb146-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb146-770"><a href="#cb146-770" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-771"><a href="#cb146-771" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-772"><a href="#cb146-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-773"><a href="#cb146-773" aria-hidden="true" tabindex="-1"></a>FitModFunction_odd<span class="ot">&lt;-</span><span class="cf">function</span>(reg, forelevel){</span>
<span id="cb146-774"><a href="#cb146-774" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter region</span></span>
<span id="cb146-775"><a href="#cb146-775" aria-hidden="true" tabindex="-1"></a>  Pinkdat<span class="ot">&lt;-</span>PinkByRegion_odd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> reg)</span>
<span id="cb146-776"><a href="#cb146-776" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create time series</span></span>
<span id="cb146-777"><a href="#cb146-777" aria-hidden="true" tabindex="-1"></a>  datts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pinkdat<span class="sc">$</span>lnreturns, <span class="at">start=</span>Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>) </span>
<span id="cb146-778"><a href="#cb146-778" aria-hidden="true" tabindex="-1"></a>  cutoff<span class="ot">&lt;-</span><span class="dv">2015</span><span class="sc">-</span>forelevel</span>
<span id="cb146-779"><a href="#cb146-779" aria-hidden="true" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, Pinkdat<span class="sc">$</span>year[<span class="dv">1</span>], cutoff)</span>
<span id="cb146-780"><a href="#cb146-780" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">window</span>(datts, cutoff<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2015</span>)</span>
<span id="cb146-781"><a href="#cb146-781" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-782"><a href="#cb146-782" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(train)</span>
<span id="cb146-783"><a href="#cb146-783" aria-hidden="true" tabindex="-1"></a>  <span class="co">#testing to be sure that this is the best model (is the best mode the simplest if it is within 2 AIC values?)</span></span>
<span id="cb146-784"><a href="#cb146-784" aria-hidden="true" tabindex="-1"></a>  trace <span class="ot">&lt;-</span> <span class="fu">capture.output</span>({</span>
<span id="cb146-785"><a href="#cb146-785" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign so it doesn't pollute the output</span></span>
<span id="cb146-786"><a href="#cb146-786" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(datts, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-787"><a href="#cb146-787" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb146-788"><a href="#cb146-788" aria-hidden="true" tabindex="-1"></a>  con    <span class="ot">&lt;-</span> <span class="fu">textConnection</span>(trace)</span>
<span id="cb146-789"><a href="#cb146-789" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">read.table</span>(con, <span class="at">sep=</span><span class="st">":"</span>)</span>
<span id="cb146-790"><a href="#cb146-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(con)</span>
<span id="cb146-791"><a href="#cb146-791" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-792"><a href="#cb146-792" aria-hidden="true" tabindex="-1"></a>  <span class="co">#getting the "best models" that are within 2 AIC units</span></span>
<span id="cb146-793"><a href="#cb146-793" aria-hidden="true" tabindex="-1"></a>  BestMods<span class="ot">&lt;-</span>models<span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="fu">nrow</span>(models)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">AIC =</span> <span class="fu">replace</span>(V2, V2 <span class="sc">==</span> <span class="st">"Inf"</span>, <span class="dv">99999</span>), <span class="at">AIC =</span> <span class="fu">as.numeric</span>(AIC), <span class="at">DeltaAIC =</span> AIC<span class="sc">-</span><span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DeltaAIC <span class="sc">&lt;=</span> <span class="fl">2.0</span>)</span>
<span id="cb146-794"><a href="#cb146-794" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(BestMods)){</span>
<span id="cb146-795"><a href="#cb146-795" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>Mod[i]<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-796"><a href="#cb146-796" aria-hidden="true" tabindex="-1"></a>    BestMods<span class="sc">$</span>npar[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(<span class="fu">as.numeric</span>(BestMods<span class="sc">$</span>Mod[i][[<span class="dv">1</span>]][<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]))</span>
<span id="cb146-797"><a href="#cb146-797" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(BestMods<span class="sc">$</span>V1[i], <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">==</span> <span class="st">" with drift         "</span>){</span>
<span id="cb146-798"><a href="#cb146-798" aria-hidden="true" tabindex="-1"></a>      BestMods<span class="sc">$</span>npar[i] <span class="ot">=</span> BestMods<span class="sc">$</span>npar[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb146-799"><a href="#cb146-799" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-800"><a href="#cb146-800" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-801"><a href="#cb146-801" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-802"><a href="#cb146-802" aria-hidden="true" tabindex="-1"></a>  New<span class="ot">&lt;-</span>BestMods <span class="sc">%&gt;%</span> <span class="fu">filter</span>(npar <span class="sc">==</span> <span class="fu">min</span>(npar))</span>
<span id="cb146-803"><a href="#cb146-803" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="dv">0</span> <span class="sc">%in%</span> New<span class="sc">$</span>DeltaAIC){</span>
<span id="cb146-804"><a href="#cb146-804" aria-hidden="true" tabindex="-1"></a>    <span class="co">#auto arima picked the best model</span></span>
<span id="cb146-805"><a href="#cb146-805" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-806"><a href="#cb146-806" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb146-807"><a href="#cb146-807" aria-hidden="true" tabindex="-1"></a>    <span class="co">#of the models with the fewest parameters, pick the lowest AIC</span></span>
<span id="cb146-808"><a href="#cb146-808" aria-hidden="true" tabindex="-1"></a>    newmod<span class="ot">&lt;-</span>New <span class="sc">%&gt;%</span> <span class="fu">filter</span>(AIC <span class="sc">==</span> <span class="fu">min</span>(AIC)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Mod)</span>
<span id="cb146-809"><a href="#cb146-809" aria-hidden="true" tabindex="-1"></a>    mod<span class="ot">&lt;-</span><span class="fu">Arima</span>(train, <span class="at">order =</span> <span class="fu">as.numeric</span>(<span class="fu">strsplit</span>(newmod<span class="sc">$</span>Mod[[<span class="dv">1</span>]], <span class="st">"[,]"</span>)), <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-810"><a href="#cb146-810" aria-hidden="true" tabindex="-1"></a>    res<span class="ot">&lt;-</span><span class="fu">accuracy</span>(<span class="fu">forecast</span>(mod, <span class="at">h=</span>forelevel), test)[<span class="dv">2</span>,<span class="st">"MASE"</span>] <span class="co">#test set MASE</span></span>
<span id="cb146-811"><a href="#cb146-811" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-812"><a href="#cb146-812" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-813"><a href="#cb146-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Fit =</span> mod, <span class="at">MASE =</span> res, <span class="at">Bm =</span> BestMods)) <span class="co">#include best mods for testing to see that it's doing what I want</span></span>
<span id="cb146-814"><a href="#cb146-814" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-815"><a href="#cb146-815" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-816"><a href="#cb146-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-817"><a href="#cb146-817" aria-hidden="true" tabindex="-1"></a><span class="co">#================================================================</span></span>
<span id="cb146-818"><a href="#cb146-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-819"><a href="#cb146-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-820"><a href="#cb146-820" aria-hidden="true" tabindex="-1"></a>Next step is to then define the regions </span>
<span id="cb146-823"><a href="#cb146-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-824"><a href="#cb146-824" aria-hidden="true" tabindex="-1"></a><span class="co">#regions vector</span></span>
<span id="cb146-825"><a href="#cb146-825" aria-hidden="true" tabindex="-1"></a>regions<span class="ot">&lt;-</span><span class="fu">unique</span>(PinkByRegion<span class="sc">$</span>region)</span>
<span id="cb146-826"><a href="#cb146-826" aria-hidden="true" tabindex="-1"></a><span class="co">#regions key</span></span>
<span id="cb146-827"><a href="#cb146-827" aria-hidden="true" tabindex="-1"></a>regionskey<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Cook Inlet"</span>, <span class="st">"E. Kamchatka"</span>, <span class="st">"Japan"</span>, <span class="st">"Kodiak"</span>, <span class="st">"Russia"</span>, <span class="st">"N.British Columbia"</span>,</span>
<span id="cb146-828"><a href="#cb146-828" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Prince William Sound"</span>, <span class="st">"S. Alaska Pen."</span>, <span class="st">"S. British Columbia"</span>, <span class="st">"SE Alaska"</span>, <span class="st">"W. Kamchatka"</span>, <span class="st">"W. Alaska"</span>)</span>
<span id="cb146-829"><a href="#cb146-829" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(regionskey)<span class="ot">&lt;-</span>regions <span class="co">#for plotting</span></span>
<span id="cb146-830"><a href="#cb146-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-831"><a href="#cb146-831" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through regions/levels</span></span>
<span id="cb146-832"><a href="#cb146-832" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb146-833"><a href="#cb146-833" aria-hidden="true" tabindex="-1"></a>DiagPlots<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF)</span>
<span id="cb146-834"><a href="#cb146-834" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots)<span class="ot">&lt;-</span>regions</span>
<span id="cb146-835"><a href="#cb146-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-836"><a href="#cb146-836" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb146-837"><a href="#cb146-837" aria-hidden="true" tabindex="-1"></a>DiagPlots_even<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF_even)</span>
<span id="cb146-838"><a href="#cb146-838" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots_even)<span class="ot">&lt;-</span>regions</span>
<span id="cb146-839"><a href="#cb146-839" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb146-840"><a href="#cb146-840" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb146-841"><a href="#cb146-841" aria-hidden="true" tabindex="-1"></a>DiagPlots_odd<span class="ot">&lt;-</span><span class="fu">lapply</span>(regions, ACFandPACF_odd)</span>
<span id="cb146-842"><a href="#cb146-842" aria-hidden="true" tabindex="-1"></a>   <span class="fu">names</span>(DiagPlots_odd)<span class="ot">&lt;-</span>regions   </span>
<span id="cb146-843"><a href="#cb146-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-844"><a href="#cb146-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-845"><a href="#cb146-845" aria-hidden="true" tabindex="-1"></a>Lets look at the regional breakdowns of ACF and PACF, first for all years:</span>
<span id="cb146-848"><a href="#cb146-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-849"><a href="#cb146-849" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb146-850"><a href="#cb146-850" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-851"><a href="#cb146-851" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-852"><a href="#cb146-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-853"><a href="#cb146-853" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-854"><a href="#cb146-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-855"><a href="#cb146-855" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb146-856"><a href="#cb146-856" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-857"><a href="#cb146-857" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-858"><a href="#cb146-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-859"><a href="#cb146-859" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-860"><a href="#cb146-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-861"><a href="#cb146-861" aria-hidden="true" tabindex="-1"></a>The ACFs for regions show different levels of lag or total correlation. </span>
<span id="cb146-862"><a href="#cb146-862" aria-hidden="true" tabindex="-1"></a>Let's look for even years:</span>
<span id="cb146-865"><a href="#cb146-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-866"><a href="#cb146-866" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb146-867"><a href="#cb146-867" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-868"><a href="#cb146-868" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-869"><a href="#cb146-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_even[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-870"><a href="#cb146-870" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-871"><a href="#cb146-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-872"><a href="#cb146-872" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb146-873"><a href="#cb146-873" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-874"><a href="#cb146-874" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-875"><a href="#cb146-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_even[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-876"><a href="#cb146-876" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-877"><a href="#cb146-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-878"><a href="#cb146-878" aria-hidden="true" tabindex="-1"></a>And then for odd years:</span>
<span id="cb146-881"><a href="#cb146-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-882"><a href="#cb146-882" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb146-883"><a href="#cb146-883" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-884"><a href="#cb146-884" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-885"><a href="#cb146-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_odd[[r]][[<span class="dv">1</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-886"><a href="#cb146-886" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-887"><a href="#cb146-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-888"><a href="#cb146-888" aria-hidden="true" tabindex="-1"></a><span class="co">#PACF plots for each region</span></span>
<span id="cb146-889"><a href="#cb146-889" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb146-890"><a href="#cb146-890" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(regions)){</span>
<span id="cb146-891"><a href="#cb146-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(DiagPlots_odd[[r]][[<span class="dv">2</span>]], <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Region: "</span>, regionskey[r]))</span>
<span id="cb146-892"><a href="#cb146-892" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-893"><a href="#cb146-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-894"><a href="#cb146-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-895"><a href="#cb146-895" aria-hidden="true" tabindex="-1"></a>The next step is to look at the ARIMA models for regions by all years, even and odd years, and define forecast levels. Let's start with all years.</span>
<span id="cb146-896"><a href="#cb146-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-899"><a href="#cb146-899" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-900"><a href="#cb146-900" aria-hidden="true" tabindex="-1"></a><span class="co">#forecast levels</span></span>
<span id="cb146-901"><a href="#cb146-901" aria-hidden="true" tabindex="-1"></a>forecastlevels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb146-902"><a href="#cb146-902" aria-hidden="true" tabindex="-1"></a><span class="co">#all combinations</span></span>
<span id="cb146-903"><a href="#cb146-903" aria-hidden="true" tabindex="-1"></a>Allcombs<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(regions, forecastlevels)</span>
<span id="cb146-904"><a href="#cb146-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-905"><a href="#cb146-905" aria-hidden="true" tabindex="-1"></a><span class="co">#================================================</span></span>
<span id="cb146-906"><a href="#cb146-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-907"><a href="#cb146-907" aria-hidden="true" tabindex="-1"></a><span class="co">#All</span></span>
<span id="cb146-908"><a href="#cb146-908" aria-hidden="true" tabindex="-1"></a>RegionMods<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-909"><a href="#cb146-909" aria-hidden="true" tabindex="-1"></a><span class="co"># head(RegionMods_even)</span></span>
<span id="cb146-910"><a href="#cb146-910" aria-hidden="true" tabindex="-1"></a><span class="co"># names(RegionMods_even)</span></span>
<span id="cb146-911"><a href="#cb146-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-912"><a href="#cb146-912" aria-hidden="true" tabindex="-1"></a>Now let's consider even years. </span>
<span id="cb146-915"><a href="#cb146-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-916"><a href="#cb146-916" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb146-917"><a href="#cb146-917" aria-hidden="true" tabindex="-1"></a>RegionMods_even<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction_even, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-918"><a href="#cb146-918" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RegionMods_even)</span>
<span id="cb146-919"><a href="#cb146-919" aria-hidden="true" tabindex="-1"></a><span class="co">#names(RegionMods_even) #should be three for each region</span></span>
<span id="cb146-920"><a href="#cb146-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-921"><a href="#cb146-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-922"><a href="#cb146-922" aria-hidden="true" tabindex="-1"></a>Now let's consider odd years. </span>
<span id="cb146-925"><a href="#cb146-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-926"><a href="#cb146-926" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd </span></span>
<span id="cb146-927"><a href="#cb146-927" aria-hidden="true" tabindex="-1"></a>RegionMods_odd<span class="ot">&lt;-</span><span class="fu">mapply</span>(FitModFunction_odd, Allcombs<span class="sc">$</span>regions, Allcombs<span class="sc">$</span>forecastlevels, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-928"><a href="#cb146-928" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(RegionMods_odd)</span>
<span id="cb146-929"><a href="#cb146-929" aria-hidden="true" tabindex="-1"></a><span class="co">#names(RegionMods_odd) #should be three for each region</span></span>
<span id="cb146-930"><a href="#cb146-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-931"><a href="#cb146-931" aria-hidden="true" tabindex="-1"></a>Now, we're extracting the MASE and creating our final model tables </span>
<span id="cb146-934"><a href="#cb146-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-935"><a href="#cb146-935" aria-hidden="true" tabindex="-1"></a><span class="co">#getting MASE</span></span>
<span id="cb146-936"><a href="#cb146-936" aria-hidden="true" tabindex="-1"></a><span class="co">#All</span></span>
<span id="cb146-937"><a href="#cb146-937" aria-hidden="true" tabindex="-1"></a>RegionMASE<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb146-938"><a href="#cb146-938" aria-hidden="true" tabindex="-1"></a>RegionBestMod<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb146-939"><a href="#cb146-939" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb146-940"><a href="#cb146-940" aria-hidden="true" tabindex="-1"></a>RegionMASE_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_even, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb146-941"><a href="#cb146-941" aria-hidden="true" tabindex="-1"></a>RegionBestMod_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_even, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb146-942"><a href="#cb146-942" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb146-943"><a href="#cb146-943" aria-hidden="true" tabindex="-1"></a>RegionMASE_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_odd, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span>x<span class="sc">$</span>MASE})</span>
<span id="cb146-944"><a href="#cb146-944" aria-hidden="true" tabindex="-1"></a>RegionBestMod_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionMods_odd, <span class="cf">function</span>(x){y<span class="ot">&lt;-</span><span class="fu">as.character</span>(x<span class="sc">$</span>Fit)})</span>
<span id="cb146-945"><a href="#cb146-945" aria-hidden="true" tabindex="-1"></a><span class="co">#combine into tables</span></span>
<span id="cb146-946"><a href="#cb146-946" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb146-947"><a href="#cb146-947" aria-hidden="true" tabindex="-1"></a>ResultsTable<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod, <span class="at">MASE =</span> RegionMASE)</span>
<span id="cb146-948"><a href="#cb146-948" aria-hidden="true" tabindex="-1"></a>ResultsTable</span>
<span id="cb146-949"><a href="#cb146-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-950"><a href="#cb146-950" aria-hidden="true" tabindex="-1"></a><span class="co">#even</span></span>
<span id="cb146-951"><a href="#cb146-951" aria-hidden="true" tabindex="-1"></a>ResultsTable_even<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod_even, <span class="at">MASE =</span> RegionMASE_even)</span>
<span id="cb146-952"><a href="#cb146-952" aria-hidden="true" tabindex="-1"></a>ResultsTable_even</span>
<span id="cb146-953"><a href="#cb146-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-954"><a href="#cb146-954" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb146-955"><a href="#cb146-955" aria-hidden="true" tabindex="-1"></a>ResultsTable_odd<span class="ot">&lt;-</span>Allcombs <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">Model =</span> RegionBestMod_odd, <span class="at">MASE =</span> RegionMASE_odd)</span>
<span id="cb146-956"><a href="#cb146-956" aria-hidden="true" tabindex="-1"></a>ResultsTable_odd</span>
<span id="cb146-957"><a href="#cb146-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-958"><a href="#cb146-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-959"><a href="#cb146-959" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb146-960"><a href="#cb146-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-961"><a href="#cb146-961" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sockeye:</span></span>
<span id="cb146-962"><a href="#cb146-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-963"><a href="#cb146-963" aria-hidden="true" tabindex="-1"></a>Plot MASE for three different forecast periods - 5, 10, and 20 years - across all regions. MASE <span class="sc">\&lt;</span> 1 is a "good" value.</span>
<span id="cb146-964"><a href="#cb146-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-965"><a href="#cb146-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-966"><a href="#cb146-966" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTableSock) <span class="sc">+</span> </span>
<span id="cb146-967"><a href="#cb146-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb146-968"><a href="#cb146-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb146-969"><a href="#cb146-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-970"><a href="#cb146-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb146-971"><a href="#cb146-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sockeye"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-972"><a href="#cb146-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-973"><a href="#cb146-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-974"><a href="#cb146-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-975"><a href="#cb146-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-976"><a href="#cb146-976" aria-hidden="true" tabindex="-1"></a>None of the ARIMA models performed well for the forecasts of 20 years of data. Below is a comparison of the three lengths of forecasted data for South British Columbia where MASE was below 1 for the 5 year forecast but <span class="sc">\&gt;</span>1 for the 10 and 20 year forecasts.</span>
<span id="cb146-977"><a href="#cb146-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-980"><a href="#cb146-980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-981"><a href="#cb146-981" aria-hidden="true" tabindex="-1"></a>sock.sbc<span class="ot">&lt;-</span><span class="fu">subset</span>(SockByRegion, region<span class="sc">==</span><span class="st">'sbc'</span>)</span>
<span id="cb146-982"><a href="#cb146-982" aria-hidden="true" tabindex="-1"></a>sbc.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(sock.sbc<span class="sc">$</span>lnreturns, <span class="at">start=</span>sock.sbc<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-983"><a href="#cb146-983" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5, 10, and 20 year forecasts</span></span>
<span id="cb146-984"><a href="#cb146-984" aria-hidden="true" tabindex="-1"></a>train.sbc5<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-985"><a href="#cb146-985" aria-hidden="true" tabindex="-1"></a>test.sbc5<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-986"><a href="#cb146-986" aria-hidden="true" tabindex="-1"></a>sbc.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-987"><a href="#cb146-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-988"><a href="#cb146-988" aria-hidden="true" tabindex="-1"></a>train.sbc10<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-989"><a href="#cb146-989" aria-hidden="true" tabindex="-1"></a>test.sbc10<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-990"><a href="#cb146-990" aria-hidden="true" tabindex="-1"></a>sbc.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-991"><a href="#cb146-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-992"><a href="#cb146-992" aria-hidden="true" tabindex="-1"></a>train.sbc20<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-993"><a href="#cb146-993" aria-hidden="true" tabindex="-1"></a>test.sbc20<span class="ot">&lt;-</span><span class="fu">window</span>(sbc.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-994"><a href="#cb146-994" aria-hidden="true" tabindex="-1"></a>sbc.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.sbc20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-995"><a href="#cb146-995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-996"><a href="#cb146-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-997"><a href="#cb146-997" aria-hidden="true" tabindex="-1"></a>Here are plots of the three forecast scenarios for sockeye in South British Columbia.</span>
<span id="cb146-998"><a href="#cb146-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-999"><a href="#cb146-999" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=F}</span></span>
<span id="cb146-1000"><a href="#cb146-1000" aria-hidden="true" tabindex="-1"></a>sbc.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1001"><a href="#cb146-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1002"><a href="#cb146-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.sbc5))</span>
<span id="cb146-1003"><a href="#cb146-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1004"><a href="#cb146-1004" aria-hidden="true" tabindex="-1"></a>sbc.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1005"><a href="#cb146-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1006"><a href="#cb146-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.sbc10))</span>
<span id="cb146-1007"><a href="#cb146-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1008"><a href="#cb146-1008" aria-hidden="true" tabindex="-1"></a>sbc.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1009"><a href="#cb146-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1010"><a href="#cb146-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.sbc20))</span>
<span id="cb146-1011"><a href="#cb146-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1012"><a href="#cb146-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1013"><a href="#cb146-1013" aria-hidden="true" tabindex="-1"></a>Looking at stationarity:</span>
<span id="cb146-1016"><a href="#cb146-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1017"><a href="#cb146-1017" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestModSock, <span class="cf">function</span>(x){</span>
<span id="cb146-1018"><a href="#cb146-1018" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-1019"><a href="#cb146-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb146-1020"><a href="#cb146-1020" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-1021"><a href="#cb146-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1022"><a href="#cb146-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb146-1023"><a href="#cb146-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb146-1024"><a href="#cb146-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1025"><a href="#cb146-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb146-1026"><a href="#cb146-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Sockeye)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1027"><a href="#cb146-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1028"><a href="#cb146-1028" aria-hidden="true" tabindex="-1"></a>For Sockeye, 6 regions required differencing for all of the three subsets of the data (3 forecasting levels). Two regions required differencing for one subset of the data; four regions were stationary at any level of subsetting.</span>
<span id="cb146-1029"><a href="#cb146-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1030"><a href="#cb146-1030" aria-hidden="true" tabindex="-1"></a>None of the regional models for the 5-year forecast had autocorrelation in the residuals based on the results of the Ljung-Box test (p-value &gt; 0.05). </span>
<span id="cb146-1031"><a href="#cb146-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1032"><a href="#cb146-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chum:</span></span>
<span id="cb146-1033"><a href="#cb146-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1036"><a href="#cb146-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1037"><a href="#cb146-1037" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTableChum) <span class="sc">+</span> </span>
<span id="cb146-1038"><a href="#cb146-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb146-1039"><a href="#cb146-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb146-1040"><a href="#cb146-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1041"><a href="#cb146-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb146-1042"><a href="#cb146-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Chum"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1043"><a href="#cb146-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1044"><a href="#cb146-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1045"><a href="#cb146-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1046"><a href="#cb146-1046" aria-hidden="true" tabindex="-1"></a>Many of the 5 and 10 year forecasts for Chum seem to perform well across regions. Models fit to data in Russia do the worst at forecasting in that region. Additionally, forecasts are poor across the different numbers of years tested in E. Kamachatka, SE Alaska and W. Kamachatka.</span>
<span id="cb146-1047"><a href="#cb146-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1048"><a href="#cb146-1048" aria-hidden="true" tabindex="-1"></a>20 year forecast for Kodiak:</span>
<span id="cb146-1049"><a href="#cb146-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1052"><a href="#cb146-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1053"><a href="#cb146-1053" aria-hidden="true" tabindex="-1"></a>chum.kod<span class="ot">&lt;-</span><span class="fu">subset</span>(ChumByRegion, region<span class="sc">==</span><span class="st">'kod'</span>)</span>
<span id="cb146-1054"><a href="#cb146-1054" aria-hidden="true" tabindex="-1"></a>chum.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(chum.kod<span class="sc">$</span>lnreturns, <span class="at">start=</span>chum.kod<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-1055"><a href="#cb146-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#test datasets for plotting</span></span>
<span id="cb146-1056"><a href="#cb146-1056" aria-hidden="true" tabindex="-1"></a>test.kod20<span class="ot">&lt;-</span><span class="fu">window</span>(chum.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1057"><a href="#cb146-1057" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(RegionModsChum[[<span class="dv">9</span>]]<span class="sc">$</span>Fit, <span class="at">h =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.kod20))</span>
<span id="cb146-1058"><a href="#cb146-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1059"><a href="#cb146-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1060"><a href="#cb146-1060" aria-hidden="true" tabindex="-1"></a>10 year forecast for Russia:</span>
<span id="cb146-1061"><a href="#cb146-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1064"><a href="#cb146-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1065"><a href="#cb146-1065" aria-hidden="true" tabindex="-1"></a>chum.russ<span class="ot">&lt;-</span><span class="fu">subset</span>(ChumByRegion, region<span class="sc">==</span><span class="st">'m_i'</span>)</span>
<span id="cb146-1066"><a href="#cb146-1066" aria-hidden="true" tabindex="-1"></a>chum.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(chum.russ<span class="sc">$</span>lnreturns, <span class="at">start=</span>chum.russ<span class="sc">$</span>year[<span class="dv">1</span>])</span>
<span id="cb146-1067"><a href="#cb146-1067" aria-hidden="true" tabindex="-1"></a><span class="co">#test datasets for plotting</span></span>
<span id="cb146-1068"><a href="#cb146-1068" aria-hidden="true" tabindex="-1"></a>test.russ10<span class="ot">&lt;-</span><span class="fu">window</span>(chum.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1069"><a href="#cb146-1069" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(RegionModsChum[[<span class="dv">11</span>]]<span class="sc">$</span>Fit, <span class="at">h =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.russ10))</span>
<span id="cb146-1070"><a href="#cb146-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1071"><a href="#cb146-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1072"><a href="#cb146-1072" aria-hidden="true" tabindex="-1"></a>It looks like returns really increase at the end of the time series in this region, which is likely why ARIMA models don't forecast this well.</span>
<span id="cb146-1073"><a href="#cb146-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1074"><a href="#cb146-1074" aria-hidden="true" tabindex="-1"></a>Looking at stationarity:</span>
<span id="cb146-1075"><a href="#cb146-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1078"><a href="#cb146-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1079"><a href="#cb146-1079" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestModChum, <span class="cf">function</span>(x){</span>
<span id="cb146-1080"><a href="#cb146-1080" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-1081"><a href="#cb146-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb146-1082"><a href="#cb146-1082" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-1083"><a href="#cb146-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1084"><a href="#cb146-1084" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb146-1085"><a href="#cb146-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb146-1086"><a href="#cb146-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1087"><a href="#cb146-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb146-1088"><a href="#cb146-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Chum)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1089"><a href="#cb146-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1090"><a href="#cb146-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1091"><a href="#cb146-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1092"><a href="#cb146-1092" aria-hidden="true" tabindex="-1"></a>For Chum, time series for 5 of the regions were stationary (using tests from auto.arima) and 7 required 1 difference to be stationary.</span>
<span id="cb146-1093"><a href="#cb146-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1094"><a href="#cb146-1094" aria-hidden="true" tabindex="-1"></a>There was significant autocorrelation (based on Ljung-Box test) in 4 of the regional models for Chum:</span>
<span id="cb146-1095"><a href="#cb146-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1098"><a href="#cb146-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1099"><a href="#cb146-1099" aria-hidden="true" tabindex="-1"></a>ac_mods_chum<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">31</span>, <span class="dv">32</span>) <span class="co">#indexes of models with autocorrelated residuals</span></span>
<span id="cb146-1100"><a href="#cb146-1100" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_chum)){</span>
<span id="cb146-1101"><a href="#cb146-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTableChum<span class="sc">$</span>regions[ac_mods_chum[i]]], ResultsTableChum<span class="sc">$</span>forecastlevels[ac_mods_chum[i]]))</span>
<span id="cb146-1102"><a href="#cb146-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkresiduals</span>(RegionModsChum[[ac_mods_chum[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb146-1103"><a href="#cb146-1103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-1104"><a href="#cb146-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1105"><a href="#cb146-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1106"><a href="#cb146-1106" aria-hidden="true" tabindex="-1"></a>This suggests that ARIMA models may not be the best fit in this instance.</span>
<span id="cb146-1107"><a href="#cb146-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1108"><a href="#cb146-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pink:</span></span>
<span id="cb146-1109"><a href="#cb146-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1110"><a href="#cb146-1110" aria-hidden="true" tabindex="-1"></a>Plot MASE for three different forecast periods - 5, 10, and 20 years - across all regions. MASE <span class="sc">\&lt;</span> 1 is a "good" value.</span>
<span id="cb146-1111"><a href="#cb146-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1114"><a href="#cb146-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1115"><a href="#cb146-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb146-1116"><a href="#cb146-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable) <span class="sc">+</span> </span>
<span id="cb146-1117"><a href="#cb146-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb146-1118"><a href="#cb146-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb146-1119"><a href="#cb146-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1120"><a href="#cb146-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb146-1121"><a href="#cb146-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks all Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1122"><a href="#cb146-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1123"><a href="#cb146-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb146-1124"><a href="#cb146-1124" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable_even) <span class="sc">+</span> </span>
<span id="cb146-1125"><a href="#cb146-1125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb146-1126"><a href="#cb146-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb146-1127"><a href="#cb146-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1128"><a href="#cb146-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb146-1129"><a href="#cb146-1129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks Even Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1130"><a href="#cb146-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1131"><a href="#cb146-1131" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb146-1132"><a href="#cb146-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ResultsTable_odd) <span class="sc">+</span> </span>
<span id="cb146-1133"><a href="#cb146-1133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> regions, <span class="at">y =</span> MASE, <span class="at">fill =</span> <span class="fu">as.factor</span>(forecastlevels)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb146-1134"><a href="#cb146-1134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">1</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb146-1135"><a href="#cb146-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1136"><a href="#cb146-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>) <span class="sc">+</span> </span>
<span id="cb146-1137"><a href="#cb146-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pinks Odd Years"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1138"><a href="#cb146-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1139"><a href="#cb146-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1140"><a href="#cb146-1140" aria-hidden="true" tabindex="-1"></a>Despite the MASE fits seeming pretty good for the pink model runs some of the forecasts were underwhelming. Two regions were considered for forcasts, Cook Inlet, and SE Alaska with models that included for all years, even years, and odd years.</span>
<span id="cb146-1141"><a href="#cb146-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1142"><a href="#cb146-1142" aria-hidden="true" tabindex="-1"></a>The first region, Cook Inlet, performed poorly (relative to some of the other regions) when looking at MASE values.  </span>
<span id="cb146-1145"><a href="#cb146-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1146"><a href="#cb146-1146" aria-hidden="true" tabindex="-1"></a><span class="co">#Cook Inlet</span></span>
<span id="cb146-1147"><a href="#cb146-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------</span></span>
<span id="cb146-1148"><a href="#cb146-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb146-1149"><a href="#cb146-1149" aria-hidden="true" tabindex="-1"></a>pink.ci<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb146-1150"><a href="#cb146-1150" aria-hidden="true" tabindex="-1"></a>ci.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb146-1151"><a href="#cb146-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1152"><a href="#cb146-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1153"><a href="#cb146-1153" aria-hidden="true" tabindex="-1"></a>train.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-1154"><a href="#cb146-1154" aria-hidden="true" tabindex="-1"></a>test.ci5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1155"><a href="#cb146-1155" aria-hidden="true" tabindex="-1"></a>ci.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1156"><a href="#cb146-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1157"><a href="#cb146-1157" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1158"><a href="#cb146-1158" aria-hidden="true" tabindex="-1"></a>train.ci10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-1159"><a href="#cb146-1159" aria-hidden="true" tabindex="-1"></a>test.ci10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1160"><a href="#cb146-1160" aria-hidden="true" tabindex="-1"></a>ci.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1161"><a href="#cb146-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1162"><a href="#cb146-1162" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1163"><a href="#cb146-1163" aria-hidden="true" tabindex="-1"></a>train.ci20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-1164"><a href="#cb146-1164" aria-hidden="true" tabindex="-1"></a>test.ci20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1165"><a href="#cb146-1165" aria-hidden="true" tabindex="-1"></a>ci.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1166"><a href="#cb146-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1167"><a href="#cb146-1167" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb146-1168"><a href="#cb146-1168" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years</span></span>
<span id="cb146-1169"><a href="#cb146-1169" aria-hidden="true" tabindex="-1"></a>pink.ci_even<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_even, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb146-1170"><a href="#cb146-1170" aria-hidden="true" tabindex="-1"></a>ci.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci_even<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci_even<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-1171"><a href="#cb146-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1172"><a href="#cb146-1172" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1173"><a href="#cb146-1173" aria-hidden="true" tabindex="-1"></a>train.ci_even5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-1174"><a href="#cb146-1174" aria-hidden="true" tabindex="-1"></a>test.ci_even5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1175"><a href="#cb146-1175" aria-hidden="true" tabindex="-1"></a>ci_even.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1176"><a href="#cb146-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1177"><a href="#cb146-1177" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1178"><a href="#cb146-1178" aria-hidden="true" tabindex="-1"></a>train.ci_even10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-1179"><a href="#cb146-1179" aria-hidden="true" tabindex="-1"></a>test.ci_even10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1180"><a href="#cb146-1180" aria-hidden="true" tabindex="-1"></a>ci_even.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1181"><a href="#cb146-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1182"><a href="#cb146-1182" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1183"><a href="#cb146-1183" aria-hidden="true" tabindex="-1"></a>train.ci_even20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-1184"><a href="#cb146-1184" aria-hidden="true" tabindex="-1"></a>test.ci_even20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_even, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1185"><a href="#cb146-1185" aria-hidden="true" tabindex="-1"></a>ci_even.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_even20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1186"><a href="#cb146-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1187"><a href="#cb146-1187" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb146-1188"><a href="#cb146-1188" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years</span></span>
<span id="cb146-1189"><a href="#cb146-1189" aria-hidden="true" tabindex="-1"></a>pink.ci_odd<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_odd, region<span class="sc">==</span><span class="st">'ci'</span>)</span>
<span id="cb146-1190"><a href="#cb146-1190" aria-hidden="true" tabindex="-1"></a>ci.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.ci_odd<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.ci_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-1191"><a href="#cb146-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1192"><a href="#cb146-1192" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1193"><a href="#cb146-1193" aria-hidden="true" tabindex="-1"></a>train.ci_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2009</span>)</span>
<span id="cb146-1194"><a href="#cb146-1194" aria-hidden="true" tabindex="-1"></a>test.ci_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1195"><a href="#cb146-1195" aria-hidden="true" tabindex="-1"></a>ci_odd.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1196"><a href="#cb146-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1197"><a href="#cb146-1197" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1198"><a href="#cb146-1198" aria-hidden="true" tabindex="-1"></a>train.ci_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-1199"><a href="#cb146-1199" aria-hidden="true" tabindex="-1"></a>test.ci_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1200"><a href="#cb146-1200" aria-hidden="true" tabindex="-1"></a>ci_odd.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1201"><a href="#cb146-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1202"><a href="#cb146-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1203"><a href="#cb146-1203" aria-hidden="true" tabindex="-1"></a>train.ci_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-1204"><a href="#cb146-1204" aria-hidden="true" tabindex="-1"></a>test.ci_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(ci.ts_odd, <span class="at">start=</span><span class="dv">1997</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1205"><a href="#cb146-1205" aria-hidden="true" tabindex="-1"></a>ci_odd.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.ci_odd20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1206"><a href="#cb146-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1207"><a href="#cb146-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1208"><a href="#cb146-1208" aria-hidden="true" tabindex="-1"></a>Let's look at forcast plots for the best performing models that consider all data, even years, and odd years. </span>
<span id="cb146-1209"><a href="#cb146-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1212"><a href="#cb146-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1213"><a href="#cb146-1213" aria-hidden="true" tabindex="-1"></a><span class="co">#Plots</span></span>
<span id="cb146-1214"><a href="#cb146-1214" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> ci.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1215"><a href="#cb146-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1216"><a href="#cb146-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci5))</span>
<span id="cb146-1217"><a href="#cb146-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1218"><a href="#cb146-1218" aria-hidden="true" tabindex="-1"></a>plot_10 <span class="ot">&lt;-</span> ci.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1219"><a href="#cb146-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1220"><a href="#cb146-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci10))</span>
<span id="cb146-1221"><a href="#cb146-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1222"><a href="#cb146-1222" aria-hidden="true" tabindex="-1"></a>plot_20 <span class="ot">&lt;-</span> ci.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1223"><a href="#cb146-1223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1224"><a href="#cb146-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci20))</span>
<span id="cb146-1225"><a href="#cb146-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1226"><a href="#cb146-1226" aria-hidden="true" tabindex="-1"></a>plot_even_5 <span class="ot">&lt;-</span> ci_even.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1227"><a href="#cb146-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1228"><a href="#cb146-1228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even5))</span>
<span id="cb146-1229"><a href="#cb146-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1230"><a href="#cb146-1230" aria-hidden="true" tabindex="-1"></a>plot_even_10 <span class="ot">&lt;-</span> ci_even.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1231"><a href="#cb146-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1232"><a href="#cb146-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even10))</span>
<span id="cb146-1233"><a href="#cb146-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1234"><a href="#cb146-1234" aria-hidden="true" tabindex="-1"></a>plot_even_20 <span class="ot">&lt;-</span> ci_even.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1235"><a href="#cb146-1235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1236"><a href="#cb146-1236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_even20))</span>
<span id="cb146-1237"><a href="#cb146-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1238"><a href="#cb146-1238" aria-hidden="true" tabindex="-1"></a>plot_odd_5 <span class="ot">&lt;-</span> ci_odd.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1239"><a href="#cb146-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1240"><a href="#cb146-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd5))</span>
<span id="cb146-1241"><a href="#cb146-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1242"><a href="#cb146-1242" aria-hidden="true" tabindex="-1"></a>plot_odd_10 <span class="ot">&lt;-</span> ci_odd.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1243"><a href="#cb146-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1244"><a href="#cb146-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd10))</span>
<span id="cb146-1245"><a href="#cb146-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1246"><a href="#cb146-1246" aria-hidden="true" tabindex="-1"></a>plot_odd_20 <span class="ot">&lt;-</span> ci_odd.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1247"><a href="#cb146-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1248"><a href="#cb146-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.ci_odd20))</span>
<span id="cb146-1249"><a href="#cb146-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1250"><a href="#cb146-1250" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_5, plot_10, plot_20, plot_even_5, plot_even_10, plot_even_20, plot_odd_5, plot_odd_10, plot_odd_20, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb146-1251"><a href="#cb146-1251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1252"><a href="#cb146-1252" aria-hidden="true" tabindex="-1"></a>None of the models fit well. Let's look at one more region. </span>
<span id="cb146-1253"><a href="#cb146-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1256"><a href="#cb146-1256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1257"><a href="#cb146-1257" aria-hidden="true" tabindex="-1"></a><span class="co">#SE AK</span></span>
<span id="cb146-1258"><a href="#cb146-1258" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------</span></span>
<span id="cb146-1259"><a href="#cb146-1259" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years</span></span>
<span id="cb146-1260"><a href="#cb146-1260" aria-hidden="true" tabindex="-1"></a>pink.seak<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb146-1261"><a href="#cb146-1261" aria-hidden="true" tabindex="-1"></a>seak.ts<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-1262"><a href="#cb146-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1263"><a href="#cb146-1263" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1264"><a href="#cb146-1264" aria-hidden="true" tabindex="-1"></a>train.seak5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-1265"><a href="#cb146-1265" aria-hidden="true" tabindex="-1"></a>test.seak5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1266"><a href="#cb146-1266" aria-hidden="true" tabindex="-1"></a>seak.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1267"><a href="#cb146-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1268"><a href="#cb146-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1269"><a href="#cb146-1269" aria-hidden="true" tabindex="-1"></a>train.seak10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-1270"><a href="#cb146-1270" aria-hidden="true" tabindex="-1"></a>test.seak10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1271"><a href="#cb146-1271" aria-hidden="true" tabindex="-1"></a>seak.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1272"><a href="#cb146-1272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1273"><a href="#cb146-1273" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1274"><a href="#cb146-1274" aria-hidden="true" tabindex="-1"></a>train.seak20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-1275"><a href="#cb146-1275" aria-hidden="true" tabindex="-1"></a>test.seak20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1276"><a href="#cb146-1276" aria-hidden="true" tabindex="-1"></a>seak.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1277"><a href="#cb146-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1278"><a href="#cb146-1278" aria-hidden="true" tabindex="-1"></a><span class="co">#----------------------------------------------------</span></span>
<span id="cb146-1279"><a href="#cb146-1279" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years</span></span>
<span id="cb146-1280"><a href="#cb146-1280" aria-hidden="true" tabindex="-1"></a>pink.seak_even<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_even, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb146-1281"><a href="#cb146-1281" aria-hidden="true" tabindex="-1"></a>seak.ts_even<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak_even<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak_even<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-1282"><a href="#cb146-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1283"><a href="#cb146-1283" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1284"><a href="#cb146-1284" aria-hidden="true" tabindex="-1"></a>train.seak_even5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2010</span>)</span>
<span id="cb146-1285"><a href="#cb146-1285" aria-hidden="true" tabindex="-1"></a>test.seak_even5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">2012</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1286"><a href="#cb146-1286" aria-hidden="true" tabindex="-1"></a>seak_even.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1287"><a href="#cb146-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1288"><a href="#cb146-1288" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1289"><a href="#cb146-1289" aria-hidden="true" tabindex="-1"></a>train.seak_even10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">2004</span>)</span>
<span id="cb146-1290"><a href="#cb146-1290" aria-hidden="true" tabindex="-1"></a>test.seak_even10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">2006</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1291"><a href="#cb146-1291" aria-hidden="true" tabindex="-1"></a>seak_even.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1292"><a href="#cb146-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1293"><a href="#cb146-1293" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1294"><a href="#cb146-1294" aria-hidden="true" tabindex="-1"></a>train.seak_even20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1952</span>, <span class="at">end=</span><span class="dv">1994</span>)</span>
<span id="cb146-1295"><a href="#cb146-1295" aria-hidden="true" tabindex="-1"></a>test.seak_even20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_even, <span class="at">start=</span><span class="dv">1996</span>, <span class="at">end=</span><span class="dv">2014</span>)</span>
<span id="cb146-1296"><a href="#cb146-1296" aria-hidden="true" tabindex="-1"></a>seak_even.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_even20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1297"><a href="#cb146-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1298"><a href="#cb146-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#------------------------------</span></span>
<span id="cb146-1299"><a href="#cb146-1299" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years</span></span>
<span id="cb146-1300"><a href="#cb146-1300" aria-hidden="true" tabindex="-1"></a>pink.seak_odd<span class="ot">&lt;-</span><span class="fu">subset</span>(PinkByRegion_odd, region<span class="sc">==</span><span class="st">'seak'</span>)</span>
<span id="cb146-1301"><a href="#cb146-1301" aria-hidden="true" tabindex="-1"></a>seak.ts_odd<span class="ot">&lt;-</span><span class="fu">ts</span>(pink.seak_odd<span class="sc">$</span>lnreturns, <span class="at">start=</span>pink.seak_odd<span class="sc">$</span>year[<span class="dv">1</span>], <span class="at">frequency =</span> <span class="fl">0.5</span>)</span>
<span id="cb146-1302"><a href="#cb146-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1303"><a href="#cb146-1303" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 5 year forecast </span></span>
<span id="cb146-1304"><a href="#cb146-1304" aria-hidden="true" tabindex="-1"></a>train.seak_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2009</span>)</span>
<span id="cb146-1305"><a href="#cb146-1305" aria-hidden="true" tabindex="-1"></a>test.seak_odd5<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">2011</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1306"><a href="#cb146-1306" aria-hidden="true" tabindex="-1"></a>seak_odd.final5<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd5, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1307"><a href="#cb146-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1308"><a href="#cb146-1308" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 10 year forecast </span></span>
<span id="cb146-1309"><a href="#cb146-1309" aria-hidden="true" tabindex="-1"></a>train.seak_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">2005</span>)</span>
<span id="cb146-1310"><a href="#cb146-1310" aria-hidden="true" tabindex="-1"></a>test.seak_odd10<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">2007</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1311"><a href="#cb146-1311" aria-hidden="true" tabindex="-1"></a>seak_odd.final10<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd10, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1312"><a href="#cb146-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1313"><a href="#cb146-1313" aria-hidden="true" tabindex="-1"></a><span class="co">#create training and test datasets for the 20 year forecast </span></span>
<span id="cb146-1314"><a href="#cb146-1314" aria-hidden="true" tabindex="-1"></a>train.seak_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1953</span>, <span class="at">end=</span><span class="dv">1995</span>)</span>
<span id="cb146-1315"><a href="#cb146-1315" aria-hidden="true" tabindex="-1"></a>test.seak_odd20<span class="ot">&lt;-</span><span class="fu">window</span>(seak.ts_odd, <span class="at">start=</span><span class="dv">1997</span>, <span class="at">end=</span><span class="dv">2015</span>)</span>
<span id="cb146-1316"><a href="#cb146-1316" aria-hidden="true" tabindex="-1"></a>seak_odd.final20<span class="ot">&lt;-</span>forecast<span class="sc">::</span><span class="fu">auto.arima</span>(train.seak_odd20, <span class="at">approximation =</span> F, <span class="at">stepwise =</span> F)</span>
<span id="cb146-1317"><a href="#cb146-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1318"><a href="#cb146-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1319"><a href="#cb146-1319" aria-hidden="true" tabindex="-1"></a>Let's look at forcast plots for the best performing models that consider all data, even years, and odd years. </span>
<span id="cb146-1322"><a href="#cb146-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1323"><a href="#cb146-1323" aria-hidden="true" tabindex="-1"></a><span class="co">#Plots </span></span>
<span id="cb146-1324"><a href="#cb146-1324" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">&lt;-</span> seak.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1325"><a href="#cb146-1325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1326"><a href="#cb146-1326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak5))</span>
<span id="cb146-1327"><a href="#cb146-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1328"><a href="#cb146-1328" aria-hidden="true" tabindex="-1"></a>plot_10 <span class="ot">&lt;-</span> seak.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1329"><a href="#cb146-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1330"><a href="#cb146-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak10))</span>
<span id="cb146-1331"><a href="#cb146-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1332"><a href="#cb146-1332" aria-hidden="true" tabindex="-1"></a>plot_20 <span class="ot">&lt;-</span> seak.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1333"><a href="#cb146-1333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1334"><a href="#cb146-1334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak20))</span>
<span id="cb146-1335"><a href="#cb146-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1336"><a href="#cb146-1336" aria-hidden="true" tabindex="-1"></a>plot_even_5 <span class="ot">&lt;-</span> seak_even.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1337"><a href="#cb146-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1338"><a href="#cb146-1338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even5))</span>
<span id="cb146-1339"><a href="#cb146-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1340"><a href="#cb146-1340" aria-hidden="true" tabindex="-1"></a>plot_even_10 <span class="ot">&lt;-</span> seak_even.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1341"><a href="#cb146-1341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1342"><a href="#cb146-1342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even10))</span>
<span id="cb146-1343"><a href="#cb146-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1344"><a href="#cb146-1344" aria-hidden="true" tabindex="-1"></a>plot_even_20 <span class="ot">&lt;-</span> seak_even.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1345"><a href="#cb146-1345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1346"><a href="#cb146-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_even20))</span>
<span id="cb146-1347"><a href="#cb146-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1348"><a href="#cb146-1348" aria-hidden="true" tabindex="-1"></a>plot_odd_5 <span class="ot">&lt;-</span> seak_odd.final5 <span class="sc">%&gt;%</span></span>
<span id="cb146-1349"><a href="#cb146-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1350"><a href="#cb146-1350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd5))</span>
<span id="cb146-1351"><a href="#cb146-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1352"><a href="#cb146-1352" aria-hidden="true" tabindex="-1"></a>plot_odd_10 <span class="ot">&lt;-</span> seak_odd.final10 <span class="sc">%&gt;%</span></span>
<span id="cb146-1353"><a href="#cb146-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1354"><a href="#cb146-1354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd10))</span>
<span id="cb146-1355"><a href="#cb146-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1356"><a href="#cb146-1356" aria-hidden="true" tabindex="-1"></a>plot_odd_20 <span class="ot">&lt;-</span> seak_odd.final20 <span class="sc">%&gt;%</span></span>
<span id="cb146-1357"><a href="#cb146-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-1358"><a href="#cb146-1358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span><span class="fu">fortify</span>(test.seak_odd20))</span>
<span id="cb146-1359"><a href="#cb146-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1360"><a href="#cb146-1360" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_5, plot_10, plot_20, plot_even_5, plot_even_10, plot_even_20, plot_odd_5, plot_odd_10, plot_odd_20, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb146-1361"><a href="#cb146-1361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1362"><a href="#cb146-1362" aria-hidden="true" tabindex="-1"></a>These models were all pretty flat and also didn't seem to capture the trends particularly well. </span>
<span id="cb146-1363"><a href="#cb146-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1364"><a href="#cb146-1364" aria-hidden="true" tabindex="-1"></a>Next, the number of models that had a differencing was plotted for all years, even years, and odd years.  </span>
<span id="cb146-1365"><a href="#cb146-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1368"><a href="#cb146-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1369"><a href="#cb146-1369" aria-hidden="true" tabindex="-1"></a><span class="co">#All Years </span></span>
<span id="cb146-1370"><a href="#cb146-1370" aria-hidden="true" tabindex="-1"></a>Ndiff<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod, <span class="cf">function</span>(x){</span>
<span id="cb146-1371"><a href="#cb146-1371" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-1372"><a href="#cb146-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb146-1373"><a href="#cb146-1373" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-1374"><a href="#cb146-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1375"><a href="#cb146-1375" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb146-1376"><a href="#cb146-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb146-1377"><a href="#cb146-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1378"><a href="#cb146-1378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb146-1379"><a href="#cb146-1379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-All Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1380"><a href="#cb146-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1381"><a href="#cb146-1381" aria-hidden="true" tabindex="-1"></a><span class="co">#Even Years </span></span>
<span id="cb146-1382"><a href="#cb146-1382" aria-hidden="true" tabindex="-1"></a>Ndiff_even<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod_even, <span class="cf">function</span>(x){</span>
<span id="cb146-1383"><a href="#cb146-1383" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-1384"><a href="#cb146-1384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb146-1385"><a href="#cb146-1385" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-1386"><a href="#cb146-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1387"><a href="#cb146-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff_even, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb146-1388"><a href="#cb146-1388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb146-1389"><a href="#cb146-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1390"><a href="#cb146-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb146-1391"><a href="#cb146-1391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-Even Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1392"><a href="#cb146-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1393"><a href="#cb146-1393" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd Years </span></span>
<span id="cb146-1394"><a href="#cb146-1394" aria-hidden="true" tabindex="-1"></a>Ndiff_odd<span class="ot">&lt;-</span><span class="fu">sapply</span>(RegionBestMod_odd, <span class="cf">function</span>(x){</span>
<span id="cb146-1395"><a href="#cb146-1395" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">&lt;-</span><span class="fu">strsplit</span>(<span class="fu">strsplit</span>(<span class="fu">strsplit</span>(x, <span class="st">"[(]"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">"[)]"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],<span class="st">"[,]"</span>)</span>
<span id="cb146-1396"><a href="#cb146-1396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a[[<span class="dv">1</span>]][<span class="dv">2</span>])}</span>
<span id="cb146-1397"><a href="#cb146-1397" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-1398"><a href="#cb146-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1399"><a href="#cb146-1399" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Ndiff =</span> Ndiff_odd, <span class="at">region =</span> Allcombs<span class="sc">$</span>regions, <span class="at">level =</span> Allcombs<span class="sc">$</span>forecastlevels) <span class="sc">%&gt;%</span></span>
<span id="cb146-1400"><a href="#cb146-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> region, <span class="at">y =</span> Ndiff, <span class="at">fill =</span> <span class="fu">as.factor</span>(level)), <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb146-1401"><a href="#cb146-1401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">as_labeller</span>(regionskey)) <span class="sc">+</span></span>
<span id="cb146-1402"><a href="#cb146-1402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Forecast Levels"</span>, <span class="at">x =</span> <span class="st">"Region"</span>, <span class="at">y =</span> <span class="st">"Number of Differences"</span>) <span class="sc">+</span> </span>
<span id="cb146-1403"><a href="#cb146-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of differences to achieve stationarity (Pink-Odd Years)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">angle=</span><span class="sc">-</span><span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span> ))</span>
<span id="cb146-1404"><a href="#cb146-1404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1405"><a href="#cb146-1405" aria-hidden="true" tabindex="-1"></a>When considering models that used all data, five regions needed differencing. In models that considered even years only, six regions needed differencing.</span>
<span id="cb146-1406"><a href="#cb146-1406" aria-hidden="true" tabindex="-1"></a>In models that considered odd years only, ten regions needed differencing. </span>
<span id="cb146-1407"><a href="#cb146-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1408"><a href="#cb146-1408" aria-hidden="true" tabindex="-1"></a>Finally we're going to look at some residuals for models that displayed autocorraltion based on Ljung-Box test. There were only </span>
<span id="cb146-1411"><a href="#cb146-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb146-1412"><a href="#cb146-1412" aria-hidden="true" tabindex="-1"></a><span class="co">#Residuals </span></span>
<span id="cb146-1413"><a href="#cb146-1413" aria-hidden="true" tabindex="-1"></a><span class="co">#all</span></span>
<span id="cb146-1414"><a href="#cb146-1414" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">29</span>)</span>
<span id="cb146-1415"><a href="#cb146-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1416"><a href="#cb146-1416" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink)){</span>
<span id="cb146-1417"><a href="#cb146-1417" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable<span class="sc">$</span>regions[ac_mods_Pink[i]]], ResultsTable_even<span class="sc">$</span>forecastlevels[ac_mods_Pink[i]]))</span>
<span id="cb146-1418"><a href="#cb146-1418" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(RegionMods[[ac_mods_Pink[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb146-1419"><a href="#cb146-1419" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-1420"><a href="#cb146-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1421"><a href="#cb146-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#Even</span></span>
<span id="cb146-1422"><a href="#cb146-1422" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink_even<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">20</span>) </span>
<span id="cb146-1423"><a href="#cb146-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1424"><a href="#cb146-1424" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink_even)){</span>
<span id="cb146-1425"><a href="#cb146-1425" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable_even<span class="sc">$</span>regions[ac_mods_Pink_even[i]]], ResultsTable_even<span class="sc">$</span>forecastlevels[ac_mods_Pink_even[i]]))</span>
<span id="cb146-1426"><a href="#cb146-1426" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(RegionMods_even[[ac_mods_Pink_even[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb146-1427"><a href="#cb146-1427" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-1428"><a href="#cb146-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1429"><a href="#cb146-1429" aria-hidden="true" tabindex="-1"></a><span class="co">#Odd</span></span>
<span id="cb146-1430"><a href="#cb146-1430" aria-hidden="true" tabindex="-1"></a>ac_mods_Pink_odd<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">8</span>) </span>
<span id="cb146-1431"><a href="#cb146-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1432"><a href="#cb146-1432" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ac_mods_Pink_odd)){</span>
<span id="cb146-1433"><a href="#cb146-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(regionskey[ResultsTable_odd<span class="sc">$</span>regions[ac_mods_Pink_odd[i]]], ResultsTable_odd<span class="sc">$</span>forecastlevels[ac_mods_Pink_odd[i]]))</span>
<span id="cb146-1434"><a href="#cb146-1434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">checkresiduals</span>(RegionMods_odd[[ac_mods_Pink_odd[i]]]<span class="sc">$</span>Fit)</span>
<span id="cb146-1435"><a href="#cb146-1435" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-1436"><a href="#cb146-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1437"><a href="#cb146-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1438"><a href="#cb146-1438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb146-1439"><a href="#cb146-1439" aria-hidden="true" tabindex="-1"></a>#---------------------------------------------------------------------</span>
<span id="cb146-1440"><a href="#cb146-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1441"><a href="#cb146-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1442"><a href="#cb146-1442" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb146-1443"><a href="#cb146-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1444"><a href="#cb146-1444" aria-hidden="true" tabindex="-1"></a>Comparing the models across the three forecasts for SBC underlines that the data chosen for a forecast matters. Not only is the estimated ARIMA a better fit for a shorter forecast (and is trained on more data), but the training data for the model for the 20 year forecast is not stationary so the ARIMA parameters are very different from the parameters estimated for the 5 and 10 year forecasts. </span>
<span id="cb146-1445"><a href="#cb146-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1446"><a href="#cb146-1446" aria-hidden="true" tabindex="-1"></a>For sockeye, six regions had at least one forecast with a well performing model (MASE <span class="sc">\&lt;</span> 1); however, six regions did not have MASE <span class="sc">\&lt;</span> 1 for even the 5 year forecast model. None of the 20 year forecasts resulted in MASE <span class="sc">\&lt;</span> 1. This suggests that our data are so stochastic that it is difficult to forecast more than 5 years into the future. Another hypothesis could be that the training data set isn't long enough to generate a good model for the 20 year forecast, but from looking at the data we think the large inter-year variability in returns makes it difficult to fit an accurate model. In general, the models that fit the data better (lower MASE) tended to include differencing and were more likely to have higher order parameters.</span>
<span id="cb146-1447"><a href="#cb146-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1448"><a href="#cb146-1448" aria-hidden="true" tabindex="-1"></a>Models fit to Chum do better than models fit to Sockeye. There may be something about the patterns of chum population fluctuations that are more amenable to being modeled with ARIMA.</span>
<span id="cb146-1449"><a href="#cb146-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1450"><a href="#cb146-1450" aria-hidden="true" tabindex="-1"></a>Model fits to pink depended on data assumptions given their cyclic life history, and while the MASE results were lower than the other stock, ARIMA models are likely not the appropriate method for assessing or predicting pinnk returns with any level of certainty. </span>
<span id="cb146-1451"><a href="#cb146-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1452"><a href="#cb146-1452" aria-hidden="true" tabindex="-1"></a><span class="fu"># Description of each team member's contributions</span></span>
<span id="cb146-1453"><a href="#cb146-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-1454"><a href="#cb146-1454" aria-hidden="true" tabindex="-1"></a>All team members helped decide on the goal and ran the analyses for the individual species and all regions. All team members wrote the code and created the results for one species. ZR researched approaches for measuring accuracy of forecasts and created functions to run the ARIMA models over multiple regions and select the best model (even if it was different than selected by auto.arima). ETS and MS modified this code to work with their own species. All team members helped write and edit the report.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>