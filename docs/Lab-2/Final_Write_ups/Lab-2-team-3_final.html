<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Miranda Mudge, Karl Veggerby, Nick Chambers">

<title>10&nbsp; Team 3 - Lab 2 – Fish 550 Spring 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" rel="next">
<link href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-2/Lab2-MARSS.html">Analyzing multivariate salmon data with MARSS</a></li><li class="breadcrumb-item"><a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Lab-5-DLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Lab 5 - Dynamic Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Team 1 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#test-different-regions-as-sub-groups" id="toc-test-different-regions-as-sub-groups" class="nav-link" data-scroll-target="#test-different-regions-as-sub-groups">Test different regions as sub-groups</a>
  <ul class="collapse">
  <li><a href="#compare-the-new-models-using-aicc" id="toc-compare-the-new-models-using-aicc" class="nav-link" data-scroll-target="#compare-the-new-models-using-aicc">compare the new models using AICc</a>
  <ul class="collapse">
  <li><a href="#including-cycling---using-our-coho-data-full-time-series" id="toc-including-cycling---using-our-coho-data-full-time-series" class="nav-link" data-scroll-target="#including-cycling---using-our-coho-data-full-time-series">Including cycling - using our coho data, full time series</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#plot-the-acf-and-look-for-evidence-of-cycling" id="toc-plot-the-acf-and-look-for-evidence-of-cycling" class="nav-link" data-scroll-target="#plot-the-acf-and-look-for-evidence-of-cycling">Plot the ACF and look for evidence of cycling</a>
  <ul class="collapse">
  <li><a href="#note-renaming-model" id="toc-note-renaming-model" class="nav-link" data-scroll-target="#note-renaming-model">note renaming model</a></li>
  </ul></li>
  <li><a href="#plot-the-cis-and-look-for-evidence-of-cycling" id="toc-plot-the-cis-and-look-for-evidence-of-cycling" class="nav-link" data-scroll-target="#plot-the-cis-and-look-for-evidence-of-cycling">Plot the CI’s and look for evidence of cycling</a></li>
  <li><a href="#fit-the-best-model" id="toc-fit-the-best-model" class="nav-link" data-scroll-target="#fit-the-best-model">Fit the best model</a>
  <ul class="collapse">
  <li><a href="#fitting-the-best-model-to-the-full-data-set" id="toc-fitting-the-best-model-to-the-full-data-set" class="nav-link" data-scroll-target="#fitting-the-best-model-to-the-full-data-set">Fitting the best model to the full data set</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#contributions---add-your-contributions" id="toc-contributions---add-your-contributions" class="nav-link" data-scroll-target="#contributions---add-your-contributions">Contributions - add your contributions!</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-2/Final_Write_ups/Lab-2-team-3_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-2/Final_Write_ups/Lab-2-team-3_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-2/Lab2-MARSS.html">Analyzing multivariate salmon data with MARSS</a></li><li class="breadcrumb-item"><a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lab 2 MARSS models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Miranda Mudge, Karl Veggerby, Nick Chambers </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="data" class="level1">
<h1>Data</h1>
<p>We were assigned the Lower Columbia Coho data set. We selected two rivers from each Major Population Group (MPG) to test the performance of several models. The selected populations are:</p>
<p>Cascade MPG - Tilton and Sandy Rivers</p>
<p>Gorge MPG Upper and Lower Gorge Tributaries</p>
<p>Coast MPG Clatskanie, and Grays/Chinook Rivers</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-2"</span>, <span class="st">"Data_Images"</span>, <span class="st">"columbia-river.rda"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>esu <span class="ot">&lt;-</span> <span class="fu">unique</span>(columbia.river<span class="sc">$</span>esu_dps)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>plotesu <span class="ot">&lt;-</span> <span class="cf">function</span>(esuname){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> columbia.river <span class="sc">%&gt;%</span> <span class="fu">subset</span>(esu_dps <span class="sc">%in%</span> esuname)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>spawningyear, <span class="at">y=</span><span class="fu">log</span>(value), <span class="at">color=</span>majorpopgroup)) <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>esapopname) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(esuname, <span class="at">collapse=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plotesu</span>(esu[<span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Wrangle the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#format for visualization</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>esuname <span class="ot">&lt;-</span> esu[<span class="dv">4</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> columbia.river <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(esu_dps <span class="sc">==</span> esuname) <span class="sc">%&gt;%</span> <span class="co"># get only this ESU</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log.spawner =</span> <span class="fu">log</span>(value)) <span class="sc">%&gt;%</span> <span class="co"># create a column called log.spawner</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(esapopname, spawningyear, log.spawner) <span class="sc">%&gt;%</span> <span class="co"># get just the columns that I need</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"esapopname"</span>, <span class="at">values_from =</span> <span class="st">"log.spawner"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"spawningyear"</span>) <span class="sc">%&gt;%</span> <span class="co"># make the years rownames</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="co"># turn into a matrix with year down the rows</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="co"># make time across the columns</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># MARSS complains if I don't do this</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>dat[<span class="fu">is.na</span>(dat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Clean up the row names</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(dat)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(tmp, <span class="st">"Salmon, coho [(]Lower Columbia River ESU[)]"</span>, <span class="st">""</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_trim</span>(tmp)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat) <span class="ot">&lt;-</span> tmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Select a subset of rivers to test</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod_rivers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sandy River - early and late"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Grays and Chinook Rivers - late"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Clatskanie River - late"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Lower Gorge Tributaries - late"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Tilton River - early and late"</span> , </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Oregon Upper Gorge Tributaries and Hood River - early"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> dat[<span class="fu">rownames</span>(dat) <span class="sc">%in%</span> mod_rivers, ] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>We tested many models and a variety of assumptions, many of which varied by model. For all models we assumed that A was a scaling parameter.</p>
<p>Below we made a variety of assumptions and used them to generate five models to test which set of assumptions would produce the best fit to the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: all regions are behaving independently (x) but observations were collected similarly</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## each region has it's own drift where U = unequal </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## variance is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## we leave Q unconstrained here, this gives the most flexibility for each population to be unique, but may not be the best approach as we assume they should be at least somewhat related due to geographic proximity</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>mod.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: all regions are reflecting 1 underlying state (x) with equal variance</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 underlying state where U = equal</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">## R is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Q is again unconstrained but the U is equal so slighty less variation between populations than model 1</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>mod.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"equal"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: flexible model with unequal observation variance and a matrix for drift and state variance and one underlying state</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="do">## set scaling on B as 1</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="do">## U is matrix of estimated values</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="do">## variance Q is constrained so that all populations vary together</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="do">## variance R is diagonal and unequal to account for potential differences in observation error, ie different methods between regions</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="do">## A intercept can change as needed </span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Z matrix is based on our 6 selected populations and each is treated as different</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>mod.list3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">matrix</span>(<span class="dv">1</span>), </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>), </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="co"># 1 X</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">1</span>), </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="st">"mu"</span>), </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4: flexible model for independent regions</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="do">## B and Z scale to size of matrix, all 1's</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="do">## U = bias = independent matrix set to size of dataframe</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Q eaual variance in state with equal covariances</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="do">## R variance is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>mod.list4 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">6</span>), </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>,<span class="dv">6</span>,<span class="dv">1</span>), </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>, </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">6</span>), </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>, </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x0 =</span> <span class="st">"unequal"</span>, </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5: keep it simple. Each region has an independent state, observation variance is the same, and one process variance with one covariance. </span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>mod.list5 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we fit the model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list1, <span class="at">method=</span><span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 238 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 238 iterations. 
Log-likelihood: -132.2021 
AIC: 332.4043   AICc: 360.0787   
 
                                                           Estimate
R.diag                                                      0.01438
U.X.Sandy River - early and late                            0.04086
U.X.Tilton River - early and late                           0.13791
U.X.Clatskanie River - late                                 0.00863
U.X.Grays and Chinook Rivers - late                         0.10476
U.X.Lower Gorge Tributaries - late                         -0.00326
U.X.Oregon Upper Gorge Tributaries and Hood River - early   0.07033
Q.(1,1)                                                     0.96632
Q.(2,1)                                                     0.23773
Q.(3,1)                                                     0.86258
Q.(4,1)                                                     0.61088
Q.(5,1)                                                     0.92889
Q.(6,1)                                                     0.23482
Q.(2,2)                                                     0.32067
Q.(3,2)                                                     0.01290
Q.(4,2)                                                     0.01512
Q.(5,2)                                                     0.09117
Q.(6,2)                                                     0.01120
Q.(3,3)                                                     0.99958
Q.(4,3)                                                     0.81170
Q.(5,3)                                                     1.18893
Q.(6,3)                                                     0.49625
Q.(4,4)                                                     0.79880
Q.(5,4)                                                     1.19349
Q.(6,4)                                                     0.70243
Q.(5,5)                                                     1.81854
Q.(6,5)                                                     1.23660
Q.(6,6)                                                     2.31940
x0.X.Sandy River - early and late                           6.26627
x0.X.Tilton River - early and late                          4.87102
x0.X.Clatskanie River - late                                6.37770
x0.X.Grays and Chinook Rivers - late                        3.79437
x0.X.Lower Gorge Tributaries - late                         7.22292
x0.X.Oregon Upper Gorge Tributaries and Hood River - early  4.15493
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list2, <span class="at">method=</span><span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 228 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 228 iterations. 
Log-likelihood: -132.6153 
AIC: 323.2306   AICc: 342.3515   
 
                                                            Estimate
R.diag                                                      0.014405
U.1                                                         0.113374
Q.(1,1)                                                     0.971613
Q.(2,1)                                                     0.226563
Q.(3,1)                                                     0.866885
Q.(4,1)                                                     0.595561
Q.(5,1)                                                     0.935713
Q.(6,1)                                                     0.244217
Q.(2,2)                                                     0.317706
Q.(3,2)                                                     0.000202
Q.(4,2)                                                     0.077537
Q.(5,2)                                                     0.071455
Q.(6,2)                                                    -0.014512
Q.(3,3)                                                     1.004670
Q.(4,3)                                                     0.747402
Q.(5,3)                                                     1.197406
Q.(6,3)                                                     0.499534
Q.(4,4)                                                     0.750104
Q.(5,4)                                                     1.156733
Q.(6,4)                                                     0.663932
Q.(5,5)                                                     1.831847
Q.(6,5)                                                     1.249664
Q.(6,6)                                                     2.315909
x0.X.Sandy River - early and late                           6.192479
x0.X.Tilton River - early and late                          5.770486
x0.X.Clatskanie River - late                                5.362233
x0.X.Grays and Chinook Rivers - late                        5.952552
x0.X.Lower Gorge Tributaries - late                         5.970913
x0.X.Oregon Upper Gorge Tributaries and Hood River - early  3.605473
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 75 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 75 iterations. 
Log-likelihood: -152.7093 
AIC: 333.4185   AICc: 337.3808   
 
                                                                                                                Estimate
A.Tilton River - early and late                                                                                   1.8010
A.Clatskanie River - late                                                                                        -0.6439
A.Grays and Chinook Rivers - late                                                                                 0.2379
A.Lower Gorge Tributaries - late                                                                                 -1.0716
A.Oregon Upper Gorge Tributaries and Hood River - early                                                          -1.2511
R.(Sandy River - early and late,Sandy River - early and late)                                                     0.2843
R.(Tilton River - early and late,Tilton River - early and late)                                                   0.7014
R.(Clatskanie River - late,Clatskanie River - late)                                                               0.2951
R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)                                               0.0384
R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)                                                 0.5659
R.(Oregon Upper Gorge Tributaries and Hood River - early,Oregon Upper Gorge Tributaries and Hood River - early)   1.5916
U.u                                                                                                               0.0326
Q.q                                                                                                               0.3637
x0.mu                                                                                                             6.2476
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=500) reached before log-log convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=500) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -166.2868 
AIC: 360.5736   AICc: 364.5358   
 
                                                                                                                    Estimate
R.diag                                                                                                              0.453112
U.u                                                                                                                 0.055434
Q.(X.Sandy River - early and late,X.Sandy River - early and late)                                                   0.092472
Q.(X.Tilton River - early and late,X.Tilton River - early and late)                                                 0.105175
Q.(X.Clatskanie River - late,X.Clatskanie River - late)                                                             0.081650
Q.(X.Grays and Chinook Rivers - late,X.Grays and Chinook Rivers - late)                                             0.000648
Q.(X.Lower Gorge Tributaries - late,X.Lower Gorge Tributaries - late)                                               0.231055
Q.(X.Oregon Upper Gorge Tributaries and Hood River - early,X.Oregon Upper Gorge Tributaries and Hood River - early) 1.369032
x0.X.Sandy River - early and late                                                                                   6.069829
x0.X.Tilton River - early and late                                                                                  6.777505
x0.X.Clatskanie River - late                                                                                        4.281262
x0.X.Grays and Chinook Rivers - late                                                                                5.479334
x0.X.Lower Gorge Tributaries - late                                                                                 4.620066
x0.X.Oregon Upper Gorge Tributaries and Hood River - early                                                          4.422688
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  Q.(X.Grays and Chinook Rivers - late,X.Grays and Chinook Rivers - late)  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list5, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 893 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 893 iterations. 
Log-likelihood: -153.8425 
AIC: 337.6851   AICc: 342.2565   
 
                                                           Estimate
R.diag                                                      0.46807
U.X.Sandy River - early and late                            0.04176
U.X.Tilton River - early and late                          -0.06150
U.X.Clatskanie River - late                                 0.02970
U.X.Grays and Chinook Rivers - late                         0.05641
U.X.Lower Gorge Tributaries - late                         -0.05582
U.X.Oregon Upper Gorge Tributaries and Hood River - early  -0.00703
Q.diag                                                      0.33587
Q.offdiag                                                   0.33577
x0.X.Sandy River - early and late                           6.19170
x0.X.Tilton River - early and late                         11.29497
x0.X.Clatskanie River - late                                5.93388
x0.X.Grays and Chinook Rivers - late                        5.70333
x0.X.Lower Gorge Tributaries - late                         8.76133
x0.X.Oregon Upper Gorge Tributaries and Hood River - early  6.74708
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<p>Here we plot the fit of the models to visually check the model performance</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plot.mod1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plot.mod2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot.mod3 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plot.mod4 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit4, <span class="at">plot.type =</span> <span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>plot.mod5 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit5, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-8-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>Here we further tested the model fit by examining the corrplot to see which rivers were most closely correlated to see if that fit with our assumptions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change fit# to evaluate correlation between regions in different models </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>corrmat <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q))) <span class="sc">%*%</span> Q <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q)))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Correlation matrix of 6 test regions shows high correlation between Tilton River and Grays and Chinook Rivers, indicating the potential of these regions behaving as 1 sub-population. This will be tested in the next section.</p>
<p>#diagnostics</p>
<p>Testing for model performance using AICc</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc, fit5<span class="sc">$</span>AICc)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22.697887  4.970699  0.000000 27.155030  4.875695</code></pre>
</div>
</div>
<p>A comparison of delta AICc indicates that model 3 is the best fit for the data. There are no other models within delta AICc of 2.0 or less. There are two alternative models within delta AICc of 5.0, but no compelling reason to further those over the clearly top model. Model 3 was the best out of the five models tested, so we’ll use that one to estimate historical abundances. This is not to say that model 3 is the best model possible for this data, only that it’s the best model out of the 5 that we compared.</p>
<p>We then evaluated the fit of states by looking at plots and residuals</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model 3</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fit3<span class="sc">$</span>states</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
X1 6.280179 6.279389 6.088308 5.415753 5.901063 6.248499 7.035001 7.021632
       [,9]    [,10]    [,11]    [,12]   [,13]    [,14]    [,15]    [,16]
X1 7.161675 6.987405 7.291717 7.511783 7.57813 7.300468 7.287755 7.236499
      [,17]    [,18]    [,19]    [,20]    [,21]    [,22]    [,23]    [,24]
X1 6.607524 6.846007 6.494363 5.915379 6.171551 6.137207 5.578782 5.451146
      [,25]    [,26]    [,27]    [,28]    [,29]    [,30]    [,31]    [,32]
X1 5.725675 5.931041 6.646672 7.090928 6.878673 7.050644 7.079096 7.199707
      [,33]    [,34]    [,35]    [,36]    [,37]    [,38]    [,39]    [,40]
X1 7.000968 6.953619 7.077913 7.307096 7.500606 7.380459 7.058554 7.335456
      [,41]    [,42]    [,43]    [,44]    [,45]    [,46]    [,47]    [,48]
X1 8.107335 6.385602 6.807309 7.001013 5.961508 6.592824 7.454632 7.811492</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsSmooth</span>(fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   .rownames  t .estimate       .se
1         X1  1  6.280179 0.3517725
2         X1  2  6.279389 0.3715729
3         X1  3  6.088308 0.3737970
4         X1  4  5.415753 0.3740536
5         X1  5  5.901063 0.3740832
6         X1  6  6.248499 0.3740867
7         X1  7  7.035001 0.3740871
8         X1  8  7.021632 0.3740871
9         X1  9  7.161675 0.3740871
10        X1 10  6.987405 0.3740871
11        X1 11  7.291717 0.3740871
12        X1 12  7.511783 0.3740871
13        X1 13  7.578130 0.3740871
14        X1 14  7.300468 0.3740871
15        X1 15  7.287755 0.3740871
16        X1 16  7.236499 0.3740871
17        X1 17  6.607524 0.3740871
18        X1 18  6.846007 0.3740864
19        X1 19  6.494363 0.3740811
20        X1 20  5.915379 0.3740347
21        X1 21  6.171551 0.3736335
22        X1 22  6.137207 0.3701492
23        X1 23  5.578782 0.3385563
24        X1 24  5.451146 0.3358668
25        X1 25  5.725675 0.3356453
26        X1 26  5.931041 0.3355945
27        X1 27  6.646672 0.3351848
28        X1 28  7.090928 0.3301029
29        X1 29  6.878673 0.2592910
30        X1 30  7.050644 0.2797804
31        X1 31  7.079096 0.2797264
32        X1 32  7.199707 0.2578702
33        X1 33  7.000968 0.2917856
34        X1 34  6.953619 0.2571024
35        X1 35  7.077913 0.2558983
36        X1 36  7.307096 0.2534567
37        X1 37  7.500606 0.1550014
38        X1 38  7.380459 0.1544473
39        X1 39  7.058554 0.1544449
40        X1 40  7.335456 0.1544477
41        X1 41  8.107335 0.1550942
42        X1 42  6.385602 0.2664316
43        X1 43  6.807309 0.2706957
44        X1 44  7.001013 0.2968817
45        X1 45  5.961508 0.2709719
46        X1 46  6.592824 0.2737963
47        X1 47  7.454632 0.3622036
48        X1 48  7.811492 0.3265167</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.model.resids.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = acf.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-11-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
</section>
<section id="test-different-regions-as-sub-groups" class="level1">
<h1>Test different regions as sub-groups</h1>
<p>We also examined the potential for region to behave as sub-populations based on major population group, our initial correlation analysis, and some geographic assumptions about physical proximity and climate.</p>
<p>Comparing 3 sub-populations: cascade, coast, and gorge based on their designated MPG</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mod.list6 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="co">#B = matrix(1), # B = "identity" 3x3 matrix</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># U = matrix("u"), #needs 3 rows U = "equal" or "unequal" # default = unequal</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"cascade"</span>, <span class="st">"cascade"</span>, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"coast"</span>, <span class="st">"coast"</span>, </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"gorge"</span>, <span class="st">"gorge"</span>)), </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#x0 = matrix("mu"), # x0 = default </span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=500) reached before log-log convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=500) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -142.2401 
AIC: 326.4802   AICc: 335.8136   
 
                                                                                                                Estimate
A.Tilton River - early and late                                                                                  1.84062
A.Grays and Chinook Rivers - late                                                                                0.58750
A.Oregon Upper Gorge Tributaries and Hood River - early                                                         -0.20634
R.(Sandy River - early and late,Sandy River - early and late)                                                    0.33917
R.(Tilton River - early and late,Tilton River - early and late)                                                  0.53829
R.(Clatskanie River - late,Clatskanie River - late)                                                              0.11986
R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)                                              0.00168
R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)                                                0.00386
R.(Oregon Upper Gorge Tributaries and Hood River - early,Oregon Upper Gorge Tributaries and Hood River - early)  1.25596
U.cascade                                                                                                        0.03298
U.coast                                                                                                          0.05520
U.gorge                                                                                                          0.02279
Q.(1,1)                                                                                                          0.19674
Q.(2,1)                                                                                                          0.38386
Q.(3,1)                                                                                                          0.59328
Q.(2,2)                                                                                                          0.87190
Q.(3,2)                                                                                                          1.20480
Q.(3,3)                                                                                                          1.80778
x0.cascade                                                                                                       6.19074
x0.coast                                                                                                         4.31126
x0.gorge                                                                                                         6.07799
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)  parameter value has not converged.
 Warning: the  R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit6, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>Based on the correlation plot, the grays and chinook rivers and the lower gorge tributaries are highly correlated. We want to evaluate a model with these regions as a sub-population.</p>
<p>Comparing 2 sub-populations: grays/chinook rivers and lower gorge “GCL” and all other test regions “STCU”</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mod.list7 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"STCU"</span>, <span class="st">"STCU"</span>, </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"STCU"</span>, <span class="st">"GCL"</span>, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"GCL"</span>, <span class="st">"STCU"</span>)), </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 452 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 452 iterations. 
Log-likelihood: -144.5939 
AIC: 323.1877   AICc: 329.1295   
 
                                                                                                                Estimate
A.Tilton River - early and late                                                                                  1.79368
A.Clatskanie River - late                                                                                       -0.66291
A.Lower Gorge Tributaries - late                                                                                -1.21399
A.Oregon Upper Gorge Tributaries and Hood River - early                                                         -1.26072
R.(Sandy River - early and late,Sandy River - early and late)                                                    0.32024
R.(Tilton River - early and late,Tilton River - early and late)                                                  0.61981
R.(Clatskanie River - late,Clatskanie River - late)                                                              0.38990
R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)                                              0.01470
R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)                                                0.00834
R.(Oregon Upper Gorge Tributaries and Hood River - early,Oregon Upper Gorge Tributaries and Hood River - early)  1.36820
U.STCU                                                                                                           0.03351
U.GCL                                                                                                            0.03955
Q.(1,1)                                                                                                          0.28112
Q.(2,1)                                                                                                          0.67064
Q.(2,2)                                                                                                          1.60038
x0.STCU                                                                                                          6.22159
x0.GCL                                                                                                           6.74437
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit7, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>While the description “cascades” only describes a couple regions in our test set, we decided to test a model separating the general cascades from the 2 coast regions (Clatskaine and Gray/Chinook) because geographically there is a large separation.</p>
<p>Comparing 2 sub-populations: coast “coast” and all other test regions “casgor”</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mod.list8 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"casgor"</span>, <span class="st">"casgor"</span>, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"coast"</span>, <span class="st">"coast"</span>, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"casgor"</span>, <span class="st">"casgor"</span>)), </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>fit8 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=500) reached before log-log convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=500) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -151.9059 
AIC: 337.8118   AICc: 343.7536   
 
                                                                                                                Estimate
A.Tilton River - early and late                                                                                   1.7936
A.Grays and Chinook Rivers - late                                                                                 0.5657
A.Lower Gorge Tributaries - late                                                                                 -1.0682
A.Oregon Upper Gorge Tributaries and Hood River - early                                                          -1.2280
R.(Sandy River - early and late,Sandy River - early and late)                                                     0.3191
R.(Tilton River - early and late,Tilton River - early and late)                                                   0.6853
R.(Clatskanie River - late,Clatskanie River - late)                                                               0.1025
R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)                                               0.0144
R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)                                                 0.6027
R.(Oregon Upper Gorge Tributaries and Hood River - early,Oregon Upper Gorge Tributaries and Hood River - early)   1.6470
U.casgor                                                                                                          0.0263
U.coast                                                                                                           0.0617
Q.(1,1)                                                                                                           0.2611
Q.(2,1)                                                                                                           0.4195
Q.(2,2)                                                                                                           0.7069
x0.casgor                                                                                                         6.2288
x0.coast                                                                                                          4.0332
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit8, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<section id="compare-the-new-models-using-aicc" class="level2">
<h2 class="anchored" data-anchor-id="compare-the-new-models-using-aicc">compare the new models using AICc</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit6<span class="sc">$</span>AICc, fit7<span class="sc">$</span>AICc, fit8<span class="sc">$</span>AICc )</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  8.251333  6.684090  0.000000 14.624087</code></pre>
</div>
</div>
<p>Our new analysis of grouped populations indicates that some of the regions do behave as sub populations. The new best model builds off of the predictions from the correlation analysis, with the Grays/Chinook Rivers and the Lower Gorge Tributaries behaving as 1 sub-population. Additionally, the model treating major populaton groups as sub-populations performed better than our original model providing some possible evidence that grouping by MPG can improve the model fit to the data. However, the AICc value was only 1.56 better than our model without the grouping by MPG so it is not significantly better.</p>
<section id="including-cycling---using-our-coho-data-full-time-series" class="level3">
<h3 class="anchored" data-anchor-id="including-cycling---using-our-coho-data-full-time-series">Including cycling - using our coho data, full time series</h3>
<p>Because we know that coho abundance can be influenced by broad patterns in climate and ocean conditions we tested for underlying seasonality by looking for cycling in the data set and evaluated whether this might generate a better fitting model.To accomplish this, we incorporated seasonality as a covariate in a new model below. We tested 5 and 10 year cycles after looking back at our data, specifically of the Sandy River which has good the fewest missing values of the time series data.</p>
</section>
</section>
</section>
<section id="plot-the-acf-and-look-for-evidence-of-cycling" class="level1">
<h1>Plot the ACF and look for evidence of cycling</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(sub_dat[i,], <span class="at">na.action=</span>na.pass, <span class="at">main=</span><span class="fu">rownames</span>(sub_dat)[i])</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the acf plots and the pattern in the Tilton with significant autocorrelation at 5 years with a possible cyclic pattern, we decided to test for cycling with frequency 5 or 10 years.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(sub_dat)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">5</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>(),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">10</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> int 48</code></pre>
</div>
</div>
<section id="note-renaming-model" class="level2">
<h2 class="anchored" data-anchor-id="note-renaming-model">note renaming model</h2>
<p>Now let’s fit a model with these covariates. Let’s analyze the populations separately, so Q is diagonal.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mod.list9 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># different varcov</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>mod.list10 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Reached maxit before parameters converged. Maxit was 500.
 neither abstol nor log-log convergence tests were passed.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: maxit reached at  500  iter before convergence.
 Neither abstol nor log-log convergence test were passed.
 The likelihood and params are not at the MLE values.
 Try setting control$maxit higher.
Log-likelihood: -122.3743 
AIC: 360.7487   AICc: 471.1358   
 
                                                                Estimate
R.diag                                                            0.0594
U.X.Sandy River - early and late                                  0.0347
U.X.Tilton River - early and late                                 0.0848
U.X.Clatskanie River - late                                       0.0229
U.X.Grays and Chinook Rivers - late                               0.1188
U.X.Lower Gorge Tributaries - late                               -0.0249
U.X.Oregon Upper Gorge Tributaries and Hood River - early         0.0690
Q.(1,1)                                                           0.6612
Q.(2,1)                                                           0.1770
Q.(3,1)                                                           0.7712
Q.(4,1)                                                           0.2301
Q.(5,1)                                                           0.7257
Q.(6,1)                                                           0.1805
Q.(2,2)                                                           0.1865
Q.(3,2)                                                           0.0882
Q.(4,2)                                                           0.0534
Q.(5,2)                                                           0.1055
Q.(6,2)                                                          -0.0901
Q.(3,3)                                                           1.0143
Q.(4,3)                                                           0.2799
Q.(5,3)                                                           0.9850
Q.(6,3)                                                           0.4850
Q.(4,4)                                                           0.0821
Q.(5,4)                                                           0.2776
Q.(6,4)                                                           0.1202
Q.(5,5)                                                           1.1312
Q.(6,5)                                                           0.9784
Q.(6,6)                                                           1.9099
x0.X.Sandy River - early and late                                 6.1413
x0.X.Tilton River - early and late                                6.5152
x0.X.Clatskanie River - late                                      5.4488
x0.X.Grays and Chinook Rivers - late                              3.2187
x0.X.Lower Gorge Tributaries - late                               7.2336
x0.X.Oregon Upper Gorge Tributaries and Hood River - early        3.3965
D.(Sandy River - early and late,S1-5)                             0.0963
D.(Tilton River - early and late,S1-5)                            0.1123
D.(Clatskanie River - late,S1-5)                                  0.1341
D.(Grays and Chinook Rivers - late,S1-5)                          0.3636
D.(Lower Gorge Tributaries - late,S1-5)                           0.2403
D.(Oregon Upper Gorge Tributaries and Hood River - early,S1-5)   -0.2980
D.(Sandy River - early and late,C1-5)                            -0.2310
D.(Tilton River - early and late,C1-5)                           -0.1013
D.(Clatskanie River - late,C1-5)                                 -0.3284
D.(Grays and Chinook Rivers - late,C1-5)                          0.0548
D.(Lower Gorge Tributaries - late,C1-5)                          -0.4294
D.(Oregon Upper Gorge Tributaries and Hood River - early,C1-5)   -0.1410
D.(Sandy River - early and late,S1-10)                           -0.2140
D.(Tilton River - early and late,S1-10)                          -0.2920
D.(Clatskanie River - late,S1-10)                                 0.0129
D.(Grays and Chinook Rivers - late,S1-10)                        -0.0589
D.(Lower Gorge Tributaries - late,S1-10)                          0.0943
D.(Oregon Upper Gorge Tributaries and Hood River - early,S1-10)  -0.3012
D.(Sandy River - early and late,C1-10)                            0.3017
D.(Tilton River - early and late,C1-10)                           0.3438
D.(Clatskanie River - late,C1-10)                                 0.3315
D.(Grays and Chinook Rivers - late,C1-10)                        -0.2001
D.(Lower Gorge Tributaries - late,C1-10)                          0.5987
D.(Oregon Upper Gorge Tributaries and Hood River - early,C1-10)   0.9464
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  logLik  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fit10 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Reached maxit before parameters converged. Maxit was 500.
 neither abstol nor log-log convergence tests were passed.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: maxit reached at  500  iter before convergence.
 Neither abstol nor log-log convergence test were passed.
 The likelihood and params are not at the MLE values.
 Try setting control$maxit higher.
Log-likelihood: -139.8571 
AIC: 357.7142   AICc: 396.2327   
 
                                                                Estimate
R.diag                                                           0.40252
U.X.Sandy River - early and late                                 0.03120
U.X.Tilton River - early and late                               -0.09783
U.X.Clatskanie River - late                                      0.00798
U.X.Grays and Chinook Rivers - late                              0.04185
U.X.Lower Gorge Tributaries - late                              -0.07209
U.X.Oregon Upper Gorge Tributaries and Hood River - early       -0.00911
Q.diag                                                           0.18717
Q.offdiag                                                        0.18693
x0.X.Sandy River - early and late                                6.12719
x0.X.Tilton River - early and late                              12.03196
x0.X.Clatskanie River - late                                     6.29538
x0.X.Grays and Chinook Rivers - late                             6.22823
x0.X.Lower Gorge Tributaries - late                              8.87295
x0.X.Oregon Upper Gorge Tributaries and Hood River - early       6.30541
D.(Sandy River - early and late,S1-5)                            0.06481
D.(Tilton River - early and late,S1-5)                           0.20617
D.(Clatskanie River - late,S1-5)                                 0.12357
D.(Grays and Chinook Rivers - late,S1-5)                         0.21613
D.(Lower Gorge Tributaries - late,S1-5)                          0.29918
D.(Oregon Upper Gorge Tributaries and Hood River - early,S1-5)  -0.42741
D.(Sandy River - early and late,C1-5)                           -0.24312
D.(Tilton River - early and late,C1-5)                           0.05516
D.(Clatskanie River - late,C1-5)                                -0.24633
D.(Grays and Chinook Rivers - late,C1-5)                        -0.26776
D.(Lower Gorge Tributaries - late,C1-5)                         -0.38084
D.(Oregon Upper Gorge Tributaries and Hood River - early,C1-5)  -0.39089
D.(Sandy River - early and late,S1-10)                          -0.16402
D.(Tilton River - early and late,S1-10)                         -0.50357
D.(Clatskanie River - late,S1-10)                               -0.24140
D.(Grays and Chinook Rivers - late,S1-10)                        0.37730
D.(Lower Gorge Tributaries - late,S1-10)                        -0.12532
D.(Oregon Upper Gorge Tributaries and Hood River - early,S1-10) -0.60109
D.(Sandy River - early and late,C1-10)                           0.30372
D.(Tilton River - early and late,C1-10)                          0.78227
D.(Clatskanie River - late,C1-10)                                0.18489
D.(Grays and Chinook Rivers - late,C1-10)                       -0.01834
D.(Lower Gorge Tributaries - late,C1-10)                         0.42664
D.(Oregon Upper Gorge Tributaries and Hood River - early,C1-10)  0.56162
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  logLik  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>plot.mod9 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit9, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plot.mod10 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit10, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>Here we look at Model 9.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit9) <span class="sc">%&gt;%</span> <span class="co">#confidence estimates</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co">#only D parameters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MARSShessian(MLEobj, method = hessian.fun): MARSShessian: Hessian could not be inverted to compute the parameter var-cov matrix. parSigma set to NULL.  See MARSSinfo("HessianNA").</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MARSSparamCIs(x, alpha = alpha, ...): MARSSparamCIs: No parSigma
element returned by Hessian function.  See marssMLE object errors
(MLEobj$errors)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="at">each=</span><span class="dv">12</span>)) <span class="co">#label lags</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(sub_dat),<span class="dv">4</span>)) <span class="co">#rownames on repeat</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"C"</span>), <span class="at">each=</span><span class="dv">6</span>), <span class="dv">2</span>) <span class="co">#each sin cos 6 times, 2 test freq</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="plot-the-cis-and-look-for-evidence-of-cycling" class="level1">
<h1>Plot the CI’s and look for evidence of cycling</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates for Model 9"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The cosine estimates, particularly for the Upper Gorge Tributaries and Hood River, indicate the potential for a seasonal cycle that peaks every 10 years. We encountered a Hessian error in our code that prevented us from plotting confidence intervals for this data, likely due to many years of missing data.</p>
<p>Here we’re looking at Model 10.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit10) <span class="sc">%&gt;%</span> <span class="co">#confidence estimates</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co">#only D parameters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MARSShessian(MLEobj, method = hessian.fun): MARSShessian: Hessian could not be inverted to compute the parameter var-cov matrix. parSigma set to NULL.  See MARSSinfo("HessianNA").</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MARSSparamCIs(x, alpha = alpha, ...): MARSSparamCIs: No parSigma
element returned by Hessian function.  See marssMLE object errors
(MLEobj$errors)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="at">each=</span><span class="dv">12</span>)) <span class="co">#label lags</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(sub_dat),<span class="dv">4</span>)) <span class="co">#rownames on repeat</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"C"</span>), <span class="at">each=</span><span class="dv">6</span>), <span class="dv">2</span>) <span class="co">#each sin cos 6 times, 2 test freq</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates for Model 10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The same analysis but with an equal variance covariance matrix estimated for Q still highlights the potential for a 10 year cycle, this time with the Tilton River.</p>
<p>Evaluate AICc for seasonality against our current best model 3.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit9<span class="sc">$</span>AICc, fit10<span class="sc">$</span>AICc )</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   0.00000 133.75497  58.85194</code></pre>
</div>
</div>
<p>The equal variance covariance matrix for Q was better, but still not as good as our current best model. Now we’ll try building a model with just the 10 year cycle as that best explains the potential seasonality in the data, using the same code from above.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(sub_dat)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>covariates_10 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">10</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> int 48</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>mod.list11 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates_10</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>fit11 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list11, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 907 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 907 iterations. 
Log-likelihood: -145.4365 
AIC: 344.873   AICc: 361.131   
 
                                                                Estimate
R.diag                                                            0.4547
U.X.Sandy River - early and late                                  0.0343
U.X.Tilton River - early and late                                -0.0889
U.X.Clatskanie River - late                                       0.0164
U.X.Grays and Chinook Rivers - late                               0.0582
U.X.Lower Gorge Tributaries - late                               -0.0604
U.X.Oregon Upper Gorge Tributaries and Hood River - early        -0.0155
Q.diag                                                            0.1793
Q.offdiag                                                         0.1792
x0.X.Sandy River - early and late                                 6.1640
x0.X.Tilton River - early and late                               11.8954
x0.X.Clatskanie River - late                                      6.1301
x0.X.Grays and Chinook Rivers - late                              6.1545
x0.X.Lower Gorge Tributaries - late                               8.5981
x0.X.Oregon Upper Gorge Tributaries and Hood River - early        6.7473
D.(Sandy River - early and late,S1-10)                           -0.1603
D.(Tilton River - early and late,S1-10)                          -0.4925
D.(Clatskanie River - late,S1-10)                                -0.2217
D.(Grays and Chinook Rivers - late,S1-10)                         0.6871
D.(Lower Gorge Tributaries - late,S1-10)                         -0.0580
D.(Oregon Upper Gorge Tributaries and Hood River - early,S1-10)  -0.5855
D.(Sandy River - early and late,C1-10)                            0.3330
D.(Tilton River - early and late,C1-10)                           0.8098
D.(Clatskanie River - late,C1-10)                                 0.2120
D.(Grays and Chinook Rivers - late,C1-10)                        -0.4796
D.(Lower Gorge Tributaries - late,C1-10)                          0.4661
D.(Oregon Upper Gorge Tributaries and Hood River - early,C1-10)   0.7174
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit11<span class="sc">$</span>AICc )</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.00000 23.75023</code></pre>
</div>
</div>
<p>Narrowing down to just a 10 year cycle improved the model, but the seasonality still doesn’t help the model as a covariate.</p>
<p>Ultimately, the best model for predicting historical data for Coho salmon is Model 3 which treats all populations idependently.</p>
</section>
<section id="fit-the-best-model" class="level1">
<h1>Fit the best model</h1>
<p>Here we predict historical data for all regions using our best model from the initial analysis. One caveat to this approach is that our correlation analysis was performed on a test set, with model 3 specifying Z based on this data. This yields the best model, but is more difficult to fit to historical data based on the information available to us now.</p>
<p>Future directions should include evaluating the correlation between all the regions to evaluate if other regions would fit into the same sub-group as the grays/chinook and lower gorge. Because there isn’t an obvious indicator variable that separates these regions from other regions in our test set, more analysis is needed to identify what is driving this separation of states.</p>
<section id="fitting-the-best-model-to-the-full-data-set" class="level2">
<h2 class="anchored" data-anchor-id="fitting-the-best-model-to-the-full-data-set">Fitting the best model to the full data set</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>mod.list.full <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">matrix</span>(<span class="dv">1</span>), </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>), </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="co"># 1 X</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">23</span>, <span class="dv">1</span>), </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="st">"mu"</span>), </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>fit_full <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(dat, <span class="at">model =</span> mod.list.full, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=1000) reached before log-log convergence.
Alert: Numerical warnings were generated. Print the $errors element of output to see the warnings.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=1000) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -243.3955 
AIC: 582.7909   AICc: 602.4729   
 
                                                                                                                                       Estimate
A.Coweeman River - late                                                                                                                7.20e-01
A.East Fork Lewis River - early and late                                                                                               2.50e-01
A.Kalama River - late                                                                                                                 -1.60e+00
A.Lower Cowlitz River - late                                                                                                           1.39e+00
A.North Fork Lewis River - early and late                                                                                              8.20e-01
A.North Fork Toutle River - early and late                                                                                             2.36e-01
A.Salmon Creek - late                                                                                                                  9.31e-02
A.Sandy River - early and late                                                                                                        -9.15e-01
A.South Fork Toutle River - early and late                                                                                             3.68e-01
A.Tilton River - early and late                                                                                                        1.04e+00
A.Upper Cowlitz River - early and late                                                                                                 2.08e+00
A.Washougal River - late                                                                                                              -8.84e-01
A.Big Creek - late                                                                                                                    -1.47e+00
A.Clatskanie River - late                                                                                                             -1.31e+00
A.Elochoman River - late                                                                                                              -1.91e-01
A.Grays and Chinook Rivers - late                                                                                                     -5.09e-03
A.Mill, Abernathy, and Germany Creeks - late                                                                                          -8.34e-01
A.Scappoose Creek - late                                                                                                              -1.45e+00
A.Youngs Bay - late                                                                                                                   -1.91e+00
A.Lower Gorge Tributaries - late                                                                                                      -1.72e+00
A.Oregon Upper Gorge Tributaries and Hood River - early                                                                               -1.90e+00
A.Washington Upper Gorge Tributaries and White Salmon River - late                                                                    -3.43e+00
R.(Clackamas River - early and late,Clackamas River - early and late)                                                                  7.43e-01
R.(Coweeman River - late,Coweeman River - late)                                                                                        1.56e-02
R.(East Fork Lewis River - early and late,East Fork Lewis River - early and late)                                                      8.51e-02
R.(Kalama River - late,Kalama River - late)                                                                                            8.88e-06
R.(Lower Cowlitz River - late,Lower Cowlitz River - late)                                                                              2.98e-02
R.(North Fork Lewis River - early and late,North Fork Lewis River - early and late)                                                    2.86e-01
R.(North Fork Toutle River - early and late,North Fork Toutle River - early and late)                                                  9.75e-02
R.(Salmon Creek - late,Salmon Creek - late)                                                                                            1.38e-03
R.(Sandy River - early and late,Sandy River - early and late)                                                                          4.19e-01
R.(South Fork Toutle River - early and late,South Fork Toutle River - early and late)                                                  1.96e-01
R.(Tilton River - early and late,Tilton River - early and late)                                                                        3.31e-01
R.(Upper Cowlitz River - early and late,Upper Cowlitz River - early and late)                                                          3.32e-01
R.(Washougal River - late,Washougal River - late)                                                                                      6.48e-05
R.(Big Creek - late,Big Creek - late)                                                                                                  2.08e-01
R.(Clatskanie River - late,Clatskanie River - late)                                                                                    5.81e-01
R.(Elochoman River - late,Elochoman River - late)                                                                                      3.10e-02
R.(Grays and Chinook Rivers - late,Grays and Chinook Rivers - late)                                                                    2.28e-03
R.(Mill, Abernathy, and Germany Creeks - late,Mill, Abernathy, and Germany Creeks - late)                                              3.85e-03
R.(Scappoose Creek - late,Scappoose Creek - late)                                                                                      2.54e-01
R.(Youngs Bay - late,Youngs Bay - late)                                                                                                9.75e-01
R.(Lower Gorge Tributaries - late,Lower Gorge Tributaries - late)                                                                      7.95e-01
R.(Oregon Upper Gorge Tributaries and Hood River - early,Oregon Upper Gorge Tributaries and Hood River - early)                        1.89e+00
R.(Washington Upper Gorge Tributaries and White Salmon River - late,Washington Upper Gorge Tributaries and White Salmon River - late)  2.92e-01
U.u                                                                                                                                    2.49e-02
Q.q                                                                                                                                    2.67e-01
x0.mu                                                                                                                                  7.32e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
1763 warnings. First 10 shown.  Type cat(object$errors) to see the full list.
 Warning: the  A.Grays and Chinook Rivers - late  parameter value has not converged.
 Warning: the  R.(Kalama River - late,Kalama River - late)  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.
 
MARSSkem warnings. Type MARSSinfo() for help.
 iter=122 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').
 iter=122 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').
 iter=123 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').
 iter=123 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').
 iter=124 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').
 iter=124 Setting element of R to 0, blocked.  See MARSSinfo("R0blocked"). The error is due to the following MARSSkemcheck errors.
  MARSSkemcheck error: t=1: For method=kem (EM), if an element of the diagonal of R is 0, the corresponding row of both A and D must be fixed. See MARSSinfo('AZR0').</code></pre>
</div>
</div>
<p>#Estimate historical abundance back to 1970</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit_full, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-3_final_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>We tested numerous models as shown above and model three was found to be the best. Model three assumed that all populations followed the same underlying state rather than separate groups have different underlying states. It also assumed a simple Q matrix since we had little biological reason or data to support indepenent variances and covariances between populations.</p>
<p>We also tested for cyclic patterns in the data. ACF plots showed a possible correlation in the Tilton River with significant autocorrelation at 5 years. Further tests using Fourier cycles revealed a possible significant cyclic pattern at ten years, although we were unable to generate confidence intervals due to a large number of missing years in the data. Despite this possible result, models including cycling did not significantly outperform model 3.</p>
<p>Based on our best model there has been no significant decline in abundance across this ESU since 1970.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We did not find significant support for our initial hypothesis that populations withing MPG’s would be more closely correlated than populations from other MPG’s. While we found some support for the idea that some populations are correlated, it was limited to the Grays/Chinook Rivers and Lower Gorge Tributaries in model 7. Since these populations are in different habitat types, Coastal vs.&nbsp;Cascade, and would be expected to covary with other more similar regions we did not see a biological reason to group these tributaries. However, additional information may present a valid rationale for why these groups would be correlated.</p>
<p>Our weak evidence of ten year cycles could be related to the Pacific Decadal Oscillation (PDO) which occurs on ten year cycles. The relationship between PDO and salmon abundance began breaking down after large climatic shifts occured in the 1990’s and NPGO has emerged as a better predictor of ocean effects on salmon. It is possible this ten year cycle was present but weak if it were stronger in the earlier data but less so in more recent data. Further work to examine if this relationship is present in the data could improve historical estimates when PDO was a better predictor of abundance.</p>
<p>While we did not find evidence of a decline in abundance for the period of record, most populations had little to no early data to draw upon and the model was based heavily on the Sandy River as one of only two populations in the ESU that had a long time series of data. Since we used a model that assumed a single underlying state it hindcast a very similar pattern for each population. This model could be improved significantly if additional population specific data were found as the model may no longer depend so heavily on a single watershed.</p>
<hr>
<section id="contributions---add-your-contributions" class="level2">
<h2 class="anchored" data-anchor-id="contributions---add-your-contributions">Contributions - add your contributions!</h2>
<p>We tackled this lab by having multiple group meetings to brainstorm strategies, test code, and plan progress. Miranda adapted code from the Lab2-MARSS document to the Coho data, acted as scribe for testing code during group meetings, contributed ideas for selecting models to test, and annotated many of the models for report generation. Nick and Karl helped with group coding and Nick pulled the group code documents into one final doc and drafted model assumptions, results and discussion sections with help from the other team members.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/atsa-es\.github\.io\/fish550-2023\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="pagination-link" aria-label="Team 2 - Lab 2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="pagination-link" aria-label="Team 4 - Lab 2">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb121" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Team 3 - Lab 2</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Lab 2 MARSS models</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Miranda Mudge, Karl Veggerby, Nick Chambers"</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>We were assigned the Lower Columbia Coho data set. We selected two rivers from each Major Population Group (MPG) to test the performance of several models. The selected populations are:</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>Cascade MPG - </span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>Tilton and Sandy Rivers</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>Gorge MPG</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>Upper and Lower Gorge Tributaries</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>Coast MPG</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>Clatskanie, and Grays/Chinook Rivers</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a><span class="in">library(MARSS)</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)</span></span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the data</span></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a><span class="in">load(here::here("Lab-2", "Data_Images", "columbia-river.rda"))</span></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a><span class="in">#plot the data</span></span>
<span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a><span class="in">esu &lt;- unique(columbia.river$esu_dps)</span></span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a><span class="in">plotesu &lt;- function(esuname){</span></span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a><span class="in">  df &lt;- columbia.river %&gt;% subset(esu_dps %in% esuname)</span></span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(df, aes(x=spawningyear, y=log(value), color=majorpopgroup)) + </span></span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size=0.2, na.rm = TRUE) + </span></span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.text.x = element_text(size = 3)) +</span></span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(size = 5, angle = 90)) +</span></span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~esapopname) +</span></span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle(paste0(esuname, collapse="\n"))</span></span>
<span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a><span class="in">plotesu(esu[4])</span></span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a>Wrangle the data.</span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE}</span></span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a><span class="in">#format for visualization</span></span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a><span class="in">esuname &lt;- esu[4]</span></span>
<span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- columbia.river %&gt;% </span></span>
<span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a><span class="in">  subset(esu_dps == esuname) %&gt;% # get only this ESU</span></span>
<span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(log.spawner = log(value)) %&gt;% # create a column called log.spawner</span></span>
<span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a><span class="in">  select(esapopname, spawningyear, log.spawner) %&gt;% # get just the columns that I need</span></span>
<span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = "esapopname", values_from = "log.spawner") %&gt;% </span></span>
<span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a><span class="in">  column_to_rownames(var = "spawningyear") %&gt;% # make the years rownames</span></span>
<span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a><span class="in">  as.matrix() %&gt;% # turn into a matrix with year down the rows</span></span>
<span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a><span class="in">  t() # make time across the columns</span></span>
<span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a><span class="in"># MARSS complains if I don't do this</span></span>
<span id="cb121-70"><a href="#cb121-70" aria-hidden="true" tabindex="-1"></a><span class="in">dat[is.na(dat)] &lt;- NA</span></span>
<span id="cb121-71"><a href="#cb121-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a>Clean up the row names</span>
<span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(dat)</span>
<span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(tmp, <span class="st">"Salmon, coho [(]Lower Columbia River ESU[)]"</span>, <span class="st">""</span>)</span>
<span id="cb121-80"><a href="#cb121-80" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_trim</span>(tmp)</span>
<span id="cb121-81"><a href="#cb121-81" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat) <span class="ot">&lt;-</span> tmp</span>
<span id="cb121-82"><a href="#cb121-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-83"><a href="#cb121-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a>Select a subset of rivers to test</span>
<span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-88"><a href="#cb121-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-89"><a href="#cb121-89" aria-hidden="true" tabindex="-1"></a>mod_rivers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sandy River - early and late"</span>, </span>
<span id="cb121-90"><a href="#cb121-90" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Grays and Chinook Rivers - late"</span>, </span>
<span id="cb121-91"><a href="#cb121-91" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Clatskanie River - late"</span>, </span>
<span id="cb121-92"><a href="#cb121-92" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Lower Gorge Tributaries - late"</span>, </span>
<span id="cb121-93"><a href="#cb121-93" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Tilton River - early and late"</span> , </span>
<span id="cb121-94"><a href="#cb121-94" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Oregon Upper Gorge Tributaries and Hood River - early"</span>)</span>
<span id="cb121-95"><a href="#cb121-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-96"><a href="#cb121-96" aria-hidden="true" tabindex="-1"></a>sub_dat <span class="ot">&lt;-</span> dat[<span class="fu">rownames</span>(dat) <span class="sc">%in%</span> mod_rivers, ] </span>
<span id="cb121-97"><a href="#cb121-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-98"><a href="#cb121-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-99"><a href="#cb121-99" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb121-100"><a href="#cb121-100" aria-hidden="true" tabindex="-1"></a>We tested many models and a variety of assumptions, many of which varied by model. For all models we assumed that A was a scaling parameter.</span>
<span id="cb121-101"><a href="#cb121-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-102"><a href="#cb121-102" aria-hidden="true" tabindex="-1"></a>Below we made a variety of assumptions and used them to generate five models to test which set of assumptions would produce the best fit to the data. </span>
<span id="cb121-103"><a href="#cb121-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-106"><a href="#cb121-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-107"><a href="#cb121-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: all regions are behaving independently (x) but observations were collected similarly</span></span>
<span id="cb121-108"><a href="#cb121-108" aria-hidden="true" tabindex="-1"></a><span class="do">## each region has it's own drift where U = unequal </span></span>
<span id="cb121-109"><a href="#cb121-109" aria-hidden="true" tabindex="-1"></a><span class="do">## variance is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb121-110"><a href="#cb121-110" aria-hidden="true" tabindex="-1"></a><span class="do">## we leave Q unconstrained here, this gives the most flexibility for each population to be unique, but may not be the best approach as we assume they should be at least somewhat related due to geographic proximity</span></span>
<span id="cb121-111"><a href="#cb121-111" aria-hidden="true" tabindex="-1"></a>mod.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-112"><a href="#cb121-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb121-113"><a href="#cb121-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-114"><a href="#cb121-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb121-115"><a href="#cb121-115" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-116"><a href="#cb121-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-117"><a href="#cb121-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: all regions are reflecting 1 underlying state (x) with equal variance</span></span>
<span id="cb121-118"><a href="#cb121-118" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 underlying state where U = equal</span></span>
<span id="cb121-119"><a href="#cb121-119" aria-hidden="true" tabindex="-1"></a><span class="do">## R is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb121-120"><a href="#cb121-120" aria-hidden="true" tabindex="-1"></a><span class="do">## Q is again unconstrained but the U is equal so slighty less variation between populations than model 1</span></span>
<span id="cb121-121"><a href="#cb121-121" aria-hidden="true" tabindex="-1"></a>mod.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-122"><a href="#cb121-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"equal"</span>,</span>
<span id="cb121-123"><a href="#cb121-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-124"><a href="#cb121-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb121-125"><a href="#cb121-125" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-126"><a href="#cb121-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-127"><a href="#cb121-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: flexible model with unequal observation variance and a matrix for drift and state variance and one underlying state</span></span>
<span id="cb121-128"><a href="#cb121-128" aria-hidden="true" tabindex="-1"></a><span class="do">## set scaling on B as 1</span></span>
<span id="cb121-129"><a href="#cb121-129" aria-hidden="true" tabindex="-1"></a><span class="do">## U is matrix of estimated values</span></span>
<span id="cb121-130"><a href="#cb121-130" aria-hidden="true" tabindex="-1"></a><span class="do">## variance Q is constrained so that all populations vary together</span></span>
<span id="cb121-131"><a href="#cb121-131" aria-hidden="true" tabindex="-1"></a><span class="do">## variance R is diagonal and unequal to account for potential differences in observation error, ie different methods between regions</span></span>
<span id="cb121-132"><a href="#cb121-132" aria-hidden="true" tabindex="-1"></a><span class="do">## A intercept can change as needed </span></span>
<span id="cb121-133"><a href="#cb121-133" aria-hidden="true" tabindex="-1"></a><span class="do">## Z matrix is based on our 6 selected populations and each is treated as different</span></span>
<span id="cb121-134"><a href="#cb121-134" aria-hidden="true" tabindex="-1"></a>mod.list3 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">matrix</span>(<span class="dv">1</span>), </span>
<span id="cb121-135"><a href="#cb121-135" aria-hidden="true" tabindex="-1"></a>                   <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>), </span>
<span id="cb121-136"><a href="#cb121-136" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="co"># 1 X</span></span>
<span id="cb121-137"><a href="#cb121-137" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">1</span>), </span>
<span id="cb121-138"><a href="#cb121-138" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-139"><a href="#cb121-139" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb121-140"><a href="#cb121-140" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="st">"mu"</span>), </span>
<span id="cb121-141"><a href="#cb121-141" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-142"><a href="#cb121-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-143"><a href="#cb121-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4: flexible model for independent regions</span></span>
<span id="cb121-144"><a href="#cb121-144" aria-hidden="true" tabindex="-1"></a><span class="do">## B and Z scale to size of matrix, all 1's</span></span>
<span id="cb121-145"><a href="#cb121-145" aria-hidden="true" tabindex="-1"></a><span class="do">## U = bias = independent matrix set to size of dataframe</span></span>
<span id="cb121-146"><a href="#cb121-146" aria-hidden="true" tabindex="-1"></a><span class="do">## Q eaual variance in state with equal covariances</span></span>
<span id="cb121-147"><a href="#cb121-147" aria-hidden="true" tabindex="-1"></a><span class="do">## R variance is diagonal and equal due to similar methods for collecting observations</span></span>
<span id="cb121-148"><a href="#cb121-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-149"><a href="#cb121-149" aria-hidden="true" tabindex="-1"></a>mod.list4 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">6</span>), </span>
<span id="cb121-150"><a href="#cb121-150" aria-hidden="true" tabindex="-1"></a>                  <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>,<span class="dv">6</span>,<span class="dv">1</span>), </span>
<span id="cb121-151"><a href="#cb121-151" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>, </span>
<span id="cb121-152"><a href="#cb121-152" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">diag</span>(<span class="dv">1</span>,<span class="dv">6</span>), </span>
<span id="cb121-153"><a href="#cb121-153" aria-hidden="true" tabindex="-1"></a>                  <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-154"><a href="#cb121-154" aria-hidden="true" tabindex="-1"></a>                  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>, </span>
<span id="cb121-155"><a href="#cb121-155" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x0 =</span> <span class="st">"unequal"</span>, </span>
<span id="cb121-156"><a href="#cb121-156" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-157"><a href="#cb121-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-158"><a href="#cb121-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5: keep it simple. Each region has an independent state, observation variance is the same, and one process variance with one covariance. </span></span>
<span id="cb121-159"><a href="#cb121-159" aria-hidden="true" tabindex="-1"></a>mod.list5 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-160"><a href="#cb121-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb121-161"><a href="#cb121-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-162"><a href="#cb121-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span></span>
<span id="cb121-163"><a href="#cb121-163" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-164"><a href="#cb121-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-165"><a href="#cb121-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-166"><a href="#cb121-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-167"><a href="#cb121-167" aria-hidden="true" tabindex="-1"></a>Here we fit the model.</span>
<span id="cb121-170"><a href="#cb121-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-171"><a href="#cb121-171" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb121-172"><a href="#cb121-172" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list1, <span class="at">method=</span><span class="st">"BFGS"</span>)</span>
<span id="cb121-173"><a href="#cb121-173" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list2, <span class="at">method=</span><span class="st">"BFGS"</span>)</span>
<span id="cb121-174"><a href="#cb121-174" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list3)</span>
<span id="cb121-175"><a href="#cb121-175" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list4)</span>
<span id="cb121-176"><a href="#cb121-176" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list5, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span>
<span id="cb121-177"><a href="#cb121-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-178"><a href="#cb121-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-179"><a href="#cb121-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-180"><a href="#cb121-180" aria-hidden="true" tabindex="-1"></a>Here we plot the fit of the models to visually check the model performance</span>
<span id="cb121-181"><a href="#cb121-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-184"><a href="#cb121-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-185"><a href="#cb121-185" aria-hidden="true" tabindex="-1"></a>plot.mod1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-186"><a href="#cb121-186" aria-hidden="true" tabindex="-1"></a>plot.mod2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-187"><a href="#cb121-187" aria-hidden="true" tabindex="-1"></a>plot.mod3 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-188"><a href="#cb121-188" aria-hidden="true" tabindex="-1"></a>plot.mod4 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit4, <span class="at">plot.type =</span> <span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-189"><a href="#cb121-189" aria-hidden="true" tabindex="-1"></a>plot.mod5 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit5, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-190"><a href="#cb121-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-191"><a href="#cb121-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-192"><a href="#cb121-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-193"><a href="#cb121-193" aria-hidden="true" tabindex="-1"></a>Here we further tested the model fit by examining the corrplot to see which rivers were most closely correlated to see if that fit with our assumptions.</span>
<span id="cb121-194"><a href="#cb121-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-197"><a href="#cb121-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-198"><a href="#cb121-198" aria-hidden="true" tabindex="-1"></a><span class="co"># change fit# to evaluate correlation between regions in different models </span></span>
<span id="cb121-199"><a href="#cb121-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-200"><a href="#cb121-200" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb121-201"><a href="#cb121-201" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb121-202"><a href="#cb121-202" aria-hidden="true" tabindex="-1"></a>corrmat <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q))) <span class="sc">%*%</span> Q <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q)))</span>
<span id="cb121-203"><a href="#cb121-203" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat)</span>
<span id="cb121-204"><a href="#cb121-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-205"><a href="#cb121-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-206"><a href="#cb121-206" aria-hidden="true" tabindex="-1"></a>Correlation matrix of 6 test regions shows high correlation between Tilton River and Grays and Chinook Rivers, indicating the potential of these regions behaving as 1 sub-population. This will be tested in the next section. </span>
<span id="cb121-207"><a href="#cb121-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-208"><a href="#cb121-208" aria-hidden="true" tabindex="-1"></a>#diagnostics</span>
<span id="cb121-209"><a href="#cb121-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-210"><a href="#cb121-210" aria-hidden="true" tabindex="-1"></a>Testing for model performance using AICc</span>
<span id="cb121-211"><a href="#cb121-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-214"><a href="#cb121-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-215"><a href="#cb121-215" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc, fit5<span class="sc">$</span>AICc)</span>
<span id="cb121-216"><a href="#cb121-216" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span>
<span id="cb121-217"><a href="#cb121-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-218"><a href="#cb121-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-219"><a href="#cb121-219" aria-hidden="true" tabindex="-1"></a>A comparison of delta AICc indicates that model 3 is the best fit for the data. There are no other models within delta AICc of 2.0 or less. There are two alternative models within delta AICc of 5.0, but no compelling reason to further those over the clearly top model. Model 3 was the best out of the five models tested, so we'll use that one to estimate historical abundances. This is not to say that model 3 is the best model possible for this data, only that it's the best model out of the 5 that we compared. </span>
<span id="cb121-220"><a href="#cb121-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-221"><a href="#cb121-221" aria-hidden="true" tabindex="-1"></a>We then evaluated the fit of states by looking at plots and residuals</span>
<span id="cb121-222"><a href="#cb121-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-225"><a href="#cb121-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-226"><a href="#cb121-226" aria-hidden="true" tabindex="-1"></a><span class="co">#model 3</span></span>
<span id="cb121-227"><a href="#cb121-227" aria-hidden="true" tabindex="-1"></a>fit3<span class="sc">$</span>states</span>
<span id="cb121-228"><a href="#cb121-228" aria-hidden="true" tabindex="-1"></a><span class="fu">tsSmooth</span>(fit3)</span>
<span id="cb121-229"><a href="#cb121-229" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-230"><a href="#cb121-230" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"residuals"</span>)</span>
<span id="cb121-231"><a href="#cb121-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-232"><a href="#cb121-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-233"><a href="#cb121-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-234"><a href="#cb121-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-235"><a href="#cb121-235" aria-hidden="true" tabindex="-1"></a><span class="fu"># Test different regions as sub-groups </span></span>
<span id="cb121-236"><a href="#cb121-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-237"><a href="#cb121-237" aria-hidden="true" tabindex="-1"></a>We also examined the potential for region to behave as sub-populations based on major population group, our initial correlation analysis, and some geographic assumptions about physical proximity and climate. </span>
<span id="cb121-238"><a href="#cb121-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-239"><a href="#cb121-239" aria-hidden="true" tabindex="-1"></a>Comparing 3 sub-populations: cascade, coast, and gorge based on their designated MPG</span>
<span id="cb121-242"><a href="#cb121-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-243"><a href="#cb121-243" aria-hidden="true" tabindex="-1"></a>mod.list6 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="co">#B = matrix(1), # B = "identity" 3x3 matrix</span></span>
<span id="cb121-244"><a href="#cb121-244" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># U = matrix("u"), #needs 3 rows U = "equal" or "unequal" # default = unequal</span></span>
<span id="cb121-245"><a href="#cb121-245" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb121-246"><a href="#cb121-246" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"cascade"</span>, <span class="st">"cascade"</span>, </span>
<span id="cb121-247"><a href="#cb121-247" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"coast"</span>, <span class="st">"coast"</span>, </span>
<span id="cb121-248"><a href="#cb121-248" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"gorge"</span>, <span class="st">"gorge"</span>)), </span>
<span id="cb121-249"><a href="#cb121-249" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-250"><a href="#cb121-250" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb121-251"><a href="#cb121-251" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#x0 = matrix("mu"), # x0 = default </span></span>
<span id="cb121-252"><a href="#cb121-252" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-253"><a href="#cb121-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-254"><a href="#cb121-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-255"><a href="#cb121-255" aria-hidden="true" tabindex="-1"></a>fit6 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list6)</span>
<span id="cb121-256"><a href="#cb121-256" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit6, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-257"><a href="#cb121-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-258"><a href="#cb121-258" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb121-259"><a href="#cb121-259" aria-hidden="true" tabindex="-1"></a>Based on the correlation plot, the grays and chinook rivers and the lower gorge tributaries are highly correlated. We want to evaluate a model with these regions as a sub-population. </span>
<span id="cb121-260"><a href="#cb121-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-261"><a href="#cb121-261" aria-hidden="true" tabindex="-1"></a>Comparing 2 sub-populations: grays/chinook rivers and lower gorge "GCL" and all other test regions "STCU"</span>
<span id="cb121-264"><a href="#cb121-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-265"><a href="#cb121-265" aria-hidden="true" tabindex="-1"></a>mod.list7 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb121-266"><a href="#cb121-266" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"STCU"</span>, <span class="st">"STCU"</span>, </span>
<span id="cb121-267"><a href="#cb121-267" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"STCU"</span>, <span class="st">"GCL"</span>, </span>
<span id="cb121-268"><a href="#cb121-268" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"GCL"</span>, <span class="st">"STCU"</span>)), </span>
<span id="cb121-269"><a href="#cb121-269" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-270"><a href="#cb121-270" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb121-271"><a href="#cb121-271" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-272"><a href="#cb121-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-273"><a href="#cb121-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-274"><a href="#cb121-274" aria-hidden="true" tabindex="-1"></a>fit7 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list7)</span>
<span id="cb121-275"><a href="#cb121-275" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit7, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-276"><a href="#cb121-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-277"><a href="#cb121-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-278"><a href="#cb121-278" aria-hidden="true" tabindex="-1"></a>While the description "cascades" only describes a couple regions in our test set, we decided to test a model separating the general cascades from the 2 coast regions (Clatskaine and Gray/Chinook) because geographically there is a large separation. </span>
<span id="cb121-279"><a href="#cb121-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-280"><a href="#cb121-280" aria-hidden="true" tabindex="-1"></a>Comparing 2 sub-populations: coast "coast" and all other test regions "casgor"</span>
<span id="cb121-281"><a href="#cb121-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-284"><a href="#cb121-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-285"><a href="#cb121-285" aria-hidden="true" tabindex="-1"></a>mod.list8 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># 1 X</span></span>
<span id="cb121-286"><a href="#cb121-286" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"casgor"</span>, <span class="st">"casgor"</span>, </span>
<span id="cb121-287"><a href="#cb121-287" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"coast"</span>, <span class="st">"coast"</span>, </span>
<span id="cb121-288"><a href="#cb121-288" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"casgor"</span>, <span class="st">"casgor"</span>)), </span>
<span id="cb121-289"><a href="#cb121-289" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-290"><a href="#cb121-290" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb121-291"><a href="#cb121-291" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-292"><a href="#cb121-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-293"><a href="#cb121-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-294"><a href="#cb121-294" aria-hidden="true" tabindex="-1"></a>fit8 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model =</span> mod.list8)</span>
<span id="cb121-295"><a href="#cb121-295" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit8, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-296"><a href="#cb121-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-297"><a href="#cb121-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-298"><a href="#cb121-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## compare the new models using AICc</span></span>
<span id="cb121-299"><a href="#cb121-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-302"><a href="#cb121-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-303"><a href="#cb121-303" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit6<span class="sc">$</span>AICc, fit7<span class="sc">$</span>AICc, fit8<span class="sc">$</span>AICc )</span>
<span id="cb121-304"><a href="#cb121-304" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span>
<span id="cb121-305"><a href="#cb121-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-306"><a href="#cb121-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-307"><a href="#cb121-307" aria-hidden="true" tabindex="-1"></a>Our new analysis of grouped populations indicates that some of the regions do behave as sub populations. The new best model builds off of the predictions from the correlation analysis, with the Grays/Chinook Rivers and the Lower Gorge Tributaries behaving as 1 sub-population. Additionally, the model treating major populaton groups as sub-populations performed better than our original model providing some possible evidence that grouping by MPG can improve the model fit to the data. However, the AICc value was only 1.56 better than our model without the grouping by MPG so it is not significantly better. </span>
<span id="cb121-308"><a href="#cb121-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-309"><a href="#cb121-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-310"><a href="#cb121-310" aria-hidden="true" tabindex="-1"></a><span class="fu">### Including cycling - using our coho data, full time series</span></span>
<span id="cb121-311"><a href="#cb121-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-312"><a href="#cb121-312" aria-hidden="true" tabindex="-1"></a>Because we know that coho abundance can be influenced by broad patterns in climate and ocean conditions we tested for underlying seasonality by looking for cycling in the data set and evaluated whether this might generate a better fitting model.To accomplish this, we incorporated seasonality as a covariate in a new model below. We tested 5 and 10 year cycles after looking back at our data, specifically of the Sandy River which has good the fewest missing values of the time series data. </span>
<span id="cb121-313"><a href="#cb121-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-314"><a href="#cb121-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-315"><a href="#cb121-315" aria-hidden="true" tabindex="-1"></a><span class="fu"># Plot the ACF and look for evidence of cycling</span></span>
<span id="cb121-318"><a href="#cb121-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-319"><a href="#cb121-319" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb121-320"><a href="#cb121-320" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb121-321"><a href="#cb121-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(sub_dat[i,], <span class="at">na.action=</span>na.pass, <span class="at">main=</span><span class="fu">rownames</span>(sub_dat)[i])</span>
<span id="cb121-322"><a href="#cb121-322" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-323"><a href="#cb121-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-324"><a href="#cb121-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-325"><a href="#cb121-325" aria-hidden="true" tabindex="-1"></a>Based on the acf plots and the pattern in the Tilton with significant autocorrelation at 5 years with a possible cyclic pattern, we decided to test for cycling with frequency 5 or 10 years. </span>
<span id="cb121-326"><a href="#cb121-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-329"><a href="#cb121-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-330"><a href="#cb121-330" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(sub_dat)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb121-331"><a href="#cb121-331" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb121-332"><a href="#cb121-332" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">5</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>(),</span>
<span id="cb121-333"><a href="#cb121-333" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">10</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb121-334"><a href="#cb121-334" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-335"><a href="#cb121-335" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TT)</span>
<span id="cb121-336"><a href="#cb121-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-337"><a href="#cb121-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-338"><a href="#cb121-338" aria-hidden="true" tabindex="-1"></a><span class="fu">## note renaming model</span></span>
<span id="cb121-339"><a href="#cb121-339" aria-hidden="true" tabindex="-1"></a>Now let's fit a model with these covariates. Let's analyze the populations separately, so Q is diagonal.</span>
<span id="cb121-342"><a href="#cb121-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-343"><a href="#cb121-343" aria-hidden="true" tabindex="-1"></a>mod.list9 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-344"><a href="#cb121-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>, <span class="co"># different varcov</span></span>
<span id="cb121-345"><a href="#cb121-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb121-346"><a href="#cb121-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-347"><a href="#cb121-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb121-348"><a href="#cb121-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb121-349"><a href="#cb121-349" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-350"><a href="#cb121-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-351"><a href="#cb121-351" aria-hidden="true" tabindex="-1"></a>mod.list10 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-352"><a href="#cb121-352" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span>,</span>
<span id="cb121-353"><a href="#cb121-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb121-354"><a href="#cb121-354" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-355"><a href="#cb121-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb121-356"><a href="#cb121-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb121-357"><a href="#cb121-357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-358"><a href="#cb121-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-359"><a href="#cb121-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-360"><a href="#cb121-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-363"><a href="#cb121-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-364"><a href="#cb121-364" aria-hidden="true" tabindex="-1"></a>fit9 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list9)</span>
<span id="cb121-365"><a href="#cb121-365" aria-hidden="true" tabindex="-1"></a>fit10 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list10)</span>
<span id="cb121-366"><a href="#cb121-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-367"><a href="#cb121-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-368"><a href="#cb121-368" aria-hidden="true" tabindex="-1"></a>plot.mod9 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit9, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-369"><a href="#cb121-369" aria-hidden="true" tabindex="-1"></a>plot.mod10 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(fit10, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-370"><a href="#cb121-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-371"><a href="#cb121-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-372"><a href="#cb121-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-373"><a href="#cb121-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-374"><a href="#cb121-374" aria-hidden="true" tabindex="-1"></a>Here we look at Model 9. </span>
<span id="cb121-377"><a href="#cb121-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-378"><a href="#cb121-378" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb121-379"><a href="#cb121-379" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit9) <span class="sc">%&gt;%</span> <span class="co">#confidence estimates</span></span>
<span id="cb121-380"><a href="#cb121-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co">#only D parameters</span></span>
<span id="cb121-381"><a href="#cb121-381" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="at">each=</span><span class="dv">12</span>)) <span class="co">#label lags</span></span>
<span id="cb121-382"><a href="#cb121-382" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(sub_dat),<span class="dv">4</span>)) <span class="co">#rownames on repeat</span></span>
<span id="cb121-383"><a href="#cb121-383" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"C"</span>), <span class="at">each=</span><span class="dv">6</span>), <span class="dv">2</span>) <span class="co">#each sin cos 6 times, 2 test freq</span></span>
<span id="cb121-384"><a href="#cb121-384" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span>
<span id="cb121-385"><a href="#cb121-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-386"><a href="#cb121-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-387"><a href="#cb121-387" aria-hidden="true" tabindex="-1"></a><span class="fu"># Plot the CI's and look for evidence of cycling</span></span>
<span id="cb121-390"><a href="#cb121-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-391"><a href="#cb121-391" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb121-392"><a href="#cb121-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-393"><a href="#cb121-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb121-394"><a href="#cb121-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb121-395"><a href="#cb121-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb121-396"><a href="#cb121-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates for Model 9"</span>)</span>
<span id="cb121-397"><a href="#cb121-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-398"><a href="#cb121-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-399"><a href="#cb121-399" aria-hidden="true" tabindex="-1"></a>The cosine estimates, particularly for the Upper Gorge Tributaries and Hood River, indicate the potential for a seasonal cycle that peaks every 10 years. We encountered a Hessian error in our code that prevented us from plotting confidence intervals for this data, likely due to many years of missing data.  </span>
<span id="cb121-400"><a href="#cb121-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-401"><a href="#cb121-401" aria-hidden="true" tabindex="-1"></a>Here we're looking at Model 10. </span>
<span id="cb121-404"><a href="#cb121-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-405"><a href="#cb121-405" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit10) <span class="sc">%&gt;%</span> <span class="co">#confidence estimates</span></span>
<span id="cb121-406"><a href="#cb121-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co">#only D parameters</span></span>
<span id="cb121-407"><a href="#cb121-407" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>), <span class="at">each=</span><span class="dv">12</span>)) <span class="co">#label lags</span></span>
<span id="cb121-408"><a href="#cb121-408" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(sub_dat),<span class="dv">4</span>)) <span class="co">#rownames on repeat</span></span>
<span id="cb121-409"><a href="#cb121-409" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"C"</span>), <span class="at">each=</span><span class="dv">6</span>), <span class="dv">2</span>) <span class="co">#each sin cos 6 times, 2 test freq</span></span>
<span id="cb121-410"><a href="#cb121-410" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span>
<span id="cb121-411"><a href="#cb121-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-412"><a href="#cb121-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-415"><a href="#cb121-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-416"><a href="#cb121-416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb121-417"><a href="#cb121-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-418"><a href="#cb121-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb121-419"><a href="#cb121-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb121-420"><a href="#cb121-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb121-421"><a href="#cb121-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates for Model 10"</span>)</span>
<span id="cb121-422"><a href="#cb121-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-423"><a href="#cb121-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-424"><a href="#cb121-424" aria-hidden="true" tabindex="-1"></a>The same analysis but with an equal variance covariance matrix estimated for Q still highlights the potential for a 10 year cycle, this time with the Tilton River. </span>
<span id="cb121-425"><a href="#cb121-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-426"><a href="#cb121-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-427"><a href="#cb121-427" aria-hidden="true" tabindex="-1"></a>Evaluate AICc for seasonality against our current best model 3. </span>
<span id="cb121-428"><a href="#cb121-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-431"><a href="#cb121-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-432"><a href="#cb121-432" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit9<span class="sc">$</span>AICc, fit10<span class="sc">$</span>AICc )</span>
<span id="cb121-433"><a href="#cb121-433" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span>
<span id="cb121-434"><a href="#cb121-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-435"><a href="#cb121-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-436"><a href="#cb121-436" aria-hidden="true" tabindex="-1"></a>The equal variance covariance matrix for Q was better, but still not as good as our current best model. Now we'll try building a model with just the 10 year cycle as that best explains the potential seasonality in the data, using the same code from above. </span>
<span id="cb121-437"><a href="#cb121-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-440"><a href="#cb121-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-441"><a href="#cb121-441" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(sub_dat)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb121-442"><a href="#cb121-442" aria-hidden="true" tabindex="-1"></a>covariates_10 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb121-443"><a href="#cb121-443" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">10</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb121-444"><a href="#cb121-444" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-445"><a href="#cb121-445" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(TT)</span>
<span id="cb121-446"><a href="#cb121-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-447"><a href="#cb121-447" aria-hidden="true" tabindex="-1"></a>mod.list11 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb121-448"><a href="#cb121-448" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span>,</span>
<span id="cb121-449"><a href="#cb121-449" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb121-450"><a href="#cb121-450" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb121-451"><a href="#cb121-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb121-452"><a href="#cb121-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates_10</span>
<span id="cb121-453"><a href="#cb121-453" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-454"><a href="#cb121-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-455"><a href="#cb121-455" aria-hidden="true" tabindex="-1"></a>fit11 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(sub_dat, <span class="at">model=</span>mod.list11, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>) )</span>
<span id="cb121-456"><a href="#cb121-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-457"><a href="#cb121-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-460"><a href="#cb121-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-461"><a href="#cb121-461" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit3<span class="sc">$</span>AICc, fit11<span class="sc">$</span>AICc )</span>
<span id="cb121-462"><a href="#cb121-462" aria-hidden="true" tabindex="-1"></a>aic<span class="sc">-</span><span class="fu">min</span>(aic) <span class="co">#delta AICc </span></span>
<span id="cb121-463"><a href="#cb121-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-464"><a href="#cb121-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-465"><a href="#cb121-465" aria-hidden="true" tabindex="-1"></a>Narrowing down to just a 10 year cycle improved the model, but the seasonality still doesn't help the model as a covariate. </span>
<span id="cb121-466"><a href="#cb121-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-467"><a href="#cb121-467" aria-hidden="true" tabindex="-1"></a>Ultimately, the best model for predicting historical data for Coho salmon is Model 3 which treats all populations idependently. </span>
<span id="cb121-468"><a href="#cb121-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-469"><a href="#cb121-469" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fit the best model</span></span>
<span id="cb121-470"><a href="#cb121-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-471"><a href="#cb121-471" aria-hidden="true" tabindex="-1"></a>Here we predict historical data for all regions using our best model from the initial analysis. One caveat to this approach is that our correlation analysis was performed on a test set, with model 3 specifying Z based on this data. This yields the best model, but is more difficult to fit to historical data based on the information available to us now. </span>
<span id="cb121-472"><a href="#cb121-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-473"><a href="#cb121-473" aria-hidden="true" tabindex="-1"></a>Future directions should include evaluating the correlation between all the regions to evaluate if other regions would fit into the same sub-group as the grays/chinook and lower gorge. Because there isn't an obvious indicator variable that separates these regions from other regions in our test set, more analysis is needed to identify what is driving this separation of states. </span>
<span id="cb121-474"><a href="#cb121-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-475"><a href="#cb121-475" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting the best model to the full data set</span></span>
<span id="cb121-478"><a href="#cb121-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-479"><a href="#cb121-479" aria-hidden="true" tabindex="-1"></a>mod.list.full <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> <span class="fu">matrix</span>(<span class="dv">1</span>), </span>
<span id="cb121-480"><a href="#cb121-480" aria-hidden="true" tabindex="-1"></a>                   <span class="at">U =</span> <span class="fu">matrix</span>(<span class="st">"u"</span>), </span>
<span id="cb121-481"><a href="#cb121-481" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="co"># 1 X</span></span>
<span id="cb121-482"><a href="#cb121-482" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Z =</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">23</span>, <span class="dv">1</span>), </span>
<span id="cb121-483"><a href="#cb121-483" aria-hidden="true" tabindex="-1"></a>                   <span class="at">A =</span> <span class="st">"scaling"</span>, </span>
<span id="cb121-484"><a href="#cb121-484" aria-hidden="true" tabindex="-1"></a>                   <span class="at">R =</span> <span class="st">"diagonal and unequal"</span>, <span class="co"># single column of 1s for Y</span></span>
<span id="cb121-485"><a href="#cb121-485" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="st">"mu"</span>), </span>
<span id="cb121-486"><a href="#cb121-486" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tinitx =</span> <span class="dv">0</span>)</span>
<span id="cb121-487"><a href="#cb121-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-488"><a href="#cb121-488" aria-hidden="true" tabindex="-1"></a>fit_full <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(dat, <span class="at">model =</span> mod.list.full, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span>
<span id="cb121-489"><a href="#cb121-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-490"><a href="#cb121-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-491"><a href="#cb121-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-492"><a href="#cb121-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-493"><a href="#cb121-493" aria-hidden="true" tabindex="-1"></a>#Estimate historical abundance back to 1970</span>
<span id="cb121-494"><a href="#cb121-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-497"><a href="#cb121-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-498"><a href="#cb121-498" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit_full, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb121-499"><a href="#cb121-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-500"><a href="#cb121-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-501"><a href="#cb121-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-502"><a href="#cb121-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-503"><a href="#cb121-503" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb121-504"><a href="#cb121-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-505"><a href="#cb121-505" aria-hidden="true" tabindex="-1"></a>We tested numerous models as shown above and model three was found to be the best. Model three assumed that all populations followed the same underlying state rather than separate groups have different underlying states. It also assumed a simple Q matrix since we had little biological reason or data to support indepenent variances and covariances between populations. </span>
<span id="cb121-506"><a href="#cb121-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-507"><a href="#cb121-507" aria-hidden="true" tabindex="-1"></a>We also tested for cyclic patterns in the data. ACF plots showed a possible correlation in the Tilton River with significant autocorrelation at 5 years. Further tests using Fourier cycles revealed a possible significant cyclic pattern at ten years, although we were unable to generate confidence intervals due to a large number of missing years in the data. Despite this possible result, models including cycling did not significantly outperform model 3. </span>
<span id="cb121-508"><a href="#cb121-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-509"><a href="#cb121-509" aria-hidden="true" tabindex="-1"></a>Based on our best model there has been no significant decline in abundance across this ESU since 1970. </span>
<span id="cb121-510"><a href="#cb121-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-511"><a href="#cb121-511" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb121-512"><a href="#cb121-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-513"><a href="#cb121-513" aria-hidden="true" tabindex="-1"></a>We did not find significant support for our initial hypothesis that populations withing MPG's would be more closely correlated than populations from other MPG's. While we found some support for the idea that some populations are correlated, it was limited to the Grays/Chinook Rivers and Lower Gorge Tributaries in model 7. Since these populations are in different habitat types, Coastal vs. Cascade, and would be expected to covary with other more similar regions we did not see a biological reason to group these tributaries. However, additional information may present a valid rationale for why these groups would be correlated. </span>
<span id="cb121-514"><a href="#cb121-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-515"><a href="#cb121-515" aria-hidden="true" tabindex="-1"></a>Our weak evidence of ten year cycles could be related to the Pacific Decadal Oscillation (PDO) which occurs on ten year cycles. The relationship between PDO and salmon abundance began breaking down after large climatic shifts occured in the 1990's and NPGO has emerged as a better predictor of ocean effects on salmon. It is possible this ten year cycle was present but weak if it were stronger in the earlier data but less so in more recent data. Further work to examine if this relationship is present in the data could improve historical estimates when PDO was a better predictor of abundance. </span>
<span id="cb121-516"><a href="#cb121-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-517"><a href="#cb121-517" aria-hidden="true" tabindex="-1"></a>While we did not find evidence of a decline in abundance for the period of record, most populations had little to no early data to draw upon and the model was based heavily on the Sandy River as one of only two populations in the ESU that had a long time series of data. Since we used a model that assumed a single underlying state it hindcast a very similar pattern for each population. This model could be improved significantly if additional population specific data were found as the model may no longer depend so heavily on a single watershed. </span>
<span id="cb121-518"><a href="#cb121-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-519"><a href="#cb121-519" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------</span>
<span id="cb121-520"><a href="#cb121-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-521"><a href="#cb121-521" aria-hidden="true" tabindex="-1"></a><span class="fu">## Contributions - add your contributions! </span></span>
<span id="cb121-522"><a href="#cb121-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-523"><a href="#cb121-523" aria-hidden="true" tabindex="-1"></a>We tackled this lab by having multiple group meetings to brainstorm strategies, test code, and plan progress. Miranda adapted code from the Lab2-MARSS document to the Coho data, acted as scribe for testing code during group meetings, contributed ideas for selecting models to test, and annotated many of the models for report generation. Nick and Karl helped with group coding and Nick pulled the group code documents into one final doc and drafted model assumptions, results and discussion sections with help from the other team members. </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-2/Final_Write_ups/Lab-2-team-3_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-2/Final_Write_ups/Lab-2-team-3_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>