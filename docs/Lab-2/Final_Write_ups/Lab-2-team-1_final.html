<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emma Timmins-Schiffman, Maria Kuruvilla, Zoe Rand">

<title>8&nbsp; Team 1 - Lab 2 – Fish 550 Spring 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" rel="next">
<link href="../../Lab-2/Lab2-MARSS.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-2/Lab2-MARSS.html">Analyzing multivariate salmon data with MARSS</a></li><li class="breadcrumb-item"><a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Lab-5-DLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Lab 5 - Dynamic Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Team 1 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li><a href="#general-questions" id="toc-general-questions" class="nav-link" data-scroll-target="#general-questions">General Questions</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#code-for-analysis" id="toc-code-for-analysis" class="nav-link" data-scroll-target="#code-for-analysis">Code for analysis:</a>
  <ul class="collapse">
  <li><a href="#hypothesis-1-11-independent-populations" id="toc-hypothesis-1-11-independent-populations" class="nav-link" data-scroll-target="#hypothesis-1-11-independent-populations">1. Hypothesis 1: 11 independent populations</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#evaluate-support-for-the-major-population-groups.-are-the-populations-in-the-groups-more-correlated-than-outside-the-groups" id="toc-evaluate-support-for-the-major-population-groups.-are-the-populations-in-the-groups-more-correlated-than-outside-the-groups" class="nav-link" data-scroll-target="#evaluate-support-for-the-major-population-groups.-are-the-populations-in-the-groups-more-correlated-than-outside-the-groups">2. Evaluate support for the major population groups. Are the populations in the groups more correlated than outside the groups?</a></li>
  <li><a href="#evaluate-the-evidence-of-cycling-in-the-data." id="toc-evaluate-the-evidence-of-cycling-in-the-data." class="nav-link" data-scroll-target="#evaluate-the-evidence-of-cycling-in-the-data.">3. Evaluate the evidence of cycling in the data.&nbsp;</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#description-of-each-team-members-contributions" id="toc-description-of-each-team-members-contributions" class="nav-link" data-scroll-target="#description-of-each-team-members-contributions">Description of each team member’s contributions</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-2/Final_Write_ups/Lab-2-team-1_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-2/Final_Write_ups/Lab-2-team-1_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-2/Lab2-MARSS.html">Analyzing multivariate salmon data with MARSS</a></li><li class="breadcrumb-item"><a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Lab 2 MARSS models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emma Timmins-Schiffman, Maria Kuruvilla, Zoe Rand </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="data" class="level1">
<h1>Data</h1>
<p>Describe what data set you will work with and any subsetting you decided on. For example, you may have decided to look only at a section of the ESU that your team was assigned.</p>
<p>Load the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-2"</span>, <span class="st">"Data_Images"</span>, <span class="st">"columbia-river.rda"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Look at the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>esu <span class="ot">&lt;-</span> <span class="fu">unique</span>(columbia.river<span class="sc">$</span>esu_dps)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>esu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Steelhead (Middle Columbia River DPS)"     
[2] "Steelhead (Upper Columbia River DPS)"      
[3] "Steelhead (Lower Columbia River DPS)"      
[4] "Salmon, coho (Lower Columbia River ESU)"   
[5] "Salmon, Chinook (Lower Columbia River ESU)"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plotesu <span class="ot">&lt;-</span> <span class="cf">function</span>(esuname){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> columbia.river <span class="sc">%&gt;%</span> <span class="fu">subset</span>(esu_dps <span class="sc">%in%</span> esuname)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>spawningyear, <span class="at">y=</span><span class="fu">log</span>(value), <span class="at">color=</span>majorpopgroup)) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>esapopname) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(esuname, <span class="at">collapse=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Chinook</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotesu</span>(esu[<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Wrangle the data.</p>
<p>We had some issues with one of the populations having duplicated entries, with some being NA and some having values, (Lower Gorge Tributaries - fall) and we also had a lot of ESA populations, so we decided to focus only on the Cascade populations.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chin_c_r<span class="ot">&lt;-</span>columbia.river <span class="sc">%&gt;%</span> <span class="fu">subset</span>(esu_dps <span class="sc">==</span> esu[<span class="dv">5</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>chin_c_r <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(majorpopgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cascade fall"</span>, <span class="st">"Cascade late fall"</span>, <span class="st">"Cascade spring"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>spawningyear, <span class="at">y=</span><span class="fu">log</span>(value), <span class="at">color=</span>majorpopgroup)) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>esapopname) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(esu[<span class="dv">5</span>], <span class="at">collapse=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Formatting data for MARSS:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>chin_newdat <span class="ot">&lt;-</span> chin_c_r <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(majorpopgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cascade fall"</span>, <span class="st">"Cascade late fall"</span>, <span class="st">"Cascade spring"</span>)) <span class="sc">%&gt;%</span> <span class="co">#just looking at cascade populations</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log.spawner =</span> <span class="fu">log</span>(value)) <span class="sc">%&gt;%</span> <span class="co"># create a column called log.spawner</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(esapopname, spawningyear, log.spawner) <span class="sc">%&gt;%</span> <span class="co"># get just the columns that I need</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> esapopname, <span class="at">values_from =</span> log.spawner) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"spawningyear"</span>) <span class="sc">%&gt;%</span> <span class="co"># make the years rownames</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="co"># turn into a matrix with year down the rows</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="co"># make time across the columns</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># MARSS complains if I don't do this</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>chin_newdat[<span class="fu">is.na</span>(chin_newdat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up row names</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(chin_newdat)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(tmp, <span class="st">"Salmon, Chinook [(]Lower Columbia River ESU[)]"</span>, <span class="st">""</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_trim</span>(tmp)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(chin_newdat) <span class="ot">&lt;-</span> tmp</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#look at data</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chin_newdat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                    1964     1965     1966     1967     1968
Clackamas River - fall                NA       NA       NA       NA       NA
Lewis River - fall              6.448889 6.792344 6.368187 6.018593 5.517453
Lower Cowlitz River - fall      8.105308 8.649449 8.472614 8.610137 7.741968
Toutle River - fall             7.821643 7.289611 7.206377 7.353722 7.830028
Upper Cowlitz River - fall            NA       NA       NA       NA       NA
Lewis River - late fall         9.732521 8.978030 9.361085 9.181015 8.876265
Sandy River - late fall               NA       NA       NA       NA       NA
Kalama River - spring                 NA       NA       NA       NA       NA
North Fork Lewis River - spring       NA       NA       NA       NA       NA
Sandy River - spring                  NA       NA       NA       NA       NA
Upper Cowlitz River - spring          NA       NA       NA       NA       NA</code></pre>
</div>
</div>
</section>
<section id="general-questions" class="level1">
<h1>General Questions</h1>
<p>Each group has the same general tasks, but you will adapt them as you work on the data.</p>
<ol type="1">
<li><p>Create estimates of spawner abundance for all missing years and provide estimates of the decline from the historical abundance.</p></li>
<li><p>Evaluate support for the major population groups. Are the populations in the groups more correlated than outside the groups?</p></li>
<li><p>Evaluate the evidence of cycling in the data. <em>We will talk about how to do this on the Tuesday after lab.</em></p></li>
</ol>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>Address the following in your methods</p>
<p><em>Describe your assumptions about the x and how the data time series are related to x.</em></p>
<ul>
<li><p>We tested 2 different assumptions about how the data time series are related to x.</p>
<ol type="1">
<li><p>All the esa populations are independent populations: this means that each data series (y) corresponds to an independent x series.</p></li>
<li><p>There are 3 Cascade populations based on run timing, and the river surveys are all surveying these populations according to run time: this means that each data series (y) corresponds to the x series that relates to its run timing (major population group).</p>
<ul>
<li><p>Within both of these, we tested independent process errors with different variances (Q is “diagonal and unequal”), as well as independent process errors with equal variances (Q is “diagonal and equal”), and equal variance covariance (Q is “equalvarcov”).</p></li>
<li><p>We assumed that each population has its own growth rate (U is unequal).</p></li>
</ul></li>
</ol>
<p><em>Write out assumptions in matrix form:</em></p>
<ol type="1">
<li><p>11 independent populations</p>
<p><span class="math display">\[
\begin{bmatrix} x_{t,1} \\ x_{t,2}\\ ... \\x_{t,11} \end{bmatrix} = \begin{bmatrix} x_{t-1,1} \\ x_{t-1,2}\\ ... \\x_{t-1,11} \end{bmatrix} + \begin{bmatrix} u_1 \\ u_2\\ ... \\u_{11} \end{bmatrix} + w_t \text{  where } w_t \sim MVN(0, \mathbf{Q})
\]</span></p></li>
</ol>
<p>where:</p>
<p><span class="math display">\[
\mathbf{Q} =
\begin{bmatrix} q_1 &amp; 0  &amp; ...&amp; 0\\
0 &amp; q_2 &amp;  ...&amp; 0\\
\vdots &amp; 0 &amp; \ddots &amp; \vdots\\
0 &amp; 0 &amp; 0  &amp; q_{11} \end{bmatrix}
\]</span></p>
<p>or:</p>
<p><span class="math display">\[
\mathbf{Q} =
\begin{bmatrix} q &amp; 0  &amp; ...&amp; 0\\
0 &amp; q &amp;  ...&amp; 0\\
\vdots &amp; 0 &amp; \ddots &amp; \vdots\\
0 &amp; 0 &amp; 0  &amp; q \end{bmatrix}
\]</span></p>
<p>or:</p></li>
</ul>
<p><span class="math display">\[
\mathbf{Q} =
\begin{bmatrix} q &amp; p  &amp; ...&amp; p\\
p &amp; q &amp;  ...&amp; p\\
\vdots &amp; p &amp; \ddots &amp; \vdots\\
p &amp; p &amp; p  &amp; q \end{bmatrix}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix} y_{t,1} \\ y_{t, 2} \\ \vdots \\y_{t,11} \end{bmatrix} =
\begin{bmatrix}1 &amp; 0  &amp; ...&amp; 0\\
0 &amp; 1 &amp;  ...&amp; 0\\
\vdots &amp; 0 &amp; \ddots &amp; \vdots\\
0 &amp; 0 &amp; 0  &amp; 1\end{bmatrix}
\begin{bmatrix} x_{t,1} \\ x_{t, 2} \\ \vdots \\x_{t,11} \end{bmatrix} + \mathbf{a} + \mathbf{v_t} \text{ where } \mathbf{v_t} \sim MVN(0, \mathbf{R})
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\mathbf{R} =
\begin{bmatrix} r &amp; 0  &amp; ...&amp; 0\\
0 &amp; r &amp;  ...&amp; 0\\
\vdots &amp; 0 &amp; \ddots &amp; \vdots\\
0 &amp; 0 &amp; 0  &amp; r \end{bmatrix}
\]</span></p>
<ol start="2" type="1">
<li>3 independent populations according to run time</li>
</ol>
<p><span class="math display">\[
\begin{bmatrix} x_{t,1} \\ x_{t,2}\\ x_{t,3} \end{bmatrix} = \begin{bmatrix} x_{t-1,1} \\ x_{t-1,2}\\ x_{t-1,3} \end{bmatrix} + \begin{bmatrix} u_1 \\ u_2\\ u_3 \end{bmatrix} + w_t \text{  where } w_t \sim MVN(0, \mathbf{Q})\]</span></p>
<p>where <strong><em>Q</em></strong> is as above but is 3x3 instead of 11x11.</p>
<p><span class="math display">\[
\begin{bmatrix} y_{t,1} \\ y_{t, 2} \\ \vdots \\y_{t,11} \end{bmatrix} =
\begin{bmatrix}1 &amp; 0  &amp;  0\\
1 &amp; 0 &amp;  0\\
\vdots &amp; 1 &amp; \vdots\\
0 &amp; 1 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots\\
\vdots &amp; 0 &amp; 1 \\
\vdots &amp; \vdots &amp; \vdots \end{bmatrix}
\begin{bmatrix} x_{t,1} \\ x_{t, 2} \\x_{t,3} \end{bmatrix} + \mathbf{a} + \mathbf{v_t} \text{ where } \mathbf{v_t} \sim MVN(0, \mathbf{R})
\]</span></p>
<p>and <strong><em>R</em></strong> is the same as above.</p>
<section id="code-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="code-for-analysis">Code for analysis:</h2>
<section id="hypothesis-1-11-independent-populations" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-1-11-independent-populations">1. Hypothesis 1: 11 independent populations</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list1, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 167 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 167 iterations. 
Log-likelihood: -414.6942 
AIC: 897.3884   AICc: 905.3217   
 
                                                                         Estimate
R.diag                                                                   4.02e-01
U.X.Clackamas River - fall                                              -3.53e-02
U.X.Lewis River - fall                                                   2.99e-02
U.X.Lower Cowlitz River - fall                                          -2.06e-02
U.X.Toutle River - fall                                                 -2.37e-02
U.X.Upper Cowlitz River - fall                                           2.26e-01
U.X.Lewis River - late fall                                             -5.80e-03
U.X.Sandy River - late fall                                              1.97e-02
U.X.Kalama River - spring                                               -5.68e-02
U.X.North Fork Lewis River - spring                                     -2.02e-02
U.X.Sandy River - spring                                                 2.56e-02
U.X.Upper Cowlitz River - spring                                         3.71e-02
Q.(X.Clackamas River - fall,X.Clackamas River - fall)                    2.50e-15
Q.(X.Lewis River - fall,X.Lewis River - fall)                            2.57e-02
Q.(X.Lower Cowlitz River - fall,X.Lower Cowlitz River - fall)            1.48e-14
Q.(X.Toutle River - fall,X.Toutle River - fall)                          7.25e-01
Q.(X.Upper Cowlitz River - fall,X.Upper Cowlitz River - fall)            7.07e+00
Q.(X.Lewis River - late fall,X.Lewis River - late fall)                  1.73e-19
Q.(X.Sandy River - late fall,X.Sandy River - late fall)                  2.82e-02
Q.(X.Kalama River - spring,X.Kalama River - spring)                      5.91e-01
Q.(X.North Fork Lewis River - spring,X.North Fork Lewis River - spring)  2.16e-01
Q.(X.Sandy River - spring,X.Sandy River - spring)                        8.73e-14
Q.(X.Upper Cowlitz River - spring,X.Upper Cowlitz River - spring)        1.13e-13
x0.X.Clackamas River - fall                                              7.57e+00
x0.X.Lewis River - fall                                                  6.20e+00
x0.X.Lower Cowlitz River - fall                                          8.78e+00
x0.X.Toutle River - fall                                                 7.70e+00
x0.X.Upper Cowlitz River - fall                                         -1.51e+00
x0.X.Lewis River - late fall                                             9.22e+00
x0.X.Sandy River - late fall                                             7.94e+00
x0.X.Kalama River - spring                                               7.05e+00
x0.X.North Fork Lewis River - spring                                     6.98e+00
x0.X.Sandy River - spring                                                6.76e+00
x0.X.Upper Cowlitz River - spring                                        4.44e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># resid1&lt;-autoplot(fit1, plot.type="residuals")</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># headings&lt;-c('Model innovation', "Cholesky standardized model smoothation", "Cholesky standaradized state smoothation", "Residuals normality test", "Cholesky standaradized model innnovation residuals acf")</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"model.resids.ytt1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot type = model.resids.ytt1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"qqplot.std.model.resids.ytt1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot type = qqplot.std.model.resids.ytt1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"acf.std.model.resids.ytt1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-9-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot type = acf.std.model.resids.ytt1</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and equal"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list2, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 1328 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 1328 iterations. 
Log-likelihood: -489.2305 
AIC: 1026.461   AICc: 1030.332   
 
                                     Estimate
R.diag                                0.72949
U.X.Clackamas River - fall           -0.03785
U.X.Lewis River - fall                0.02564
U.X.Lower Cowlitz River - fall       -0.01440
U.X.Toutle River - fall              -0.00564
U.X.Upper Cowlitz River - fall        0.36757
U.X.Lewis River - late fall          -0.01337
U.X.Sandy River - late fall           0.02332
U.X.Kalama River - spring            -0.06396
U.X.North Fork Lewis River - spring  -0.02687
U.X.Sandy River - spring              0.02783
U.X.Upper Cowlitz River - spring      0.02691
Q.diag                                0.09185
x0.X.Clackamas River - fall           7.71621
x0.X.Lewis River - fall               6.28414
x0.X.Lower Cowlitz River - fall       8.50382
x0.X.Toutle River - fall              7.61118
x0.X.Upper Cowlitz River - fall      -8.27194
x0.X.Lewis River - late fall          9.30977
x0.X.Sandy River - late fall          7.89736
x0.X.Kalama River - spring            7.49044
x0.X.North Fork Lewis River - spring  7.27055
x0.X.Sandy River - spring             6.65318
x0.X.Upper Cowlitz River - spring     4.92931
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mod.list3 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list3, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 1128 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 1128 iterations. 
Log-likelihood: -470.7432 
AIC: 991.4863   AICc: 995.6934   
 
                                     Estimate
R.diag                                0.61116
U.X.Clackamas River - fall           -0.12651
U.X.Lewis River - fall                0.05037
U.X.Lower Cowlitz River - fall        0.00770
U.X.Toutle River - fall               0.01946
U.X.Upper Cowlitz River - fall        0.37609
U.X.Lewis River - late fall           0.01014
U.X.Sandy River - late fall          -0.00839
U.X.Kalama River - spring            -0.09167
U.X.North Fork Lewis River - spring  -0.06193
U.X.Sandy River - spring             -0.00388
U.X.Upper Cowlitz River - spring      0.01885
Q.diag                                0.20574
Q.offdiag                             0.15919
x0.X.Clackamas River - fall          12.71323
x0.X.Lewis River - fall               6.24942
x0.X.Lower Cowlitz River - fall       8.59167
x0.X.Toutle River - fall              7.62076
x0.X.Upper Cowlitz River - fall      -7.61327
x0.X.Lewis River - late fall          9.30191
x0.X.Sandy River - late fall          9.75499
x0.X.Kalama River - spring            9.24570
x0.X.North Fork Lewis River - spring  9.30467
x0.X.Sandy River - spring             8.59831
x0.X.Upper Cowlitz River - spring     6.27949
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Hypothesis 2: 3 independent populations based on run timing</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mod.list4<span class="ot">&lt;-</span>mod.list1</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(chin_newdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Clackamas River - fall"          "Lewis River - fall"             
 [3] "Lower Cowlitz River - fall"      "Toutle River - fall"            
 [5] "Upper Cowlitz River - fall"      "Lewis River - late fall"        
 [7] "Sandy River - late fall"         "Kalama River - spring"          
 [9] "North Fork Lewis River - spring" "Sandy River - spring"           
[11] "Upper Cowlitz River - spring"   </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mod.list4<span class="sc">$</span>Z<span class="ot">&lt;-</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">4</span>))) <span class="co">#creating factor based on run times</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#mod.list4</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list4, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 243 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 243 iterations. 
Log-likelihood: -501.0319 
AIC: 1038.064   AICc: 1040.228   
 
                                   Estimate
A.Lewis River - fall               1.41e+00
A.Lower Cowlitz River - fall       2.96e+00
A.Toutle River - fall              1.52e+00
A.Upper Cowlitz River - fall       4.49e-01
A.Sandy River - late fall         -7.45e-01
A.North Fork Lewis River - spring  8.78e-01
A.Sandy River - spring             2.49e+00
A.Upper Cowlitz River - spring     1.71e-01
R.diag                             1.03e+00
U.fa                               1.97e-03
U.l_fa                            -1.99e-03
U.Sp                              -2.08e-02
Q.(fa,fa)                          2.31e-01
Q.(l_fa,l_fa)                      3.88e-12
Q.(Sp,Sp)                          1.39e-12
x0.fa                              5.49e+00
x0.l_fa                            9.13e+00
x0.Sp                              6.10e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit4, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mod.list5<span class="ot">&lt;-</span>mod.list4</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mod.list5<span class="sc">$</span>Q<span class="ot">&lt;-</span><span class="st">"diagonal and equal"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>fit5<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list5, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 419 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 419 iterations. 
Log-likelihood: -512.9568 
AIC: 1057.914   AICc: 1059.624   
 
                                  Estimate
A.Lewis River - fall               1.61011
A.Lower Cowlitz River - fall       3.15768
A.Toutle River - fall              1.70686
A.Upper Cowlitz River - fall       0.65164
A.Sandy River - late fall         -0.84303
A.North Fork Lewis River - spring  0.91788
A.Sandy River - spring             2.52482
A.Upper Cowlitz River - spring     0.19157
R.diag                             1.08461
U.fa                               0.00745
U.l_fa                             0.01049
U.Sp                              -0.01849
Q.diag                             0.05334
x0.fa                              5.29045
x0.l_fa                            9.14607
x0.Sp                              6.08345
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit5, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mod.list6<span class="ot">&lt;-</span>mod.list4</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>mod.list6<span class="sc">$</span>Q<span class="ot">&lt;-</span><span class="st">"equalvarcov"</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>fit6<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list6, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 370 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 370 iterations. 
Log-likelihood: -506.724 
AIC: 1047.448   AICc: 1049.379   
 
                                  Estimate
A.Lewis River - fall               1.86873
A.Lower Cowlitz River - fall       3.42045
A.Toutle River - fall              1.99521
A.Upper Cowlitz River - fall       0.98958
A.Sandy River - late fall         -0.81266
A.North Fork Lewis River - spring  0.93794
A.Sandy River - spring             2.55274
A.Upper Cowlitz River - spring     0.21590
R.diag                             1.03257
U.fa                               0.02001
U.l_fa                             0.00719
U.Sp                              -0.03876
Q.diag                             0.11257
Q.offdiag                          0.10630
x0.fa                              5.00493
x0.l_fa                            9.33436
x0.Sp                              7.28177
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit6, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MARSSresiduals.tT reported warnings. See msg element or attribute of returned residuals object.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc, fit5<span class="sc">$</span>AICc, fit6<span class="sc">$</span>AICc)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>mods<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>aic.names<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"Model"</span>, mods, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(aic, aic<span class="sc">-</span><span class="fu">min</span>(aic)), <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">byrow =</span> F)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(a)<span class="ot">&lt;-</span>aic.names</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span>a[<span class="fu">order</span>(a[,<span class="dv">2</span>],<span class="at">decreasing=</span><span class="cn">FALSE</span>),] <span class="co">#order by lowest AICc</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(a, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"AICc"</span>, <span class="st">"Delta AIC"</span>)) <span class="co">#make a pretty table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">AICc</th>
<th style="text-align: right;">Delta AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1</td>
<td style="text-align: right;">905.3217</td>
<td style="text-align: right;">0.00000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 3</td>
<td style="text-align: right;">995.6934</td>
<td style="text-align: right;">90.37173</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 2</td>
<td style="text-align: right;">1030.3319</td>
<td style="text-align: right;">125.01016</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 4</td>
<td style="text-align: right;">1040.2284</td>
<td style="text-align: right;">134.90665</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 6</td>
<td style="text-align: right;">1049.3786</td>
<td style="text-align: right;">144.05686</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 5</td>
<td style="text-align: right;">1059.6243</td>
<td style="text-align: right;">154.30253</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The first model we tested, where we had each population with its own x value and Q was diagonal and unequal, had the lowest AICc. Therefore, we used this model to look at historical abundance.</p>
<ol type="1">
<li><em>Create estimates of spawner abundance for all missing years and provide estimates of the decline from the historical abundance.</em></li>
</ol>
<p>Estimates of log abundance for each population:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">"Pop"</span> <span class="ot">=</span> <span class="fu">rownames</span>(chin_newdat),<span class="st">"Dat"</span> <span class="ot">=</span> chin_newdat[,<span class="dv">1</span>], <span class="st">"Est"</span> <span class="ot">=</span> fit1<span class="sc">$</span>states[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   Pop                               Dat   Est
   &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt;
 1 Clackamas River - fall          NA     7.53
 2 Lewis River - fall               6.45  6.23
 3 Lower Cowlitz River - fall       8.11  8.76
 4 Toutle River - fall              7.82  7.68
 5 Upper Cowlitz River - fall      NA    -1.29
 6 Lewis River - late fall          9.73  9.22
 7 Sandy River - late fall         NA     7.96
 8 Kalama River - spring           NA     7.00
 9 North Fork Lewis River - spring NA     6.96
10 Sandy River - spring            NA     6.79
11 Upper Cowlitz River - spring    NA     4.48</code></pre>
</div>
</div>
<p>Estimated percent change from historical abundance for each population</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#percent change in log abundance </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>hist.abund<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">Pop =</span> <span class="fu">rownames</span>(chin_newdat), </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Year1 =</span> fit1<span class="sc">$</span>states[,<span class="dv">1</span>],</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Year58 =</span> fit1<span class="sc">$</span>states[,<span class="dv">58</span>])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>hist.abund<span class="ot">&lt;-</span>hist.abund <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PChange =</span> ((Year58 <span class="sc">-</span> Year1)<span class="sc">/</span><span class="fu">abs</span>(Year1)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#the estimate for "Upper Cowlitz River - fall" initial population is super low (&lt;1 in real scale), and so the percent change blows up (it's like 1000), so I took this out to make the plot easier to read. Also I think this is probably unrealistic. </span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>hist.abund <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pop <span class="sc">!=</span> <span class="st">"Upper Cowlitz River - fall"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pop, <span class="at">y =</span> PChange, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">3</span>)))), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Fall"</span>, <span class="st">"Late Fall"</span>, <span class="st">"Spring"</span>), <span class="at">name =</span> <span class="st">"Run"</span>) <span class="sc">+</span> </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Population"</span>, <span class="at">y=</span><span class="st">"% Change From Hist. Abund."</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">270</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Do your estimates differ depending on the assumptions you make about the structure of the data, i.e.&nbsp;you assumptions about the x’s, Q, and U?</em></p>
<p>Using our second best model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>hist.abund<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">Pop =</span> <span class="fu">rownames</span>(chin_newdat), </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Year1 =</span> fit3<span class="sc">$</span>states[,<span class="dv">1</span>],</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Year58 =</span> fit3<span class="sc">$</span>states[,<span class="dv">58</span>])</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>hist.abund<span class="ot">&lt;-</span>hist.abund <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PChange =</span> ((Year58 <span class="sc">-</span> Year1)<span class="sc">/</span><span class="fu">abs</span>(Year1)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#the estimate for "Upper Cowlitz River - fall" is still not great, so I took this out for this plot as well</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>hist.abund <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pop <span class="sc">!=</span> <span class="st">"Upper Cowlitz River - fall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pop, <span class="at">y =</span> PChange, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">3</span>)))), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Fall"</span>, <span class="st">"Late Fall"</span>, <span class="st">"Spring"</span>), <span class="at">name =</span> <span class="st">"Run"</span>) <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Population"</span>, <span class="at">y=</span><span class="st">"% Change From Hist. Abund."</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">270</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The form of the model does make a difference in the model outputs. For instance, in the first model, the populations of Sandy River spring and late fall are estimated to show an increase, while in the second model, it’s estimated to decrease. Lewis River fall and Lower Cowlitz river fall and Toutle River fall, all show opposite trends in these two models as well.</p>
<section id="evaluate-support-for-the-major-population-groups.-are-the-populations-in-the-groups-more-correlated-than-outside-the-groups" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-support-for-the-major-population-groups.-are-the-populations-in-the-groups-more-correlated-than-outside-the-groups">2. Evaluate support for the major population groups. Are the populations in the groups more correlated than outside the groups?</h3>
<p>Look at the correlation plots for the best models for each hypothesis: model 1 for hypothesis 1 and model 4 for hypothesis 2</p>
<p>Population correlations for Model 1</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#different variances and covariances in process error</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>mod.list1.unconst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>fit1.unconst<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list1.unconst, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 443 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 443 iterations. 
Log-likelihood: -358.8132 
AIC: 895.6264   AICc: 961.0141   
 
                                      Estimate
R.diag                                1.32e-01
U.X.Clackamas River - fall           -2.71e-01
U.X.Lewis River - fall                4.57e-02
U.X.Lower Cowlitz River - fall       -3.83e-03
U.X.Toutle River - fall               7.86e-03
U.X.Upper Cowlitz River - fall        6.99e-01
U.X.Lewis River - late fall          -5.12e-04
U.X.Sandy River - late fall           1.76e-02
U.X.Kalama River - spring            -3.23e-02
U.X.North Fork Lewis River - spring  -5.04e-02
U.X.Sandy River - spring              2.78e-02
U.X.Upper Cowlitz River - spring     -2.99e-02
Q.(1,1)                               8.50e-01
Q.(2,1)                               2.64e-01
Q.(3,1)                               2.36e-01
Q.(4,1)                               3.35e-01
Q.(5,1)                               2.04e+00
Q.(6,1)                               2.20e-01
Q.(7,1)                               7.65e-01
Q.(8,1)                               1.59e-01
Q.(9,1)                              -5.58e-02
Q.(10,1)                             -3.97e-02
Q.(11,1)                              1.20e-01
Q.(2,2)                               2.44e-01
Q.(3,2)                               1.73e-01
Q.(4,2)                               3.44e-01
Q.(5,2)                               7.86e-01
Q.(6,2)                               1.27e-01
Q.(7,2)                               2.22e-01
Q.(8,2)                               5.38e-04
Q.(9,2)                               1.16e-01
Q.(10,2)                             -4.54e-02
Q.(11,2)                              2.40e-01
Q.(3,3)                               1.92e-01
Q.(4,3)                               2.76e-01
Q.(5,3)                               6.69e-01
Q.(6,3)                               1.11e-01
Q.(7,3)                               2.20e-01
Q.(8,3)                               2.56e-01
Q.(9,3)                               1.26e-01
Q.(10,3)                             -1.77e-02
Q.(11,3)                              1.63e-01
Q.(4,4)                               1.17e+00
Q.(5,4)                               2.31e+00
Q.(6,4)                               9.04e-02
Q.(7,4)                               3.18e-01
Q.(8,4)                               4.51e-01
Q.(9,4)                               3.11e-01
Q.(10,4)                              9.49e-04
Q.(11,4)                              1.22e-01
Q.(5,5)                               7.91e+00
Q.(6,5)                               3.54e-01
Q.(7,5)                               1.87e+00
Q.(8,5)                               1.03e+00
Q.(9,5)                               6.48e-01
Q.(10,5)                             -2.40e-02
Q.(11,5)                             -3.67e-01
Q.(6,6)                               1.02e-01
Q.(7,6)                               1.93e-01
Q.(8,6)                               2.66e-02
Q.(9,6)                              -3.11e-02
Q.(10,6)                             -2.57e-02
Q.(11,6)                              1.94e-01
Q.(7,7)                               6.95e-01
Q.(8,7)                               2.24e-01
Q.(9,7)                              -5.12e-02
Q.(10,7)                             -2.63e-02
Q.(11,7)                              8.84e-02
Q.(8,8)                               1.11e+00
Q.(9,8)                               2.54e-01
Q.(10,8)                              8.11e-02
Q.(11,8)                             -1.62e-01
Q.(9,9)                               6.72e-01
Q.(10,9)                             -1.46e-02
Q.(11,9)                             -3.18e-01
Q.(10,10)                             1.68e-02
Q.(11,10)                            -5.53e-02
Q.(11,11)                             7.53e-01
x0.X.Clackamas River - fall           2.04e+01
x0.X.Lewis River - fall               6.46e+00
x0.X.Lower Cowlitz River - fall       8.48e+00
x0.X.Toutle River - fall              7.70e+00
x0.X.Upper Cowlitz River - fall      -1.63e+01
x0.X.Lewis River - late fall          9.34e+00
x0.X.Sandy River - late fall          8.73e+00
x0.X.Kalama River - spring            5.73e+00
x0.X.North Fork Lewis River - spring  8.61e+00
x0.X.Sandy River - spring             6.62e+00
x0.X.Upper Cowlitz River - spring     6.53e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>Q1.unconst <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1.unconst, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>corrmat1.unconst <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q1.unconst))) <span class="sc">%*%</span> Q1.unconst <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q1.unconst)))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat1.unconst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For model 1 (with Q changed to unconstrained so we can see a correlation matrix), abundances from the Clackamas fall (1) and Sandy River late fall (7) populations are highly positively correlated. These populations are very close geographically. In fact, populations 1-7 are all positively correlated; these are the fall run populations and may be influenced by the same environmental variables. Spring run populations demonstrate less association with each other and with the fall run fish. These results suggest that we could possibly group fall and late fall runs together, but there is little support for grouping the separate spring run populations.</p>
<p>We can similarly look at an unconstrained Q if we group the populations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mod.list4.unconst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">4</span>)))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>fit4.unconst<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list4.unconst, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 187 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 187 iterations. 
Log-likelihood: -496.1341 
AIC: 1034.268   AICc: 1037.22   
 
                                  Estimate
A.Lewis River - fall               1.96417
A.Lower Cowlitz River - fall       3.51420
A.Toutle River - fall              2.08487
A.Upper Cowlitz River - fall       1.02678
A.Sandy River - late fall         -0.74770
A.North Fork Lewis River - spring  0.91773
A.Sandy River - spring             2.55819
A.Upper Cowlitz River - spring     0.18349
R.diag                             0.97709
U.fa                               0.02022
U.l_fa                            -0.00175
U.Sp                              -0.04097
Q.(1,1)                            0.25657
Q.(2,1)                            0.04185
Q.(3,1)                            0.13073
Q.(2,2)                            0.00683
Q.(3,2)                            0.02132
Q.(3,3)                            0.06661
x0.fa                              4.92205
x0.l_fa                            9.23022
x0.Sp                              7.17168
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>Q4.unconst <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit4.unconst, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>corrmat4.unconst <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q4.unconst))) <span class="sc">%*%</span> Q4.unconst <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q4.unconst)))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat4.unconst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When the data are all collapsed by run timing, all runs show high positive correlation with each other. We know this is a false way to group the data, but we can try to fit a model with grouped fall &amp; late fall runs and separate spring run populations.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mod.list7 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">7</span>), <span class="st">'Sp1'</span>, <span class="st">'Sp2'</span>, <span class="st">'Sp3'</span>, <span class="st">'Sp4'</span>))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>fit7<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list7, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 243 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 243 iterations. 
Log-likelihood: -492.6786 
AIC: 1049.357   AICc: 1056.351   
 
                             Estimate
A.Lewis River - fall          1.71326
A.Lower Cowlitz River - fall  3.26751
A.Toutle River - fall         1.87432
A.Upper Cowlitz River - fall  0.97929
A.Lewis River - late fall     4.07056
A.Sandy River - late fall     3.07716
R.diag                        0.91670
U.fa                          0.01418
U.Sp1                        -0.09593
U.Sp2                        -0.04996
U.Sp3                         0.02676
U.Sp4                         0.00991
Q.(1,1)                       0.17211
Q.(2,1)                       0.17385
Q.(3,1)                       0.11997
Q.(4,1)                      -0.01898
Q.(5,1)                       0.09557
Q.(2,2)                       0.22195
Q.(3,2)                       0.07276
Q.(4,2)                      -0.01590
Q.(5,2)                       0.11224
Q.(3,3)                       0.13417
Q.(4,3)                      -0.01663
Q.(5,3)                       0.05021
Q.(4,4)                       0.00232
Q.(5,4)                      -0.00943
Q.(5,5)                       0.05839
x0.fa                         5.20535
x0.Sp1                        9.21407
x0.Sp2                        8.51336
x0.Sp3                        6.65876
x0.Sp4                        5.68845
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>Q7 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit7, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>corrmat7 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q7))) <span class="sc">%*%</span> Q7 <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q7)))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Check the fit of this model if Q is set to diagonal and unequal, which yields a lower AICc than the unconstrained Q for previous examples.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mod.list8 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">7</span>), <span class="st">'Sp1'</span>, <span class="st">'Sp2'</span>, <span class="st">'Sp3'</span>, <span class="st">'Sp4'</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>fit8<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list8, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 291 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 291 iterations. 
Log-likelihood: -499.9098 
AIC: 1043.82   AICc: 1047.063   
 
                              Estimate
A.Lewis River - fall          1.67e+00
A.Lower Cowlitz River - fall  3.23e+00
A.Toutle River - fall         1.83e+00
A.Upper Cowlitz River - fall  9.24e-01
A.Lewis River - late fall     4.03e+00
A.Sandy River - late fall     3.05e+00
R.diag                        1.03e+00
U.fa                          1.23e-02
U.Sp1                        -4.52e-02
U.Sp2                        -5.56e-02
U.Sp3                         2.56e-02
U.Sp4                         3.71e-02
Q.(fa,fa)                     1.44e-01
Q.(Sp1,Sp1)                   2.67e-12
Q.(Sp2,Sp2)                   2.54e-12
Q.(Sp3,Sp3)                   6.24e-12
Q.(Sp4,Sp4)                   1.20e-12
x0.fa                         5.24e+00
x0.Sp1                        6.88e+00
x0.Sp2                        8.25e+00
x0.Sp3                        6.76e+00
x0.Sp4                        4.44e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit8, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>The AICc is quite a bit higher than it was for our preferred models. We can also see that some of the fall populations (e.g.&nbsp;Upper Cowlitz) are not well represented with this model.</p>
</section>
<section id="evaluate-the-evidence-of-cycling-in-the-data." class="level3">
<h3 class="anchored" data-anchor-id="evaluate-the-evidence-of-cycling-in-the-data.">3. Evaluate the evidence of cycling in the data.&nbsp;</h3>
<p>We want to subset the data so that we can have three rivers with no NAs. We are choosing Lewis river fall, Lewis river late fall and Lower Cowlitz river from 1964 to 2008.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>chin_subset <span class="ot">&lt;-</span> chin_newdat[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chin_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                               1964     1965     1966     1967     1968
Lewis River - fall         6.448889 6.792344 6.368187 6.018593 5.517453
Lower Cowlitz River - fall 8.105308 8.649449 8.472614 8.610137 7.741968
Lewis River - late fall    9.732521 8.978030 9.361085 9.181015 8.876265
                               1969     1970      1971     1972     1973
Lewis River - fall         5.796058 6.487684  7.669495 6.280396 5.347108
Lower Cowlitz River - fall 8.357024 9.180500 10.032672 9.953563 9.034796
Lewis River - late fall    8.514389 8.326033  9.899781 9.824877 9.118225
                               1974     1975     1976     1977     1978
Lewis River - fall         6.040255 6.364751 5.783825 6.342121 6.532334
Lower Cowlitz River - fall 8.931420 8.469263 8.223091 8.671972 8.068403
Lewis River - late fall    8.929170 9.536690 8.122965 8.843615 8.587279
                               1979     1980     1981     1982     1983
Lewis River - fall         6.573680 5.739793 5.983936 5.480639 5.720312
Lower Cowlitz River - fall 9.018332 7.790696 8.291797 8.014336 8.203578
Lewis River - late fall    8.990068 9.535246 9.867705 9.032409 9.513404
                               1984     1985     1986     1987     1988
Lewis River - fall         5.257495 6.291569 7.549609 6.740519 7.180831
Lower Cowlitz River - fall 7.854381 8.366370 8.127995 8.687779 8.948976
Lewis River - late fall    8.872347 8.921458 9.256460 9.410011 9.320539
                               1989     1990     1991     1992     1993
Lewis River - fall         7.457032 7.811973 6.232448 6.908755 6.577861
Lower Cowlitz River - fall 8.884610 7.900266 7.850493 7.819636 7.704361
Lewis River - late fall    9.906383 9.640693 9.081029 8.613957 8.773694
                               1994     1995     1996     1997     1998
Lewis River - fall         7.536364 5.298317 7.135687 7.459915 7.192182
Lower Cowlitz River - fall 7.828835 7.710205 7.379008 7.904704 7.653495
Lewis River - late fall    9.042632 9.181426 9.478610 9.007979 8.551208
                               1999     2000     2001     2002     2003
Lewis River - fall         7.130099 7.431892 8.326517 8.561019 8.782323
Lower Cowlitz River - fall 6.904751 7.767687 8.445053 9.511481 9.215129
Lewis River - late fall    7.790282 9.075780 9.330254 9.494993 9.465912
                               2004     2005     2006     2007     2008
Lewis River - fall         7.682943 7.838343 7.194437 6.919684 7.135687
Lower Cowlitz River - fall 8.404248 7.962067 7.987524 7.521318 7.510978
Lewis River - late fall    9.467151 9.187583 8.530307 8.218248 8.609772</code></pre>
</div>
</div>
<p>First we want to look at the ACF of each time series to see potential cycles.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(chin_subset[i,], <span class="at">na.action=</span>na.pass, <span class="at">main=</span><span class="fu">rownames</span>(chin_subset)[i])</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It looks like there might be a 4 year cycle in Lewis river fall. We can test 4 and 5 since Chinook are known to have 5 year cycles.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(chin_subset)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">4</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>(),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">5</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
</div>
<p>For now, we will choose the best model from the earlier part of the assignment for the MARSS model. However, the best model for the 3 river subset is likely to be different. We will then add the cycles as covariates in the model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>mod.list_cycle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>fit_cycle <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(chin_subset, <span class="at">model=</span>mod.list_cycle, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 65 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 65 iterations. 
Log-likelihood: -113.3892 
AIC: 270.7784   AICc: 279.8141   
 
                                                               Estimate
R.diag                                                         1.92e-01
U.X.Lewis River - fall                                         1.64e-02
U.X.Lower Cowlitz River - fall                                -1.90e-02
U.X.Lewis River - late fall                                   -5.62e-03
Q.(X.Lewis River - fall,X.Lewis River - fall)                  1.34e-01
Q.(X.Lower Cowlitz River - fall,X.Lower Cowlitz River - fall)  9.35e-02
Q.(X.Lewis River - late fall,X.Lewis River - late fall)        6.85e-11
x0.X.Lewis River - fall                                        6.57e+00
x0.X.Lower Cowlitz River - fall                                8.49e+00
x0.X.Lewis River - late fall                                   9.22e+00
D.(Lewis River - fall,S1-4)                                   -2.16e-01
D.(Lower Cowlitz River - fall,S1-4)                           -9.17e-02
D.(Lewis River - late fall,S1-4)                               8.73e-02
D.(Lewis River - fall,C1-4)                                   -5.16e-02
D.(Lower Cowlitz River - fall,C1-4)                            3.89e-03
D.(Lewis River - late fall,C1-4)                               3.07e-04
D.(Lewis River - fall,S1-5)                                   -5.67e-02
D.(Lower Cowlitz River - fall,S1-5)                           -1.48e-01
D.(Lewis River - late fall,S1-5)                              -4.41e-02
D.(Lewis River - fall,C1-5)                                   -6.82e-02
D.(Lower Cowlitz River - fall,C1-5)                            5.02e-02
D.(Lewis River - late fall,C1-5)                              -1.18e-01
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<p>We will get the estimates of the covariate effect and it’s confidence intervals.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_cycle) <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co"># we only want the covariate estimates</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#term is the parameter it is estimating</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each=</span><span class="dv">6</span>)) <span class="co">#estimating 2 (4 year and 5 year) cycles for 3 rivers </span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#6 because 2 parameters for each river (sine and cosine)</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(chin_subset),<span class="dv">2</span>)) <span class="co"># 2 for number of cycles</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>,<span class="st">"C"</span>), <span class="at">each=</span><span class="dv">3</span>), <span class="dv">2</span>) <span class="co"># 3 for rivers # 2 for cycles</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                  term      estimate  std.error    conf.low
11         D.(Lewis River - fall,S1-4) -0.2158588574 0.10781167 -0.42716585
12 D.(Lower Cowlitz River - fall,S1-4) -0.0917007008 0.10335661 -0.29427592
13    D.(Lewis River - late fall,S1-4)  0.0873051494 0.09203433 -0.09307882
14         D.(Lewis River - fall,C1-4) -0.0515586139 0.10922426 -0.26563424
15 D.(Lower Cowlitz River - fall,C1-4)  0.0038877770 0.10485041 -0.20161525
16    D.(Lewis River - late fall,C1-4)  0.0003071104 0.09380568 -0.18354864
17         D.(Lewis River - fall,S1-5) -0.0567488738 0.11526732 -0.28266866
18 D.(Lower Cowlitz River - fall,S1-5) -0.1477865944 0.10914505 -0.36170697
19    D.(Lewis River - late fall,S1-5) -0.0441016466 0.09301040 -0.22639868
20         D.(Lewis River - fall,C1-5) -0.0681577316 0.11466037 -0.29288792
21 D.(Lower Cowlitz River - fall,C1-5)  0.0502014604 0.10861810 -0.16268610
22    D.(Lewis River - late fall,C1-5) -0.1178414141 0.09312231 -0.30035778
        conf.up lag                      river sc type
11 -0.004551867   4         Lewis River - fall  S   S4
12  0.110874523   4 Lower Cowlitz River - fall  S   S4
13  0.267689120   4    Lewis River - late fall  S   S4
14  0.162517008   4         Lewis River - fall  C   C4
15  0.209390808   4 Lower Cowlitz River - fall  C   C4
16  0.184162861   4    Lewis River - late fall  C   C4
17  0.169170915   5         Lewis River - fall  S   S5
18  0.066133779   5 Lower Cowlitz River - fall  S   S5
19  0.138195383   5    Lewis River - late fall  S   S5
20  0.156572459   5         Lewis River - fall  C   C5
21  0.263089022   5 Lower Cowlitz River - fall  C   C5
22  0.064674950   5    Lewis River - late fall  C   C5</code></pre>
</div>
</div>
<p>Plot the results</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates with CIs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-2-team-1_final_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It looks like Lewis river fall has a 4 year cycle.</p>
<p>To see whether the model with cycle fits the model without cycles better, we will specify another MARSS model without the fourier covariates.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mod.list_wo_cycle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>fit_wo_cycle <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(chin_subset, <span class="at">model=</span>mod.list_wo_cycle, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 28 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 28 iterations. 
Log-likelihood: -118.5044 
AIC: 257.0088   AICc: 258.783   
 
                                                               Estimate
R.diag                                                         2.09e-01
U.X.Lewis River - fall                                         1.61e-02
U.X.Lower Cowlitz River - fall                                -1.55e-02
U.X.Lewis River - late fall                                   -5.80e-03
Q.(X.Lewis River - fall,X.Lewis River - fall)                  1.43e-01
Q.(X.Lower Cowlitz River - fall,X.Lower Cowlitz River - fall)  9.39e-02
Q.(X.Lewis River - late fall,X.Lewis River - late fall)        3.81e-14
x0.X.Lewis River - fall                                        6.45e+00
x0.X.Lower Cowlitz River - fall                                8.37e+00
x0.X.Lewis River - late fall                                   9.22e+00
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<p>AIC for model without cycles is 257 and for model with cycles is 284. There is more support for model without cycles even though we this is Chinook data.</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We esimated that 6 of the 11 populations showed a decline from historical abundance, with two populations demonstrating a &gt;25% decline in log-abundance. However, other populations were estimated to be increasing, with the populations in the Upper Cowlitz river (both spring and fall) showing very large increases in abundance. However, we’re not sure all of these results are reasonable, specially these levels of increase in the Upper Cowlitz river, and these results change with the different model formulations we tested. Though our best model had the lowest AICc, perhaps more models should be tested to confirm these results.</p>
<p>Residuals for model 1 (hyp. 1) did not show an association with time; however, in the residuals for model 4 (best hyp. 2 model) some of the populations did still show an association with time. This further supports our selection of model 1 as our best model.</p>
<p>We found that the population abundances of fall and late fall Chinook were positively correlated, with additional structure according to geographic proximity. Spring run populations showed higher differentiation from each other. However, when fall populations were grouped the model AICc was not improved. There is likely environmental and/or biological association among the fall and late fall run populations but they should be considered separate populations in our models.</p>
<p>When we evaluated the evidence for 4 and 5 year cycling in Chinook salmon in a subset of the rivers (Lewis fall, Lewis late fall, and Lower Cowlitz fall), we found that there was some support for a 4 year cycle in Lewis fall data. However, the AIC was much lower for a model without cycles. It is possible that another model with cycles is better.</p>
</section>
<section id="description-of-each-team-members-contributions" class="level1">
<h1>Description of each team member’s contributions</h1>
<p>All members contributed to developing the plan and methods for the analysis. ETS and ZR worked on the code for subsetting the data and fitting the models. ZR wrote the equations for the methods and worked on the results for the first question on historical abundance. ETS analyzed the results in terms of evidence for multiple populations. MK analyzed the evidence of cycling in the data. All team members contributed to the discussion and worked on the report together.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/atsa-es\.github\.io\/fish550-2023\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-2/Lab2-MARSS.html" class="pagination-link" aria-label="Lab Intro">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="pagination-link" aria-label="Team 2 - Lab 2">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Team 1 - Lab 2</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Lab 2 MARSS models</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Emma Timmins-Schiffman, Maria Kuruvilla, Zoe Rand"</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(MARSS)</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>Describe what data set you will work with and any subsetting you decided on. For example, you may have decided to look only at a section of the ESU that your team was assigned.</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>Load the data.</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-2"</span>, <span class="st">"Data_Images"</span>, <span class="st">"columbia-river.rda"</span>))</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>Look at the data.</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>esu <span class="ot">&lt;-</span> <span class="fu">unique</span>(columbia.river<span class="sc">$</span>esu_dps)</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>esu</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>plotesu <span class="ot">&lt;-</span> <span class="cf">function</span>(esuname){</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> columbia.river <span class="sc">%&gt;%</span> <span class="fu">subset</span>(esu_dps <span class="sc">%in%</span> esuname)</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>spawningyear, <span class="at">y=</span><span class="fu">log</span>(value), <span class="at">color=</span>majorpopgroup)) <span class="sc">+</span> </span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>esapopname) <span class="sc">+</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(esuname, <span class="at">collapse=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Chinook</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="fu">plotesu</span>(esu[<span class="dv">5</span>])</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>Wrangle the data.</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>We had some issues with one of the populations having duplicated entries, with some being NA and some having values, (Lower Gorge Tributaries - fall) and we also had a lot of ESA populations, so we decided to focus only on the Cascade populations.</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>chin_c_r<span class="ot">&lt;-</span>columbia.river <span class="sc">%&gt;%</span> <span class="fu">subset</span>(esu_dps <span class="sc">==</span> esu[<span class="dv">5</span>])</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>chin_c_r <span class="sc">%&gt;%</span> </span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(majorpopgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cascade fall"</span>, <span class="st">"Cascade late fall"</span>, <span class="st">"Cascade spring"</span>)) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>spawningyear, <span class="at">y=</span><span class="fu">log</span>(value), <span class="at">color=</span>majorpopgroup)) <span class="sc">+</span> </span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>esapopname) <span class="sc">+</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(esu[<span class="dv">5</span>], <span class="at">collapse=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a>Formatting data for MARSS:</span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>chin_newdat <span class="ot">&lt;-</span> chin_c_r <span class="sc">%&gt;%</span> </span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(majorpopgroup <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cascade fall"</span>, <span class="st">"Cascade late fall"</span>, <span class="st">"Cascade spring"</span>)) <span class="sc">%&gt;%</span> <span class="co">#just looking at cascade populations</span></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log.spawner =</span> <span class="fu">log</span>(value)) <span class="sc">%&gt;%</span> <span class="co"># create a column called log.spawner</span></span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(esapopname, spawningyear, log.spawner) <span class="sc">%&gt;%</span> <span class="co"># get just the columns that I need</span></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> esapopname, <span class="at">values_from =</span> log.spawner) <span class="sc">%&gt;%</span> </span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"spawningyear"</span>) <span class="sc">%&gt;%</span> <span class="co"># make the years rownames</span></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> <span class="co"># turn into a matrix with year down the rows</span></span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="co"># make time across the columns</span></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a><span class="co"># MARSS complains if I don't do this</span></span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a>chin_newdat[<span class="fu">is.na</span>(chin_newdat)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a><span class="co">#clean up row names</span></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(chin_newdat)</span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(tmp, <span class="st">"Salmon, Chinook [(]Lower Columbia River ESU[)]"</span>, <span class="st">""</span>)</span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_trim</span>(tmp)</span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(chin_newdat) <span class="ot">&lt;-</span> tmp</span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a><span class="co">#look at data</span></span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chin_newdat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a><span class="fu"># General Questions</span></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a>Each group has the same general tasks, but you will adapt them as you work on the data.</span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Create estimates of spawner abundance for all missing years and provide estimates of the decline from the historical abundance.</span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Evaluate support for the major population groups. Are the populations in the groups more correlated than outside the groups?</span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Evaluate the evidence of cycling in the data. *We will talk about how to do this on the Tuesday after lab.*</span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-106"><a href="#cb81-106" aria-hidden="true" tabindex="-1"></a>Address the following in your methods</span>
<span id="cb81-107"><a href="#cb81-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a>*Describe your assumptions about the x and how the data time series are related to x.*</span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We tested 2 different assumptions about how the data time series are related to x.</span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true" tabindex="-1"></a><span class="ss">    1.  </span>All the esa populations are independent populations: this means that each data series (y) corresponds to an independent x series.</span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true" tabindex="-1"></a><span class="ss">    2.  </span>There are 3 Cascade populations based on run timing, and the river surveys are all surveying these populations according to run time: this means that each data series (y) corresponds to the x series that relates to its run timing (major population group).</span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Within both of these, we tested independent process errors with different variances (Q is "diagonal and unequal"), as well as independent process errors with equal variances (Q is "diagonal and equal"), and equal variance covariance (Q is "equalvarcov").</span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>We assumed that each population has its own growth rate (U is unequal).</span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a>    *Write out assumptions in matrix form:*</span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-122"><a href="#cb81-122" aria-hidden="true" tabindex="-1"></a><span class="in">    1.  11 independent populations</span></span>
<span id="cb81-123"><a href="#cb81-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a><span class="in">        $$</span></span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a><span class="in">        \begin{bmatrix} x_{t,1} \\ x_{t,2}\\ ... \\x_{t,11} \end{bmatrix} = \begin{bmatrix} x_{t-1,1} \\ x_{t-1,2}\\ ... \\x_{t-1,11} \end{bmatrix} + \begin{bmatrix} u_1 \\ u_2\\ ... \\u_{11} \end{bmatrix} + w_t \text{  where } w_t \sim MVN(0, \mathbf{Q})</span></span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true" tabindex="-1"></a><span class="in">        $$</span></span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a><span class="in">    where:</span></span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a><span class="in">    \mathbf{Q} = </span></span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true" tabindex="-1"></a><span class="in">    \begin{bmatrix} q_1 &amp; 0  &amp; ...&amp; 0\\</span></span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true" tabindex="-1"></a><span class="in">    0 &amp; q_2 &amp;  ...&amp; 0\\</span></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a><span class="in">    \vdots &amp; 0 &amp; \ddots &amp; \vdots\\</span></span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a><span class="in">    0 &amp; 0 &amp; 0  &amp; q_{11} \end{bmatrix}</span></span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a><span class="in">    or:</span></span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true" tabindex="-1"></a><span class="in">    \mathbf{Q} = </span></span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a><span class="in">    \begin{bmatrix} q &amp; 0  &amp; ...&amp; 0\\</span></span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true" tabindex="-1"></a><span class="in">    0 &amp; q &amp;  ...&amp; 0\\</span></span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true" tabindex="-1"></a><span class="in">    \vdots &amp; 0 &amp; \ddots &amp; \vdots\\</span></span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a><span class="in">    0 &amp; 0 &amp; 0  &amp; q \end{bmatrix}</span></span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a><span class="in">    or:</span></span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a>\mathbf{Q} = </span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} q &amp; p  &amp; ...&amp; p<span class="sc">\\</span></span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a>p &amp; q &amp;  ...&amp; p<span class="sc">\\</span></span>
<span id="cb81-154"><a href="#cb81-154" aria-hidden="true" tabindex="-1"></a>\vdots &amp; p &amp; \ddots &amp; \vdots<span class="sc">\\</span></span>
<span id="cb81-155"><a href="#cb81-155" aria-hidden="true" tabindex="-1"></a>p &amp; p &amp; p  &amp; q \end{bmatrix}</span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} y_{t,1} <span class="sc">\\</span> y_{t, 2} <span class="sc">\\</span> \vdots <span class="sc">\\</span>y_{t,11} \end{bmatrix} = </span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}1 &amp; 0  &amp; ...&amp; 0<span class="sc">\\</span></span>
<span id="cb81-161"><a href="#cb81-161" aria-hidden="true" tabindex="-1"></a>0 &amp; 1 &amp;  ...&amp; 0<span class="sc">\\</span></span>
<span id="cb81-162"><a href="#cb81-162" aria-hidden="true" tabindex="-1"></a>\vdots &amp; 0 &amp; \ddots &amp; \vdots<span class="sc">\\</span></span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a>0 &amp; 0 &amp; 0  &amp; 1\end{bmatrix} </span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} x_{t,1} <span class="sc">\\</span> x_{t, 2} <span class="sc">\\</span> \vdots <span class="sc">\\</span>x_{t,11} \end{bmatrix} + \mathbf{a} + \mathbf{v_t} \text{ where } \mathbf{v_t} \sim MVN(0, \mathbf{R})</span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-170"><a href="#cb81-170" aria-hidden="true" tabindex="-1"></a>\mathbf{R} = </span>
<span id="cb81-171"><a href="#cb81-171" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} r &amp; 0  &amp; ...&amp; 0<span class="sc">\\</span></span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a>0 &amp; r &amp;  ...&amp; 0<span class="sc">\\</span></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a>\vdots &amp; 0 &amp; \ddots &amp; \vdots<span class="sc">\\</span></span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a>0 &amp; 0 &amp; 0  &amp; r \end{bmatrix}</span>
<span id="cb81-175"><a href="#cb81-175" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-176"><a href="#cb81-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>3 independent populations according to run time</span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-180"><a href="#cb81-180" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} x_{t,1} <span class="sc">\\</span> x_{t,2}<span class="sc">\\</span> x_{t,3} \end{bmatrix} = \begin{bmatrix} x_{t-1,1} <span class="sc">\\</span> x_{t-1,2}<span class="sc">\\</span> x_{t-1,3} \end{bmatrix} + \begin{bmatrix} u_1 <span class="sc">\\</span> u_2<span class="sc">\\</span> u_3 \end{bmatrix} + w_t \text{  where } w_t \sim MVN(0, \mathbf{Q})$$</span>
<span id="cb81-181"><a href="#cb81-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a>where ***Q*** is as above but is 3x3 instead of 11x11.</span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} y_{t,1} <span class="sc">\\</span> y_{t, 2} <span class="sc">\\</span> \vdots <span class="sc">\\</span>y_{t,11} \end{bmatrix} = </span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}1 &amp; 0  &amp;  0<span class="sc">\\</span></span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a>1 &amp; 0 &amp;  0<span class="sc">\\</span></span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a>\vdots &amp; 1 &amp; \vdots<span class="sc">\\</span></span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a>0 &amp; 1 &amp; 0 <span class="sc">\\</span> </span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a>\vdots &amp; \vdots &amp; \vdots<span class="sc">\\</span></span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a>\vdots &amp; 0 &amp; 1 <span class="sc">\\</span></span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a>\vdots &amp; \vdots &amp; \vdots \end{bmatrix} </span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix} x_{t,1} <span class="sc">\\</span> x_{t, 2} <span class="sc">\\</span>x_{t,3} \end{bmatrix} + \mathbf{a} + \mathbf{v_t} \text{ where } \mathbf{v_t} \sim MVN(0, \mathbf{R})</span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a>and ***R*** is the same as above.</span>
<span id="cb81-197"><a href="#cb81-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-198"><a href="#cb81-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a><span class="fu">## Code for analysis:</span></span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.  Hypothesis 1: 11 independent populations</span></span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-205"><a href="#cb81-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-206"><a href="#cb81-206" aria-hidden="true" tabindex="-1"></a>mod.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span></span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list1, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-217"><a href="#cb81-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-218"><a href="#cb81-218" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-219"><a href="#cb81-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a><span class="in">options(knitr.duplicate.label = "allow")</span></span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-224"><a href="#cb81-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a><span class="co"># resid1&lt;-autoplot(fit1, plot.type="residuals")</span></span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a><span class="co"># headings&lt;-c('Model innovation', "Cholesky standardized model smoothation", "Cholesky standaradized state smoothation", "Residuals normality test", "Cholesky standaradized model innnovation residuals acf")</span></span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"model.resids.ytt1"</span>)</span>
<span id="cb81-232"><a href="#cb81-232" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"qqplot.std.model.resids.ytt1"</span>)</span>
<span id="cb81-233"><a href="#cb81-233" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit1, <span class="at">plot.type =</span> <span class="st">"acf.std.model.resids.ytt1"</span>)</span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-235"><a href="#cb81-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-236"><a href="#cb81-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='residuals model 1', echo=F}</span></span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a><span class="in"># for(i in 1:length(resid1)) {</span></span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a><span class="in">#   cat("#### ", headings[i], "\n")</span></span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a><span class="in">#   print(resid1[[i]])</span></span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a><span class="in">#   cat('\n\n')</span></span>
<span id="cb81-243"><a href="#cb81-243" aria-hidden="true" tabindex="-1"></a><span class="in"># }</span></span>
<span id="cb81-244"><a href="#cb81-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-245"><a href="#cb81-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-246"><a href="#cb81-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a>mod.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and equal"</span></span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list2, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span>
<span id="cb81-257"><a href="#cb81-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-258"><a href="#cb81-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-261"><a href="#cb81-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-262"><a href="#cb81-262" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a>mod.list3 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-270"><a href="#cb81-270" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-271"><a href="#cb81-271" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"equalvarcov"</span></span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list3, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit3, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Hypothesis 2: 3 independent populations based on run timing</span>
<span id="cb81-285"><a href="#cb81-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-286"><a href="#cb81-286" aria-hidden="true" tabindex="-1"></a>mod.list4<span class="ot">&lt;-</span>mod.list1</span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(chin_newdat)</span>
<span id="cb81-288"><a href="#cb81-288" aria-hidden="true" tabindex="-1"></a>mod.list4<span class="sc">$</span>Z<span class="ot">&lt;-</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">4</span>))) <span class="co">#creating factor based on run times</span></span>
<span id="cb81-289"><a href="#cb81-289" aria-hidden="true" tabindex="-1"></a><span class="co">#mod.list4</span></span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list4, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit4, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-298"><a href="#cb81-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-299"><a href="#cb81-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-302"><a href="#cb81-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-303"><a href="#cb81-303" aria-hidden="true" tabindex="-1"></a>mod.list5<span class="ot">&lt;-</span>mod.list4</span>
<span id="cb81-304"><a href="#cb81-304" aria-hidden="true" tabindex="-1"></a>mod.list5<span class="sc">$</span>Q<span class="ot">&lt;-</span><span class="st">"diagonal and equal"</span></span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a>fit5<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list5, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-307"><a href="#cb81-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit5, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a>mod.list6<span class="ot">&lt;-</span>mod.list4</span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a>mod.list6<span class="sc">$</span>Q<span class="ot">&lt;-</span><span class="st">"equalvarcov"</span></span>
<span id="cb81-319"><a href="#cb81-319" aria-hidden="true" tabindex="-1"></a>fit6<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model =</span> mod.list6, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">2000</span>))</span>
<span id="cb81-320"><a href="#cb81-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit6, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-326"><a href="#cb81-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-327"><a href="#cb81-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-332"><a href="#cb81-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-333"><a href="#cb81-333" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc, fit5<span class="sc">$</span>AICc, fit6<span class="sc">$</span>AICc)</span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a>mods<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a>aic.names<span class="ot">&lt;-</span><span class="fu">paste</span>(<span class="st">"Model"</span>, mods, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">c</span>(aic, aic<span class="sc">-</span><span class="fu">min</span>(aic)), <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">byrow =</span> F)</span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(a)<span class="ot">&lt;-</span>aic.names</span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span>a[<span class="fu">order</span>(a[,<span class="dv">2</span>],<span class="at">decreasing=</span><span class="cn">FALSE</span>),] <span class="co">#order by lowest AICc</span></span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(a, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"AICc"</span>, <span class="st">"Delta AIC"</span>)) <span class="co">#make a pretty table</span></span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a>The first model we tested, where we had each population with its own x value and Q was diagonal and unequal, had the lowest AICc. Therefore, we used this model to look at historical abundance.</span>
<span id="cb81-343"><a href="#cb81-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-344"><a href="#cb81-344" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>*Create estimates of spawner abundance for all missing years and provide estimates of the decline from the historical abundance.*</span>
<span id="cb81-345"><a href="#cb81-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-346"><a href="#cb81-346" aria-hidden="true" tabindex="-1"></a>Estimates of log abundance for each population:</span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-351"><a href="#cb81-351" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">"Pop"</span> <span class="ot">=</span> <span class="fu">rownames</span>(chin_newdat),<span class="st">"Dat"</span> <span class="ot">=</span> chin_newdat[,<span class="dv">1</span>], <span class="st">"Est"</span> <span class="ot">=</span> fit1<span class="sc">$</span>states[,<span class="dv">1</span>])</span>
<span id="cb81-352"><a href="#cb81-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a>Estimated percent change from historical abundance for each population</span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a><span class="in">#percent change in log abundance </span></span>
<span id="cb81-358"><a href="#cb81-358" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund&lt;-tibble(Pop = rownames(chin_newdat), </span></span>
<span id="cb81-359"><a href="#cb81-359" aria-hidden="true" tabindex="-1"></a><span class="in">                   Year1 = fit1$states[,1],</span></span>
<span id="cb81-360"><a href="#cb81-360" aria-hidden="true" tabindex="-1"></a><span class="in">                   Year58 = fit1$states[,58])</span></span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a><span class="in">                   </span></span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund&lt;-hist.abund %&gt;% mutate(PChange = ((Year58 - Year1)/abs(Year1)) * 100)</span></span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a><span class="in">#the estimate for "Upper Cowlitz River - fall" initial population is super low (&lt;1 in real scale), and so the percent change blows up (it's like 1000), so I took this out to make the plot easier to read. Also I think this is probably unrealistic. </span></span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund %&gt;% filter(Pop != "Upper Cowlitz River - fall") %&gt;%</span></span>
<span id="cb81-366"><a href="#cb81-366" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() + geom_histogram(aes(x = Pop, y = PChange, fill = factor(c(rep("fa", 5), rep("l_fa", 2), rep("Sp", 3)))), stat = "identity") + </span></span>
<span id="cb81-367"><a href="#cb81-367" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(aes(yintercept = 0), color = "red") + </span></span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_discrete(labels = c("Fall", "Late Fall", "Spring"), name = "Run") + </span></span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Population", y="% Change From Hist. Abund.") + theme_minimal() + </span></span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 270, hjust = -0.1))</span></span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a>*Do your estimates differ depending on the assumptions you make about the structure of the data, i.e. you assumptions about the x's, Q, and U?*</span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a>Using our second best model:</span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-377"><a href="#cb81-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE}</span></span>
<span id="cb81-378"><a href="#cb81-378" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund&lt;-tibble(Pop = rownames(chin_newdat), </span></span>
<span id="cb81-379"><a href="#cb81-379" aria-hidden="true" tabindex="-1"></a><span class="in">                   Year1 = fit3$states[,1],</span></span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a><span class="in">                   Year58 = fit3$states[,58])</span></span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a><span class="in">                   </span></span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund&lt;-hist.abund %&gt;% mutate(PChange = ((Year58 - Year1)/abs(Year1)) * 100)</span></span>
<span id="cb81-383"><a href="#cb81-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-384"><a href="#cb81-384" aria-hidden="true" tabindex="-1"></a><span class="in">#the estimate for "Upper Cowlitz River - fall" is still not great, so I took this out for this plot as well</span></span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a><span class="in">hist.abund %&gt;% filter(Pop != "Upper Cowlitz River - fall") %&gt;% </span></span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot() + geom_histogram(aes(x = Pop, y = PChange, fill = factor(c(rep("fa", 5), rep("l_fa", 2), rep("Sp", 3)))), stat = "identity") + </span></span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(aes(yintercept = 0), color = "red") + </span></span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_discrete(labels = c("Fall", "Late Fall", "Spring"), name = "Run") + </span></span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Population", y="% Change From Hist. Abund.") + theme_minimal() + </span></span>
<span id="cb81-390"><a href="#cb81-390" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 270, hjust = -0.1))</span></span>
<span id="cb81-391"><a href="#cb81-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-392"><a href="#cb81-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-393"><a href="#cb81-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-394"><a href="#cb81-394" aria-hidden="true" tabindex="-1"></a>The form of the model does make a difference in the model outputs. For instance, in the first model, the populations of Sandy River spring and late fall are estimated to show an increase, while in the second model, it's estimated to decrease. Lewis River fall and Lower Cowlitz river fall and Toutle River fall, all show opposite trends in these two models as well.</span>
<span id="cb81-395"><a href="#cb81-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2.  Evaluate support for the major population groups. Are the populations in the groups more correlated than outside the groups?</span></span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a>Look at the correlation plots for the best models for each hypothesis: model 1 for hypothesis 1 and model 4 for hypothesis 2</span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a>Population correlations for Model 1</span>
<span id="cb81-401"><a href="#cb81-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a><span class="co">#different variances and covariances in process error</span></span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a>mod.list1.unconst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-409"><a href="#cb81-409" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-410"><a href="#cb81-410" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span></span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-412"><a href="#cb81-412" aria-hidden="true" tabindex="-1"></a>fit1.unconst<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list1.unconst, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-413"><a href="#cb81-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-416"><a href="#cb81-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-417"><a href="#cb81-417" aria-hidden="true" tabindex="-1"></a>Q1.unconst <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1.unconst, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a>corrmat1.unconst <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q1.unconst))) <span class="sc">%*%</span> Q1.unconst <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q1.unconst)))</span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat1.unconst)</span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a>For model 1 (with Q changed to unconstrained so we can see a correlation matrix), abundances from the Clackamas fall (1) and Sandy River late fall (7) populations are highly positively correlated. These populations are very close geographically. In fact, populations 1-7 are all positively correlated; these are the fall run populations and may be influenced by the same environmental variables. Spring run populations demonstrate less association with each other and with the fall run fish. These results suggest that we could possibly group fall and late fall runs together, but there is little support for grouping the separate spring run populations.</span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-425"><a href="#cb81-425" aria-hidden="true" tabindex="-1"></a>We can similarly look at an unconstrained Q if we group the populations:</span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a>mod.list4.unconst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-432"><a href="#cb81-432" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb81-433"><a href="#cb81-433" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"l_fa"</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">"Sp"</span>, <span class="dv">4</span>)))</span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a>fit4.unconst<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list4.unconst, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a>Q4.unconst <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit4.unconst, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a>corrmat4.unconst <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q4.unconst))) <span class="sc">%*%</span> Q4.unconst <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q4.unconst)))</span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat4.unconst)</span>
<span id="cb81-440"><a href="#cb81-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-441"><a href="#cb81-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-442"><a href="#cb81-442" aria-hidden="true" tabindex="-1"></a>When the data are all collapsed by run timing, all runs show high positive correlation with each other. We know this is a false way to group the data, but we can try to fit a model with grouped fall &amp; late fall runs and separate spring run populations.</span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a>mod.list7 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">7</span>), <span class="st">'Sp1'</span>, <span class="st">'Sp2'</span>, <span class="st">'Sp3'</span>, <span class="st">'Sp4'</span>))</span>
<span id="cb81-454"><a href="#cb81-454" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-455"><a href="#cb81-455" aria-hidden="true" tabindex="-1"></a>fit7<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list7, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a>Q7 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit7, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>Q</span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a>corrmat7 <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q7))) <span class="sc">%*%</span> Q7 <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(Q7)))</span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corrmat7)</span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-462"><a href="#cb81-462" aria-hidden="true" tabindex="-1"></a>Check the fit of this model if Q is set to diagonal and unequal, which yields a lower AICc than the unconstrained Q for previous examples.</span>
<span id="cb81-463"><a href="#cb81-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a>mod.list8 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>,</span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"fa"</span>, <span class="dv">7</span>), <span class="st">'Sp1'</span>, <span class="st">'Sp2'</span>, <span class="st">'Sp3'</span>, <span class="st">'Sp4'</span>))</span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-474"><a href="#cb81-474" aria-hidden="true" tabindex="-1"></a>fit8<span class="ot">&lt;-</span><span class="fu">MARSS</span>(chin_newdat, <span class="at">model=</span>mod.list8, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-475"><a href="#cb81-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-476"><a href="#cb81-476" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit8, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a>The AICc is quite a bit higher than it was for our preferred models. We can also see that some of the fall populations (e.g. Upper Cowlitz) are not well represented with this model. </span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.  Evaluate the evidence of cycling in the data.&nbsp;</span></span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-482"><a href="#cb81-482" aria-hidden="true" tabindex="-1"></a>We want to subset the data so that we can have three rivers with no NAs. We are choosing Lewis river fall, Lewis river late fall and Lower Cowlitz river from 1964 to 2008.</span>
<span id="cb81-483"><a href="#cb81-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a>chin_subset <span class="ot">&lt;-</span> chin_newdat[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>]</span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chin_subset)</span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a>First we want to look at the ACF of each time series to see potential cycles. </span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">acf</span>(chin_subset[i,], <span class="at">na.action=</span>na.pass, <span class="at">main=</span><span class="fu">rownames</span>(chin_subset)[i])</span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a>It looks like there might be a 4 year cycle in Lewis river fall. We can test 4 and 5 since Chinook are known to have 5 year cycles. </span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-511"><a href="#cb81-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-512"><a href="#cb81-512" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(chin_subset)[<span class="dv">2</span>] <span class="co">#number of time steps</span></span>
<span id="cb81-513"><a href="#cb81-513" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-514"><a href="#cb81-514" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">4</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>(),</span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">fourier</span>(<span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span>TT, <span class="at">freq=</span><span class="dv">5</span>), <span class="at">K=</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a>For now, we will choose the best model from the earlier part of the assignment for the MARSS model. However, the best model for the 3 river subset is likely to be different. We will then add the cycles as covariates in the model.</span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a>mod.list_cycle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span>,</span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> <span class="st">"unconstrained"</span>,</span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> covariates</span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a>fit_cycle <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(chin_subset, <span class="at">model=</span>mod.list_cycle, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-536"><a href="#cb81-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-537"><a href="#cb81-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a>We will get the estimates of the covariate effect and it's confidence intervals. </span>
<span id="cb81-539"><a href="#cb81-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-540"><a href="#cb81-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-544"><a href="#cb81-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_cycle) <span class="sc">%&gt;%</span></span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(stringr<span class="sc">::</span><span class="fu">str_sub</span>(term,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"D"</span>) <span class="co"># we only want the covariate estimates</span></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a><span class="co">#term is the parameter it is estimating</span></span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>lag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each=</span><span class="dv">6</span>)) <span class="co">#estimating 2 (4 year and 5 year) cycles for 3 rivers </span></span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a><span class="co">#6 because 2 parameters for each river (sine and cosine)</span></span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>river <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">rownames</span>(chin_subset),<span class="dv">2</span>)) <span class="co"># 2 for number of cycles</span></span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sc <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"S"</span>,<span class="st">"C"</span>), <span class="at">each=</span><span class="dv">3</span>), <span class="dv">2</span>) <span class="co"># 3 for rivers # 2 for cycles</span></span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>sc,df<span class="sc">$</span>lag)</span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a>Plot the results</span>
<span id="cb81-559"><a href="#cb81-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-560"><a href="#cb81-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>type, <span class="at">y=</span>estimate, <span class="at">col=</span>lag)) <span class="sc">+</span> </span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>conf.low, <span class="at">ymax=</span>conf.up), <span class="at">width=</span>.<span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>river) <span class="sc">+</span></span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"The cycle estimates with CIs"</span>)</span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-572"><a href="#cb81-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-573"><a href="#cb81-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a>It looks like Lewis river fall has a 4 year cycle. </span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a>To see whether the model with cycle fits the model without cycles better, we will specify another MARSS model without the fourier covariates.</span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a>mod.list_wo_cycle <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">U =</span> <span class="st">"unequal"</span>,</span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">R =</span> <span class="st">"diagonal and equal"</span>,</span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"diagonal and unequal"</span></span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a>fit_wo_cycle <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(chin_subset, <span class="at">model=</span>mod.list_wo_cycle, <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-591"><a href="#cb81-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-592"><a href="#cb81-592" aria-hidden="true" tabindex="-1"></a>AIC for model without cycles is 257 and for model with cycles is 284. There is more support for model without cycles even though we this is Chinook data.</span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-600"><a href="#cb81-600" aria-hidden="true" tabindex="-1"></a>We esimated that 6 of the 11 populations showed a decline from historical abundance, with two populations demonstrating a <span class="sc">\&gt;</span>25% decline in log-abundance. However, other populations were estimated to be increasing, with the populations in the Upper Cowlitz river (both spring and fall) showing very large increases in abundance. However, we're not sure all of these results are reasonable, specially these levels of increase in the Upper Cowlitz river, and these results change with the different model formulations we tested. Though our best model had the lowest AICc, perhaps more models should be tested to confirm these results.</span>
<span id="cb81-601"><a href="#cb81-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a>Residuals for model 1 (hyp. 1) did not show an association with time; however, in the residuals for model 4 (best hyp. 2 model) some of the populations did still show an association with time. This further supports our selection of model 1 as our best model.</span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-604"><a href="#cb81-604" aria-hidden="true" tabindex="-1"></a>We found that the population abundances of fall and late fall Chinook were positively correlated, with additional structure according to geographic proximity. Spring run populations showed higher differentiation from each other. However, when fall populations were grouped the model AICc was not improved. There is likely environmental and/or biological association among the fall and late fall run populations but they should be considered separate populations in our models.</span>
<span id="cb81-605"><a href="#cb81-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a>When we evaluated the evidence for 4 and 5 year cycling in Chinook salmon in a subset of the rivers (Lewis fall, Lewis late fall, and Lower Cowlitz fall), we found that there was some support for a 4 year cycle in Lewis fall data. However, the AIC was much lower for a model without cycles. It is possible that another model with cycles is better. </span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-609"><a href="#cb81-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-610"><a href="#cb81-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a><span class="fu"># Description of each team member's contributions</span></span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a>All members contributed to developing the plan and methods for the analysis. ETS and ZR worked on the code for subsetting the data and fitting the models. ZR wrote the equations for the methods and worked on the results for the first question on historical abundance. ETS analyzed the results in terms of evidence for multiple populations. MK analyzed the evidence of cycling in the data. All team members contributed to the discussion and worked on the report together.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-2/Final_Write_ups/Lab-2-team-1_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-2/Final_Write_ups/Lab-2-team-1_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>