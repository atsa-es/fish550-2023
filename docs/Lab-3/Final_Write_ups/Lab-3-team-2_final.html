<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eric, Madison, Maria">
<meta name="dcterms.date" content="2023-04-20">

<title>Fish 550 Spring 2023 - 14&nbsp; Team 2 - Lab 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" rel="next">
<link href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-3/Lab-3-DFA.html">Dynamic Factor Analysis</a></li><li class="breadcrumb-item"><a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#plankton-selection" id="toc-plankton-selection" class="nav-link" data-scroll-target="#plankton-selection">Plankton Selection</a></li>
  <li><a href="#wrangle-the-data" id="toc-wrangle-the-data" class="nav-link" data-scroll-target="#wrangle-the-data">Wrangle the data</a></li>
  <li><a href="#initial-model-set-up" id="toc-initial-model-set-up" class="nav-link" data-scroll-target="#initial-model-set-up">Initial Model Set-up</a></li>
  </ul></li>
  <li><a href="#initial-results" id="toc-initial-results" class="nav-link" data-scroll-target="#initial-results">Initial Results</a>
  <ul class="collapse">
  <li><a href="#matrix-for-best-fit-model" id="toc-matrix-for-best-fit-model" class="nav-link" data-scroll-target="#matrix-for-best-fit-model">Matrix for best fit model</a></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics">Diagnostics</a>
  <ul class="collapse">
  <li><a href="#model-fits" id="toc-model-fits" class="nav-link" data-scroll-target="#model-fits">Model Fits</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#seasonal-model-exploration" id="toc-seasonal-model-exploration" class="nav-link" data-scroll-target="#seasonal-model-exploration">Seasonal Model Exploration</a>
  <ul class="collapse">
  <li><a href="#seasonal-model-set-up" id="toc-seasonal-model-set-up" class="nav-link" data-scroll-target="#seasonal-model-set-up">Seasonal Model Set-up</a></li>
  </ul></li>
  <li><a href="#seasonal-results" id="toc-seasonal-results" class="nav-link" data-scroll-target="#seasonal-results">Seasonal Results</a>
  <ul class="collapse">
  <li><a href="#matrix-for-best-seasonal-model" id="toc-matrix-for-best-seasonal-model" class="nav-link" data-scroll-target="#matrix-for-best-seasonal-model">Matrix for Best Seasonal Model</a></li>
  <li><a href="#plotting-the-seasonal-model" id="toc-plotting-the-seasonal-model" class="nav-link" data-scroll-target="#plotting-the-seasonal-model">Plotting the Seasonal Model</a>
  <ul class="collapse">
  <li><a href="#additional-diagnostic" id="toc-additional-diagnostic" class="nav-link" data-scroll-target="#additional-diagnostic">Additional Diagnostic</a></li>
  </ul></li>
  <li><a href="#model-fits-1" id="toc-model-fits-1" class="nav-link" data-scroll-target="#model-fits-1">Model Fits</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#team-contributions" id="toc-team-contributions" class="nav-link" data-scroll-target="#team-contributions">Team contributions</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-3/Final_Write_ups/Lab-3-team-2_final.Rmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-3/Final_Write_ups/Lab-3-team-2_final.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Dynamic Factor Analysis (DFA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eric, Madison, Maria </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<hr>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This lab focused on dynamic factor analysis, exploring plankton blooms in Lake Washington.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load MARSS for data and analyses</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ lubridate 1.9.2     ✔ tibble    3.2.1
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## load the raw data (there are 3 datasets contained here)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lakeWAplankton, <span class="at">package =</span> <span class="st">"MARSS"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## we want `lakeWAplanktonTrans`, which has been transformed</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## so the 0's are replaced with NA's and the data z-scored</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>all_dat <span class="ot">&lt;-</span> lakeWAplanktonTrans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="plankton-selection" class="level2">
<h2 class="anchored" data-anchor-id="plankton-selection">Plankton Selection</h2>
<p><strong>Which plankton taxa did you choose and how did you choose them?</strong></p>
<p>We selected two primary producers (Diatoms &amp; Other Algae), two grazers (Daphnia &amp; Cyclops), and one predator (Epischura). We wanted to consider potential interaction between species (primary producers, grazers, predators), and also select species that were data-rich for the majority of the time series.</p>
<ul>
<li><p><em>Diatoms</em> (Primary Producer) dominated in early spring time (Phytoplankton)</p></li>
<li><p><em>Other Algae</em> (Primary Producer) –&gt; Various algal species that grazers eat. Complete data set.</p></li>
<li><p><em>Daphnia</em> (Grazer) –&gt; Eat diatoms bloom after diatoms (zooplankton)</p></li>
<li><p><em>Cyclops</em> (Grazer) –&gt; Grazer taxa, eat phytoplankton</p></li>
<li><p><em>Epischura</em> (Predator) –&gt; Calanus Copepod, tend to peak after diatoms</p></li>
</ul>
<p><strong>What time period did you examine and why?</strong></p>
<p>We are choosing years 1978 to 1985 since Daphnia data is more consistent after 1978 and we are able to capture an interesting trend in Total Phosphorus.</p>
</section>
<section id="wrangle-the-data" class="level2">
<h2 class="anchored" data-anchor-id="wrangle-the-data">Wrangle the data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add some code here</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>yr_frst <span class="ot">&lt;-</span> <span class="dv">1978</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>yr_last <span class="ot">&lt;-</span> <span class="dv">1985</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>init_dat <span class="ot">&lt;-</span> all_dat[all_dat[, <span class="st">"Year"</span>] <span class="sc">&gt;=</span> yr_frst <span class="sc">&amp;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                      all_dat[, <span class="st">"Year"</span>] <span class="sc">&lt;=</span> yr_last,]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># put the 5 response variables in the yt matrix, can be replace whenever</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This represents multiple trophic levels</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary prod: Diatoms &amp; Other Algae</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Grazers: Daphnia &amp; Cyclops</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predators: Epischura</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plank_taxa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Other.algae"</span>,<span class="st">"Daphnia"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Epischura"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> init_dat[,plank_taxa] <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="do">## mean of each taxon</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">## subtract the means</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>plank_dat <span class="ot">&lt;-</span> dat <span class="sc">-</span> y_bar</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="do">## assign new column names</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(plank_dat)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(plank_dat) <span class="ot">&lt;-</span> spp</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># create a covariates matrix</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>covnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>,<span class="st">"pH"</span>) <span class="co">#pH has missing data points so it will only work in certain date ranges</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">&lt;-</span> init_dat[,covnames] <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plank_dat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  [,1]        [,2]       [,3]      [,4]       [,5]
Diatoms      0.1246322  0.30716558  0.3712350 1.4055328  0.2285722
Other.algae -1.3987376 -1.57104269 -0.6584466 0.7589764 -0.1346297
Daphnia     -0.9460105 -1.05132054 -0.3179194 0.7737740  1.0986668
Cyclops      0.3364779 -0.05110172  0.8265634 2.0655099  1.1347830
Epischura   -0.7829961 -0.82779368 -0.3518153 0.5790608 -0.9097123</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(covar[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]        [,3]      [,4]        [,5]
Temp -1.1553515 -1.2206156 -1.04048230 -0.555334 -0.03826858
TP   -0.3389558 -0.1338955  0.01745845 -0.584375 -0.51843108
pH   -0.7794830 -0.9036437  0.65305114  1.933781 -0.89501851</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">## initialize a counter</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plotting space &amp; make plots</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(plank_dat), <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">=</span> <span class="fu">ncol</span>(plank_dat)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> spp){</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(plank_dat[i,],  <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Abundance index"</span>, <span class="at">col=</span>clr[cnt], <span class="at">type=</span><span class="st">"b"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(i)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  cnt <span class="ot">&lt;-</span> cnt <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/plot_data-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## set plot colors</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>,<span class="st">"purple"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## initialize a counter</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plotting space &amp; make plots</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(covar), <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">row.names</span>(covar)){</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(covar[i,],  <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Value"</span>, <span class="at">col=</span>clr[cnt], <span class="at">type=</span><span class="st">"b"</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(i)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  cnt <span class="ot">&lt;-</span> cnt <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/plot_data-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="initial-model-set-up" class="level2">
<h2 class="anchored" data-anchor-id="initial-model-set-up">Initial Model Set-up</h2>
<p>We examined models that considered three underlying state options: two, three, and four states. We also tested three observation error matrices, diagonal and equal, diagonal and unequal, and equal variance and covariance. We originally were going to include unconstrained but omitted it due to convergence issues. We wanted to explore assumptions for observation error given our uncertainty surrounding collection and counting methods for the data set. Finally, we considered all combinations of three possible covariates, temperature (Temp), total phosphorus (TP), and pH.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model.states <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model.states) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"two_states"</span>,<span class="st">"three_states"</span>,<span class="st">"four_states"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Also testing different observation error matrices</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>R.models <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"diagonal and unequal"</span>,<span class="st">"equalvarcov"</span>, <span class="st">"diagonal and equal"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Also the covariates must be z-scored if the response variables are demeaned</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>d.models <span class="ot">&lt;-</span> <span class="fu">list</span>( </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># d1 = "zero", # No covariates</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">d2 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"Temp"</span>])), <span class="co"># Temperature</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">d3 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"TP"</span>])), <span class="co"># Total Phosphorus</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">d4 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"pH"</span>])), <span class="co"># ph</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">d5 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>)])),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">d6 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"TP"</span>, <span class="st">"pH"</span>)])),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">d7 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>, <span class="st">"pH"</span>)])),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">d8 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>, <span class="st">"pH"</span>)])) <span class="co"># Temperature and Total Phosphorus</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d.models) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp"</span>, <span class="st">"TP"</span>, <span class="st">"pH"</span>, <span class="st">"Temp and TP"</span>, <span class="st">"TP and pH"</span>, <span class="st">"Temp and pH"</span>, <span class="st">"Temp,TP, and pH"</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Define Model List </span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="st">"zero"</span>, <span class="co"># this is set to zero because the data has been demeaned</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"identity"</span>, <span class="co"># Q is set to the default value, this can also be "diagonal and equal" or "diagonal and unequal"</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">x0 =</span> <span class="st">"zero"</span> <span class="co"># x0 can be also be set to "unconstrained" or "unequal" it might be useful to try these later</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#DFA form for mars model Q--reduces option to streamline run time</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># all other params are left to their default settings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then set up for model runs for 63 model runs, looking at various combination of states, covariates (d) and observation error (R).</p>
<div class="cell" data-hash="Lab-3-team-2_final_cache/html/MARSS_models_bc6f087539f96be1fd622bb23893a025">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Added in another for loop to run through cycling options, be warned, this means there are 80 total models. It takes a long time to run</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>start.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>out.tab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> model.states){</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d.models)){</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(R.model <span class="cf">in</span> R.models){</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>i, <span class="at">R=</span>R.model), mod.list)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">#MARSS will throw an error if covariates are not a matrix, This will not pass the covariate arg if it does not exist</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      if(j==1) {</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      fit &lt;- MARSS(plank_dat, model=fit.model, </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                form = "dfa", z.score = FALSE, silent = TRUE,</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                control=list(maxit=2000, allow.degen=TRUE))</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      }</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      else {</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plank_dat, <span class="at">model=</span>fit.model, </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">800</span>, <span class="at">allow.degen =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">covariates =</span> d.models[[j]])</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      }</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">States=</span><span class="fu">names</span>(model.states)[i<span class="dv">-1</span>],<span class="at">d=</span><span class="fu">names</span>(d.models)[j],<span class="at">R=</span>R.model, <span class="co"># </span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      out.tab<span class="ot">=</span><span class="fu">rbind</span>(out.tab,out)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>      fits<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>end.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>elapsed.time <span class="ot">&lt;-</span> <span class="fu">round</span>((end.time <span class="sc">-</span> start.time), <span class="dv">3</span>)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(elapsed.time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 8.496 mins</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab<span class="sc">$</span>AICc)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> out.tab[min.AICc, ]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         States               d                    R    logLik      AICc
19   two_states Temp,TP, and pH diagonal and unequal -461.3723  984.6112
37 three_states     Temp and pH diagonal and unequal -465.6312  988.6075
40 three_states Temp,TP, and pH diagonal and unequal -460.1504  989.0255
61  four_states Temp,TP, and pH diagonal and unequal -460.0915  993.5313
58  four_states     Temp and pH diagonal and unequal -466.1926  994.2518
16   two_states     Temp and pH diagonal and unequal -472.1331  994.9035
31 three_states     Temp and TP diagonal and unequal -474.3998 1006.1448
22 three_states            Temp diagonal and unequal -481.1397 1008.4938
10   two_states     Temp and TP diagonal and unequal -479.6465 1009.9303
1    two_states            Temp diagonal and unequal -485.3761 1010.4043
52  four_states     Temp and TP diagonal and unequal -474.7942 1011.4550
43  four_states            Temp diagonal and unequal -482.4445 1015.5264
20   two_states Temp,TP, and pH          equalvarcov -482.1252 1019.3497
21   two_states Temp,TP, and pH   diagonal and equal -483.8513 1020.5659
17   two_states     Temp and pH          equalvarcov -490.0328 1024.0831
18   two_states     Temp and pH   diagonal and equal -491.6144 1025.0589
41 three_states Temp,TP, and pH          equalvarcov -482.1362 1026.1390
42 three_states Temp,TP, and pH   diagonal and equal -483.8520 1027.3048
38 three_states     Temp and pH          equalvarcov -489.2019 1029.0411
39 three_states     Temp and pH   diagonal and equal -491.6753 1031.7717
59  four_states     Temp and pH          equalvarcov -489.2028 1033.5049
12   two_states     Temp and TP   diagonal and equal -498.8663 1039.5627
34 three_states       TP and pH diagonal and unequal -491.2575 1039.8601
11   two_states     Temp and TP          equalvarcov -498.5663 1041.1501
33 three_states     Temp and TP   diagonal and equal -499.0256 1046.4723
28 three_states              pH diagonal and unequal -500.6607 1047.5358
3    two_states            Temp   diagonal and equal -508.4297 1047.8940
32 three_states     Temp and TP          equalvarcov -498.6549 1047.9473
2    two_states            Temp          equalvarcov -507.6000 1048.3749
60  four_states     Temp and pH   diagonal and equal -497.8517 1048.5668
63  four_states Temp,TP, and pH   diagonal and equal -492.2152 1048.5728
55  four_states       TP and pH diagonal and unequal -493.7216 1049.3098
62  four_states Temp,TP, and pH          equalvarcov -491.8611 1050.1507
23 three_states            Temp          equalvarcov -507.4046 1054.4613
24 three_states            Temp   diagonal and equal -508.5171 1054.5180
49  four_states              pH diagonal and unequal -502.8687 1056.3748
25 three_states              TP diagonal and unequal -506.7778 1059.7701
44  four_states            Temp          equalvarcov -508.3806 1060.7787
54  four_states     Temp and TP   diagonal and equal -506.1435 1065.1504
53  four_states     Temp and TP          equalvarcov -506.1030 1067.3054
46  four_states              TP diagonal and unequal -509.9086 1070.4546
45  four_states            Temp   diagonal and equal -514.7653 1071.3606
13   two_states       TP and pH diagonal and unequal -511.5294 1073.6961
7    two_states              pH diagonal and unequal -520.8304 1081.3129
4    two_states              TP diagonal and unequal -521.7079 1083.0680
35 three_states       TP and pH          equalvarcov -518.5049 1087.6471
36 three_states       TP and pH   diagonal and equal -520.2389 1088.8988
29 three_states              pH          equalvarcov -527.1656 1093.9834
30 three_states              pH   diagonal and equal -529.8045 1097.0927
56  four_states       TP and pH          equalvarcov -521.4913 1098.0819
57  four_states       TP and pH   diagonal and equal -522.7912 1098.4457
14   two_states       TP and pH          equalvarcov -529.8739 1103.7652
50  four_states              pH          equalvarcov -531.0839 1106.1852
51  four_states              pH   diagonal and equal -532.8581 1107.5463
27 three_states              TP   diagonal and equal -535.1172 1107.7182
15   two_states       TP and pH   diagonal and equal -533.4082 1108.6465
26 three_states              TP          equalvarcov -535.0348 1109.7218
48  four_states              TP   diagonal and equal -537.2049 1116.2399
47  four_states              TP          equalvarcov -536.8928 1117.8030
5    two_states              TP          equalvarcov -546.5152 1126.2053
6    two_states              TP   diagonal and equal -547.7638 1126.5620
8    two_states              pH          equalvarcov -548.6089 1130.3926
9    two_states              pH   diagonal and equal -555.0446 1141.1237
   num.param num.iter converged
19        29      353      TRUE
37        27      800     FALSE
40        32      800     FALSE
61        34      425      TRUE
58        29      800     FALSE
16        24      800     FALSE
31        27      313      TRUE
22        22      800     FALSE
10        24      110      TRUE
1         19      800     FALSE
52        29      800     FALSE
43        24      800     FALSE
20        26      694      TRUE
21        25       77      TRUE
17        21      613      TRUE
18        20       56      TRUE
41        29      582      TRUE
42        28      117      TRUE
38        24      800     FALSE
39        23      106      TRUE
59        26      800     FALSE
12        20       72      TRUE
34        27      800     FALSE
11        21      455      TRUE
33        23      102      TRUE
28        22      800     FALSE
3         15       62      TRUE
32        24      557      TRUE
2         16      559      TRUE
60        25       81      TRUE
63        30       84      TRUE
55        29      800     FALSE
62        31      800     FALSE
23        19      800     FALSE
24        18       91      TRUE
49        24      800     FALSE
25        22      800     FALSE
44        21      800     FALSE
54        25       86      TRUE
53        26      800     FALSE
46        24      800     FALSE
45        20       83      TRUE
13        24      800     FALSE
7         19      800     FALSE
4         19      800     FALSE
35        24      530      TRUE
36        23       75      TRUE
29        19      800     FALSE
30        18       78      TRUE
56        26      673      TRUE
57        25       87      TRUE
14        21      434      TRUE
50        21      452      TRUE
51        20      800     FALSE
27        18       68      TRUE
15        20       48      TRUE
26        19      418      TRUE
48        20       93      TRUE
47        21      428      TRUE
5         16      559      TRUE
6         15       52      TRUE
8         16      800     FALSE
9         15       58      TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="initial-results" class="level1">
<h1>Initial Results</h1>
<p>The time for all models to fit was approximately 40 min, and the model that has the least AICc is the model with two states, diagonal and unequal errors and all 3 covariates. Many of the models did not converge, which could have been due to data being inconsistent with our model assumptions, insufficient data (we selected a data rich time period, so I’m not sure about this one), or not enough number of iterations for fitting. (MARSS Manual, Chapter 10).</p>
<section id="matrix-for-best-fit-model" class="level3">
<h3 class="anchored" data-anchor-id="matrix-for-best-fit-model">Matrix for best fit model</h3>
<p>What forms of models did you fit (ie, write them out in matrix form)?</p>
<p><span class="math display">\[
\begin{bmatrix}
y_1\\
y_2\\
y_3\\
y_4\\
y_5\\
\end{bmatrix}_t
=
\begin{bmatrix}
z_{1,1} &amp; z_{1,2}\\
z_{2,1} &amp; z_{2,2}\\
z_{3,1} &amp; z_{3,2}\\
z_{4,1} &amp; z_{4,2}\\
z_{5,1} &amp; z_{5,2}\\
\end{bmatrix}
*
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_t
+
\begin{bmatrix}
d_{1,1} &amp; d_{1,2} &amp; d_{1,3}\\
d_{2,1} &amp; d_{2,2} &amp; d_{2,3}\\
d_{3,1} &amp; d_{3,2} &amp; d_{3,3}\\
d_{4,1} &amp; d_{4,2} &amp; d_{4,3}\\
d_{5,1} &amp; d_{5,2} &amp; d_{5,3}\\
\end{bmatrix}
*
\begin{bmatrix}
Temp \\
TP \\
pH\\
\end{bmatrix}_t
+
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5
\end{bmatrix}_t
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_t
=
\begin{bmatrix}
1 &amp; 0\\
0 &amp; 1\\
\end{bmatrix}
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_{t-1}
+
\begin{bmatrix}
w_1\\
w_2\\
\end{bmatrix}_t
\]</span></p>
<p>Process Error</p>
<p><span class="math display">\[
\begin{bmatrix}
w_1\\
w_2\\
\end{bmatrix}
\sim MVN
\begin{pmatrix}
\begin{bmatrix}
0\\
0\\
\end{bmatrix},
\begin{bmatrix}
1 &amp; 0\\
0 &amp; 1\\
\end{bmatrix}
\end{pmatrix}
\]</span></p>
<p>Observation Error</p>
<p><span class="math display">\[
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5\\
\end{bmatrix}
\sim MVN
\begin{pmatrix}
\begin{bmatrix}
0\\
0\\
0\\
0\\
0\\
\end{bmatrix},
\begin{bmatrix}
r_1 &amp; 0&amp; 0&amp; 0&amp; 0\\
0 &amp; r_2&amp; 0&amp; 0&amp; 0\\
0 &amp; 0&amp; r_3&amp; 0&amp; 0\\
0 &amp; 0&amp; 0&amp; r_4&amp; 0\\
0 &amp; 0&amp; 0&amp; 0&amp; r_5\\
\end{bmatrix}
\end{pmatrix}
\]</span></p>
</section>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics">Diagnostics</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotating the model, plotting the states and loadings</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>best_fit <span class="ot">&lt;-</span> fits[[<span class="dv">19</span>]]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Z Estimations and rotate the data</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>Z_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(best_fit, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est)<span class="sc">$</span>rotmat</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate factor loadings</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>Z_rot <span class="ot">=</span> Z_est <span class="sc">%*%</span> H_inv   </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>proc_rot <span class="ot">=</span> <span class="fu">solve</span>(H_inv) <span class="sc">%*%</span> best_fit<span class="sc">$</span>states</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plank_dat)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">ncol</span>(Z_est)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="do">## plot labels</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(mm)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plot area</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, m, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the processes</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot[i,]))</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts,proc_rot[i,], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> ylm, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>,i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot))</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>N_ts)[<span class="fu">abs</span>(Z_rot[,i])<span class="sc">&gt;</span>minZ],</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">as.vector</span>(Z_rot[<span class="fu">abs</span>(Z_rot[,i])<span class="sc">&gt;</span>minZ,i]),</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"h"</span>,</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm,</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, N_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot[j,i] <span class="sc">&gt;</span> minZ) {<span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot[j,i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {<span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/factor_loadings-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot CCF's</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(proc_rot[<span class="dv">1</span>,],proc_rot[<span class="dv">2</span>,], <span class="at">lag.max =</span> <span class="dv">15</span>, <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"State 1 vs 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/factor_loadings-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This model seems to explain primary producer and grazer dynamics best in state 1, and predator dynamics best in state two. Epischura has a strong negative trend in state two, compared to other species which are all postive in both states 1 and 2.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(best_fit) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.model.resids.ytT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-12.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-13.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-14.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-15.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = acf.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Continued Diagnostics-16.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>The diagnostic plots show relatively good fits for three of the species, but “other algae” and diatoms aren’t being captured as the model is missing the full range of data. There may be some structure to the residuals for diatoms and maybe cyclops with few outliers, but all species and states show normality in the QQ plots.</p>
<section id="model-fits" class="level3">
<h3 class="anchored" data-anchor-id="model-fits">Model Fits</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>get_DFA_fits <span class="ot">&lt;-</span> <span class="cf">function</span>(MLEobj, <span class="at">dd =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## empty list for results</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="do">## extra stuff for var() calcs</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    Ey <span class="ot">&lt;-</span> MARSS<span class="sc">:::</span><span class="fu">MARSShatyt</span>(MLEobj)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model params</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## number of obs ts</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    nn <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">1</span>]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## number of time steps</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">2</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(ZZ)<span class="sc">$</span>rotmat</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## check for covars</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dd)) {</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        DD <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        <span class="do">## model expectation</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states <span class="sc">+</span> DD <span class="sc">%*%</span> dd</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="do">## model expectation</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>        fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Var in model fits</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    VtT <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(MLEobj)<span class="sc">$</span>VtT</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    VV <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (tt <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>        RZVZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>R <span class="sc">-</span> ZZ <span class="sc">%*%</span> VtT[, </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>            , tt] <span class="sc">%*%</span> <span class="fu">t</span>(ZZ)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>        SS <span class="ot">&lt;-</span> Ey<span class="sc">$</span>yxtT[, , tt] <span class="sc">-</span> Ey<span class="sc">$</span>ytT[, tt, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> </span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">t</span>(MLEobj<span class="sc">$</span>states[, tt, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>        VV <span class="ot">&lt;-</span> <span class="fu">cbind</span>(VV, <span class="fu">diag</span>(RZVZ <span class="sc">+</span> SS <span class="sc">%*%</span> <span class="fu">t</span>(ZZ) <span class="sc">+</span> ZZ <span class="sc">%*%</span> <span class="fu">t</span>(SS)))</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(VV)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">## upper &amp; lower (1-alpha)% CI</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fits)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">1</span>]</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="do">## get model fits &amp; CI's</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>mod_fit <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(best_fit)</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the fits</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(N_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    up <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>up[i, ]</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    mn <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>ex[i, ]</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    lo <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>lo[i, ]</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(w_ts, plank_dat[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These fits seem to be missing a lot of the interannual peaks and valleys for daphnia and the confidence intervals for cyclops and epischura are very tight and missing data. We may be able to find a better fitting model with seasonal considerations.</p>
</section>
</section>
</section>
<section id="seasonal-model-exploration" class="level1">
<h1>Seasonal Model Exploration</h1>
<p><strong>Describe the effects of environmental or dummy variables on (possibly seasonal) patterns in the data.</strong></p>
<section id="seasonal-model-set-up" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-model-set-up">Seasonal Model Set-up</h2>
<p>We decided to look at three seasonal patterns, an annual pattern (12 months), a six month pattern, and a 3 month pattern (Winter, Spring, Summer, Fall).</p>
<div class="cell" data-hash="Lab-3-team-2_final_cache/html/Seasonal exploration_affbed691d4b5baa0643270ee8ea456d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>fits_season <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>out.tab.season <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>model.states <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model.states) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"two_states"</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>R.models <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"diagonal and unequal"</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 month period </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  c.Four_12 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.12</span>, sin<span class="fl">.12</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 month period </span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">6</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">6</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  c.Four_6 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.6</span>, sin<span class="fl">.6</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 month period </span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  c.Four_3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.3</span>, sin<span class="fl">.3</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  d10 <span class="ot">=</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>, <span class="st">"pH"</span>)]))</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  d12 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_12, d10)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  d6 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_6, d10)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  d3 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_3, d10)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>  d.models <span class="ot">&lt;-</span> <span class="fu">list</span>(d10, d12, d6, d3)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(d.models) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp,TP, and pH"</span>, <span class="st">"12 month"</span>, <span class="st">"6 month"</span>, <span class="st">"3 month"</span>)</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  mod.list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> <span class="st">"zero"</span>,</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q =</span> <span class="st">"identity"</span>,</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">x0 =</span> <span class="st">"zero"</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  start.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d.models)){</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(R.model <span class="cf">in</span> R.models){</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>i, <span class="at">R=</span>R.model), mod.list)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>        fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plank_dat, <span class="at">model=</span>fit.model, </span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">800</span>, <span class="at">allow.degen=</span><span class="cn">TRUE</span>), </span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">covariates =</span> d.models[[j]])</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">States=</span><span class="fu">names</span>(model.states)[i<span class="dv">-1</span>],<span class="at">d=</span><span class="fu">names</span>(d.models)[j],<span class="at">R=</span>R.model, <span class="co"># </span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>        out.tab.season<span class="ot">=</span><span class="fu">rbind</span>(out.tab.season,out)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>        fits_season<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  end.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  elapsed.time <span class="ot">&lt;-</span> <span class="fu">round</span>((end.time <span class="sc">-</span> start.time), <span class="dv">3</span>)</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Elapsed time for period:"</span>, elapsed.time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Elapsed time for period: 1.019"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab.season<span class="sc">$</span>AICc)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.2</span> <span class="ot">&lt;-</span> out.tab.season[min.AICc, ]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  States               d                    R    logLik      AICc num.param
3   &lt;NA&gt;         6 month diagonal and unequal -419.3891  938.3174        45
2   &lt;NA&gt;        12 month diagonal and unequal -447.2196  993.9783        45
1   &lt;NA&gt; Temp,TP, and pH diagonal and unequal -460.1765  996.0288        35
4   &lt;NA&gt;         3 month diagonal and unequal -459.1695 1017.8782        45
  num.iter converged
3      406      TRUE
2      800     FALSE
1      800     FALSE
4      800     FALSE</code></pre>
</div>
</div>
</section>
</section>
<section id="seasonal-results" class="level1">
<h1>Seasonal Results</h1>
<p>When comparing our previous best model,a two state model with diagonal and unequal observation error with covariates temperature, total phosphorous, and pH, to a model with the same assumptions but adding in seasonal considerations, both 12 month periods and 6 month periods performed better than the non-seasonal model. The model with the 6 month period performed the best by a significant margin. We explore the diagnostics and model fits below.</p>
<section id="matrix-for-best-seasonal-model" class="level2">
<h2 class="anchored" data-anchor-id="matrix-for-best-seasonal-model">Matrix for Best Seasonal Model</h2>
<p><span class="math display">\[
\begin{bmatrix}
y_1\\
y_2\\
y_3\\
y_4\\
y_5\\
\end{bmatrix}_t
=
\begin{bmatrix}
z_{1,1} &amp; z_{1,2}\\
z_{2,1} &amp; z_{2,2}\\
z_{3,1} &amp; z_{3,2}\\
z_{4,1} &amp; z_{4,2}\\
z_{5,1} &amp; z_{5,2}\\
\end{bmatrix}
*
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_t
+
\begin{bmatrix}
d_{1,1} &amp; d_{1,2} &amp; d_{1,3} &amp; d_{1,4} &amp; d_{1,5}\\
d_{2,1} &amp; d_{2,2} &amp; d_{2,3} &amp; d_{2,4} &amp; d_{2,5}\\
d_{3,1} &amp; d_{3,2} &amp; d_{3,3} &amp; d_{3,4} &amp; d_{3,5}\\
d_{4,1} &amp; d_{4,2} &amp; d_{4,3} &amp; d_{4,4} &amp; d_{4,5}\\
d_{5,1} &amp; d_{5,2} &amp; d_{5,3} &amp; d_{5,4} &amp; d_{5,5}\\
\end{bmatrix}
*
\begin{bmatrix}
Temp \\
TP \\
pH\\
cos(2pi*TT/6)\\
sin(2pi*TT/6\\
\end{bmatrix}_t
+
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5
\end{bmatrix}_t
\]</span> <span class="math display">\[
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_t
=
\begin{bmatrix}
1 &amp; 0\\
0 &amp; 1\\
\end{bmatrix}
\begin{bmatrix}
x_1\\
x_2\\
\end{bmatrix}_{t-1}
+
\begin{bmatrix}
w_1\\
w_2\\
\end{bmatrix}_t
\]</span></p>
<p>Process Error</p>
<p><span class="math display">\[
\begin{bmatrix}
w_1\\
w_2\\
\end{bmatrix}
\sim MVN
\begin{pmatrix}
\begin{bmatrix}
0\\
0\\
\end{bmatrix},
\begin{bmatrix}
1 &amp; 0\\
0 &amp; 1\\
\end{bmatrix}
\end{pmatrix}
\]</span></p>
<p>Observation Error</p>
<p><span class="math display">\[
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5\\
\end{bmatrix}
\sim MVN
\begin{pmatrix}
\begin{bmatrix}
0\\
0\\
0\\
0\\
0\\
\end{bmatrix},
\begin{bmatrix}
r_1 &amp; 0&amp; 0&amp; 0&amp; 0\\
0 &amp; r_2&amp; 0&amp; 0&amp; 0\\
0 &amp; 0&amp; r_3&amp; 0&amp; 0\\
0 &amp; 0&amp; 0&amp; r_4&amp; 0\\
0 &amp; 0&amp; 0&amp; 0&amp; r_5\\
\end{bmatrix}
\end{pmatrix}
\]</span></p>
</section>
<section id="plotting-the-seasonal-model" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-seasonal-model">Plotting the Seasonal Model</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotating the model, plotting the states and loadings</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>best_fit_s <span class="ot">&lt;-</span> fits_season[[<span class="dv">3</span>]]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Z Estimations and rotate the data</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>Z_est_s <span class="ot">&lt;-</span> <span class="fu">coef</span>(best_fit_s, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>H_inv_s <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est_s)<span class="sc">$</span>rotmat</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate factor loadings</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>Z_rot_s <span class="ot">=</span> Z_est_s <span class="sc">%*%</span> H_inv_s   </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>proc_rot_s <span class="ot">=</span> <span class="fu">solve</span>(H_inv_s) <span class="sc">%*%</span> best_fit_s<span class="sc">$</span>states</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plank_dat)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">ncol</span>(Z_est)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="do">## plot labels</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(mm)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plot area</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, m, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the processes</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot_s[i,]))</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts,proc_rot_s[i,], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> ylm, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot_s[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot_s[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>,i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot_s))</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>N_ts)[<span class="fu">abs</span>(Z_rot_s[,i])<span class="sc">&gt;</span>minZ],</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">as.vector</span>(Z_rot_s[<span class="fu">abs</span>(Z_rot_s[,i])<span class="sc">&gt;</span>minZ,i]),</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"h"</span>,</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm,</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, N_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot_s[j,i] <span class="sc">&gt;</span> minZ) {<span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot_s[j,i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {<span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state with seasonality"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/factor_loadings including seasonality-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot CCF's</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(proc_rot_s[<span class="dv">1</span>,],proc_rot_s[<span class="dv">2</span>,], <span class="at">lag.max =</span> <span class="dv">15</span>, <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"State 1 vs 2 with seasonality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/factor_loadings including seasonality-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The factor loading seen in the model that is including seasonality seems to explain the dynamics of the speices better than the model that did not include seasonality, however, the sign of factor loading for Epishura, our predator species, changed to become positive in the seasonal model.</p>
<p>Factor loadings: * Pattern for primary producers and grazers is better explained by state one * Pattern for predator species is better explained by state two</p>
<p>CCF plot indicates that there is still some seasonal mechanism occurring that our model is not capturing.</p>
<section id="additional-diagnostic" class="level3">
<h3 class="anchored" data-anchor-id="additional-diagnostic">Additional Diagnostic</h3>
<div class="cell" data-hash="Lab-3-team-2_final_cache/html/Seasonal Diagnostics_9bb4e8c1dbb7ec22c90e420bf9aea662">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(best_fit_s)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = fitted.ytT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.model.resids.ytT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-10.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-11.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-12.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-13.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = qqplot.std.state.resids.xtT </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-14.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Hit &lt;Return&gt; to see next plot (q to exit): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-15.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot.type = acf.std.model.resids.ytt1 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/Seasonal Diagnostics-16.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Finished plots.</code></pre>
</div>
</div>
<p>This model is fitting the species better overall compared to the non-seaosnal model. Residuals and assumptions of normality look good overall. Daphnia still show some seasonal pattern not being captured in this model in the Cholesky residuals.</p>
</section>
</section>
<section id="model-fits-1" class="level2">
<h2 class="anchored" data-anchor-id="model-fits-1">Model Fits</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">1</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get model fits &amp; CI's</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>mod_fit_s <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(best_fit_s)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the fits</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(N_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    up <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>up[i, ]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    mn <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>ex[i, ]</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    lo <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>lo[i, ]</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(w_ts, plank_dat[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-2_final_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Still not fitting other algae and daphina particularly well, but the model is trying to follow the trends and most of the data are captured within the confidence intervals. The confidence intervals are larger for cyclops and epishura compared to the non-seasonal model and more of the data are being captured.</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>In this exercise our goal was to capturing the dynamics of predator and prey species in Lake Washington in the late 70’s and early 80’s.</p>
<p>Seasonal model (six month period) fit better and the factor loading results showed more of a deviance between state one and state two for primary producers and grazers, and predators.</p>
<p>All three environmental covariates were included in the best fit model, showing that they are explaning levels of variability for the selected species in the selected time period.</p>
<p>Epishura seem to have an offset from the other species. We’re fitting two independent states to five species, and while one state captured the dynamics of grazers and primary producers relatively well, epishura was not captured at all in this state, indicating independence between these two groups of plankton in the time period analyzed.</p>
<p>All three environmental covariates were included in the best fit model, showing that they are explaning levels of variability for the selected species in the selected time period.</p>
</section>
<section id="team-contributions" class="level1">
<h1>Team contributions</h1>
<p>Madi set up plotting code for the entire time series for all species to select species of interest in data rich periods.</p>
<p>Eric wrote the majority of the model set up code and created functions used for plotting.</p>
<p>Maria took the code that Eric wrote, optimized it for our covariate process, and helped with convergence issues, and set up the initial model that included seasonal considerations.</p>
<p>Madi took the Maria’s code and edited to include seasonal considerations for three periods, added commentary for diagnostics, and set-up the Rmarkdown structure and coded the model matrices.</p>
<p>All team members helped with defining the matrices for the selected models, interpretation of results, and writing of the report.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb63" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Team 2 - Lab 3"</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Dynamic Factor Analysis (DFA)"</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Eric, Madison, Maria"</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> April 20, 2023</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 72</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>This lab focused on dynamic factor analysis, exploring plankton blooms</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>in Lake Washington.</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data}</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a><span class="do">## load MARSS for data and analyses</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="do">## load the raw data (there are 3 datasets contained here)</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lakeWAplankton, <span class="at">package =</span> <span class="st">"MARSS"</span>)</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a><span class="do">## we want `lakeWAplanktonTrans`, which has been transformed</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a><span class="do">## so the 0's are replaced with NA's and the data z-scored</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>all_dat <span class="ot">&lt;-</span> lakeWAplanktonTrans</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plankton Selection</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>**Which plankton taxa did you choose and how did you choose them?**</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>We selected two primary producers (Diatoms &amp; Other Algae), two grazers</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>(Daphnia &amp; Cyclops), and one predator (Epischura). We wanted to consider</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>potential interaction between species (primary producers, grazers,</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>predators), and also select species that were data-rich for the majority</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>of the time series.</span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Diatoms* (Primary Producer) dominated in early spring time</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>    (Phytoplankton)</span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Other Algae* (Primary Producer) --<span class="sc">\&gt;</span> Various algal species that</span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a>    grazers eat. Complete data set.</span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Daphnia* (Grazer) --<span class="sc">\&gt;</span> Eat diatoms bloom after diatoms</span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a>    (zooplankton)</span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Cyclops* (Grazer) --<span class="sc">\&gt;</span> Grazer taxa, eat phytoplankton</span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Epischura* (Predator) --<span class="sc">\&gt;</span> Calanus Copepod, tend to peak after</span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a>    diatoms</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>**What time period did you examine and why?**</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a>We are choosing years 1978 to 1985 since Daphnia data is more consistent</span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a>after 1978 and we are able to capture an interesting trend in Total</span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a>Phosphorus.</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wrangle the data</span></span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wrangle_data}</span></span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a><span class="do">## add some code here</span></span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a>yr_frst <span class="ot">&lt;-</span> <span class="dv">1978</span></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a>yr_last <span class="ot">&lt;-</span> <span class="dv">1985</span></span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a>init_dat <span class="ot">&lt;-</span> all_dat[all_dat[, <span class="st">"Year"</span>] <span class="sc">&gt;=</span> yr_frst <span class="sc">&amp;</span> </span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a>                      all_dat[, <span class="st">"Year"</span>] <span class="sc">&lt;=</span> yr_last,]</span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a><span class="co"># put the 5 response variables in the yt matrix, can be replace whenever</span></span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a><span class="co"># This represents multiple trophic levels</span></span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Primary prod: Diatoms &amp; Other Algae</span></span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Grazers: Daphnia &amp; Cyclops</span></span>
<span id="cb63-94"><a href="#cb63-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Predators: Epischura</span></span>
<span id="cb63-95"><a href="#cb63-95" aria-hidden="true" tabindex="-1"></a>plank_taxa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Other.algae"</span>,<span class="st">"Daphnia"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Epischura"</span>)</span>
<span id="cb63-96"><a href="#cb63-96" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> init_dat[,plank_taxa] <span class="sc">%&gt;%</span></span>
<span id="cb63-97"><a href="#cb63-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb63-98"><a href="#cb63-98" aria-hidden="true" tabindex="-1"></a><span class="do">## mean of each taxon</span></span>
<span id="cb63-99"><a href="#cb63-99" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-100"><a href="#cb63-100" aria-hidden="true" tabindex="-1"></a><span class="do">## subtract the means</span></span>
<span id="cb63-101"><a href="#cb63-101" aria-hidden="true" tabindex="-1"></a>plank_dat <span class="ot">&lt;-</span> dat <span class="sc">-</span> y_bar</span>
<span id="cb63-102"><a href="#cb63-102" aria-hidden="true" tabindex="-1"></a><span class="do">## assign new column names</span></span>
<span id="cb63-103"><a href="#cb63-103" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">rownames</span>(plank_dat)</span>
<span id="cb63-104"><a href="#cb63-104" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(plank_dat) <span class="ot">&lt;-</span> spp</span>
<span id="cb63-105"><a href="#cb63-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-106"><a href="#cb63-106" aria-hidden="true" tabindex="-1"></a><span class="co"># create a covariates matrix</span></span>
<span id="cb63-107"><a href="#cb63-107" aria-hidden="true" tabindex="-1"></a>covnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>,<span class="st">"pH"</span>) <span class="co">#pH has missing data points so it will only work in certain date ranges</span></span>
<span id="cb63-108"><a href="#cb63-108" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">&lt;-</span> init_dat[,covnames] <span class="sc">%&gt;%</span></span>
<span id="cb63-109"><a href="#cb63-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb63-110"><a href="#cb63-110" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plank_dat[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb63-111"><a href="#cb63-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-112"><a href="#cb63-112" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(covar[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb63-113"><a href="#cb63-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-114"><a href="#cb63-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-115"><a href="#cb63-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-116"><a href="#cb63-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-117"><a href="#cb63-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot_data}</span></span>
<span id="cb63-118"><a href="#cb63-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-119"><a href="#cb63-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-120"><a href="#cb63-120" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb63-121"><a href="#cb63-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-122"><a href="#cb63-122" aria-hidden="true" tabindex="-1"></a><span class="do">## initialize a counter</span></span>
<span id="cb63-123"><a href="#cb63-123" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb63-124"><a href="#cb63-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-125"><a href="#cb63-125" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plotting space &amp; make plots</span></span>
<span id="cb63-126"><a href="#cb63-126" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(plank_dat), <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-127"><a href="#cb63-127" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">=</span> <span class="fu">ncol</span>(plank_dat)</span>
<span id="cb63-128"><a href="#cb63-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-129"><a href="#cb63-129" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> spp){</span>
<span id="cb63-130"><a href="#cb63-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(plank_dat[i,],  <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb63-131"><a href="#cb63-131" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb63-132"><a href="#cb63-132" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Abundance index"</span>, <span class="at">col=</span>clr[cnt], <span class="at">type=</span><span class="st">"b"</span>)</span>
<span id="cb63-133"><a href="#cb63-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb63-134"><a href="#cb63-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(i)</span>
<span id="cb63-135"><a href="#cb63-135" aria-hidden="true" tabindex="-1"></a>  cnt <span class="ot">&lt;-</span> cnt <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb63-136"><a href="#cb63-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-137"><a href="#cb63-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-138"><a href="#cb63-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-139"><a href="#cb63-139" aria-hidden="true" tabindex="-1"></a><span class="do">## set plot colors</span></span>
<span id="cb63-140"><a href="#cb63-140" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>,<span class="st">"purple"</span>)</span>
<span id="cb63-141"><a href="#cb63-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-142"><a href="#cb63-142" aria-hidden="true" tabindex="-1"></a><span class="do">## initialize a counter</span></span>
<span id="cb63-143"><a href="#cb63-143" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb63-144"><a href="#cb63-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-145"><a href="#cb63-145" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plotting space &amp; make plots</span></span>
<span id="cb63-146"><a href="#cb63-146" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(covar), <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-147"><a href="#cb63-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-148"><a href="#cb63-148" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">row.names</span>(covar)){</span>
<span id="cb63-149"><a href="#cb63-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(covar[i,],  <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb63-150"><a href="#cb63-150" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb63-151"><a href="#cb63-151" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Value"</span>, <span class="at">col=</span>clr[cnt], <span class="at">type=</span><span class="st">"b"</span>)</span>
<span id="cb63-152"><a href="#cb63-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb63-153"><a href="#cb63-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(i)</span>
<span id="cb63-154"><a href="#cb63-154" aria-hidden="true" tabindex="-1"></a>  cnt <span class="ot">&lt;-</span> cnt <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb63-155"><a href="#cb63-155" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-156"><a href="#cb63-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-157"><a href="#cb63-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-158"><a href="#cb63-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-159"><a href="#cb63-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-160"><a href="#cb63-160" aria-hidden="true" tabindex="-1"></a><span class="fu">## Initial Model Set-up</span></span>
<span id="cb63-161"><a href="#cb63-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-162"><a href="#cb63-162" aria-hidden="true" tabindex="-1"></a>We examined models that considered three underlying state options: two,</span>
<span id="cb63-163"><a href="#cb63-163" aria-hidden="true" tabindex="-1"></a>three, and four states. We also tested three observation error matrices,</span>
<span id="cb63-164"><a href="#cb63-164" aria-hidden="true" tabindex="-1"></a>diagonal and equal, diagonal and unequal, and equal variance and</span>
<span id="cb63-165"><a href="#cb63-165" aria-hidden="true" tabindex="-1"></a>covariance. We originally were going to include unconstrained but</span>
<span id="cb63-166"><a href="#cb63-166" aria-hidden="true" tabindex="-1"></a>omitted it due to convergence issues. We wanted to explore assumptions</span>
<span id="cb63-167"><a href="#cb63-167" aria-hidden="true" tabindex="-1"></a>for observation error given our uncertainty surrounding collection and</span>
<span id="cb63-168"><a href="#cb63-168" aria-hidden="true" tabindex="-1"></a>counting methods for the data set. Finally, we considered all</span>
<span id="cb63-169"><a href="#cb63-169" aria-hidden="true" tabindex="-1"></a>combinations of three possible covariates, temperature (Temp), total</span>
<span id="cb63-170"><a href="#cb63-170" aria-hidden="true" tabindex="-1"></a>phosphorus (TP), and pH.</span>
<span id="cb63-171"><a href="#cb63-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-172"><a href="#cb63-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_params}</span></span>
<span id="cb63-173"><a href="#cb63-173" aria-hidden="true" tabindex="-1"></a>model.states <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb63-174"><a href="#cb63-174" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model.states) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"two_states"</span>,<span class="st">"three_states"</span>,<span class="st">"four_states"</span>)</span>
<span id="cb63-175"><a href="#cb63-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-176"><a href="#cb63-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Also testing different observation error matrices</span></span>
<span id="cb63-177"><a href="#cb63-177" aria-hidden="true" tabindex="-1"></a>R.models <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"diagonal and unequal"</span>,<span class="st">"equalvarcov"</span>, <span class="st">"diagonal and equal"</span>)</span>
<span id="cb63-178"><a href="#cb63-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-179"><a href="#cb63-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Also the covariates must be z-scored if the response variables are demeaned</span></span>
<span id="cb63-180"><a href="#cb63-180" aria-hidden="true" tabindex="-1"></a>d.models <span class="ot">&lt;-</span> <span class="fu">list</span>( </span>
<span id="cb63-181"><a href="#cb63-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># d1 = "zero", # No covariates</span></span>
<span id="cb63-182"><a href="#cb63-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">d2 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"Temp"</span>])), <span class="co"># Temperature</span></span>
<span id="cb63-183"><a href="#cb63-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">d3 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"TP"</span>])), <span class="co"># Total Phosphorus</span></span>
<span id="cb63-184"><a href="#cb63-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">d4 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="st">"pH"</span>])), <span class="co"># ph</span></span>
<span id="cb63-185"><a href="#cb63-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">d5 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>)])),</span>
<span id="cb63-186"><a href="#cb63-186" aria-hidden="true" tabindex="-1"></a>  <span class="at">d6 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"TP"</span>, <span class="st">"pH"</span>)])),</span>
<span id="cb63-187"><a href="#cb63-187" aria-hidden="true" tabindex="-1"></a>  <span class="at">d7 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>, <span class="st">"pH"</span>)])),</span>
<span id="cb63-188"><a href="#cb63-188" aria-hidden="true" tabindex="-1"></a>  <span class="at">d8 =</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>, <span class="st">"pH"</span>)])) <span class="co"># Temperature and Total Phosphorus</span></span>
<span id="cb63-189"><a href="#cb63-189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-190"><a href="#cb63-190" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d.models) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp"</span>, <span class="st">"TP"</span>, <span class="st">"pH"</span>, <span class="st">"Temp and TP"</span>, <span class="st">"TP and pH"</span>, <span class="st">"Temp and pH"</span>, <span class="st">"Temp,TP, and pH"</span>)</span>
<span id="cb63-191"><a href="#cb63-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-192"><a href="#cb63-192" aria-hidden="true" tabindex="-1"></a><span class="co">#Define Model List </span></span>
<span id="cb63-193"><a href="#cb63-193" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb63-194"><a href="#cb63-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="st">"zero"</span>, <span class="co"># this is set to zero because the data has been demeaned</span></span>
<span id="cb63-195"><a href="#cb63-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q =</span> <span class="st">"identity"</span>, <span class="co"># Q is set to the default value, this can also be "diagonal and equal" or "diagonal and unequal"</span></span>
<span id="cb63-196"><a href="#cb63-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">x0 =</span> <span class="st">"zero"</span> <span class="co"># x0 can be also be set to "unconstrained" or "unequal" it might be useful to try these later</span></span>
<span id="cb63-197"><a href="#cb63-197" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-198"><a href="#cb63-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-199"><a href="#cb63-199" aria-hidden="true" tabindex="-1"></a><span class="co">#DFA form for mars model Q--reduces option to streamline run time</span></span>
<span id="cb63-200"><a href="#cb63-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-201"><a href="#cb63-201" aria-hidden="true" tabindex="-1"></a><span class="co"># all other params are left to their default settings</span></span>
<span id="cb63-202"><a href="#cb63-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-203"><a href="#cb63-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-204"><a href="#cb63-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-205"><a href="#cb63-205" aria-hidden="true" tabindex="-1"></a>We then set up for model runs for 63 model runs, looking at various</span>
<span id="cb63-206"><a href="#cb63-206" aria-hidden="true" tabindex="-1"></a>combination of states, covariates (d) and observation error (R).</span>
<span id="cb63-207"><a href="#cb63-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-208"><a href="#cb63-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r MARSS_models, cache = TRUE}</span></span>
<span id="cb63-209"><a href="#cb63-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Added in another for loop to run through cycling options, be warned, this means there are 80 total models. It takes a long time to run</span></span>
<span id="cb63-210"><a href="#cb63-210" aria-hidden="true" tabindex="-1"></a>start.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb63-211"><a href="#cb63-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-212"><a href="#cb63-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-213"><a href="#cb63-213" aria-hidden="true" tabindex="-1"></a>out.tab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-214"><a href="#cb63-214" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb63-215"><a href="#cb63-215" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> model.states){</span>
<span id="cb63-216"><a href="#cb63-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d.models)){</span>
<span id="cb63-217"><a href="#cb63-217" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(R.model <span class="cf">in</span> R.models){</span>
<span id="cb63-218"><a href="#cb63-218" aria-hidden="true" tabindex="-1"></a>      fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>i, <span class="at">R=</span>R.model), mod.list)</span>
<span id="cb63-219"><a href="#cb63-219" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb63-220"><a href="#cb63-220" aria-hidden="true" tabindex="-1"></a>      <span class="co">#MARSS will throw an error if covariates are not a matrix, This will not pass the covariate arg if it does not exist</span></span>
<span id="cb63-221"><a href="#cb63-221" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      if(j==1) {</span></span>
<span id="cb63-222"><a href="#cb63-222" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      fit &lt;- MARSS(plank_dat, model=fit.model, </span></span>
<span id="cb63-223"><a href="#cb63-223" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                form = "dfa", z.score = FALSE, silent = TRUE,</span></span>
<span id="cb63-224"><a href="#cb63-224" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                control=list(maxit=2000, allow.degen=TRUE))</span></span>
<span id="cb63-225"><a href="#cb63-225" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      }</span></span>
<span id="cb63-226"><a href="#cb63-226" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      else {</span></span>
<span id="cb63-227"><a href="#cb63-227" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plank_dat, <span class="at">model=</span>fit.model, </span>
<span id="cb63-228"><a href="#cb63-228" aria-hidden="true" tabindex="-1"></a>                   <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-229"><a href="#cb63-229" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">800</span>, <span class="at">allow.degen =</span> <span class="cn">TRUE</span>), </span>
<span id="cb63-230"><a href="#cb63-230" aria-hidden="true" tabindex="-1"></a>                   <span class="at">covariates =</span> d.models[[j]])</span>
<span id="cb63-231"><a href="#cb63-231" aria-hidden="true" tabindex="-1"></a>      <span class="co">#      }</span></span>
<span id="cb63-232"><a href="#cb63-232" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb63-233"><a href="#cb63-233" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">States=</span><span class="fu">names</span>(model.states)[i<span class="dv">-1</span>],<span class="at">d=</span><span class="fu">names</span>(d.models)[j],<span class="at">R=</span>R.model, <span class="co"># </span></span>
<span id="cb63-234"><a href="#cb63-234" aria-hidden="true" tabindex="-1"></a>                     <span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb63-235"><a href="#cb63-235" aria-hidden="true" tabindex="-1"></a>                     <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb63-236"><a href="#cb63-236" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-237"><a href="#cb63-237" aria-hidden="true" tabindex="-1"></a>      out.tab<span class="ot">=</span><span class="fu">rbind</span>(out.tab,out)</span>
<span id="cb63-238"><a href="#cb63-238" aria-hidden="true" tabindex="-1"></a>      fits<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb63-239"><a href="#cb63-239" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb63-240"><a href="#cb63-240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-241"><a href="#cb63-241" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-242"><a href="#cb63-242" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-243"><a href="#cb63-243" aria-hidden="true" tabindex="-1"></a>end.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb63-244"><a href="#cb63-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-245"><a href="#cb63-245" aria-hidden="true" tabindex="-1"></a>elapsed.time <span class="ot">&lt;-</span> <span class="fu">round</span>((end.time <span class="sc">-</span> start.time), <span class="dv">3</span>)</span>
<span id="cb63-246"><a href="#cb63-246" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(elapsed.time)</span>
<span id="cb63-247"><a href="#cb63-247" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab<span class="sc">$</span>AICc)</span>
<span id="cb63-248"><a href="#cb63-248" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> out.tab[min.AICc, ]</span>
<span id="cb63-249"><a href="#cb63-249" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span></span>
<span id="cb63-250"><a href="#cb63-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-251"><a href="#cb63-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-252"><a href="#cb63-252" aria-hidden="true" tabindex="-1"></a><span class="fu"># Initial Results</span></span>
<span id="cb63-253"><a href="#cb63-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-254"><a href="#cb63-254" aria-hidden="true" tabindex="-1"></a>The time for all models to fit was approximately 40 min, and the model</span>
<span id="cb63-255"><a href="#cb63-255" aria-hidden="true" tabindex="-1"></a>that has the least AICc is the model with two states, diagonal and</span>
<span id="cb63-256"><a href="#cb63-256" aria-hidden="true" tabindex="-1"></a>unequal errors and all 3 covariates. Many of the models did not</span>
<span id="cb63-257"><a href="#cb63-257" aria-hidden="true" tabindex="-1"></a>converge, which could have been due to data being inconsistent with our</span>
<span id="cb63-258"><a href="#cb63-258" aria-hidden="true" tabindex="-1"></a>model assumptions, insufficient data (we selected a data rich time</span>
<span id="cb63-259"><a href="#cb63-259" aria-hidden="true" tabindex="-1"></a>period, so I'm not sure about this one), or not enough number of</span>
<span id="cb63-260"><a href="#cb63-260" aria-hidden="true" tabindex="-1"></a>iterations for fitting. (MARSS Manual, Chapter 10).</span>
<span id="cb63-261"><a href="#cb63-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-262"><a href="#cb63-262" aria-hidden="true" tabindex="-1"></a><span class="fu">### Matrix for best fit model</span></span>
<span id="cb63-263"><a href="#cb63-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-264"><a href="#cb63-264" aria-hidden="true" tabindex="-1"></a>What forms of models did you fit (ie, write them out in matrix form)?</span>
<span id="cb63-265"><a href="#cb63-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-266"><a href="#cb63-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-267"><a href="#cb63-267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-268"><a href="#cb63-268" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-269"><a href="#cb63-269" aria-hidden="true" tabindex="-1"></a>y_1<span class="sc">\\</span></span>
<span id="cb63-270"><a href="#cb63-270" aria-hidden="true" tabindex="-1"></a>y_2<span class="sc">\\</span></span>
<span id="cb63-271"><a href="#cb63-271" aria-hidden="true" tabindex="-1"></a>y_3<span class="sc">\\</span></span>
<span id="cb63-272"><a href="#cb63-272" aria-hidden="true" tabindex="-1"></a>y_4<span class="sc">\\</span></span>
<span id="cb63-273"><a href="#cb63-273" aria-hidden="true" tabindex="-1"></a>y_5<span class="sc">\\</span></span>
<span id="cb63-274"><a href="#cb63-274" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-275"><a href="#cb63-275" aria-hidden="true" tabindex="-1"></a>=</span>
<span id="cb63-276"><a href="#cb63-276" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-277"><a href="#cb63-277" aria-hidden="true" tabindex="-1"></a>z_{1,1} &amp; z_{1,2}<span class="sc">\\</span></span>
<span id="cb63-278"><a href="#cb63-278" aria-hidden="true" tabindex="-1"></a>z_{2,1} &amp; z_{2,2}<span class="sc">\\</span></span>
<span id="cb63-279"><a href="#cb63-279" aria-hidden="true" tabindex="-1"></a>z_{3,1} &amp; z_{3,2}<span class="sc">\\</span></span>
<span id="cb63-280"><a href="#cb63-280" aria-hidden="true" tabindex="-1"></a>z_{4,1} &amp; z_{4,2}<span class="sc">\\</span></span>
<span id="cb63-281"><a href="#cb63-281" aria-hidden="true" tabindex="-1"></a>z_{5,1} &amp; z_{5,2}<span class="sc">\\</span></span>
<span id="cb63-282"><a href="#cb63-282" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-283"><a href="#cb63-283" aria-hidden="true" tabindex="-1"></a>*</span>
<span id="cb63-284"><a href="#cb63-284" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-285"><a href="#cb63-285" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-286"><a href="#cb63-286" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-287"><a href="#cb63-287" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-288"><a href="#cb63-288" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-289"><a href="#cb63-289" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-290"><a href="#cb63-290" aria-hidden="true" tabindex="-1"></a>d_{1,1} &amp; d_{1,2} &amp; d_{1,3}<span class="sc">\\</span></span>
<span id="cb63-291"><a href="#cb63-291" aria-hidden="true" tabindex="-1"></a>d_{2,1} &amp; d_{2,2} &amp; d_{2,3}<span class="sc">\\</span></span>
<span id="cb63-292"><a href="#cb63-292" aria-hidden="true" tabindex="-1"></a>d_{3,1} &amp; d_{3,2} &amp; d_{3,3}<span class="sc">\\</span></span>
<span id="cb63-293"><a href="#cb63-293" aria-hidden="true" tabindex="-1"></a>d_{4,1} &amp; d_{4,2} &amp; d_{4,3}<span class="sc">\\</span></span>
<span id="cb63-294"><a href="#cb63-294" aria-hidden="true" tabindex="-1"></a>d_{5,1} &amp; d_{5,2} &amp; d_{5,3}<span class="sc">\\</span></span>
<span id="cb63-295"><a href="#cb63-295" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-296"><a href="#cb63-296" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span></span>
<span id="cb63-297"><a href="#cb63-297" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-298"><a href="#cb63-298" aria-hidden="true" tabindex="-1"></a>Temp <span class="sc">\\</span></span>
<span id="cb63-299"><a href="#cb63-299" aria-hidden="true" tabindex="-1"></a>TP <span class="sc">\\</span></span>
<span id="cb63-300"><a href="#cb63-300" aria-hidden="true" tabindex="-1"></a>pH<span class="sc">\\</span></span>
<span id="cb63-301"><a href="#cb63-301" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-302"><a href="#cb63-302" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-303"><a href="#cb63-303" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-304"><a href="#cb63-304" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb63-305"><a href="#cb63-305" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb63-306"><a href="#cb63-306" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb63-307"><a href="#cb63-307" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb63-308"><a href="#cb63-308" aria-hidden="true" tabindex="-1"></a>v_5</span>
<span id="cb63-309"><a href="#cb63-309" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-310"><a href="#cb63-310" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-311"><a href="#cb63-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-312"><a href="#cb63-312" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-313"><a href="#cb63-313" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-314"><a href="#cb63-314" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-315"><a href="#cb63-315" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-316"><a href="#cb63-316" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-317"><a href="#cb63-317" aria-hidden="true" tabindex="-1"></a>=</span>
<span id="cb63-318"><a href="#cb63-318" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-319"><a href="#cb63-319" aria-hidden="true" tabindex="-1"></a>1 &amp; 0<span class="sc">\\</span></span>
<span id="cb63-320"><a href="#cb63-320" aria-hidden="true" tabindex="-1"></a>0 &amp; 1<span class="sc">\\</span></span>
<span id="cb63-321"><a href="#cb63-321" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-322"><a href="#cb63-322" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-323"><a href="#cb63-323" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-324"><a href="#cb63-324" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-325"><a href="#cb63-325" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_{t-1}</span>
<span id="cb63-326"><a href="#cb63-326" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-327"><a href="#cb63-327" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-328"><a href="#cb63-328" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb63-329"><a href="#cb63-329" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb63-330"><a href="#cb63-330" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-331"><a href="#cb63-331" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-332"><a href="#cb63-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-333"><a href="#cb63-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-334"><a href="#cb63-334" aria-hidden="true" tabindex="-1"></a>Process Error</span>
<span id="cb63-335"><a href="#cb63-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-336"><a href="#cb63-336" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-337"><a href="#cb63-337" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-338"><a href="#cb63-338" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb63-339"><a href="#cb63-339" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb63-340"><a href="#cb63-340" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-341"><a href="#cb63-341" aria-hidden="true" tabindex="-1"></a>\sim MVN</span>
<span id="cb63-342"><a href="#cb63-342" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb63-343"><a href="#cb63-343" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-344"><a href="#cb63-344" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-345"><a href="#cb63-345" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-346"><a href="#cb63-346" aria-hidden="true" tabindex="-1"></a>\end{bmatrix},</span>
<span id="cb63-347"><a href="#cb63-347" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-348"><a href="#cb63-348" aria-hidden="true" tabindex="-1"></a>1 &amp; 0<span class="sc">\\</span></span>
<span id="cb63-349"><a href="#cb63-349" aria-hidden="true" tabindex="-1"></a>0 &amp; 1<span class="sc">\\</span></span>
<span id="cb63-350"><a href="#cb63-350" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-351"><a href="#cb63-351" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb63-352"><a href="#cb63-352" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-353"><a href="#cb63-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-354"><a href="#cb63-354" aria-hidden="true" tabindex="-1"></a>Observation Error </span>
<span id="cb63-355"><a href="#cb63-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-356"><a href="#cb63-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-357"><a href="#cb63-357" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb63-358"><a href="#cb63-358" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-359"><a href="#cb63-359" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb63-360"><a href="#cb63-360" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb63-361"><a href="#cb63-361" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb63-362"><a href="#cb63-362" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb63-363"><a href="#cb63-363" aria-hidden="true" tabindex="-1"></a>v_5<span class="sc">\\</span></span>
<span id="cb63-364"><a href="#cb63-364" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-365"><a href="#cb63-365" aria-hidden="true" tabindex="-1"></a>\sim MVN</span>
<span id="cb63-366"><a href="#cb63-366" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb63-367"><a href="#cb63-367" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-368"><a href="#cb63-368" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-369"><a href="#cb63-369" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-370"><a href="#cb63-370" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-371"><a href="#cb63-371" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-372"><a href="#cb63-372" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-373"><a href="#cb63-373" aria-hidden="true" tabindex="-1"></a>\end{bmatrix},</span>
<span id="cb63-374"><a href="#cb63-374" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-375"><a href="#cb63-375" aria-hidden="true" tabindex="-1"></a>r_1 &amp; 0&amp; 0&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-376"><a href="#cb63-376" aria-hidden="true" tabindex="-1"></a>0 &amp; r_2&amp; 0&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-377"><a href="#cb63-377" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; r_3&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-378"><a href="#cb63-378" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; 0&amp; r_4&amp; 0<span class="sc">\\</span></span>
<span id="cb63-379"><a href="#cb63-379" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; 0&amp; 0&amp; r_5<span class="sc">\\</span></span>
<span id="cb63-380"><a href="#cb63-380" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-381"><a href="#cb63-381" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb63-382"><a href="#cb63-382" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-383"><a href="#cb63-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-384"><a href="#cb63-384" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagnostics</span></span>
<span id="cb63-385"><a href="#cb63-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-386"><a href="#cb63-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r factor_loadings}</span></span>
<span id="cb63-387"><a href="#cb63-387" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotating the model, plotting the states and loadings</span></span>
<span id="cb63-388"><a href="#cb63-388" aria-hidden="true" tabindex="-1"></a>best_fit <span class="ot">&lt;-</span> fits[[<span class="dv">19</span>]]</span>
<span id="cb63-389"><a href="#cb63-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-390"><a href="#cb63-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Z Estimations and rotate the data</span></span>
<span id="cb63-391"><a href="#cb63-391" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb63-392"><a href="#cb63-392" aria-hidden="true" tabindex="-1"></a>Z_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(best_fit, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb63-393"><a href="#cb63-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-394"><a href="#cb63-394" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb63-395"><a href="#cb63-395" aria-hidden="true" tabindex="-1"></a>H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est)<span class="sc">$</span>rotmat</span>
<span id="cb63-396"><a href="#cb63-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-397"><a href="#cb63-397" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate factor loadings</span></span>
<span id="cb63-398"><a href="#cb63-398" aria-hidden="true" tabindex="-1"></a>Z_rot <span class="ot">=</span> Z_est <span class="sc">%*%</span> H_inv   </span>
<span id="cb63-399"><a href="#cb63-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-400"><a href="#cb63-400" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb63-401"><a href="#cb63-401" aria-hidden="true" tabindex="-1"></a>proc_rot <span class="ot">=</span> <span class="fu">solve</span>(H_inv) <span class="sc">%*%</span> best_fit<span class="sc">$</span>states</span>
<span id="cb63-402"><a href="#cb63-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-403"><a href="#cb63-403" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plank_dat)</span>
<span id="cb63-404"><a href="#cb63-404" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">ncol</span>(Z_est)</span>
<span id="cb63-405"><a href="#cb63-405" aria-hidden="true" tabindex="-1"></a><span class="do">## plot labels</span></span>
<span id="cb63-406"><a href="#cb63-406" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb63-407"><a href="#cb63-407" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(mm)</span>
<span id="cb63-408"><a href="#cb63-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-409"><a href="#cb63-409" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plot area</span></span>
<span id="cb63-410"><a href="#cb63-410" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, m, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb63-411"><a href="#cb63-411" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-412"><a href="#cb63-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-413"><a href="#cb63-413" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the processes</span></span>
<span id="cb63-414"><a href="#cb63-414" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb63-415"><a href="#cb63-415" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot[i,]))</span>
<span id="cb63-416"><a href="#cb63-416" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb63-417"><a href="#cb63-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts,proc_rot[i,], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>,</span>
<span id="cb63-418"><a href="#cb63-418" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> ylm, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb63-419"><a href="#cb63-419" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb63-420"><a href="#cb63-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb63-421"><a href="#cb63-421" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb63-422"><a href="#cb63-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-423"><a href="#cb63-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-424"><a href="#cb63-424" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb63-425"><a href="#cb63-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>,i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-426"><a href="#cb63-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb63-427"><a href="#cb63-427" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-428"><a href="#cb63-428" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb63-429"><a href="#cb63-429" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb63-430"><a href="#cb63-430" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot))</span>
<span id="cb63-431"><a href="#cb63-431" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb63-432"><a href="#cb63-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>N_ts)[<span class="fu">abs</span>(Z_rot[,i])<span class="sc">&gt;</span>minZ],</span>
<span id="cb63-433"><a href="#cb63-433" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">as.vector</span>(Z_rot[<span class="fu">abs</span>(Z_rot[,i])<span class="sc">&gt;</span>minZ,i]),</span>
<span id="cb63-434"><a href="#cb63-434" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"h"</span>,</span>
<span id="cb63-435"><a href="#cb63-435" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm,</span>
<span id="cb63-436"><a href="#cb63-436" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, N_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb63-437"><a href="#cb63-437" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb63-438"><a href="#cb63-438" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot[j,i] <span class="sc">&gt;</span> minZ) {<span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb63-439"><a href="#cb63-439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot[j,i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {<span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb63-440"><a href="#cb63-440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb63-441"><a href="#cb63-441" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb63-442"><a href="#cb63-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-443"><a href="#cb63-443" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-444"><a href="#cb63-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-445"><a href="#cb63-445" aria-hidden="true" tabindex="-1"></a><span class="do">## plot CCF's</span></span>
<span id="cb63-446"><a href="#cb63-446" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(proc_rot[<span class="dv">1</span>,],proc_rot[<span class="dv">2</span>,], <span class="at">lag.max =</span> <span class="dv">15</span>, <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb63-447"><a href="#cb63-447" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"State 1 vs 2"</span>)</span>
<span id="cb63-448"><a href="#cb63-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-449"><a href="#cb63-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-450"><a href="#cb63-450" aria-hidden="true" tabindex="-1"></a>This model seems to explain primary producer and grazer dynamics best in</span>
<span id="cb63-451"><a href="#cb63-451" aria-hidden="true" tabindex="-1"></a>state 1, and predator dynamics best in state two. Epischura has a strong</span>
<span id="cb63-452"><a href="#cb63-452" aria-hidden="true" tabindex="-1"></a>negative trend in state two, compared to other species which are all</span>
<span id="cb63-453"><a href="#cb63-453" aria-hidden="true" tabindex="-1"></a>postive in both states 1 and 2.</span>
<span id="cb63-454"><a href="#cb63-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-455"><a href="#cb63-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Continued Diagnostics}</span></span>
<span id="cb63-456"><a href="#cb63-456" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(best_fit) </span>
<span id="cb63-457"><a href="#cb63-457" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-458"><a href="#cb63-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-459"><a href="#cb63-459" aria-hidden="true" tabindex="-1"></a>The diagnostic plots show relatively good fits for three of the species,</span>
<span id="cb63-460"><a href="#cb63-460" aria-hidden="true" tabindex="-1"></a>but "other algae" and diatoms aren't being captured as the model is</span>
<span id="cb63-461"><a href="#cb63-461" aria-hidden="true" tabindex="-1"></a>missing the full range of data. There may be some structure to the</span>
<span id="cb63-462"><a href="#cb63-462" aria-hidden="true" tabindex="-1"></a>residuals for diatoms and maybe cyclops with few outliers, but all</span>
<span id="cb63-463"><a href="#cb63-463" aria-hidden="true" tabindex="-1"></a>species and states show normality in the QQ plots.</span>
<span id="cb63-464"><a href="#cb63-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-465"><a href="#cb63-465" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Fits</span></span>
<span id="cb63-466"><a href="#cb63-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-469"><a href="#cb63-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-470"><a href="#cb63-470" aria-hidden="true" tabindex="-1"></a>get_DFA_fits <span class="ot">&lt;-</span> <span class="cf">function</span>(MLEobj, <span class="at">dd =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb63-471"><a href="#cb63-471" aria-hidden="true" tabindex="-1"></a>    <span class="do">## empty list for results</span></span>
<span id="cb63-472"><a href="#cb63-472" aria-hidden="true" tabindex="-1"></a>    fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb63-473"><a href="#cb63-473" aria-hidden="true" tabindex="-1"></a>    <span class="do">## extra stuff for var() calcs</span></span>
<span id="cb63-474"><a href="#cb63-474" aria-hidden="true" tabindex="-1"></a>    Ey <span class="ot">&lt;-</span> MARSS<span class="sc">:::</span><span class="fu">MARSShatyt</span>(MLEobj)</span>
<span id="cb63-475"><a href="#cb63-475" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model params</span></span>
<span id="cb63-476"><a href="#cb63-476" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb63-477"><a href="#cb63-477" aria-hidden="true" tabindex="-1"></a>    <span class="do">## number of obs ts</span></span>
<span id="cb63-478"><a href="#cb63-478" aria-hidden="true" tabindex="-1"></a>    nn <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">1</span>]</span>
<span id="cb63-479"><a href="#cb63-479" aria-hidden="true" tabindex="-1"></a>    <span class="do">## number of time steps</span></span>
<span id="cb63-480"><a href="#cb63-480" aria-hidden="true" tabindex="-1"></a>    TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">2</span>]</span>
<span id="cb63-481"><a href="#cb63-481" aria-hidden="true" tabindex="-1"></a>    <span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb63-482"><a href="#cb63-482" aria-hidden="true" tabindex="-1"></a>    H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(ZZ)<span class="sc">$</span>rotmat</span>
<span id="cb63-483"><a href="#cb63-483" aria-hidden="true" tabindex="-1"></a>    <span class="do">## check for covars</span></span>
<span id="cb63-484"><a href="#cb63-484" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dd)) {</span>
<span id="cb63-485"><a href="#cb63-485" aria-hidden="true" tabindex="-1"></a>        DD <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb63-486"><a href="#cb63-486" aria-hidden="true" tabindex="-1"></a>        <span class="do">## model expectation</span></span>
<span id="cb63-487"><a href="#cb63-487" aria-hidden="true" tabindex="-1"></a>        fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states <span class="sc">+</span> DD <span class="sc">%*%</span> dd</span>
<span id="cb63-488"><a href="#cb63-488" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb63-489"><a href="#cb63-489" aria-hidden="true" tabindex="-1"></a>        <span class="do">## model expectation</span></span>
<span id="cb63-490"><a href="#cb63-490" aria-hidden="true" tabindex="-1"></a>        fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states</span>
<span id="cb63-491"><a href="#cb63-491" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-492"><a href="#cb63-492" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Var in model fits</span></span>
<span id="cb63-493"><a href="#cb63-493" aria-hidden="true" tabindex="-1"></a>    VtT <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(MLEobj)<span class="sc">$</span>VtT</span>
<span id="cb63-494"><a href="#cb63-494" aria-hidden="true" tabindex="-1"></a>    VV <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-495"><a href="#cb63-495" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (tt <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb63-496"><a href="#cb63-496" aria-hidden="true" tabindex="-1"></a>        RZVZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>R <span class="sc">-</span> ZZ <span class="sc">%*%</span> VtT[, </span>
<span id="cb63-497"><a href="#cb63-497" aria-hidden="true" tabindex="-1"></a>            , tt] <span class="sc">%*%</span> <span class="fu">t</span>(ZZ)</span>
<span id="cb63-498"><a href="#cb63-498" aria-hidden="true" tabindex="-1"></a>        SS <span class="ot">&lt;-</span> Ey<span class="sc">$</span>yxtT[, , tt] <span class="sc">-</span> Ey<span class="sc">$</span>ytT[, tt, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> </span>
<span id="cb63-499"><a href="#cb63-499" aria-hidden="true" tabindex="-1"></a>            <span class="fu">t</span>(MLEobj<span class="sc">$</span>states[, tt, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb63-500"><a href="#cb63-500" aria-hidden="true" tabindex="-1"></a>        VV <span class="ot">&lt;-</span> <span class="fu">cbind</span>(VV, <span class="fu">diag</span>(RZVZ <span class="sc">+</span> SS <span class="sc">%*%</span> <span class="fu">t</span>(ZZ) <span class="sc">+</span> ZZ <span class="sc">%*%</span> <span class="fu">t</span>(SS)))</span>
<span id="cb63-501"><a href="#cb63-501" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-502"><a href="#cb63-502" aria-hidden="true" tabindex="-1"></a>    SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(VV)</span>
<span id="cb63-503"><a href="#cb63-503" aria-hidden="true" tabindex="-1"></a>    <span class="do">## upper &amp; lower (1-alpha)% CI</span></span>
<span id="cb63-504"><a href="#cb63-504" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb63-505"><a href="#cb63-505" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb63-506"><a href="#cb63-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fits)</span>
<span id="cb63-507"><a href="#cb63-507" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-508"><a href="#cb63-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-509"><a href="#cb63-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-510"><a href="#cb63-510" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb63-511"><a href="#cb63-511" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">1</span>]</span>
<span id="cb63-512"><a href="#cb63-512" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb63-513"><a href="#cb63-513" aria-hidden="true" tabindex="-1"></a><span class="do">## get model fits &amp; CI's</span></span>
<span id="cb63-514"><a href="#cb63-514" aria-hidden="true" tabindex="-1"></a>mod_fit <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(best_fit)</span>
<span id="cb63-515"><a href="#cb63-515" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the fits</span></span>
<span id="cb63-516"><a href="#cb63-516" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb63-517"><a href="#cb63-517" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(N_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb63-518"><a href="#cb63-518" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-519"><a href="#cb63-519" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb63-520"><a href="#cb63-520" aria-hidden="true" tabindex="-1"></a>    up <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>up[i, ]</span>
<span id="cb63-521"><a href="#cb63-521" aria-hidden="true" tabindex="-1"></a>    mn <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>ex[i, ]</span>
<span id="cb63-522"><a href="#cb63-522" aria-hidden="true" tabindex="-1"></a>    lo <span class="ot">&lt;-</span> mod_fit<span class="sc">$</span>lo[i, ]</span>
<span id="cb63-523"><a href="#cb63-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb63-524"><a href="#cb63-524" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb63-525"><a href="#cb63-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb63-526"><a href="#cb63-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(w_ts, plank_dat[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb63-527"><a href="#cb63-527" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb63-528"><a href="#cb63-528" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-529"><a href="#cb63-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb63-530"><a href="#cb63-530" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-531"><a href="#cb63-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-532"><a href="#cb63-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-533"><a href="#cb63-533" aria-hidden="true" tabindex="-1"></a>These fits seem to be missing a lot of the interannual peaks and valleys</span>
<span id="cb63-534"><a href="#cb63-534" aria-hidden="true" tabindex="-1"></a>for daphnia and the confidence intervals for cyclops and epischura are</span>
<span id="cb63-535"><a href="#cb63-535" aria-hidden="true" tabindex="-1"></a>very tight and missing data. We may be able to find a better fitting</span>
<span id="cb63-536"><a href="#cb63-536" aria-hidden="true" tabindex="-1"></a>model with seasonal considerations.</span>
<span id="cb63-537"><a href="#cb63-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-538"><a href="#cb63-538" aria-hidden="true" tabindex="-1"></a><span class="fu"># Seasonal Model Exploration</span></span>
<span id="cb63-539"><a href="#cb63-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-540"><a href="#cb63-540" aria-hidden="true" tabindex="-1"></a>**Describe the effects of environmental or dummy variables on (possibly</span>
<span id="cb63-541"><a href="#cb63-541" aria-hidden="true" tabindex="-1"></a>seasonal) patterns in the data.**</span>
<span id="cb63-542"><a href="#cb63-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-543"><a href="#cb63-543" aria-hidden="true" tabindex="-1"></a><span class="fu">## Seasonal Model Set-up</span></span>
<span id="cb63-544"><a href="#cb63-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-545"><a href="#cb63-545" aria-hidden="true" tabindex="-1"></a>We decided to look at three seasonal patterns, an annual pattern (12</span>
<span id="cb63-546"><a href="#cb63-546" aria-hidden="true" tabindex="-1"></a>months), a six month pattern, and a 3 month pattern (Winter, Spring,</span>
<span id="cb63-547"><a href="#cb63-547" aria-hidden="true" tabindex="-1"></a>Summer, Fall).</span>
<span id="cb63-548"><a href="#cb63-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-549"><a href="#cb63-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Seasonal exploration, cache = TRUE}</span></span>
<span id="cb63-550"><a href="#cb63-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-551"><a href="#cb63-551" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]</span>
<span id="cb63-552"><a href="#cb63-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-553"><a href="#cb63-553" aria-hidden="true" tabindex="-1"></a>fits_season <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb63-554"><a href="#cb63-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-555"><a href="#cb63-555" aria-hidden="true" tabindex="-1"></a>out.tab.season <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb63-556"><a href="#cb63-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-557"><a href="#cb63-557" aria-hidden="true" tabindex="-1"></a>model.states <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb63-558"><a href="#cb63-558" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(model.states) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"two_states"</span>)</span>
<span id="cb63-559"><a href="#cb63-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-560"><a href="#cb63-560" aria-hidden="true" tabindex="-1"></a>R.models <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"diagonal and unequal"</span>)</span>
<span id="cb63-561"><a href="#cb63-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-562"><a href="#cb63-562" aria-hidden="true" tabindex="-1"></a><span class="co"># 12 month period </span></span>
<span id="cb63-563"><a href="#cb63-563" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb63-564"><a href="#cb63-564" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb63-565"><a href="#cb63-565" aria-hidden="true" tabindex="-1"></a>  c.Four_12 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.12</span>, sin<span class="fl">.12</span>)</span>
<span id="cb63-566"><a href="#cb63-566" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-567"><a href="#cb63-567" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 month period </span></span>
<span id="cb63-568"><a href="#cb63-568" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">6</span>)</span>
<span id="cb63-569"><a href="#cb63-569" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">6</span>)</span>
<span id="cb63-570"><a href="#cb63-570" aria-hidden="true" tabindex="-1"></a>  c.Four_6 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.6</span>, sin<span class="fl">.6</span>)</span>
<span id="cb63-571"><a href="#cb63-571" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-572"><a href="#cb63-572" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 month period </span></span>
<span id="cb63-573"><a href="#cb63-573" aria-hidden="true" tabindex="-1"></a>  cos<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb63-574"><a href="#cb63-574" aria-hidden="true" tabindex="-1"></a>  sin<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb63-575"><a href="#cb63-575" aria-hidden="true" tabindex="-1"></a>  c.Four_3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos<span class="fl">.3</span>, sin<span class="fl">.3</span>)</span>
<span id="cb63-576"><a href="#cb63-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-577"><a href="#cb63-577" aria-hidden="true" tabindex="-1"></a>  d10 <span class="ot">=</span> <span class="fu">zscore</span>(<span class="fu">t</span>(init_dat[,<span class="fu">c</span>(<span class="st">"Temp"</span>,<span class="st">"TP"</span>, <span class="st">"pH"</span>)]))</span>
<span id="cb63-578"><a href="#cb63-578" aria-hidden="true" tabindex="-1"></a>  d12 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_12, d10)</span>
<span id="cb63-579"><a href="#cb63-579" aria-hidden="true" tabindex="-1"></a>  d6 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_6, d10)</span>
<span id="cb63-580"><a href="#cb63-580" aria-hidden="true" tabindex="-1"></a>  d3 <span class="ot">=</span> <span class="fu">rbind</span>(c.Four_3, d10)</span>
<span id="cb63-581"><a href="#cb63-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-582"><a href="#cb63-582" aria-hidden="true" tabindex="-1"></a>  d.models <span class="ot">&lt;-</span> <span class="fu">list</span>(d10, d12, d6, d3)</span>
<span id="cb63-583"><a href="#cb63-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(d.models) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Temp,TP, and pH"</span>, <span class="st">"12 month"</span>, <span class="st">"6 month"</span>, <span class="st">"3 month"</span>)</span>
<span id="cb63-584"><a href="#cb63-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-585"><a href="#cb63-585" aria-hidden="true" tabindex="-1"></a>  mod.list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb63-586"><a href="#cb63-586" aria-hidden="true" tabindex="-1"></a>    <span class="at">A =</span> <span class="st">"zero"</span>,</span>
<span id="cb63-587"><a href="#cb63-587" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q =</span> <span class="st">"identity"</span>,</span>
<span id="cb63-588"><a href="#cb63-588" aria-hidden="true" tabindex="-1"></a>    <span class="at">x0 =</span> <span class="st">"zero"</span></span>
<span id="cb63-589"><a href="#cb63-589" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-590"><a href="#cb63-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-591"><a href="#cb63-591" aria-hidden="true" tabindex="-1"></a>  start.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb63-592"><a href="#cb63-592" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(d.models)){</span>
<span id="cb63-593"><a href="#cb63-593" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(R.model <span class="cf">in</span> R.models){</span>
<span id="cb63-594"><a href="#cb63-594" aria-hidden="true" tabindex="-1"></a>        fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>i, <span class="at">R=</span>R.model), mod.list)</span>
<span id="cb63-595"><a href="#cb63-595" aria-hidden="true" tabindex="-1"></a>        fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plank_dat, <span class="at">model=</span>fit.model, </span>
<span id="cb63-596"><a href="#cb63-596" aria-hidden="true" tabindex="-1"></a>                     <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">silent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-597"><a href="#cb63-597" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">800</span>, <span class="at">allow.degen=</span><span class="cn">TRUE</span>), </span>
<span id="cb63-598"><a href="#cb63-598" aria-hidden="true" tabindex="-1"></a>                     <span class="at">covariates =</span> d.models[[j]])</span>
<span id="cb63-599"><a href="#cb63-599" aria-hidden="true" tabindex="-1"></a>        out<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">States=</span><span class="fu">names</span>(model.states)[i<span class="dv">-1</span>],<span class="at">d=</span><span class="fu">names</span>(d.models)[j],<span class="at">R=</span>R.model, <span class="co"># </span></span>
<span id="cb63-600"><a href="#cb63-600" aria-hidden="true" tabindex="-1"></a>                       <span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb63-601"><a href="#cb63-601" aria-hidden="true" tabindex="-1"></a>                       <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb63-602"><a href="#cb63-602" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb63-603"><a href="#cb63-603" aria-hidden="true" tabindex="-1"></a>        out.tab.season<span class="ot">=</span><span class="fu">rbind</span>(out.tab.season,out)</span>
<span id="cb63-604"><a href="#cb63-604" aria-hidden="true" tabindex="-1"></a>        fits_season<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb63-605"><a href="#cb63-605" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb63-606"><a href="#cb63-606" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-607"><a href="#cb63-607" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-608"><a href="#cb63-608" aria-hidden="true" tabindex="-1"></a>  end.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb63-609"><a href="#cb63-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-610"><a href="#cb63-610" aria-hidden="true" tabindex="-1"></a>  elapsed.time <span class="ot">&lt;-</span> <span class="fu">round</span>((end.time <span class="sc">-</span> start.time), <span class="dv">3</span>)</span>
<span id="cb63-611"><a href="#cb63-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Elapsed time for period:"</span>, elapsed.time))</span>
<span id="cb63-612"><a href="#cb63-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-613"><a href="#cb63-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-614"><a href="#cb63-614" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab.season<span class="sc">$</span>AICc)</span>
<span id="cb63-615"><a href="#cb63-615" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.2</span> <span class="ot">&lt;-</span> out.tab.season[min.AICc, ]</span>
<span id="cb63-616"><a href="#cb63-616" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.2</span></span>
<span id="cb63-617"><a href="#cb63-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-618"><a href="#cb63-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-619"><a href="#cb63-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-620"><a href="#cb63-620" aria-hidden="true" tabindex="-1"></a><span class="fu"># Seasonal Results</span></span>
<span id="cb63-621"><a href="#cb63-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-622"><a href="#cb63-622" aria-hidden="true" tabindex="-1"></a>When comparing our previous best model,a two state model with diagonal</span>
<span id="cb63-623"><a href="#cb63-623" aria-hidden="true" tabindex="-1"></a>and unequal observation error with covariates temperature, total</span>
<span id="cb63-624"><a href="#cb63-624" aria-hidden="true" tabindex="-1"></a>phosphorous, and pH, to a model with the same assumptions but adding in</span>
<span id="cb63-625"><a href="#cb63-625" aria-hidden="true" tabindex="-1"></a>seasonal considerations, both 12 month periods and 6 month periods</span>
<span id="cb63-626"><a href="#cb63-626" aria-hidden="true" tabindex="-1"></a>performed better than the non-seasonal model. The model with the 6 month</span>
<span id="cb63-627"><a href="#cb63-627" aria-hidden="true" tabindex="-1"></a>period performed the best by a significant margin. We explore the</span>
<span id="cb63-628"><a href="#cb63-628" aria-hidden="true" tabindex="-1"></a>diagnostics and model fits below.</span>
<span id="cb63-629"><a href="#cb63-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-630"><a href="#cb63-630" aria-hidden="true" tabindex="-1"></a><span class="fu">## Matrix for Best Seasonal Model</span></span>
<span id="cb63-631"><a href="#cb63-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-632"><a href="#cb63-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-633"><a href="#cb63-633" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-634"><a href="#cb63-634" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-635"><a href="#cb63-635" aria-hidden="true" tabindex="-1"></a>y_1<span class="sc">\\</span></span>
<span id="cb63-636"><a href="#cb63-636" aria-hidden="true" tabindex="-1"></a>y_2<span class="sc">\\</span></span>
<span id="cb63-637"><a href="#cb63-637" aria-hidden="true" tabindex="-1"></a>y_3<span class="sc">\\</span></span>
<span id="cb63-638"><a href="#cb63-638" aria-hidden="true" tabindex="-1"></a>y_4<span class="sc">\\</span></span>
<span id="cb63-639"><a href="#cb63-639" aria-hidden="true" tabindex="-1"></a>y_5<span class="sc">\\</span></span>
<span id="cb63-640"><a href="#cb63-640" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-641"><a href="#cb63-641" aria-hidden="true" tabindex="-1"></a>=</span>
<span id="cb63-642"><a href="#cb63-642" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-643"><a href="#cb63-643" aria-hidden="true" tabindex="-1"></a>z_{1,1} &amp; z_{1,2}<span class="sc">\\</span></span>
<span id="cb63-644"><a href="#cb63-644" aria-hidden="true" tabindex="-1"></a>z_{2,1} &amp; z_{2,2}<span class="sc">\\</span></span>
<span id="cb63-645"><a href="#cb63-645" aria-hidden="true" tabindex="-1"></a>z_{3,1} &amp; z_{3,2}<span class="sc">\\</span></span>
<span id="cb63-646"><a href="#cb63-646" aria-hidden="true" tabindex="-1"></a>z_{4,1} &amp; z_{4,2}<span class="sc">\\</span></span>
<span id="cb63-647"><a href="#cb63-647" aria-hidden="true" tabindex="-1"></a>z_{5,1} &amp; z_{5,2}<span class="sc">\\</span></span>
<span id="cb63-648"><a href="#cb63-648" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-649"><a href="#cb63-649" aria-hidden="true" tabindex="-1"></a>*</span>
<span id="cb63-650"><a href="#cb63-650" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-651"><a href="#cb63-651" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-652"><a href="#cb63-652" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-653"><a href="#cb63-653" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-654"><a href="#cb63-654" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-655"><a href="#cb63-655" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-656"><a href="#cb63-656" aria-hidden="true" tabindex="-1"></a>d_{1,1} &amp; d_{1,2} &amp; d_{1,3} &amp; d_{1,4} &amp; d_{1,5}<span class="sc">\\</span></span>
<span id="cb63-657"><a href="#cb63-657" aria-hidden="true" tabindex="-1"></a>d_{2,1} &amp; d_{2,2} &amp; d_{2,3} &amp; d_{2,4} &amp; d_{2,5}<span class="sc">\\</span></span>
<span id="cb63-658"><a href="#cb63-658" aria-hidden="true" tabindex="-1"></a>d_{3,1} &amp; d_{3,2} &amp; d_{3,3} &amp; d_{3,4} &amp; d_{3,5}<span class="sc">\\</span></span>
<span id="cb63-659"><a href="#cb63-659" aria-hidden="true" tabindex="-1"></a>d_{4,1} &amp; d_{4,2} &amp; d_{4,3} &amp; d_{4,4} &amp; d_{4,5}<span class="sc">\\</span></span>
<span id="cb63-660"><a href="#cb63-660" aria-hidden="true" tabindex="-1"></a>d_{5,1} &amp; d_{5,2} &amp; d_{5,3} &amp; d_{5,4} &amp; d_{5,5}<span class="sc">\\</span></span>
<span id="cb63-661"><a href="#cb63-661" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-662"><a href="#cb63-662" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span></span>
<span id="cb63-663"><a href="#cb63-663" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-664"><a href="#cb63-664" aria-hidden="true" tabindex="-1"></a>Temp <span class="sc">\\</span></span>
<span id="cb63-665"><a href="#cb63-665" aria-hidden="true" tabindex="-1"></a>TP <span class="sc">\\</span></span>
<span id="cb63-666"><a href="#cb63-666" aria-hidden="true" tabindex="-1"></a>pH<span class="sc">\\</span></span>
<span id="cb63-667"><a href="#cb63-667" aria-hidden="true" tabindex="-1"></a>cos(2pi*TT/6)<span class="sc">\\</span></span>
<span id="cb63-668"><a href="#cb63-668" aria-hidden="true" tabindex="-1"></a>sin(2pi*TT/6<span class="sc">\\</span></span>
<span id="cb63-669"><a href="#cb63-669" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-670"><a href="#cb63-670" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-671"><a href="#cb63-671" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-672"><a href="#cb63-672" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb63-673"><a href="#cb63-673" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb63-674"><a href="#cb63-674" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb63-675"><a href="#cb63-675" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb63-676"><a href="#cb63-676" aria-hidden="true" tabindex="-1"></a>v_5</span>
<span id="cb63-677"><a href="#cb63-677" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-678"><a href="#cb63-678" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-679"><a href="#cb63-679" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-680"><a href="#cb63-680" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-681"><a href="#cb63-681" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-682"><a href="#cb63-682" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-683"><a href="#cb63-683" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-684"><a href="#cb63-684" aria-hidden="true" tabindex="-1"></a>=</span>
<span id="cb63-685"><a href="#cb63-685" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-686"><a href="#cb63-686" aria-hidden="true" tabindex="-1"></a>1 &amp; 0<span class="sc">\\</span></span>
<span id="cb63-687"><a href="#cb63-687" aria-hidden="true" tabindex="-1"></a>0 &amp; 1<span class="sc">\\</span></span>
<span id="cb63-688"><a href="#cb63-688" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-689"><a href="#cb63-689" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-690"><a href="#cb63-690" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb63-691"><a href="#cb63-691" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb63-692"><a href="#cb63-692" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_{t-1}</span>
<span id="cb63-693"><a href="#cb63-693" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb63-694"><a href="#cb63-694" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-695"><a href="#cb63-695" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb63-696"><a href="#cb63-696" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb63-697"><a href="#cb63-697" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb63-698"><a href="#cb63-698" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-699"><a href="#cb63-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-700"><a href="#cb63-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-701"><a href="#cb63-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-702"><a href="#cb63-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-703"><a href="#cb63-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-704"><a href="#cb63-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-705"><a href="#cb63-705" aria-hidden="true" tabindex="-1"></a>Process Error</span>
<span id="cb63-706"><a href="#cb63-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-707"><a href="#cb63-707" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-708"><a href="#cb63-708" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-709"><a href="#cb63-709" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb63-710"><a href="#cb63-710" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb63-711"><a href="#cb63-711" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-712"><a href="#cb63-712" aria-hidden="true" tabindex="-1"></a>\sim MVN</span>
<span id="cb63-713"><a href="#cb63-713" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb63-714"><a href="#cb63-714" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-715"><a href="#cb63-715" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-716"><a href="#cb63-716" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-717"><a href="#cb63-717" aria-hidden="true" tabindex="-1"></a>\end{bmatrix},</span>
<span id="cb63-718"><a href="#cb63-718" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-719"><a href="#cb63-719" aria-hidden="true" tabindex="-1"></a>1 &amp; 0<span class="sc">\\</span></span>
<span id="cb63-720"><a href="#cb63-720" aria-hidden="true" tabindex="-1"></a>0 &amp; 1<span class="sc">\\</span></span>
<span id="cb63-721"><a href="#cb63-721" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-722"><a href="#cb63-722" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb63-723"><a href="#cb63-723" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-724"><a href="#cb63-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-725"><a href="#cb63-725" aria-hidden="true" tabindex="-1"></a>Observation Error </span>
<span id="cb63-726"><a href="#cb63-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-727"><a href="#cb63-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-728"><a href="#cb63-728" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb63-729"><a href="#cb63-729" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-730"><a href="#cb63-730" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb63-731"><a href="#cb63-731" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb63-732"><a href="#cb63-732" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb63-733"><a href="#cb63-733" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb63-734"><a href="#cb63-734" aria-hidden="true" tabindex="-1"></a>v_5<span class="sc">\\</span></span>
<span id="cb63-735"><a href="#cb63-735" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-736"><a href="#cb63-736" aria-hidden="true" tabindex="-1"></a>\sim MVN</span>
<span id="cb63-737"><a href="#cb63-737" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb63-738"><a href="#cb63-738" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-739"><a href="#cb63-739" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-740"><a href="#cb63-740" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-741"><a href="#cb63-741" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-742"><a href="#cb63-742" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-743"><a href="#cb63-743" aria-hidden="true" tabindex="-1"></a>0<span class="sc">\\</span></span>
<span id="cb63-744"><a href="#cb63-744" aria-hidden="true" tabindex="-1"></a>\end{bmatrix},</span>
<span id="cb63-745"><a href="#cb63-745" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb63-746"><a href="#cb63-746" aria-hidden="true" tabindex="-1"></a>r_1 &amp; 0&amp; 0&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-747"><a href="#cb63-747" aria-hidden="true" tabindex="-1"></a>0 &amp; r_2&amp; 0&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-748"><a href="#cb63-748" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; r_3&amp; 0&amp; 0<span class="sc">\\</span></span>
<span id="cb63-749"><a href="#cb63-749" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; 0&amp; r_4&amp; 0<span class="sc">\\</span></span>
<span id="cb63-750"><a href="#cb63-750" aria-hidden="true" tabindex="-1"></a>0 &amp; 0&amp; 0&amp; 0&amp; r_5<span class="sc">\\</span></span>
<span id="cb63-751"><a href="#cb63-751" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb63-752"><a href="#cb63-752" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb63-753"><a href="#cb63-753" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb63-754"><a href="#cb63-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-755"><a href="#cb63-755" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting the Seasonal Model</span></span>
<span id="cb63-756"><a href="#cb63-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-757"><a href="#cb63-757" aria-hidden="true" tabindex="-1"></a><span class="in">```{r factor_loadings including seasonality}</span></span>
<span id="cb63-758"><a href="#cb63-758" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotating the model, plotting the states and loadings</span></span>
<span id="cb63-759"><a href="#cb63-759" aria-hidden="true" tabindex="-1"></a>best_fit_s <span class="ot">&lt;-</span> fits_season[[<span class="dv">3</span>]]</span>
<span id="cb63-760"><a href="#cb63-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-761"><a href="#cb63-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Z Estimations and rotate the data</span></span>
<span id="cb63-762"><a href="#cb63-762" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb63-763"><a href="#cb63-763" aria-hidden="true" tabindex="-1"></a>Z_est_s <span class="ot">&lt;-</span> <span class="fu">coef</span>(best_fit_s, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb63-764"><a href="#cb63-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-765"><a href="#cb63-765" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb63-766"><a href="#cb63-766" aria-hidden="true" tabindex="-1"></a>H_inv_s <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est_s)<span class="sc">$</span>rotmat</span>
<span id="cb63-767"><a href="#cb63-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-768"><a href="#cb63-768" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate factor loadings</span></span>
<span id="cb63-769"><a href="#cb63-769" aria-hidden="true" tabindex="-1"></a>Z_rot_s <span class="ot">=</span> Z_est_s <span class="sc">%*%</span> H_inv_s   </span>
<span id="cb63-770"><a href="#cb63-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-771"><a href="#cb63-771" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb63-772"><a href="#cb63-772" aria-hidden="true" tabindex="-1"></a>proc_rot_s <span class="ot">=</span> <span class="fu">solve</span>(H_inv_s) <span class="sc">%*%</span> best_fit_s<span class="sc">$</span>states</span>
<span id="cb63-773"><a href="#cb63-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-774"><a href="#cb63-774" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plank_dat)</span>
<span id="cb63-775"><a href="#cb63-775" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">ncol</span>(Z_est)</span>
<span id="cb63-776"><a href="#cb63-776" aria-hidden="true" tabindex="-1"></a><span class="do">## plot labels</span></span>
<span id="cb63-777"><a href="#cb63-777" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb63-778"><a href="#cb63-778" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(mm)</span>
<span id="cb63-779"><a href="#cb63-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-780"><a href="#cb63-780" aria-hidden="true" tabindex="-1"></a><span class="do">## set up plot area</span></span>
<span id="cb63-781"><a href="#cb63-781" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, m, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb63-782"><a href="#cb63-782" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-783"><a href="#cb63-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-784"><a href="#cb63-784" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the processes</span></span>
<span id="cb63-785"><a href="#cb63-785" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb63-786"><a href="#cb63-786" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot_s[i,]))</span>
<span id="cb63-787"><a href="#cb63-787" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb63-788"><a href="#cb63-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts,proc_rot_s[i,], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>,</span>
<span id="cb63-789"><a href="#cb63-789" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> ylm, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb63-790"><a href="#cb63-790" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb63-791"><a href="#cb63-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb63-792"><a href="#cb63-792" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb63-793"><a href="#cb63-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot_s[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-794"><a href="#cb63-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot_s[i,], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-795"><a href="#cb63-795" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb63-796"><a href="#cb63-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>,i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-797"><a href="#cb63-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span>mm) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>mm)</span>
<span id="cb63-798"><a href="#cb63-798" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-799"><a href="#cb63-799" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb63-800"><a href="#cb63-800" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb63-801"><a href="#cb63-801" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot_s))</span>
<span id="cb63-802"><a href="#cb63-802" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb63-803"><a href="#cb63-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>N_ts)[<span class="fu">abs</span>(Z_rot_s[,i])<span class="sc">&gt;</span>minZ],</span>
<span id="cb63-804"><a href="#cb63-804" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">as.vector</span>(Z_rot_s[<span class="fu">abs</span>(Z_rot_s[,i])<span class="sc">&gt;</span>minZ,i]),</span>
<span id="cb63-805"><a href="#cb63-805" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"h"</span>,</span>
<span id="cb63-806"><a href="#cb63-806" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm,</span>
<span id="cb63-807"><a href="#cb63-807" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, N_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb63-808"><a href="#cb63-808" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb63-809"><a href="#cb63-809" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot_s[j,i] <span class="sc">&gt;</span> minZ) {<span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb63-810"><a href="#cb63-810" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(Z_rot_s[j,i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {<span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">col =</span> clr[j])}</span>
<span id="cb63-811"><a href="#cb63-811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb63-812"><a href="#cb63-812" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb63-813"><a href="#cb63-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state with seasonality"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb63-814"><a href="#cb63-814" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-815"><a href="#cb63-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-816"><a href="#cb63-816" aria-hidden="true" tabindex="-1"></a><span class="do">## plot CCF's</span></span>
<span id="cb63-817"><a href="#cb63-817" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(proc_rot_s[<span class="dv">1</span>,],proc_rot_s[<span class="dv">2</span>,], <span class="at">lag.max =</span> <span class="dv">15</span>, <span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb63-818"><a href="#cb63-818" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"State 1 vs 2 with seasonality"</span>)</span>
<span id="cb63-819"><a href="#cb63-819" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-820"><a href="#cb63-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-821"><a href="#cb63-821" aria-hidden="true" tabindex="-1"></a>The factor loading seen in the model that is including seasonality seems</span>
<span id="cb63-822"><a href="#cb63-822" aria-hidden="true" tabindex="-1"></a>to explain the dynamics of the speices better than the model that did</span>
<span id="cb63-823"><a href="#cb63-823" aria-hidden="true" tabindex="-1"></a>not include seasonality, however, the sign of factor loading for</span>
<span id="cb63-824"><a href="#cb63-824" aria-hidden="true" tabindex="-1"></a>Epishura, our predator species, changed to become positive in the</span>
<span id="cb63-825"><a href="#cb63-825" aria-hidden="true" tabindex="-1"></a>seasonal model.</span>
<span id="cb63-826"><a href="#cb63-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-827"><a href="#cb63-827" aria-hidden="true" tabindex="-1"></a>Factor loadings: <span class="sc">\*</span> Pattern for primary producers and grazers is better</span>
<span id="cb63-828"><a href="#cb63-828" aria-hidden="true" tabindex="-1"></a>explained by state one <span class="sc">\*</span> Pattern for predator species is better</span>
<span id="cb63-829"><a href="#cb63-829" aria-hidden="true" tabindex="-1"></a>explained by state two</span>
<span id="cb63-830"><a href="#cb63-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-831"><a href="#cb63-831" aria-hidden="true" tabindex="-1"></a>CCF plot indicates that there is still some seasonal mechanism occurring</span>
<span id="cb63-832"><a href="#cb63-832" aria-hidden="true" tabindex="-1"></a>that our model is not capturing.</span>
<span id="cb63-833"><a href="#cb63-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-834"><a href="#cb63-834" aria-hidden="true" tabindex="-1"></a><span class="fu">### Additional Diagnostic</span></span>
<span id="cb63-835"><a href="#cb63-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-836"><a href="#cb63-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Seasonal Diagnostics, cache = TRUE}</span></span>
<span id="cb63-837"><a href="#cb63-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-838"><a href="#cb63-838" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(best_fit_s)  </span>
<span id="cb63-839"><a href="#cb63-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-840"><a href="#cb63-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-841"><a href="#cb63-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-842"><a href="#cb63-842" aria-hidden="true" tabindex="-1"></a>This model is fitting the species better overall compared to the</span>
<span id="cb63-843"><a href="#cb63-843" aria-hidden="true" tabindex="-1"></a>non-seaosnal model. Residuals and assumptions of normality look good</span>
<span id="cb63-844"><a href="#cb63-844" aria-hidden="true" tabindex="-1"></a>overall. Daphnia still show some seasonal pattern not being captured in</span>
<span id="cb63-845"><a href="#cb63-845" aria-hidden="true" tabindex="-1"></a>this model in the Cholesky residuals.</span>
<span id="cb63-846"><a href="#cb63-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-847"><a href="#cb63-847" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Fits</span></span>
<span id="cb63-848"><a href="#cb63-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-851"><a href="#cb63-851" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb63-852"><a href="#cb63-852" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb63-853"><a href="#cb63-853" aria-hidden="true" tabindex="-1"></a>N_ts <span class="ot">&lt;-</span> <span class="fu">dim</span>(plank_dat)[<span class="dv">1</span>]</span>
<span id="cb63-854"><a href="#cb63-854" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb63-855"><a href="#cb63-855" aria-hidden="true" tabindex="-1"></a><span class="do">## get model fits &amp; CI's</span></span>
<span id="cb63-856"><a href="#cb63-856" aria-hidden="true" tabindex="-1"></a>mod_fit_s <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(best_fit_s)</span>
<span id="cb63-857"><a href="#cb63-857" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the fits</span></span>
<span id="cb63-858"><a href="#cb63-858" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> plank_taxa</span>
<span id="cb63-859"><a href="#cb63-859" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(N_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb63-860"><a href="#cb63-860" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb63-861"><a href="#cb63-861" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_ts) {</span>
<span id="cb63-862"><a href="#cb63-862" aria-hidden="true" tabindex="-1"></a>    up <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>up[i, ]</span>
<span id="cb63-863"><a href="#cb63-863" aria-hidden="true" tabindex="-1"></a>    mn <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>ex[i, ]</span>
<span id="cb63-864"><a href="#cb63-864" aria-hidden="true" tabindex="-1"></a>    lo <span class="ot">&lt;-</span> mod_fit_s<span class="sc">$</span>lo[i, ]</span>
<span id="cb63-865"><a href="#cb63-865" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb63-866"><a href="#cb63-866" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb63-867"><a href="#cb63-867" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_frst <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plank_dat)[<span class="dv">2</span>])</span>
<span id="cb63-868"><a href="#cb63-868" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(w_ts, plank_dat[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb63-869"><a href="#cb63-869" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb63-870"><a href="#cb63-870" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb63-871"><a href="#cb63-871" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb63-872"><a href="#cb63-872" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-873"><a href="#cb63-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb63-874"><a href="#cb63-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-875"><a href="#cb63-875" aria-hidden="true" tabindex="-1"></a>Still not fitting other algae and daphina particularly well, but the</span>
<span id="cb63-876"><a href="#cb63-876" aria-hidden="true" tabindex="-1"></a>model is trying to follow the trends and most of the data are captured</span>
<span id="cb63-877"><a href="#cb63-877" aria-hidden="true" tabindex="-1"></a>within the confidence intervals. The confidence intervals are larger for</span>
<span id="cb63-878"><a href="#cb63-878" aria-hidden="true" tabindex="-1"></a>cyclops and epishura compared to the non-seasonal model and more of the</span>
<span id="cb63-879"><a href="#cb63-879" aria-hidden="true" tabindex="-1"></a>data are being captured.</span>
<span id="cb63-880"><a href="#cb63-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-881"><a href="#cb63-881" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb63-882"><a href="#cb63-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-883"><a href="#cb63-883" aria-hidden="true" tabindex="-1"></a>In this exercise our goal was to capturing the dynamics of predator and</span>
<span id="cb63-884"><a href="#cb63-884" aria-hidden="true" tabindex="-1"></a>prey species in Lake Washington in the late 70's and early 80's.</span>
<span id="cb63-885"><a href="#cb63-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-886"><a href="#cb63-886" aria-hidden="true" tabindex="-1"></a>Seasonal model (six month period) fit better and the factor loading</span>
<span id="cb63-887"><a href="#cb63-887" aria-hidden="true" tabindex="-1"></a>results showed more of a deviance between state one and state two for</span>
<span id="cb63-888"><a href="#cb63-888" aria-hidden="true" tabindex="-1"></a>primary producers and grazers, and predators.</span>
<span id="cb63-889"><a href="#cb63-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-890"><a href="#cb63-890" aria-hidden="true" tabindex="-1"></a>All three environmental covariates were included in the best fit model,</span>
<span id="cb63-891"><a href="#cb63-891" aria-hidden="true" tabindex="-1"></a>showing that they are explaning levels of variability for the selected</span>
<span id="cb63-892"><a href="#cb63-892" aria-hidden="true" tabindex="-1"></a>species in the selected time period.</span>
<span id="cb63-893"><a href="#cb63-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-894"><a href="#cb63-894" aria-hidden="true" tabindex="-1"></a>Epishura seem to have an offset from the other species. We're fitting</span>
<span id="cb63-895"><a href="#cb63-895" aria-hidden="true" tabindex="-1"></a>two independent states to five species, and while one state captured the</span>
<span id="cb63-896"><a href="#cb63-896" aria-hidden="true" tabindex="-1"></a>dynamics of grazers and primary producers relatively well, epishura was</span>
<span id="cb63-897"><a href="#cb63-897" aria-hidden="true" tabindex="-1"></a>not captured at all in this state, indicating independence between these</span>
<span id="cb63-898"><a href="#cb63-898" aria-hidden="true" tabindex="-1"></a>two groups of plankton in the time period analyzed.</span>
<span id="cb63-899"><a href="#cb63-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-900"><a href="#cb63-900" aria-hidden="true" tabindex="-1"></a>All three environmental covariates were included in the best fit model,</span>
<span id="cb63-901"><a href="#cb63-901" aria-hidden="true" tabindex="-1"></a>showing that they are explaning levels of variability for the selected</span>
<span id="cb63-902"><a href="#cb63-902" aria-hidden="true" tabindex="-1"></a>species in the selected time period.</span>
<span id="cb63-903"><a href="#cb63-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-904"><a href="#cb63-904" aria-hidden="true" tabindex="-1"></a><span class="fu"># Team contributions</span></span>
<span id="cb63-905"><a href="#cb63-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-906"><a href="#cb63-906" aria-hidden="true" tabindex="-1"></a>Madi set up plotting code for the entire time series for all species to</span>
<span id="cb63-907"><a href="#cb63-907" aria-hidden="true" tabindex="-1"></a>select species of interest in data rich periods.</span>
<span id="cb63-908"><a href="#cb63-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-909"><a href="#cb63-909" aria-hidden="true" tabindex="-1"></a>Eric wrote the majority of the model set up code and created functions</span>
<span id="cb63-910"><a href="#cb63-910" aria-hidden="true" tabindex="-1"></a>used for plotting.</span>
<span id="cb63-911"><a href="#cb63-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-912"><a href="#cb63-912" aria-hidden="true" tabindex="-1"></a>Maria took the code that Eric wrote, optimized it for our covariate</span>
<span id="cb63-913"><a href="#cb63-913" aria-hidden="true" tabindex="-1"></a>process, and helped with convergence issues, and set up the initial</span>
<span id="cb63-914"><a href="#cb63-914" aria-hidden="true" tabindex="-1"></a>model that included seasonal considerations.</span>
<span id="cb63-915"><a href="#cb63-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-916"><a href="#cb63-916" aria-hidden="true" tabindex="-1"></a>Madi took the Maria's code and edited to include seasonal considerations</span>
<span id="cb63-917"><a href="#cb63-917" aria-hidden="true" tabindex="-1"></a>for three periods, added commentary for diagnostics, and set-up the</span>
<span id="cb63-918"><a href="#cb63-918" aria-hidden="true" tabindex="-1"></a>Rmarkdown structure and coded the model matrices.</span>
<span id="cb63-919"><a href="#cb63-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-920"><a href="#cb63-920" aria-hidden="true" tabindex="-1"></a>All team members helped with defining the matrices for the selected</span>
<span id="cb63-921"><a href="#cb63-921" aria-hidden="true" tabindex="-1"></a>models, interpretation of results, and writing of the report.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>