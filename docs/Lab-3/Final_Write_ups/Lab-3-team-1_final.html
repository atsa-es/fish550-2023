<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liz Elmstrom, Dylan Hubl">
<meta name="dcterms.date" content="2023-04-20">

<title>Fish 550 Spring 2023 - 13&nbsp; Team 1 - Lab 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" rel="next">
<link href="../../Lab-3/Lab-3-DFA.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-3/Lab-3-DFA.html">Dynamic Factor Analysis</a></li><li class="breadcrumb-item"><a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#explore-the-data" id="toc-explore-the-data" class="nav-link" data-scroll-target="#explore-the-data">Explore the data</a></li>
  <li><a href="#wrangle-the-data" id="toc-wrangle-the-data" class="nav-link" data-scroll-target="#wrangle-the-data">Wrangle the data</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results-dfa-model-selection" id="toc-results-dfa-model-selection" class="nav-link" data-scroll-target="#results-dfa-model-selection">Results: DFA Model Selection</a>
  <ul class="collapse">
  <li><a href="#step-1--fit-global-model-with-all-covariates-and-number-of-trends" id="toc-step-1--fit-global-model-with-all-covariates-and-number-of-trends" class="nav-link" data-scroll-target="#step-1--fit-global-model-with-all-covariates-and-number-of-trends">Step 1- Fit global model with all covariates and number of trends</a></li>
  <li><a href="#step-2--testing-number-of-trends" id="toc-step-2--testing-number-of-trends" class="nav-link" data-scroll-target="#step-2--testing-number-of-trends">Step 2- Testing number of trends</a></li>
  <li><a href="#step-3--testing-covariates" id="toc-step-3--testing-covariates" class="nav-link" data-scroll-target="#step-3--testing-covariates">Step 3- Testing covariates</a></li>
  </ul></li>
  <li><a href="#results-trends-and-individual-loadings" id="toc-results-trends-and-individual-loadings" class="nav-link" data-scroll-target="#results-trends-and-individual-loadings">Results: Trends and individual loadings</a></li>
  <li><a href="#results-model-fits-and-uncertainty" id="toc-results-model-fits-and-uncertainty" class="nav-link" data-scroll-target="#results-model-fits-and-uncertainty">Results: Model fits and uncertainty</a></li>
  <li><a href="#results-covariate-effects" id="toc-results-covariate-effects" class="nav-link" data-scroll-target="#results-covariate-effects">Results: Covariate effects</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model diagnostics</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#team-contributions" id="toc-team-contributions" class="nav-link" data-scroll-target="#team-contributions">Team contributions</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-3/Final_Write_ups/Lab-3-team-1_final.Rmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-3/Final_Write_ups/Lab-3-team-1_final.Rmd" class="toc-action">View source</a></p><p><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Dynamic Factor Analysis (DFA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Liz Elmstrom, Dylan Hubl </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<hr>
<section id="data" class="level1">
<h1>Data</h1>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load MARSS for data and analyses</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ readr     2.1.4
✔ ggplot2   3.4.2     ✔ stringr   1.5.0
✔ lubridate 1.9.2     ✔ tibble    3.2.1
✔ purrr     1.0.1     ✔ tidyr     1.3.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rje)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rje'

The following object is masked from 'package:dplyr':

    last</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## load the raw data (there are 3 datasets contained here)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lakeWAplankton, <span class="at">package =</span> <span class="st">"MARSS"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">## we want `lakeWAplanktonTrans`, which has been transformed</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">## so the 0's are replaced with NA's and the data z-scored</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>all_dat <span class="ot">&lt;-</span> lakeWAplanktonTrans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="explore-the-data" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-data">Explore the data</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## add some code here</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"colnames: "</span>, <span class="fu">colnames</span>(all_dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>colnames:  Year Month Temp TP pH Cryptomonas Diatoms Greens Bluegreens Unicells Other.algae Conochilus Cyclops Daphnia Diaptomus Epischura Leptodora Neomysis Non.daphnid.cladocerans Non.colonial.rotifers </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Phytoplankton</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>phyto_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Cryptomonas<span class="sc">:</span>Other.algae)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phyto_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Phytoplankton raw data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/explore_data-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Zooplankton</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>zoop_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Conochilus<span class="sc">:</span>Non.colonial.rotifers)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(zoop_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Zooplankton raw data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/explore_data-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Covariates</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>covar_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Temp<span class="sc">:</span>pH)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covar_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Covariates raw data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/explore_data-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="wrangle-the-data" class="level2">
<h2 class="anchored" data-anchor-id="wrangle-the-data">Wrangle the data</h2>
<p>Filtering the data to our time period of study and 5 chosen plankton species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We want diatoms, greens, unicells, cyclops and non-colonial rotifers. </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#we only want 5 of them</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> all_dat[<span class="fu">c</span>(<span class="dv">61</span><span class="sc">:</span><span class="dv">300</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">13</span>,<span class="dv">20</span>)]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Year Month       Temp        TP         pH    Diatoms      Greens
[1,] 1967     1 -0.9300647 1.8037146 -1.0241232 -0.2864578 -2.77077679
[2,] 1967     2 -1.1301244 1.6293437 -0.6693782 -0.9151002  0.09534868
[3,] 1967     3 -1.1342661 1.6293437 -0.3414063 -2.2167309          NA
[4,] 1967     4 -0.9857066 1.6293437 -0.1040172 -0.1100186 -1.62921252
[5,] 1967     5 -0.2411849 0.7574888  1.1735112  0.7754370          NA
[6,] 1967     6  0.7365915 0.7574888 -0.2171154 -0.2759888 -1.35458206
       Unicells   Cyclops Non.colonial.rotifers
[1,]  0.6357878 0.2228985           -0.39091730
[2,] -1.4946785 0.2546807           -0.07539236
[3,]  1.2201857 0.1598178           -0.02939389
[4,]  1.1982743 0.4137745            0.22992133
[5,]  2.6486743 1.4749996            1.69012431
[6,]  2.5237387 1.1154504            1.12783270</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(crit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Year Month       Temp         TP         pH    Diatoms      Greens
[235,] 1986     7  0.9215860 -0.8132061  2.3417156 -0.2563166 -0.07735829
[236,] 1986     8  1.4007716 -0.8554426  1.1266581 -0.6560822 -0.15345669
[237,] 1986     9  1.4099781 -0.7072273  0.4675909 -1.0569831 -0.23231831
[238,] 1986    10  0.5589156 -0.7448914  0.2967332 -0.1063815  0.48256562
[239,] 1986    11  0.1772289 -0.5877832 -0.6689096 -0.3679750  0.45141391
[240,] 1986    12 -0.6282182 -0.3125677 -0.3859168 -0.3104313 -0.82175392
          Unicells    Cyclops Non.colonial.rotifers
[235,] -0.03314118  0.7906729            1.09618465
[236,]  0.24857182  0.6141811           -0.09935837
[237,]  0.15818110 -0.1779850           -0.99458951
[238,]  0.16527616  0.5148200            0.10722000
[239,] -0.13522061  0.4020599            0.93664816
[240,] -0.49252085 -0.6361853           -0.49973242</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plankton_ts <span class="ot">&lt;-</span> <span class="fu">t</span>(crit[,<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(plankton_ts) <span class="ot">&lt;-</span> crit[,<span class="dv">1</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#get the number of time series (y)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>n_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plankton_ts)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#get length of time series</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">ncol</span>(plankton_ts)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#find the mean of each time series and remove it</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">apply</span>(plankton_ts, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plankton_av <span class="ot">&lt;-</span> plankton_ts <span class="sc">-</span> y_bar</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>plankton_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(plankton_ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We are interested in examining how populations of Diatoms, Greens, Unicells, Cyclops, and Non-colonial-rotifers are associated with one another and environmental factors such as temperature, pH of the water, amount of phosphorus in the water, and season. We selected a window of years to include data from 1967 to 1986.</p>
<p>We standardized the observations of these populations by z scoring to allow the models to make better parameter estimates. We will z score the covariate data as well when we begin fitting models with covariates.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p><strong>Which plankton taxa did you choose and how did you choose them?</strong></p>
<p>We chose to examine time series of Diatoms, Greens, Unicells, Cyclops, and Non-colonial-rotifers. We chose these taxa based on available data and our previous knowledge of relationships between environmental covariates (specifically total phosphorus and pH) and phytoplankton. We additionally chose two zooplankton taxa to see if we observe any community interactions.</p>
<p><strong>What time period(s) did you examine and why?</strong></p>
<p>We selected a window of years to include data from 1967 to 1986. This gave us roughly twenty years of data to work with and excluded NAs from our covariate datasets.</p>
<p><strong>What environmental or dummy variables did you include and why?</strong></p>
<p>We chose to include total phosphorus, temperature, pH, and a dummy variable of season in our global DFA model. Given that these are monthly data, it is likely that they exhibit some sort of seasonal pattern. It is well known that nutrients, pH, and water temperature all drive plankton growth and community dynamics. After selecting a model design with the global covariate model, we then tested various combinations of covariates to determine the best model fit for the data using AIC.</p>
<p><strong>What forms of models did you fit (ie, write them out in matrix form)?</strong></p>
<p>We tested support for three options for the Z matrix: <span class="math display">\[
\begin{equation*}
\begin{array}{rcccc}
&amp;m = 1&amp;m = 2&amp;m=3\\
\hline
\begin{array}{r}\text{Diatoms}\\ \text{Greens} \\ \text{Unicells} \\ \text{Cyclopes} \\
\text{Rotifters} \end{array}&amp;
\begin{bmatrix}
z_{11} \\
z_{21}\\
z_{31}\\
z_{41}\\
z_{51}\\
\end{bmatrix}&amp;
\begin{bmatrix}
z_{11} &amp;  0 \\
z_{21} &amp; z_{22}\\
z_{31} &amp; z_{32}\\
z_{41} &amp;  z_{42}\\
z_{51} &amp;  z_{52}\\
\end{bmatrix}&amp;
\begin{bmatrix}
z_{11} &amp;  0 &amp;  0\\
z_{21} &amp; z_{22} &amp;  0\\
z_{31} &amp; z_{32} &amp; z_{33}\\
z_{41} &amp;  z_{42} &amp;  z_{43}\\
z_{51} &amp;  z_{52} &amp;  z_{53}\\
\end{bmatrix}&amp;
\end{array}
\end{equation*}
\]</span> Based on sample design, we assumed that R was diagonal and equal. In a DFA model, Q is set to identity. Because we z-scored our response variables and covariates, A is set to zero. Our global model is written in matrix form below.</p>
<p>Observation model: <span class="math display">\[
\begin{bmatrix}
y_1\\
y_2\\
y_3\\
y_4\\
y_5\\
\end{bmatrix}_t=
\begin{bmatrix}
z_{11} &amp;  0 &amp;  0\\
z_{21} &amp; z_{22} &amp;  0\\
z_{31} &amp; z_{32} &amp; z_{33}\\
z_{41} &amp;  z_{42} &amp;  z_{43}\\
z_{51} &amp;  z_{52} &amp;  z_{53}\\
\end{bmatrix}*
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_t+
\begin{bmatrix}
D_{1,TP}&amp;  D_{1,pH}&amp; D_{1,cos}&amp; D_{1,sin}\\
D_{2,TP}&amp; D_{2,pH}&amp; D_{2,cos}&amp; D_{2,sin}\\
D_{3,TP}&amp;  D_{3,pH}&amp;  D_{3,cos}&amp; D_{3,sin}\\
D_{4,TP}&amp;  D_{4,pH}&amp;  D_{4,cos}&amp; D_{4,sin}\\
D_{5,TP}&amp; D_{5,pH}&amp;  D_{5,cos}&amp; D_{5,sin}\\
\end{bmatrix}*
\begin{bmatrix}
d_{TP}\\
d_{pH}\\
d_{cos}\\
d_{sin}\\
\end{bmatrix}_t+
\begin{bmatrix}
w_1\\
w_2\\
w_3\\
w_4\\
w_5\\
\end{bmatrix}_t
\]</span> <span class="math display">\[
\text{Where }w_i \sim MVN
\begin{pmatrix}
\text{0,}\begin{bmatrix}
R&amp;0&amp;0&amp;0&amp;0\\
0&amp;R&amp;0&amp;0&amp;0\\
0&amp;0&amp;R&amp;0&amp;0\\
0&amp;0&amp;0&amp;R&amp;0\\
0&amp;0&amp;0&amp;0&amp;R\\
\end{bmatrix}
\end{pmatrix}
\]</span> Process model: <span class="math display">\[
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_t=
\begin{bmatrix}
1 &amp;  0 &amp;  0\\
0 &amp;  1 &amp;  0\\
0 &amp; 0 &amp; 1\\
\end{bmatrix}*
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_{t-1}+
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5\\
\end{bmatrix}_t
\]</span></p>
<p><span class="math display">\[
\text{Where }v_i \sim MVN
\begin{pmatrix}
\text{0,}\begin{bmatrix}
1&amp;0&amp;0\\
0&amp;1&amp;0\\
0&amp;0&amp;1\\
\end{bmatrix}
\end{pmatrix}
\]</span> We assessed data support for different combinations of covariates in the D matrix in Step 3 of our model selection process below.</p>
<p><strong>What sort of model diagnostics did you use to examine model assumptions?</strong></p>
<p>Finally, we assessed our model performance by examining our model residuals for normality and homogeneity, and examined any residual autocorrelation using ACF plots.</p>
</section>
<section id="results-dfa-model-selection" class="level1">
<h1>Results: DFA Model Selection</h1>
<section id="step-1--fit-global-model-with-all-covariates-and-number-of-trends" class="level2">
<h2 class="anchored" data-anchor-id="step-1--fit-global-model-with-all-covariates-and-number-of-trends">Step 1- Fit global model with all covariates and number of trends</h2>
<p>We are keeping R to diagonal and equal based on the sample design. The default DFA setting within MARSS sets up our Z matrix, A to scaling and Q to identity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set up observation model parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#covariates</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create a matrix for each of the covariates</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>covar_ts <span class="ot">&lt;-</span> <span class="fu">t</span>(crit[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(covar_ts) <span class="ot">&lt;-</span> crit[,<span class="dv">1</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>covar_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(covar_ts) <span class="do">## If we zscore the response, do we also zscore covariates? Mark says yes</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#make a season matrix</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>cos_t <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>sin_t <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>season <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos_t,sin_t)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>season_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(season)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#dim(season)</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(covar_z,season_z)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, we are not altering the upper D matrix, so every covariate will have its own effect</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#tell MARSS what values to use to start with</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>init_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, mm), mm, <span class="dv">1</span>))</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting latent trends to 3 and R to diagonal and equal</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>mod_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">m =</span> <span class="dv">3</span>, <span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">A =</span> <span class="st">"zero"</span>) <span class="co"># If we zscore, A goes to zero (Also prob the same for demean? Not sure.)</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Model iterations</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>cont_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>, <span class="at">allow.degen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit global modal, using the zscored plankton data, right now covariates are  Z-scored</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>dfa_global <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> mod_list, <span class="at">control =</span> cont_list, <span class="at">inits =</span> init_list, <span class="at">form =</span> <span class="st">"dfa"</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 79 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 79 iterations. 
Log-likelihood: -1367.454 
AIC: 2810.908   AICc: 2813.494   
 
                                Estimate
Z.11                              0.4056
Z.21                              0.0563
Z.31                              0.3196
Z.41                              0.4541
Z.51                              0.4155
Z.22                              0.3764
Z.32                             -0.0123
Z.42                              0.2088
Z.52                              0.0316
Z.33                             -0.2370
Z.43                              0.2553
Z.53                              0.1653
R.diag                            0.3524
D.(Diatoms,Temp)                 -0.4217
D.(Greens,Temp)                   0.2761
D.(Unicells,Temp)                -0.0653
D.(Cyclops,Temp)                 -0.2028
D.(Non.colonial.rotifers,Temp)    0.3153
D.(Diatoms,TP)                   -0.2247
D.(Greens,TP)                    -0.1410
D.(Unicells,TP)                   0.3185
D.(Cyclops,TP)                    0.1078
D.(Non.colonial.rotifers,TP)     -0.0368
D.(Diatoms,pH)                    0.0916
D.(Greens,pH)                    -0.0800
D.(Unicells,pH)                   0.1617
D.(Cyclops,pH)                    0.3197
D.(Non.colonial.rotifers,pH)      0.2296
D.(Diatoms,cos_t)                -0.4867
D.(Greens,cos_t)                 -0.2590
D.(Unicells,cos_t)               -0.4105
D.(Cyclops,cos_t)                -0.3552
D.(Non.colonial.rotifers,cos_t)  -0.2825
D.(Diatoms,sin_t)                 0.0468
D.(Greens,sin_t)                  0.0306
D.(Unicells,sin_t)               -0.3159
D.(Cyclops,sin_t)                -0.1844
D.(Non.colonial.rotifers,sin_t)   0.2182
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<p>The covariates including the season were zscored to ensure they each have a variance of 1. Which will help the model produce better estimates of the parameters.</p>
</section>
<section id="step-2--testing-number-of-trends" class="level2">
<h2 class="anchored" data-anchor-id="step-2--testing-number-of-trends">Step 2- Testing number of trends</h2>
<p>Fitting DFA model with global covariate set and testing for different latent trends.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Liz's original for loop</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mod_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">A =</span> <span class="st">"zero"</span>) <span class="co"># All other parameters are the default</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>m_list <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="co"># Latent trends to loop through</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>out.tab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m_list)){</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>m_list[[i]]), mod_list) <span class="do">## model list to loop through</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">=</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> fit.model, <span class="at">control =</span> cont_list, </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">m=</span>m_list[[i]],<span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      out.tab<span class="ot">=</span><span class="fu">rbind</span>(out.tab,out)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      fits<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 35 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 35 iterations. 
Log-likelihood: -1419.84 
AIC: 2901.68   AICc: 2903.401   
 
                                Estimate
Z.11                              0.3466
Z.21                              0.0781
Z.31                              0.3841
Z.41                              0.2699
Z.51                              0.2495
R.diag                            0.5419
D.(Diatoms,Temp)                 -0.3701
D.(Greens,Temp)                  -0.0276
D.(Unicells,Temp)                -0.0635
D.(Cyclops,Temp)                 -0.2525
D.(Non.colonial.rotifers,Temp)    0.4129
D.(Diatoms,TP)                   -0.2278
D.(Greens,TP)                    -0.0512
D.(Unicells,TP)                   0.2204
D.(Cyclops,TP)                    0.2389
D.(Non.colonial.rotifers,TP)      0.0299
D.(Diatoms,pH)                    0.0702
D.(Greens,pH)                     0.0223
D.(Unicells,pH)                   0.1253
D.(Cyclops,pH)                    0.3580
D.(Non.colonial.rotifers,pH)      0.2233
D.(Diatoms,cos_t)                -0.4779
D.(Greens,cos_t)                 -0.3593
D.(Unicells,cos_t)               -0.4065
D.(Cyclops,cos_t)                -0.3938
D.(Non.colonial.rotifers,cos_t)  -0.2619
D.(Diatoms,sin_t)                 0.0955
D.(Greens,sin_t)                 -0.2537
D.(Unicells,sin_t)               -0.2854
D.(Cyclops,sin_t)                -0.2693
D.(Non.colonial.rotifers,sin_t)   0.2873
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! abstol and log-log tests passed at 61 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 61 iterations. 
Log-likelihood: -1395.857 
AIC: 2861.715   AICc: 2863.908   
 
                                Estimate
Z.11                              0.3677
Z.21                              0.1645
Z.31                              0.3677
Z.41                              0.3725
Z.51                              0.3119
Z.22                              0.2722
Z.32                             -0.1107
Z.42                              0.2417
Z.52                              0.0629
R.diag                            0.4490
D.(Diatoms,Temp)                 -0.3750
D.(Greens,Temp)                   0.0882
D.(Unicells,Temp)                -0.1086
D.(Cyclops,Temp)                 -0.1445
D.(Non.colonial.rotifers,Temp)    0.4127
D.(Diatoms,TP)                   -0.2200
D.(Greens,TP)                    -0.1565
D.(Unicells,TP)                   0.2651
D.(Cyclops,TP)                    0.1665
D.(Non.colonial.rotifers,TP)      0.0160
D.(Diatoms,pH)                    0.0819
D.(Greens,pH)                    -0.0500
D.(Unicells,pH)                   0.1645
D.(Cyclops,pH)                    0.3159
D.(Non.colonial.rotifers,pH)      0.2224
D.(Diatoms,cos_t)                -0.4739
D.(Greens,cos_t)                 -0.3238
D.(Unicells,cos_t)               -0.4119
D.(Cyclops,cos_t)                -0.3493
D.(Non.colonial.rotifers,cos_t)  -0.2582
D.(Diatoms,sin_t)                 0.0874
D.(Greens,sin_t)                 -0.1248
D.(Unicells,sin_t)               -0.3404
D.(Cyclops,sin_t)                -0.1443
D.(Non.colonial.rotifers,sin_t)   0.2936
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! abstol and log-log tests passed at 79 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 79 iterations. 
Log-likelihood: -1367.454 
AIC: 2810.908   AICc: 2813.494   
 
                                Estimate
Z.11                              0.4056
Z.21                              0.0563
Z.31                              0.3196
Z.41                              0.4541
Z.51                              0.4155
Z.22                              0.3764
Z.32                             -0.0123
Z.42                              0.2088
Z.52                              0.0316
Z.33                             -0.2370
Z.43                              0.2553
Z.53                              0.1653
R.diag                            0.3524
D.(Diatoms,Temp)                 -0.4217
D.(Greens,Temp)                   0.2761
D.(Unicells,Temp)                -0.0653
D.(Cyclops,Temp)                 -0.2028
D.(Non.colonial.rotifers,Temp)    0.3153
D.(Diatoms,TP)                   -0.2247
D.(Greens,TP)                    -0.1410
D.(Unicells,TP)                   0.3185
D.(Cyclops,TP)                    0.1078
D.(Non.colonial.rotifers,TP)     -0.0368
D.(Diatoms,pH)                    0.0916
D.(Greens,pH)                    -0.0800
D.(Unicells,pH)                   0.1617
D.(Cyclops,pH)                    0.3197
D.(Non.colonial.rotifers,pH)      0.2296
D.(Diatoms,cos_t)                -0.4867
D.(Greens,cos_t)                 -0.2590
D.(Unicells,cos_t)               -0.4105
D.(Cyclops,cos_t)                -0.3552
D.(Non.colonial.rotifers,cos_t)  -0.2825
D.(Diatoms,sin_t)                 0.0468
D.(Greens,sin_t)                  0.0306
D.(Unicells,sin_t)               -0.3159
D.(Cyclops,sin_t)                -0.1844
D.(Non.colonial.rotifers,sin_t)   0.2182
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab<span class="sc">$</span>AICc)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> out.tab[min.AICc, ]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">cbind</span>(out.tab<span class="fl">.1</span>, <span class="at">delta.AICc =</span> out.tab<span class="fl">.1</span><span class="sc">$</span>AICc <span class="sc">-</span> out.tab<span class="fl">.1</span><span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  m    logLik     AICc num.param num.iter converged delta.AICc
3 3 -1367.454 2813.494        38       79      TRUE    0.00000
2 2 -1395.857 2863.908        35       61      TRUE   50.41369
1 1 -1419.840 2903.401        31       35      TRUE   89.90642</code></pre>
</div>
</div>
<p>In step 2, we used the global model and information criterion to test various numbers of latent states (m = 1-3). This resulted in a top model, as indicated by AICc scores, with three latent trends.</p>
<p>We can also alter the for loop to test for different R structures. We do this below as a general exercise to show how to loop through the stochastic or “random” effects of the DFA model as a part of model selection. However, considering our study design, we opt to consider only models with R equal to “diagonal and equal” moving forward.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for loop testing m and R adapted from the user manual</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>m_list <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="co"># Latent trends to loop through</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>R_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"diagonal and equal"</span>, <span class="st">"diagonal and unequal"</span>)<span class="co"># just testing two options for R, could be expanded to fit other structures</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#In this we loop use BFGS method to get all models to converge</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>cont_BFGS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>model.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (R <span class="cf">in</span> R_list) {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m_list)) {</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    dfa.model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> R, <span class="at">m =</span> m, <span class="at">A =</span> <span class="st">"zero"</span>) </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">=</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> dfa.model, <span class="at">control =</span> cont_BFGS, </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">form =</span> <span class="st">"dfa"</span>,<span class="at">method =</span> <span class="st">"BFGS"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  model.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.data, <span class="fu">data.frame</span>(<span class="at">R =</span> R, <span class="at">m =</span> m,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>                      fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 103 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 103 iterations. 
Log-likelihood: -1419.835 
AIC: 2901.671   AICc: 2903.391   
 
                                Estimate
Z.11                             -0.3455
Z.21                             -0.0774
Z.31                             -0.3833
Z.41                             -0.2675
Z.51                             -0.2475
R.diag                            0.5423
D.(Diatoms,Temp)                 -0.3667
D.(Greens,Temp)                  -0.0262
D.(Unicells,Temp)                -0.0605
D.(Cyclops,Temp)                 -0.2476
D.(Non.colonial.rotifers,Temp)    0.4169
D.(Diatoms,TP)                   -0.2190
D.(Greens,TP)                    -0.0492
D.(Unicells,TP)                   0.2303
D.(Cyclops,TP)                    0.2457
D.(Non.colonial.rotifers,TP)      0.0362
D.(Diatoms,pH)                    0.0704
D.(Greens,pH)                     0.0223
D.(Unicells,pH)                   0.1256
D.(Cyclops,pH)                    0.3580
D.(Non.colonial.rotifers,pH)      0.2234
D.(Diatoms,cos_t)                -0.4793
D.(Greens,cos_t)                 -0.3593
D.(Unicells,cos_t)               -0.4083
D.(Cyclops,cos_t)                -0.3940
D.(Non.colonial.rotifers,cos_t)  -0.2622
D.(Diatoms,sin_t)                 0.0965
D.(Greens,sin_t)                 -0.2530
D.(Unicells,sin_t)               -0.2849
D.(Cyclops,sin_t)                -0.2667
D.(Non.colonial.rotifers,sin_t)   0.2894
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 119 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 119 iterations. 
Log-likelihood: -1395.85 
AIC: 2861.7   AICc: 2863.893   
 
                                Estimate
Z.11                              0.3691
Z.21                              0.1680
Z.31                              0.3663
Z.41                              0.3759
Z.51                              0.3128
Z.22                              0.2666
Z.32                             -0.1135
Z.42                              0.2348
Z.52                              0.0581
R.diag                            0.4497
D.(Diatoms,Temp)                 -0.3721
D.(Greens,Temp)                   0.0869
D.(Unicells,Temp)                -0.1070
D.(Cyclops,Temp)                 -0.1449
D.(Non.colonial.rotifers,Temp)    0.4125
D.(Diatoms,TP)                   -0.2200
D.(Greens,TP)                    -0.1506
D.(Unicells,TP)                   0.2644
D.(Cyclops,TP)                    0.1724
D.(Non.colonial.rotifers,TP)      0.0186
D.(Diatoms,pH)                    0.0809
D.(Greens,pH)                    -0.0493
D.(Unicells,pH)                   0.1644
D.(Cyclops,pH)                    0.3165
D.(Non.colonial.rotifers,pH)      0.2228
D.(Diatoms,cos_t)                -0.4734
D.(Greens,cos_t)                 -0.3258
D.(Unicells,cos_t)               -0.4111
D.(Cyclops,cos_t)                -0.3511
D.(Non.colonial.rotifers,cos_t)  -0.2589
D.(Diatoms,sin_t)                 0.0900
D.(Greens,sin_t)                 -0.1273
D.(Unicells,sin_t)               -0.3390
D.(Cyclops,sin_t)                -0.1461
D.(Non.colonial.rotifers,sin_t)   0.2927
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 89 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 89 iterations. 
Log-likelihood: -1367.448 
AIC: 2810.895   AICc: 2813.481   
 
                                Estimate
Z.11                             -0.4072
Z.21                             -0.0590
Z.31                             -0.3172
Z.41                             -0.4581
Z.51                             -0.4173
Z.22                              0.3751
Z.32                             -0.0128
Z.42                              0.2048
Z.52                              0.0286
Z.33                              0.2379
Z.43                             -0.2497
Z.53                             -0.1602
R.diag                            0.3529
D.(Diatoms,Temp)                 -0.4167
D.(Greens,Temp)                   0.2777
D.(Unicells,Temp)                -0.0626
D.(Cyclops,Temp)                 -0.1978
D.(Non.colonial.rotifers,Temp)    0.3186
D.(Diatoms,TP)                   -0.2251
D.(Greens,TP)                    -0.1386
D.(Unicells,TP)                   0.3156
D.(Cyclops,TP)                    0.1147
D.(Non.colonial.rotifers,TP)     -0.0324
D.(Diatoms,pH)                    0.0909
D.(Greens,pH)                    -0.0800
D.(Unicells,pH)                   0.1614
D.(Cyclops,pH)                    0.3201
D.(Non.colonial.rotifers,pH)      0.2300
D.(Diatoms,cos_t)                -0.4848
D.(Greens,cos_t)                 -0.2589
D.(Unicells,cos_t)               -0.4085
D.(Cyclops,cos_t)                -0.3549
D.(Non.colonial.rotifers,cos_t)  -0.2822
D.(Diatoms,sin_t)                 0.0514
D.(Greens,sin_t)                  0.0316
D.(Unicells,sin_t)               -0.3128
D.(Cyclops,sin_t)                -0.1817
D.(Non.colonial.rotifers,sin_t)   0.2200
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 135 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 135 iterations. 
Log-likelihood: -1400.88 
AIC: 2871.76   AICc: 2873.954   
 
                                                Estimate
Z.11                                              0.4348
Z.21                                              0.0382
Z.31                                              0.3893
Z.41                                              0.2550
Z.51                                              0.2725
R.(Diatoms,Diatoms)                               0.3160
R.(Greens,Greens)                                 0.7945
R.(Unicells,Unicells)                             0.4907
R.(Cyclops,Cyclops)                               0.5918
R.(Non.colonial.rotifers,Non.colonial.rotifers)   0.4550
D.(Diatoms,Temp)                                 -0.4780
D.(Greens,Temp)                                   0.0192
D.(Unicells,Temp)                                -0.0681
D.(Cyclops,Temp)                                 -0.2322
D.(Non.colonial.rotifers,Temp)                    0.3869
D.(Diatoms,TP)                                   -0.1560
D.(Greens,TP)                                    -0.0455
D.(Unicells,TP)                                   0.2825
D.(Cyclops,TP)                                    0.2789
D.(Non.colonial.rotifers,TP)                      0.0736
D.(Diatoms,pH)                                    0.0976
D.(Greens,pH)                                     0.0182
D.(Unicells,pH)                                   0.1406
D.(Cyclops,pH)                                    0.3653
D.(Non.colonial.rotifers,pH)                      0.2359
D.(Diatoms,cos_t)                                -0.5309
D.(Greens,cos_t)                                 -0.3409
D.(Unicells,cos_t)                               -0.4160
D.(Cyclops,cos_t)                                -0.3911
D.(Non.colonial.rotifers,cos_t)                  -0.2791
D.(Diatoms,sin_t)                                -0.0162
D.(Greens,sin_t)                                 -0.2145
D.(Unicells,sin_t)                               -0.3062
D.(Cyclops,sin_t)                                -0.2634
D.(Non.colonial.rotifers,sin_t)                   0.2523
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 126 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 126 iterations. 
Log-likelihood: -1346.436 
AIC: 2770.873   AICc: 2773.598   
 
                                                 Estimate
Z.11                                             3.13e-01
Z.21                                             8.47e-02
Z.31                                             4.09e-01
Z.41                                             5.36e-01
Z.51                                             3.27e-01
Z.22                                             9.30e-02
Z.32                                            -1.83e-01
Z.42                                             5.78e-01
Z.52                                             2.04e-01
R.(Diatoms,Diatoms)                              4.66e-01
R.(Greens,Greens)                                7.79e-01
R.(Unicells,Unicells)                            2.67e-01
R.(Cyclops,Cyclops)                              1.67e-09
R.(Non.colonial.rotifers,Non.colonial.rotifers)  4.06e-01
D.(Diatoms,Temp)                                -2.39e-01
D.(Greens,Temp)                                  5.29e-02
D.(Unicells,Temp)                               -1.14e-01
D.(Cyclops,Temp)                                 2.27e-02
D.(Non.colonial.rotifers,Temp)                   5.69e-01
D.(Diatoms,TP)                                  -2.34e-01
D.(Greens,TP)                                   -1.02e-01
D.(Unicells,TP)                                  3.09e-01
D.(Cyclops,TP)                                  -6.25e-02
D.(Non.colonial.rotifers,TP)                    -7.91e-02
D.(Diatoms,pH)                                   7.21e-02
D.(Greens,pH)                                    2.71e-03
D.(Unicells,pH)                                  1.78e-01
D.(Cyclops,pH)                                   2.74e-01
D.(Non.colonial.rotifers,pH)                     1.95e-01
D.(Diatoms,cos_t)                               -4.12e-01
D.(Greens,cos_t)                                -3.19e-01
D.(Unicells,cos_t)                              -4.20e-01
D.(Cyclops,cos_t)                               -2.26e-01
D.(Non.colonial.rotifers,cos_t)                 -1.73e-01
D.(Diatoms,sin_t)                                2.06e-01
D.(Greens,sin_t)                                -1.74e-01
D.(Unicells,sin_t)                              -3.55e-01
D.(Cyclops,sin_t)                                4.50e-02
D.(Non.colonial.rotifers,sin_t)                  4.48e-01
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 109 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 109 iterations. 
Log-likelihood: -1335.486 
AIC: 2754.972   AICc: 2758.135   
 
                                                 Estimate
Z.11                                             4.22e-01
Z.21                                             2.24e-02
Z.31                                             3.73e-01
Z.41                                             3.75e-01
Z.51                                             2.94e-01
Z.22                                            -1.47e-01
Z.32                                            -3.34e-02
Z.42                                            -6.59e-01
Z.52                                            -2.55e-01
Z.33                                             2.09e-01
Z.43                                            -2.15e-01
Z.53                                            -6.14e-02
R.(Diatoms,Diatoms)                              2.92e-01
R.(Greens,Greens)                                7.59e-01
R.(Unicells,Unicells)                            2.81e-01
R.(Cyclops,Cyclops)                              4.17e-09
R.(Non.colonial.rotifers,Non.colonial.rotifers)  3.93e-01
D.(Diatoms,Temp)                                -3.54e-01
D.(Greens,Temp)                                  6.46e-02
D.(Unicells,Temp)                               -1.50e-01
D.(Cyclops,Temp)                                 1.96e-02
D.(Non.colonial.rotifers,Temp)                   5.33e-01
D.(Diatoms,TP)                                  -6.92e-02
D.(Greens,TP)                                   -1.56e-01
D.(Unicells,TP)                                  2.78e-01
D.(Cyclops,TP)                                  -6.26e-02
D.(Non.colonial.rotifers,TP)                    -3.73e-02
D.(Diatoms,pH)                                   1.31e-01
D.(Greens,pH)                                   -1.58e-02
D.(Unicells,pH)                                  1.57e-01
D.(Cyclops,pH)                                   2.75e-01
D.(Non.colonial.rotifers,pH)                     2.09e-01
D.(Diatoms,cos_t)                               -4.73e-01
D.(Greens,cos_t)                                -3.11e-01
D.(Unicells,cos_t)                              -4.42e-01
D.(Cyclops,cos_t)                               -2.27e-01
D.(Non.colonial.rotifers,cos_t)                 -1.93e-01
D.(Diatoms,sin_t)                                6.53e-02
D.(Greens,sin_t)                                -1.51e-01
D.(Unicells,sin_t)                              -3.78e-01
D.(Cyclops,sin_t)                                4.32e-02
D.(Non.colonial.rotifers,sin_t)                  4.06e-01
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model.data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>min.AICc_2 <span class="ot">&lt;-</span> <span class="fu">order</span>(model.data<span class="sc">$</span>AICc)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>model.data <span class="ot">&lt;-</span> model.data[min.AICc_2, ]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>model.data.delta <span class="ot">&lt;-</span> <span class="fu">cbind</span>(model.data, <span class="at">delta.AICc =</span> model.data<span class="sc">$</span>AICc <span class="sc">-</span> model.data<span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>model.data.delta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     R m fit.logLik     AICc num.param converged delta.AICc
6 diagonal and unequal 3  -1335.486 2758.135        42      TRUE    0.00000
5 diagonal and unequal 2  -1346.436 2773.598        39      TRUE   15.46298
3   diagonal and equal 3  -1367.448 2813.481        38      TRUE   55.34679
2   diagonal and equal 2  -1395.850 2863.893        35      TRUE  105.75822
4 diagonal and unequal 1  -1400.880 2873.954        35      TRUE  115.81903
1   diagonal and equal 1  -1419.835 2903.391        31      TRUE  145.25674</code></pre>
</div>
</div>
<p>Note - The Diagonal and unequal models do not converge using the default MARSS methods. Running the BFGS method allows all models to converge.</p>
<p>In this comparison, diagonal and unequal with 3 latent states is the top model. However, as mentioned above, this does not make sense for our study design, so moving forward we test different combinations of covariates with R = diagonal and equal and m = 3.</p>
</section>
<section id="step-3--testing-covariates" class="level2">
<h2 class="anchored" data-anchor-id="step-3--testing-covariates">Step 3- Testing covariates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use this to create every combo of rows in the covariate matrix possible</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTE: there is a saved .RDS table at the bottom that is the output of the loop</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#so you don't have to rerun (its a long time)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">powerSet</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure cos and sin are always together as season</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  combo[[i]] <span class="ot">&lt;-</span> <span class="fu">c</span>(combo[[i]],<span class="dv">5</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#d[combo[[1]],]  # [[1]] is empty so dont loop it</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>cont_BFGS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>model.cov.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">m =</span> <span class="dv">3</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A =</span> <span class="st">"zero"</span>), <span class="at">control =</span> cont_BFGS,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">method =</span> <span class="st">"BFGS"</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">covariates =</span> d[combo[[i]],])</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>   model.cov.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.cov.data,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">data.frame</span>(<span class="at">Covariates =</span>                       <span class="fu">toString</span>(<span class="fu">rownames</span>(d)[combo[[i]]]),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">LogLik =</span> fit2<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit2<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit2<span class="sc">$</span>num.params,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! Converged in 61 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 61 iterations. 
Log-likelihood: -1445.446 
AIC: 2926.892   AICc: 2927.479   
 
                        Estimate
Z.11                     0.57688
Z.21                     0.16464
Z.31                     0.33664
Z.41                     0.50783
Z.51                     0.54082
Z.22                    -0.30921
Z.32                     0.01914
Z.42                    -0.30163
Z.52                    -0.11538
Z.33                     0.21659
Z.43                    -0.02124
Z.53                     0.00108
R.diag                   0.41918
D.Diatoms               -0.13142
D.Greens                 0.38129
D.Unicells               0.33622
D.Cyclops                0.17779
D.Non.colonial.rotifers  0.33886
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 59 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 59 iterations. 
Log-likelihood: -1460.442 
AIC: 2956.884   AICc: 2957.47   
 
                        Estimate
Z.11                      0.5476
Z.21                      0.0432
Z.31                      0.3170
Z.41                      0.4714
Z.51                      0.5033
Z.22                     -0.4105
Z.32                     -0.1710
Z.42                     -0.3738
Z.52                     -0.2911
Z.33                     -0.2697
Z.43                      0.1313
Z.53                      0.0205
R.diag                    0.4023
D.Diatoms                -0.1833
D.Greens                 -0.5891
D.Unicells               -0.2483
D.Cyclops                -0.2036
D.Non.colonial.rotifers  -0.3840
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 74 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 74 iterations. 
Log-likelihood: -1409.915 
AIC: 2865.831   AICc: 2866.782   
 
                               Estimate
Z.11                            0.54025
Z.21                            0.13475
Z.31                            0.37336
Z.41                            0.54129
Z.51                            0.55720
Z.22                            0.36831
Z.32                           -0.00545
Z.42                            0.20153
Z.52                            0.02786
Z.33                           -0.23688
Z.43                            0.23139
Z.53                            0.15678
R.diag                          0.36316
D.(Diatoms,Temp)               -0.28240
D.(Greens,Temp)                 0.32594
D.(Unicells,Temp)               0.37906
D.(Cyclops,Temp)                0.13085
D.(Non.colonial.rotifers,Temp)  0.24924
D.(Diatoms,TP)                 -0.44062
D.(Greens,TP)                  -0.20733
D.(Unicells,TP)                 0.12353
D.(Cyclops,TP)                 -0.12863
D.(Non.colonial.rotifers,TP)   -0.25512
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 64 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 64 iterations. 
Log-likelihood: -1466.036 
AIC: 2968.072   AICc: 2968.658   
 
                        Estimate
Z.11                      0.4939
Z.21                      0.0329
Z.31                      0.2540
Z.41                      0.3516
Z.51                      0.3827
Z.22                     -0.4264
Z.32                     -0.1910
Z.42                     -0.3707
Z.52                     -0.2582
Z.33                      0.2671
Z.43                     -0.0481
Z.53                      0.0373
R.diag                    0.4338
D.Diatoms                 0.3036
D.Greens                  0.1978
D.Unicells                0.2527
D.Cyclops                 0.3469
D.Non.colonial.rotifers   0.4327
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 74 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 74 iterations. 
Log-likelihood: -1423.373 
AIC: 2892.745   AICc: 2893.696   
 
                               Estimate
Z.11                            0.48498
Z.21                            0.13761
Z.31                            0.31581
Z.41                            0.41506
Z.51                            0.42782
Z.22                            0.30994
Z.32                           -0.01125
Z.42                            0.30295
Z.52                            0.10575
Z.33                           -0.20714
Z.43                            0.00255
Z.53                           -0.01933
R.diag                          0.42379
D.(Diatoms,Temp)               -0.24182
D.(Greens,Temp)                 0.34760
D.(Unicells,Temp)               0.27868
D.(Cyclops,Temp)                0.07571
D.(Non.colonial.rotifers,Temp)  0.22448
D.(Diatoms,pH)                  0.36986
D.(Greens,pH)                   0.10739
D.(Unicells,pH)                 0.18328
D.(Cyclops,pH)                  0.33636
D.(Non.colonial.rotifers,pH)    0.38445
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 75 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 75 iterations. 
Log-likelihood: -1438.594 
AIC: 2923.188   AICc: 2924.139   
 
                             Estimate
Z.11                          0.49825
Z.21                          0.04300
Z.31                          0.26854
Z.41                          0.38208
Z.51                          0.40521
Z.22                          0.42581
Z.32                          0.15218
Z.42                          0.34660
Z.52                          0.25259
Z.33                          0.27229
Z.43                         -0.10659
Z.53                          0.00697
R.diag                        0.40365
D.(Diatoms,TP)               -0.01220
D.(Greens,TP)                -0.55287
D.(Unicells,TP)              -0.12258
D.(Cyclops,TP)                0.01611
D.(Non.colonial.rotifers,TP) -0.15889
D.(Diatoms,pH)                0.28987
D.(Greens,pH)                 0.05577
D.(Unicells,pH)               0.23641
D.(Cyclops,pH)                0.37197
D.(Non.colonial.rotifers,pH)  0.39398
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 90 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 90 iterations. 
Log-likelihood: -1389.371 
AIC: 2834.741   AICc: 2836.146   
 
                               Estimate
Z.11                            -0.4908
Z.21                            -0.1378
Z.31                            -0.3225
Z.41                            -0.4611
Z.51                            -0.4752
Z.22                            -0.3741
Z.32                             0.0155
Z.42                            -0.2022
Z.52                            -0.0258
Z.33                            -0.2452
Z.43                             0.2090
Z.53                             0.1381
R.diag                           0.3634
D.(Diatoms,Temp)                -0.3243
D.(Greens,Temp)                  0.3163
D.(Unicells,Temp)                0.3464
D.(Cyclops,Temp)                 0.0824
D.(Non.colonial.rotifers,Temp)   0.1998
D.(Diatoms,TP)                  -0.2975
D.(Greens,TP)                   -0.1970
D.(Unicells,TP)                  0.2284
D.(Cyclops,TP)                   0.0424
D.(Non.colonial.rotifers,TP)    -0.0764
D.(Diatoms,pH)                   0.2969
D.(Greens,pH)                    0.0392
D.(Unicells,pH)                  0.2308
D.(Cyclops,pH)                   0.3553
D.(Non.colonial.rotifers,pH)     0.3684
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 75 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 75 iterations. 
Log-likelihood: -1414.718 
AIC: 2875.437   AICc: 2876.388   
 
                                Estimate
Z.11                              0.4014
Z.21                              0.0917
Z.31                              0.3151
Z.41                              0.3889
Z.51                              0.3535
Z.22                             -0.2614
Z.32                              0.0142
Z.42                             -0.3551
Z.52                             -0.1423
Z.33                              0.1942
Z.43                              0.0179
Z.53                              0.0423
R.diag                            0.4330
D.(Diatoms,cos_t)                -0.4185
D.(Greens,cos_t)                 -0.3778
D.(Unicells,cos_t)               -0.3984
D.(Cyclops,cos_t)                -0.4592
D.(Non.colonial.rotifers,cos_t)  -0.6086
D.(Diatoms,sin_t)                 0.3571
D.(Greens,sin_t)                 -0.2360
D.(Unicells,sin_t)               -0.1746
D.(Cyclops,sin_t)                 0.0426
D.(Non.colonial.rotifers,sin_t)  -0.0416
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 86 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 86 iterations. 
Log-likelihood: -1410.615 
AIC: 2877.231   AICc: 2878.635   
 
                                Estimate
Z.11                             0.41516
Z.21                             0.07582
Z.31                             0.30578
Z.41                             0.40108
Z.51                             0.36052
Z.22                            -0.27469
Z.32                             0.00629
Z.42                            -0.36221
Z.52                            -0.14528
Z.33                            -0.20754
Z.43                             0.02215
Z.53                            -0.00321
R.diag                           0.42204
D.(Diatoms,Temp)                -0.38566
D.(Greens,Temp)                 -0.00220
D.(Unicells,Temp)               -0.08932
D.(Cyclops,Temp)                -0.02497
D.(Non.colonial.rotifers,Temp)   0.46058
D.(Diatoms,cos_t)               -0.60103
D.(Greens,cos_t)                -0.37894
D.(Unicells,cos_t)              -0.44118
D.(Cyclops,cos_t)               -0.47140
D.(Non.colonial.rotifers,cos_t) -0.39069
D.(Diatoms,sin_t)                0.02698
D.(Greens,sin_t)                -0.23800
D.(Unicells,sin_t)              -0.25121
D.(Cyclops,sin_t)                0.02170
D.(Non.colonial.rotifers,sin_t)  0.35275
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 90 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 90 iterations. 
Log-likelihood: -1383.561 
AIC: 2823.121   AICc: 2824.526   
 
                                 Estimate
Z.11                            -0.389709
Z.21                            -0.052707
Z.31                            -0.332116
Z.41                            -0.475882
Z.51                            -0.437379
Z.22                             0.350220
Z.32                             0.000979
Z.42                             0.193241
Z.52                             0.014798
Z.33                             0.216936
Z.43                            -0.278855
Z.53                            -0.172286
R.diag                           0.366800
D.(Diatoms,TP)                  -0.261663
D.(Greens,TP)                   -0.118546
D.(Unicells,TP)                  0.277579
D.(Cyclops,TP)                   0.018855
D.(Non.colonial.rotifers,TP)    -0.079289
D.(Diatoms,cos_t)               -0.341024
D.(Greens,cos_t)                -0.339710
D.(Unicells,cos_t)              -0.482904
D.(Cyclops,cos_t)               -0.461907
D.(Non.colonial.rotifers,cos_t) -0.584040
D.(Diatoms,sin_t)                0.421494
D.(Greens,sin_t)                -0.214410
D.(Unicells,sin_t)              -0.240577
D.(Cyclops,sin_t)                0.028659
D.(Non.colonial.rotifers,sin_t) -0.028721
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 103 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 103 iterations. 
Log-likelihood: -1378.866 
AIC: 2823.732   AICc: 2825.682   
 
                                Estimate
Z.11                             0.40084
Z.21                             0.04342
Z.31                             0.33358
Z.41                             0.47782
Z.51                             0.42502
Z.22                            -0.36360
Z.32                            -0.00267
Z.42                            -0.20386
Z.52                            -0.02836
Z.33                            -0.21961
Z.43                             0.28550
Z.53                             0.17815
R.diag                           0.35955
D.(Diatoms,Temp)                -0.34785
D.(Greens,Temp)                  0.27252
D.(Unicells,Temp)               -0.03706
D.(Cyclops,Temp)                -0.14369
D.(Non.colonial.rotifers,Temp)   0.38272
D.(Diatoms,TP)                  -0.24966
D.(Greens,TP)                   -0.12312
D.(Unicells,TP)                  0.27956
D.(Cyclops,TP)                   0.02549
D.(Non.colonial.rotifers,TP)    -0.09396
D.(Diatoms,cos_t)               -0.50969
D.(Greens,cos_t)                -0.20931
D.(Unicells,cos_t)              -0.50108
D.(Cyclops,cos_t)               -0.53192
D.(Non.colonial.rotifers,cos_t) -0.39807
D.(Diatoms,sin_t)                0.12139
D.(Greens,sin_t)                 0.01913
D.(Unicells,sin_t)              -0.27269
D.(Cyclops,sin_t)               -0.09597
D.(Non.colonial.rotifers,sin_t)  0.30284
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 90 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 90 iterations. 
Log-likelihood: -1406.542 
AIC: 2869.085   AICc: 2870.49   
 
                                 Estimate
Z.11                             0.391037
Z.21                             0.102275
Z.31                             0.324674
Z.41                             0.359772
Z.51                             0.330872
Z.22                            -0.279651
Z.32                             0.020142
Z.42                            -0.329081
Z.52                            -0.119438
Z.33                             0.187353
Z.43                             0.047781
Z.53                             0.061893
R.diag                           0.431253
D.(Diatoms,pH)                   0.136754
D.(Greens,pH)                   -0.000672
D.(Unicells,pH)                  0.128661
D.(Cyclops,pH)                   0.274464
D.(Non.colonial.rotifers,pH)     0.220224
D.(Diatoms,cos_t)               -0.320803
D.(Greens,cos_t)                -0.378084
D.(Unicells,cos_t)              -0.306010
D.(Cyclops,cos_t)               -0.262361
D.(Non.colonial.rotifers,cos_t) -0.450440
D.(Diatoms,sin_t)                0.348390
D.(Greens,sin_t)                -0.236357
D.(Unicells,sin_t)              -0.182891
D.(Cyclops,sin_t)                0.025616
D.(Non.colonial.rotifers,sin_t) -0.055935
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 77 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 77 iterations. 
Log-likelihood: -1402.502 
AIC: 2871.004   AICc: 2872.954   
 
                                Estimate
Z.11                             0.40804
Z.21                             0.08794
Z.31                             0.31313
Z.41                             0.37245
Z.51                             0.33718
Z.22                             0.28954
Z.32                            -0.01655
Z.42                             0.34160
Z.52                             0.12744
Z.33                             0.20110
Z.43                             0.01431
Z.53                             0.02707
R.diag                           0.42091
D.(Diatoms,Temp)                -0.43264
D.(Greens,Temp)                 -0.01644
D.(Unicells,Temp)               -0.15796
D.(Cyclops,Temp)                -0.08453
D.(Non.colonial.rotifers,Temp)   0.40804
D.(Diatoms,pH)                   0.14542
D.(Greens,pH)                    0.00279
D.(Unicells,pH)                  0.12514
D.(Cyclops,pH)                   0.27288
D.(Non.colonial.rotifers,pH)     0.22265
D.(Diatoms,cos_t)               -0.51926
D.(Greens,cos_t)                -0.38361
D.(Unicells,cos_t)              -0.38349
D.(Cyclops,cos_t)               -0.30378
D.(Non.colonial.rotifers,cos_t) -0.25567
D.(Diatoms,sin_t)               -0.02223
D.(Greens,sin_t)                -0.25052
D.(Unicells,sin_t)              -0.31800
D.(Cyclops,sin_t)               -0.04576
D.(Non.colonial.rotifers,sin_t)  0.29416
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 106 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 106 iterations. 
Log-likelihood: -1372.372 
AIC: 2810.744   AICc: 2812.694   
 
                                Estimate
Z.11                             -0.3947
Z.21                             -0.0690
Z.31                             -0.3168
Z.41                             -0.4553
Z.51                             -0.4300
Z.22                              0.3605
Z.32                             -0.0142
Z.42                              0.1953
Z.52                              0.0159
Z.33                             -0.2340
Z.43                              0.2444
Z.53                              0.1567
R.diag                            0.3603
D.(Diatoms,TP)                   -0.2350
D.(Greens,TP)                    -0.1339
D.(Unicells,TP)                   0.3161
D.(Cyclops,TP)                    0.1108
D.(Non.colonial.rotifers,TP)     -0.0155
D.(Diatoms,pH)                    0.0887
D.(Greens,pH)                    -0.0769
D.(Unicells,pH)                   0.1593
D.(Cyclops,pH)                    0.3203
D.(Non.colonial.rotifers,pH)      0.2289
D.(Diatoms,cos_t)                -0.2858
D.(Greens,cos_t)                 -0.3896
D.(Unicells,cos_t)               -0.3804
D.(Cyclops,cos_t)                -0.2598
D.(Non.colonial.rotifers,cos_t)  -0.4392
D.(Diatoms,sin_t)                 0.4096
D.(Greens,sin_t)                 -0.2067
D.(Unicells,sin_t)               -0.2596
D.(Cyclops,sin_t)                -0.0118
D.(Non.colonial.rotifers,sin_t)  -0.0575
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Success! Converged in 89 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 89 iterations. 
Log-likelihood: -1367.448 
AIC: 2810.895   AICc: 2813.481   
 
                                Estimate
Z.11                             -0.4072
Z.21                             -0.0590
Z.31                             -0.3172
Z.41                             -0.4581
Z.51                             -0.4173
Z.22                              0.3751
Z.32                             -0.0128
Z.42                              0.2048
Z.52                              0.0286
Z.33                              0.2379
Z.43                             -0.2497
Z.53                             -0.1602
R.diag                            0.3529
D.(Diatoms,Temp)                 -0.4167
D.(Greens,Temp)                   0.2777
D.(Unicells,Temp)                -0.0626
D.(Cyclops,Temp)                 -0.1978
D.(Non.colonial.rotifers,Temp)    0.3186
D.(Diatoms,TP)                   -0.2251
D.(Greens,TP)                    -0.1386
D.(Unicells,TP)                   0.3156
D.(Cyclops,TP)                    0.1147
D.(Non.colonial.rotifers,TP)     -0.0324
D.(Diatoms,pH)                    0.0909
D.(Greens,pH)                    -0.0800
D.(Unicells,pH)                   0.1614
D.(Cyclops,pH)                    0.3201
D.(Non.colonial.rotifers,pH)      0.2300
D.(Diatoms,cos_t)                -0.4848
D.(Greens,cos_t)                 -0.2589
D.(Unicells,cos_t)               -0.4085
D.(Cyclops,cos_t)                -0.3549
D.(Non.colonial.rotifers,cos_t)  -0.2822
D.(Diatoms,sin_t)                 0.0514
D.(Greens,sin_t)                  0.0316
D.(Unicells,sin_t)               -0.3128
D.(Cyclops,sin_t)                -0.1817
D.(Non.colonial.rotifers,sin_t)   0.2200
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model.cov.data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>min.AICc_3 <span class="ot">&lt;-</span> <span class="fu">order</span>(model.cov.data<span class="sc">$</span>AICc)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>model.cov.data <span class="ot">&lt;-</span> model.cov.data[min.AICc_3, ]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>covariate.table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(model.cov.data, <span class="at">delta.AICc =</span> model.cov.data<span class="sc">$</span>AICc <span class="sc">-</span> model.cov.data<span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#covariate.table</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>covariate.table<span class="sc">$</span>Covariates <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(covariate.table<span class="sc">$</span>Covariates, <span class="st">"cos_t, sin_t"</span>, <span class="st">"Season"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>covariate.table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             Covariates    LogLik     AICc num.param  delta.AICc
14       TP, pH, Season -1372.372 2812.694        33   0.0000000
15 Temp, TP, pH, Season -1367.448 2813.481        38   0.7875146
10           TP, Season -1383.561 2824.526        28  11.8322748
11     Temp, TP, Season -1378.866 2825.682        33  12.9878781
7          Temp, TP, pH -1389.371 2836.146        28  23.4524059
3              Temp, TP -1409.915 2866.782        23  54.0878741
12           pH, Season -1406.542 2870.490        28  57.7956978
13     Temp, pH, Season -1402.502 2872.954        33  60.2600159
8                Season -1414.718 2876.388        23  63.6938481
9          Temp, Season -1410.615 2878.635        28  65.9414605
5              Temp, pH -1423.373 2893.696        23  81.0022078
6                TP, pH -1438.594 2924.139        23 111.4453420
1                  Temp -1445.446 2927.479        18 114.7849628
2                    TP -1460.442 2957.470        18 144.7765617
4                    pH -1466.036 2968.658        18 155.9645606</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#this will save our table that is generated so the whole thing doesn't need to</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#be re-run in the future (i hope)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(covariate.table, "covariate_table.rds")</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#table &lt;- readRDS("covariate_table.rds")</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We used the BFGS method to estimate the parameters for the best model as running the models without this method 1) took a very long time and 2) resulted in a lot of models failing to converge.</p>
<p>To select the covariate combination that resulted in a model that fit the data the best, we held the R matrix at “diagonal and equal” and the number of latent states at three. Previously, we found these to be the best options when testing the global covariate model.</p>
<p>We see that of the 15 combinations of Temperature, Total Phosphorus (TP), pH, and Season that the top model used <em>TP, pH and Season</em> as covariates. The second top model, based on AICc, was close but with fewer parameters we would expect it to be closer to 10 AICc points away if the models were equivalent.</p>
<p>Thus, our top model has an R matrix that is diagonal and equal, three latent states, and uses TP, pH and Season as its covariates. The observation model and process model are written in matrix form below.</p>
<p>Observation model: <span class="math display">\[
\begin{bmatrix}
y_1\\
y_2\\
y_3\\
y_4\\
y_5\\
\end{bmatrix}_t=
\begin{bmatrix}
0.394 &amp;  0.000 &amp;  0.000\\
0.068 &amp;  0.361 &amp;  0.000\\
0.317 &amp; -0.014 &amp; -0.233\\
0.453 &amp;  0.196 &amp;  0.246\\
0.429 &amp;  0.017 &amp;  0.158\\
\end{bmatrix}*
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_t+
\begin{bmatrix}
-0.234&amp;  0.088&amp; -0.285&amp; 0.409\\
-0.134&amp; -0.076&amp; -0.389&amp; -0.206\\
0.317&amp;  0.159&amp;  -0.381&amp; -0.259\\
0.108&amp;  0.320&amp;  -0.259&amp; -0.011\\
-0.017&amp; 0.228&amp;  -0.439&amp; -0.056\\
\end{bmatrix}*
\begin{bmatrix}
d_{TP}\\
d_{pH}\\
d_{cos}\\
d_{sin}\\
\end{bmatrix}_t+
\begin{bmatrix}
w_1\\
w_2\\
w_3\\
w_4\\
w_5\\
\end{bmatrix}_t
\]</span> <span class="math display">\[
\text{Where }w_i \sim MVN
\begin{pmatrix}
\text{0,}\begin{bmatrix}
R&amp;0&amp;0&amp;0&amp;0\\
0&amp;R&amp;0&amp;0&amp;0\\
0&amp;0&amp;R&amp;0&amp;0\\
0&amp;0&amp;0&amp;R&amp;0\\
0&amp;0&amp;0&amp;0&amp;R\\
\end{bmatrix}
\end{pmatrix}
\]</span> Process model: <span class="math display">\[
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_t=
\begin{bmatrix}
1 &amp;  0 &amp;  0\\
0 &amp;  1 &amp;  0\\
0 &amp; 0 &amp; 1\\
\end{bmatrix}*
\begin{bmatrix}
x_1\\
x_2\\
x_3\\
\end{bmatrix}_{t-1}+
\begin{bmatrix}
v_1\\
v_2\\
v_3\\
v_4\\
v_5\\
\end{bmatrix}_t
\]</span></p>
<p><span class="math display">\[
\text{Where }v_i \sim MVN
\begin{pmatrix}
\text{0,}\begin{bmatrix}
1&amp;0&amp;0\\
0&amp;1&amp;0\\
0&amp;0&amp;1\\
\end{bmatrix}
\end{pmatrix}
\]</span></p>
</section>
</section>
<section id="results-trends-and-individual-loadings" class="level1">
<h1>Results: Trends and individual loadings</h1>
<p>Now we can look at our top model which has Total Phosporus, pH, and season as covariates with an R matrix set to “diagonal and equal” and three latent states.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create an object of the top model</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>top.mod <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">m =</span> <span class="dv">3</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A =</span> <span class="st">"zero"</span>), <span class="at">control =</span> cont_BFGS,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">covariates =</span> d[combo[[<span class="dv">15</span>]],])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 105 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 105 iterations. 
Log-likelihood: -1372.373 
AIC: 2810.746   AICc: 2812.696   
 
                                Estimate
Z.11                              0.3941
Z.21                              0.0681
Z.31                              0.3177
Z.41                              0.4539
Z.51                              0.4294
Z.22                              0.3611
Z.32                             -0.0142
Z.42                              0.1969
Z.52                              0.0173
Z.33                             -0.2337
Z.43                              0.2465
Z.53                              0.1587
R.diag                            0.3601
D.(Diatoms,TP)                   -0.2347
D.(Greens,TP)                    -0.1347
D.(Unicells,TP)                   0.3172
D.(Cyclops,TP)                    0.1085
D.(Non.colonial.rotifers,TP)     -0.0170
D.(Diatoms,pH)                    0.0887
D.(Greens,pH)                    -0.0770
D.(Unicells,pH)                   0.1591
D.(Cyclops,pH)                    0.3200
D.(Non.colonial.rotifers,pH)      0.2286
D.(Diatoms,cos_t)                -0.2859
D.(Greens,cos_t)                 -0.3895
D.(Unicells,cos_t)               -0.3810
D.(Cyclops,cos_t)                -0.2594
D.(Non.colonial.rotifers,cos_t)  -0.4391
D.(Diatoms,sin_t)                 0.4096
D.(Greens,sin_t)                 -0.2066
D.(Unicells,sin_t)               -0.2598
D.(Cyclops,sin_t)                -0.0111
D.(Non.colonial.rotifers,sin_t)  -0.0570
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot to states and loadings of top model</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Z_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est)<span class="sc">$</span>rotmat</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate factor loadings</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>Z_rot <span class="ot">=</span> Z_est <span class="sc">%*%</span> H_inv</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>proc_rot <span class="ot">=</span> <span class="fu">solve</span>(H_inv) <span class="sc">%*%</span> top.mod<span class="sc">$</span>states</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#info needed for plotting for loops</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>yr_start <span class="ot">&lt;-</span> <span class="dv">1967</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), mm, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the latent processes</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>mm) {</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot[i, ]))</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts, proc_rot[i, ], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">ylim =</span> ylm, </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i, ], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i, ], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot))</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>mm) {</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n_ts)[<span class="fu">abs</span>(Z_rot[, i]) <span class="sc">&gt;</span> minZ], <span class="fu">as.vector</span>(Z_rot[<span class="fu">abs</span>(Z_rot[, </span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>                                                                    i]) <span class="sc">&gt;</span> minZ, i]), <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, </span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, n_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_ts) {</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Z_rot[j, i] <span class="sc">&gt;</span> minZ) {</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, </span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> clr[j])</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Z_rot[j, i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, </span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> clr[j])</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display Z matrix</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                              X1          X2         X3
Diatoms               0.39411803  0.00000000  0.0000000
Greens                0.06814876  0.36106328  0.0000000
Unicells              0.31769414 -0.01422278 -0.2336810
Cyclops               0.45385559  0.19692605  0.2464826
Non.colonial.rotifers 0.42940337  0.01725603  0.1587398</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#display rotated z matrix that loadings come from</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>Z_rot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            [,1]       [,2]        [,3]
Diatoms               0.30727963 0.01665433 -0.24623340
Greens                0.05796389 0.36263188 -0.01221661
Unicells              0.10120721 0.01652711 -0.38108083
Cyclops               0.51080126 0.19716996 -0.07566039
Non.colonial.rotifers 0.43440106 0.02360494 -0.14360315</code></pre>
</div>
</div>
<p>The plots show the loadings, or the weights, for each of the latent states. The loadings in the plots do not match with the values in the z matrix above because they must be rotated using the varimax function to produce the loading values we see plotted. Thus, the second table’s values match with the loadings plot</p>
</section>
<section id="results-model-fits-and-uncertainty" class="level1">
<h1>Results: Model fits and uncertainty</h1>
<p>The DFA fitting function comes from the lab notebook</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#this function was taken from the lab book</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#get model fits </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>get_DFA_fits <span class="ot">&lt;-</span> <span class="cf">function</span>(MLEobj, <span class="at">dd =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## empty list for results</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extra stuff for var() calcs</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  Ey <span class="ot">&lt;-</span> MARSS<span class="sc">:::</span><span class="fu">MARSShatyt</span>(MLEobj)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model params</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  ZZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## number of obs ts</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">1</span>]</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## number of time steps</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">2</span>]</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(ZZ)<span class="sc">$</span>rotmat</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## check for covars</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dd)) {</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    DD <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model expectation</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states <span class="sc">+</span> DD <span class="sc">%*%</span> dd</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model expectation</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Var in model fits</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  VtT <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(MLEobj)<span class="sc">$</span>VtT</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  VV <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tt <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    RZVZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>R <span class="sc">-</span> ZZ <span class="sc">%*%</span> VtT[, </span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>                                                         , tt] <span class="sc">%*%</span> <span class="fu">t</span>(ZZ)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    SS <span class="ot">&lt;-</span> Ey<span class="sc">$</span>yxtT[, , tt] <span class="sc">-</span> Ey<span class="sc">$</span>ytT[, tt, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(MLEobj<span class="sc">$</span>states[, tt, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    VV <span class="ot">&lt;-</span> <span class="fu">cbind</span>(VV, <span class="fu">diag</span>(RZVZ <span class="sc">+</span> SS <span class="sc">%*%</span> <span class="fu">t</span>(ZZ) <span class="sc">+</span> ZZ <span class="sc">%*%</span> <span class="fu">t</span>(SS)))</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(VV)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="do">## upper &amp; lower (1-alpha)% CI</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>  fits<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  fits<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fits)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plotting the model fits.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get model fit</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>top.fit <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(top.mod, <span class="at">dd =</span> d[combo[[<span class="dv">15</span>]],])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the fit of the top model</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>yr_start <span class="ot">&lt;-</span> <span class="dv">1967</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the fit</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(n_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>                                                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_ts) {</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  up <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>up[i, ]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  mn <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>ex[i, ]</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  lo <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>lo[i, ]</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(w_ts, plankton_z[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The model fits look okay, but are not perfect for all time steps in some of the taxa (e.g., Diatoms, cylops, rotifers). This is probably because the plankton aren’t perfectly synchronized through time and the three latent trends can’t describe all of the variation across the five time series.</p>
</section>
<section id="results-covariate-effects" class="level1">
<h1>Results: Covariate effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(top.mod<span class="sc">$</span>coef[<span class="dv">14</span><span class="sc">:</span><span class="dv">33</span>])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coef)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"effect"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>coef<span class="sc">$</span>covariate <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"TP"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"pH"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"cos_t"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"sin_t"</span>, <span class="dv">5</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>coef<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Diatoms'</span>, <span class="st">'Greens'</span>, <span class="st">'Unicells'</span>, <span class="st">'Cyclops'</span>, <span class="st">'Rotifers'</span>), <span class="dv">4</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>effect_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(plot_object){</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_object, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> species, <span class="at">x =</span> effect, <span class="at">col =</span> species))<span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"TP"</span>),] <span class="sc">%&gt;%</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>pH <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"pH"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>cos <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"cos_t"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>sin <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"sin_t"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ggarrange</span>(TP<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"TP"</span>),</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>                pH<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"pH"</span>),</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>                cos<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"cosine"</span>),</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>                sin<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"sine"</span>),</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>D_mat <span class="ot">&lt;-</span> <span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(D_mat) <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"TP"</span>,<span class="st">"pH"</span>,<span class="st">"cosine"</span>,<span class="st">"sine"</span>) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>D_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                               TP          pH     cosine        sine
Diatoms               -0.23472003  0.08873555 -0.2858967  0.40961351
Greens                -0.13469895 -0.07696061 -0.3894505 -0.20656771
Unicells               0.31724030  0.15908385 -0.3810432 -0.25977833
Cyclops                0.10848838  0.32000977 -0.2594154 -0.01112088
Non.colonial.rotifers -0.01700413  0.22860445 -0.4390693 -0.05695519</code></pre>
</div>
</div>
<p>TP has a negative effect on diatoms and green algae, a positive effect on unicells and cylops, and no effect on rotifers. The effect of TP on diatoms and unicells tracks on with the literature– increased P has been shown to increase the growth of bluegreen algae and dinoflagellates (unicells), decreasing the competitive availability of diatoms. Although not included in our analyses, we can see by looking at the raw data that during times of high phosphorus, cyanobacteria (bluegreen algae) bloomed. This likely influenced diatom and green algae populations through competitive exclusion processes.</p>
<p>pH largely has a positive effect on all species of study, with the acceptance of green algal species. This suggests that greens do better under more acidic conditions (more carbon), whereas others are better suited to low CO2 (less acidic) levels.</p>
<p>Our seasonality dummy variables (cosine and sine) represent winter (cosine) and springtime (sine) periods. During winter months when the curve is high, the effect of season on algal species is negative. The springtime curve has a negative effect on unicells, rotifers, and greens, a strong postive effect on diatoms, and no effect on cylops. This makes sense considering that spring algae blooms are generally dominated by diatoms.</p>
</section>
<section id="model-diagnostics" class="level1">
<h1>Model diagnostics</h1>
<p>Below we check our model residuals and plot the acfs.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">MARSSresiduals</span>(top.mod, <span class="at">type =</span> <span class="st">"tt1"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(resids<span class="sc">$</span>model.residuals[i, ], <span class="at">ylab =</span> <span class="st">"model residuals"</span>, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="fu">rownames</span>(plankton_z)[i])</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(top.mod, <span class="at">plot.type =</span> <span class="st">"qqplot.std.model.resids.ytt1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot type = qqplot.std.model.resids.ytt1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(top.mod, <span class="at">plot.type =</span> <span class="st">"acf.std.model.resids.ytt1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lab-3-team-1_final_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>plot type = acf.std.model.resids.ytt1</code></pre>
</div>
</div>
<p>For the most part our model residuals look okay, with some potential residual pattern remaining in our Diatoms, Unicells, and Cyclops time series.</p>
<p>Our data do appear to be normally distributed based on our qq-norm plots.</p>
<p>The acf plots show some remaining auto-correlation in all of our algal time series with the exception of green algae. This suggests that there is some remaining variance not explained by our latent trends and model covariates. State 1 for example looks like it could maybe be some sort of oscillation (maybe). Future studies may want to consider some sort of larger climate variables that may influence algal abundance in Lake Washington.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We z scored the response data and all of the covariates to help the MARSS models make better parameter estimations. We then found that the observed data was best explained by 3 latent states when we held the R matrix constant at Diagonal and equal and included all covariates. This was the maximum number of latent states that we tested and had we tested more latent states, a higher number would have won out over the rest. This is because a higher number of latent states would allow for more flexibility in the models to explain our data. A latent state for each of the individual species would likely have had the lowest AIC but our goal was to “reduce dimensions” and still be able to make predictions.</p>
<p>This reduction in dimensions, explaining 5 observed datasets with 3 latent states, and the differences between the 5 species is why on areas of our fitted plots the predictions did not fit the data well.</p>
<p>The direction of the effects of the covariates on each of the species made biological sense. We saw that the winter component of the season covariate strongly limited all of the species. The season covariate was present in a number of the top models and may have had enough predictive power to reduce the predictive value of temperature. We also saw that species capable of blooms, such as diatoms in the spring or dinoflagellates in the presence of high amounts of free phosphorus were capable of suppressing other populations. This could explain why the majority of species did not respond positively to the spring portion of the season covariate.</p>
<p>Model diagnostics showed that the systematic form of our models may not have captured and removed all of the structure from the residuals. Future analyses could investigate other covariates like water turbidity which could affect the amount of light reaching into the water column which would be important for plankton species. Furthermore, another cyclical climatic variable may help reduce autocorrelation observed in the ACF plots.</p>
</section>
<section id="team-contributions" class="level1">
<h1>Team contributions</h1>
<p>Both Dylan and Liz contributed code, interpretation, and discussion to this analysis.</p>
<p>Outlined as general steps…</p>
<ol type="1">
<li><p>Find the most parsimonious model among a set that examines the effects of environmental covariates and/or an indicator of seasonality (Dylan), varying numbers of trends (Liz), and different forms of variance-covariance matrices for the observation errors (Liz and Dylan).</p></li>
<li><p>Plot trends and individual loadings for the model identified in task (1) above. (Dylan)</p></li>
<li><p>Plot model fits and uncertainty intervals for the model identified in task (1) above. (Dylan)</p></li>
<li><p>Describe the effects of environmental or dummy variables on (possibly seasonal) patterns in the data. (Liz)</p></li>
</ol>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-3/Lab-3-DFA.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb52" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Team 1 - Lab 3"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Dynamic Factor Analysis (DFA)"</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Liz Elmstrom, Dylan Hubl"</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> April 20, 2023</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the data</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data}</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="do">## load MARSS for data and analyses</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rje)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="do">## load the raw data (there are 3 datasets contained here)</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lakeWAplankton, <span class="at">package =</span> <span class="st">"MARSS"</span>)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="do">## we want `lakeWAplanktonTrans`, which has been transformed</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="do">## so the 0's are replaced with NA's and the data z-scored</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>all_dat <span class="ot">&lt;-</span> lakeWAplanktonTrans</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Explore the data</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r explore_data}</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="do">## add some code here</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"colnames: "</span>, <span class="fu">colnames</span>(all_dat), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Phytoplankton</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>phyto_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Cryptomonas<span class="sc">:</span>Other.algae)</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phyto_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Phytoplankton raw data'</span>)</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a><span class="co">#Zooplankton</span></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>zoop_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Conochilus<span class="sc">:</span>Non.colonial.rotifers)</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(zoop_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Zooplankton raw data'</span>)</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a><span class="co">#Covariates</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>covar_long <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(all_dat) <span class="sc">%&gt;%</span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">'value'</span>, <span class="at">cols =</span> Temp<span class="sc">:</span>pH)</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covar_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span> value), <span class="at">color=</span>name) <span class="sc">+</span></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">pch=</span> <span class="dv">21</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name)<span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Covariates raw data'</span>)</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wrangle the data</span></span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>Filtering the data to our time period of study and 5 chosen plankton species. </span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a><span class="co">#We want diatoms, greens, unicells, cyclops and non-colonial rotifers. </span></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a><span class="co">#we only want 5 of them</span></span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> all_dat[<span class="fu">c</span>(<span class="dv">61</span><span class="sc">:</span><span class="dv">300</span>),<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">13</span>,<span class="dv">20</span>)]</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crit)</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(crit)</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>plankton_ts <span class="ot">&lt;-</span> <span class="fu">t</span>(crit[,<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(plankton_ts) <span class="ot">&lt;-</span> crit[,<span class="dv">1</span>]</span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a><span class="co">#get the number of time series (y)</span></span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>n_ts <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plankton_ts)</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a><span class="co">#get length of time series</span></span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">ncol</span>(plankton_ts)</span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a><span class="co">#find the mean of each time series and remove it</span></span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">apply</span>(plankton_ts, <span class="dv">1</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a>plankton_av <span class="ot">&lt;-</span> plankton_ts <span class="sc">-</span> y_bar</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a>plankton_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(plankton_ts)</span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>We are interested in examining how populations of Diatoms, Greens, Unicells, Cyclops, and Non-colonial-rotifers are associated with one another and environmental factors such as temperature, pH of the water, amount of phosphorus in the water, and season. We selected a window of years to include data from 1967 to 1986.</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a>We standardized the observations of these populations by z scoring to allow the models to make better parameter estimates. We will z score the covariate data as well when we begin fitting models with covariates.</span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a>**Which plankton taxa did you choose and how did you choose them?**</span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a>We chose to examine time series of Diatoms, Greens, Unicells, Cyclops, and Non-colonial-rotifers. We chose these taxa based on available data and our previous knowledge of relationships between environmental covariates (specifically total phosphorus and pH) and phytoplankton. We additionally chose two zooplankton taxa to see if we observe any community interactions.</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a>**What time period(s) did you examine and why?**</span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a>We selected a window of years to include data from 1967 to 1986. This gave us roughly twenty years of data to work with and excluded NAs from our covariate datasets.</span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a>**What environmental or dummy variables did you include and why?**</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a>We chose to include total phosphorus, temperature, pH, and a dummy variable of season in our global DFA model. Given that these are monthly data, it is likely that they exhibit some sort of seasonal pattern. It is well known that nutrients, pH, and water temperature all drive plankton growth and community dynamics. After selecting a model design with the global covariate model, we then tested various combinations of covariates to determine the best model fit for the data using AIC. </span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>**What forms of models did you fit (ie, write them out in matrix form)?**</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a>We tested support for three options for the Z matrix:</span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a>\begin{equation*}</span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a>\begin{array}{rcccc}</span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a>&amp;m = 1&amp;m = 2&amp;m=3<span class="sc">\\</span></span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a>\hline</span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a>\begin{array}{r}\text{Diatoms}<span class="sc">\\</span> \text{Greens} <span class="sc">\\</span> \text{Unicells} <span class="sc">\\</span> \text{Cyclopes} <span class="sc">\\</span> </span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a>\text{Rotifters} \end{array}&amp;</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>z_{11} <span class="sc">\\</span></span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a>z_{21}<span class="sc">\\</span></span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a>z_{31}<span class="sc">\\</span></span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a>z_{41}<span class="sc">\\</span></span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a>z_{51}<span class="sc">\\</span></span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}&amp;</span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a>z_{11} &amp;  0 <span class="sc">\\</span></span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a>z_{21} &amp; z_{22}<span class="sc">\\</span></span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a>z_{31} &amp; z_{32}<span class="sc">\\</span></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a>z_{41} &amp;  z_{42}<span class="sc">\\</span></span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a>z_{51} &amp;  z_{52}<span class="sc">\\</span></span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}&amp;</span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a>z_{11} &amp;  0 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true" tabindex="-1"></a>z_{21} &amp; z_{22} &amp;  0<span class="sc">\\</span></span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a>z_{31} &amp; z_{32} &amp; z_{33}<span class="sc">\\</span></span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a>z_{41} &amp;  z_{42} &amp;  z_{43}<span class="sc">\\</span></span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a>z_{51} &amp;  z_{52} &amp;  z_{53}<span class="sc">\\</span></span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}&amp;</span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a>\end{array}</span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a>\end{equation*}</span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a>Based on sample design, we assumed that R was diagonal and equal. In a DFA model, Q is set to identity. Because we z-scored our response variables and covariates, A is set to zero. Our global model is written in matrix form below. </span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a>Observation model:</span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a>y_1<span class="sc">\\</span></span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a>y_2<span class="sc">\\</span></span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a>y_3<span class="sc">\\</span></span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a>y_4<span class="sc">\\</span></span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a>y_5<span class="sc">\\</span></span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t=</span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a>z_{11} &amp;  0 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a>z_{21} &amp; z_{22} &amp;  0<span class="sc">\\</span></span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a>z_{31} &amp; z_{32} &amp; z_{33}<span class="sc">\\</span></span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a>z_{41} &amp;  z_{42} &amp;  z_{43}<span class="sc">\\</span></span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a>z_{51} &amp;  z_{52} &amp;  z_{53}<span class="sc">\\</span></span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t+</span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a>D_{1,TP}&amp;  D_{1,pH}&amp; D_{1,cos}&amp; D_{1,sin}<span class="sc">\\</span></span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a>D_{2,TP}&amp; D_{2,pH}&amp; D_{2,cos}&amp; D_{2,sin}<span class="sc">\\</span></span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a>D_{3,TP}&amp;  D_{3,pH}&amp;  D_{3,cos}&amp; D_{3,sin}<span class="sc">\\</span></span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a>D_{4,TP}&amp;  D_{4,pH}&amp;  D_{4,cos}&amp; D_{4,sin}<span class="sc">\\</span></span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a>D_{5,TP}&amp; D_{5,pH}&amp;  D_{5,cos}&amp; D_{5,sin}<span class="sc">\\</span></span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>d_{TP}<span class="sc">\\</span></span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>d_{pH}<span class="sc">\\</span></span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a>d_{cos}<span class="sc">\\</span></span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a>d_{sin}<span class="sc">\\</span></span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t+</span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a>w_3<span class="sc">\\</span></span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>w_4<span class="sc">\\</span></span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>w_5<span class="sc">\\</span></span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a>\text{Where }w_i \sim MVN</span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a>\text{0,}\begin{bmatrix}</span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a>R&amp;0&amp;0&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a>0&amp;R&amp;0&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;R&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;0&amp;R&amp;0<span class="sc">\\</span></span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;0&amp;0&amp;R<span class="sc">\\</span></span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a>Process model:</span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t=</span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a>1 &amp;  0 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a>0 &amp;  1 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a>0 &amp; 0 &amp; 1<span class="sc">\\</span></span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_{t-1}+</span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb52-233"><a href="#cb52-233" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb52-234"><a href="#cb52-234" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a>v_5<span class="sc">\\</span></span>
<span id="cb52-236"><a href="#cb52-236" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t </span>
<span id="cb52-237"><a href="#cb52-237" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a>\text{Where }v_i \sim MVN</span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a>\text{0,}\begin{bmatrix}</span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a>1&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a>0&amp;1&amp;0<span class="sc">\\</span></span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;1<span class="sc">\\</span></span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb52-247"><a href="#cb52-247" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb52-248"><a href="#cb52-248" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-249"><a href="#cb52-249" aria-hidden="true" tabindex="-1"></a>We assessed data support for different combinations of covariates in the D matrix in Step 3 of our model selection process below. </span>
<span id="cb52-250"><a href="#cb52-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a>**What sort of model diagnostics did you use to examine model assumptions?**</span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a>Finally, we assessed our model performance by examining our model residuals for normality and homogeneity, and examined any residual autocorrelation using ACF plots. </span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results: DFA Model Selection</span></span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1- Fit global model with all covariates and number of trends</span></span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a>We are keeping R to diagonal and equal based on the sample design. The default DFA setting within MARSS sets up our Z matrix, A to scaling and Q to identity.</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-263"><a href="#cb52-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-264"><a href="#cb52-264" aria-hidden="true" tabindex="-1"></a><span class="co">#set up observation model parameters</span></span>
<span id="cb52-265"><a href="#cb52-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-266"><a href="#cb52-266" aria-hidden="true" tabindex="-1"></a><span class="co">#covariates</span></span>
<span id="cb52-267"><a href="#cb52-267" aria-hidden="true" tabindex="-1"></a><span class="co">#create a matrix for each of the covariates</span></span>
<span id="cb52-268"><a href="#cb52-268" aria-hidden="true" tabindex="-1"></a>covar_ts <span class="ot">&lt;-</span> <span class="fu">t</span>(crit[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb52-269"><a href="#cb52-269" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(covar_ts) <span class="ot">&lt;-</span> crit[,<span class="dv">1</span>]</span>
<span id="cb52-270"><a href="#cb52-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-271"><a href="#cb52-271" aria-hidden="true" tabindex="-1"></a>covar_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(covar_ts) <span class="do">## If we zscore the response, do we also zscore covariates? Mark says yes</span></span>
<span id="cb52-272"><a href="#cb52-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-273"><a href="#cb52-273" aria-hidden="true" tabindex="-1"></a><span class="co">#make a season matrix</span></span>
<span id="cb52-274"><a href="#cb52-274" aria-hidden="true" tabindex="-1"></a>cos_t <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb52-275"><a href="#cb52-275" aria-hidden="true" tabindex="-1"></a>sin_t <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="fu">seq</span>(TT)<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb52-276"><a href="#cb52-276" aria-hidden="true" tabindex="-1"></a>season <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cos_t,sin_t)</span>
<span id="cb52-277"><a href="#cb52-277" aria-hidden="true" tabindex="-1"></a>season_z <span class="ot">&lt;-</span> <span class="fu">zscore</span>(season)</span>
<span id="cb52-278"><a href="#cb52-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-279"><a href="#cb52-279" aria-hidden="true" tabindex="-1"></a><span class="co">#dim(season)</span></span>
<span id="cb52-280"><a href="#cb52-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-281"><a href="#cb52-281" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(covar_z,season_z)</span>
<span id="cb52-282"><a href="#cb52-282" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, we are not altering the upper D matrix, so every covariate will have its own effect</span></span>
<span id="cb52-283"><a href="#cb52-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-284"><a href="#cb52-284" aria-hidden="true" tabindex="-1"></a><span class="co">#tell MARSS what values to use to start with</span></span>
<span id="cb52-285"><a href="#cb52-285" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb52-286"><a href="#cb52-286" aria-hidden="true" tabindex="-1"></a>init_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, mm), mm, <span class="dv">1</span>))</span>
<span id="cb52-287"><a href="#cb52-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-288"><a href="#cb52-288" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting latent trends to 3 and R to diagonal and equal</span></span>
<span id="cb52-289"><a href="#cb52-289" aria-hidden="true" tabindex="-1"></a>mod_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">m =</span> <span class="dv">3</span>, <span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">A =</span> <span class="st">"zero"</span>) <span class="co"># If we zscore, A goes to zero (Also prob the same for demean? Not sure.)</span></span>
<span id="cb52-290"><a href="#cb52-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-291"><a href="#cb52-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Model iterations</span></span>
<span id="cb52-292"><a href="#cb52-292" aria-hidden="true" tabindex="-1"></a>cont_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>, <span class="at">allow.degen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-293"><a href="#cb52-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-294"><a href="#cb52-294" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit global modal, using the zscored plankton data, right now covariates are  Z-scored</span></span>
<span id="cb52-295"><a href="#cb52-295" aria-hidden="true" tabindex="-1"></a>dfa_global <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> mod_list, <span class="at">control =</span> cont_list, <span class="at">inits =</span> init_list, <span class="at">form =</span> <span class="st">"dfa"</span>,</span>
<span id="cb52-296"><a href="#cb52-296" aria-hidden="true" tabindex="-1"></a>                    <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span>
<span id="cb52-297"><a href="#cb52-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-298"><a href="#cb52-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-299"><a href="#cb52-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-300"><a href="#cb52-300" aria-hidden="true" tabindex="-1"></a>The covariates including the season were zscored to ensure they each have a variance of 1. Which will help the model produce better estimates of the parameters.</span>
<span id="cb52-301"><a href="#cb52-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-302"><a href="#cb52-302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2- Testing number of trends</span></span>
<span id="cb52-303"><a href="#cb52-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-304"><a href="#cb52-304" aria-hidden="true" tabindex="-1"></a>Fitting DFA model with global covariate set and testing for different latent trends.</span>
<span id="cb52-305"><a href="#cb52-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-308"><a href="#cb52-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-309"><a href="#cb52-309" aria-hidden="true" tabindex="-1"></a><span class="do">## Liz's original for loop</span></span>
<span id="cb52-310"><a href="#cb52-310" aria-hidden="true" tabindex="-1"></a>mod_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">A =</span> <span class="st">"zero"</span>) <span class="co"># All other parameters are the default</span></span>
<span id="cb52-311"><a href="#cb52-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-312"><a href="#cb52-312" aria-hidden="true" tabindex="-1"></a>m_list <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="co"># Latent trends to loop through</span></span>
<span id="cb52-313"><a href="#cb52-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-314"><a href="#cb52-314" aria-hidden="true" tabindex="-1"></a>out.tab <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-315"><a href="#cb52-315" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb52-316"><a href="#cb52-316" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m_list)){</span>
<span id="cb52-317"><a href="#cb52-317" aria-hidden="true" tabindex="-1"></a>      fit.model <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">list</span>(<span class="at">m=</span>m_list[[i]]), mod_list) <span class="do">## model list to loop through</span></span>
<span id="cb52-318"><a href="#cb52-318" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-319"><a href="#cb52-319" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">=</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> fit.model, <span class="at">control =</span> cont_list, </span>
<span id="cb52-320"><a href="#cb52-320" aria-hidden="true" tabindex="-1"></a>                  <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span>
<span id="cb52-321"><a href="#cb52-321" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-322"><a href="#cb52-322" aria-hidden="true" tabindex="-1"></a>      out<span class="ot">=</span><span class="fu">data.frame</span>(</span>
<span id="cb52-323"><a href="#cb52-323" aria-hidden="true" tabindex="-1"></a>                   <span class="at">m=</span>m_list[[i]],<span class="at">logLik=</span>fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb52-324"><a href="#cb52-324" aria-hidden="true" tabindex="-1"></a>                   <span class="at">num.iter=</span>fit<span class="sc">$</span>numIter, <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb52-325"><a href="#cb52-325" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-326"><a href="#cb52-326" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-327"><a href="#cb52-327" aria-hidden="true" tabindex="-1"></a>      out.tab<span class="ot">=</span><span class="fu">rbind</span>(out.tab,out)</span>
<span id="cb52-328"><a href="#cb52-328" aria-hidden="true" tabindex="-1"></a>      fits<span class="ot">=</span><span class="fu">c</span>(fits,<span class="fu">list</span>(fit))</span>
<span id="cb52-329"><a href="#cb52-329" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb52-330"><a href="#cb52-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-331"><a href="#cb52-331" aria-hidden="true" tabindex="-1"></a>min.AICc <span class="ot">&lt;-</span> <span class="fu">order</span>(out.tab<span class="sc">$</span>AICc)</span>
<span id="cb52-332"><a href="#cb52-332" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> out.tab[min.AICc, ]</span>
<span id="cb52-333"><a href="#cb52-333" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">cbind</span>(out.tab<span class="fl">.1</span>, <span class="at">delta.AICc =</span> out.tab<span class="fl">.1</span><span class="sc">$</span>AICc <span class="sc">-</span> out.tab<span class="fl">.1</span><span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb52-334"><a href="#cb52-334" aria-hidden="true" tabindex="-1"></a>out.tab<span class="fl">.1</span></span>
<span id="cb52-335"><a href="#cb52-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-336"><a href="#cb52-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-337"><a href="#cb52-337" aria-hidden="true" tabindex="-1"></a>In step 2, we used the global model and information criterion to test various numbers of latent states (m = 1-3). This resulted in a top model, as indicated by AICc scores, with three latent trends.</span>
<span id="cb52-338"><a href="#cb52-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-339"><a href="#cb52-339" aria-hidden="true" tabindex="-1"></a>We can also alter the for loop to test for different R structures. We do this below as a general exercise to show how to loop through the stochastic or "random" effects of the DFA model as a part of model selection. However, considering our study design, we opt to consider only models with R equal to "diagonal and equal" moving forward.</span>
<span id="cb52-340"><a href="#cb52-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-343"><a href="#cb52-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-344"><a href="#cb52-344" aria-hidden="true" tabindex="-1"></a><span class="do">## for loop testing m and R adapted from the user manual</span></span>
<span id="cb52-345"><a href="#cb52-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-346"><a href="#cb52-346" aria-hidden="true" tabindex="-1"></a>m_list <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="co"># Latent trends to loop through</span></span>
<span id="cb52-347"><a href="#cb52-347" aria-hidden="true" tabindex="-1"></a>R_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"diagonal and equal"</span>, <span class="st">"diagonal and unequal"</span>)<span class="co"># just testing two options for R, could be expanded to fit other structures</span></span>
<span id="cb52-348"><a href="#cb52-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-349"><a href="#cb52-349" aria-hidden="true" tabindex="-1"></a><span class="co">#In this we loop use BFGS method to get all models to converge</span></span>
<span id="cb52-350"><a href="#cb52-350" aria-hidden="true" tabindex="-1"></a>cont_BFGS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>)</span>
<span id="cb52-351"><a href="#cb52-351" aria-hidden="true" tabindex="-1"></a>model.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-352"><a href="#cb52-352" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (R <span class="cf">in</span> R_list) {</span>
<span id="cb52-353"><a href="#cb52-353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(m_list)) {</span>
<span id="cb52-354"><a href="#cb52-354" aria-hidden="true" tabindex="-1"></a>    dfa.model <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R =</span> R, <span class="at">m =</span> m, <span class="at">A =</span> <span class="st">"zero"</span>) </span>
<span id="cb52-355"><a href="#cb52-355" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb52-356"><a href="#cb52-356" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">=</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> dfa.model, <span class="at">control =</span> cont_BFGS, </span>
<span id="cb52-357"><a href="#cb52-357" aria-hidden="true" tabindex="-1"></a>                  <span class="at">form =</span> <span class="st">"dfa"</span>,<span class="at">method =</span> <span class="st">"BFGS"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, <span class="at">covariates =</span> d)</span>
<span id="cb52-358"><a href="#cb52-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-359"><a href="#cb52-359" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-360"><a href="#cb52-360" aria-hidden="true" tabindex="-1"></a>  model.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.data, <span class="fu">data.frame</span>(<span class="at">R =</span> R, <span class="at">m =</span> m,</span>
<span id="cb52-361"><a href="#cb52-361" aria-hidden="true" tabindex="-1"></a>                      fit<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit<span class="sc">$</span>num.params,</span>
<span id="cb52-362"><a href="#cb52-362" aria-hidden="true" tabindex="-1"></a>                      <span class="at">converged=</span><span class="sc">!</span>fit<span class="sc">$</span>convergence,</span>
<span id="cb52-363"><a href="#cb52-363" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb52-364"><a href="#cb52-364" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-365"><a href="#cb52-365" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-366"><a href="#cb52-366" aria-hidden="true" tabindex="-1"></a><span class="co">#model.data</span></span>
<span id="cb52-367"><a href="#cb52-367" aria-hidden="true" tabindex="-1"></a>min.AICc_2 <span class="ot">&lt;-</span> <span class="fu">order</span>(model.data<span class="sc">$</span>AICc)</span>
<span id="cb52-368"><a href="#cb52-368" aria-hidden="true" tabindex="-1"></a>model.data <span class="ot">&lt;-</span> model.data[min.AICc_2, ]</span>
<span id="cb52-369"><a href="#cb52-369" aria-hidden="true" tabindex="-1"></a>model.data.delta <span class="ot">&lt;-</span> <span class="fu">cbind</span>(model.data, <span class="at">delta.AICc =</span> model.data<span class="sc">$</span>AICc <span class="sc">-</span> model.data<span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb52-370"><a href="#cb52-370" aria-hidden="true" tabindex="-1"></a>model.data.delta</span>
<span id="cb52-371"><a href="#cb52-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-372"><a href="#cb52-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-373"><a href="#cb52-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-374"><a href="#cb52-374" aria-hidden="true" tabindex="-1"></a>Note - The Diagonal and unequal models do not converge using the default MARSS methods. Running the BFGS method allows all models to converge.</span>
<span id="cb52-375"><a href="#cb52-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-376"><a href="#cb52-376" aria-hidden="true" tabindex="-1"></a>In this comparison, diagonal and unequal with 3 latent states is the top model. However, as mentioned above, this does not make sense for our study design, so moving forward we test different combinations of covariates with R = diagonal and equal and m = 3.</span>
<span id="cb52-377"><a href="#cb52-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-378"><a href="#cb52-378" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3- Testing covariates</span></span>
<span id="cb52-379"><a href="#cb52-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-382"><a href="#cb52-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-383"><a href="#cb52-383" aria-hidden="true" tabindex="-1"></a><span class="co">#use this to create every combo of rows in the covariate matrix possible</span></span>
<span id="cb52-384"><a href="#cb52-384" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTE: there is a saved .RDS table at the bottom that is the output of the loop</span></span>
<span id="cb52-385"><a href="#cb52-385" aria-hidden="true" tabindex="-1"></a><span class="co">#so you don't have to rerun (its a long time)</span></span>
<span id="cb52-386"><a href="#cb52-386" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">powerSet</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb52-387"><a href="#cb52-387" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure cos and sin are always together as season</span></span>
<span id="cb52-388"><a href="#cb52-388" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb52-389"><a href="#cb52-389" aria-hidden="true" tabindex="-1"></a>  combo[[i]] <span class="ot">&lt;-</span> <span class="fu">c</span>(combo[[i]],<span class="dv">5</span>)</span>
<span id="cb52-390"><a href="#cb52-390" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-391"><a href="#cb52-391" aria-hidden="true" tabindex="-1"></a><span class="co">#d[combo[[1]],]  # [[1]] is empty so dont loop it</span></span>
<span id="cb52-392"><a href="#cb52-392" aria-hidden="true" tabindex="-1"></a>cont_BFGS <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">3000</span>)</span>
<span id="cb52-393"><a href="#cb52-393" aria-hidden="true" tabindex="-1"></a>model.cov.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-394"><a href="#cb52-394" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">16</span>) {</span>
<span id="cb52-395"><a href="#cb52-395" aria-hidden="true" tabindex="-1"></a>    fit2 <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">m =</span> <span class="dv">3</span>,</span>
<span id="cb52-396"><a href="#cb52-396" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A =</span> <span class="st">"zero"</span>), <span class="at">control =</span> cont_BFGS,</span>
<span id="cb52-397"><a href="#cb52-397" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>,</span>
<span id="cb52-398"><a href="#cb52-398" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">method =</span> <span class="st">"BFGS"</span>,</span>
<span id="cb52-399"><a href="#cb52-399" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">covariates =</span> d[combo[[i]],])</span>
<span id="cb52-400"><a href="#cb52-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-401"><a href="#cb52-401" aria-hidden="true" tabindex="-1"></a>   model.cov.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.cov.data,</span>
<span id="cb52-402"><a href="#cb52-402" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">data.frame</span>(<span class="at">Covariates =</span>                       <span class="fu">toString</span>(<span class="fu">rownames</span>(d)[combo[[i]]]),</span>
<span id="cb52-403"><a href="#cb52-403" aria-hidden="true" tabindex="-1"></a>                      <span class="at">LogLik =</span> fit2<span class="sc">$</span>logLik, <span class="at">AICc=</span>fit2<span class="sc">$</span>AICc, <span class="at">num.param=</span>fit2<span class="sc">$</span>num.params,</span>
<span id="cb52-404"><a href="#cb52-404" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>))</span>
<span id="cb52-405"><a href="#cb52-405" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-406"><a href="#cb52-406" aria-hidden="true" tabindex="-1"></a><span class="co">#model.cov.data</span></span>
<span id="cb52-407"><a href="#cb52-407" aria-hidden="true" tabindex="-1"></a>min.AICc_3 <span class="ot">&lt;-</span> <span class="fu">order</span>(model.cov.data<span class="sc">$</span>AICc)</span>
<span id="cb52-408"><a href="#cb52-408" aria-hidden="true" tabindex="-1"></a>model.cov.data <span class="ot">&lt;-</span> model.cov.data[min.AICc_3, ]</span>
<span id="cb52-409"><a href="#cb52-409" aria-hidden="true" tabindex="-1"></a>covariate.table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(model.cov.data, <span class="at">delta.AICc =</span> model.cov.data<span class="sc">$</span>AICc <span class="sc">-</span> model.cov.data<span class="sc">$</span>AICc[<span class="dv">1</span>])</span>
<span id="cb52-410"><a href="#cb52-410" aria-hidden="true" tabindex="-1"></a><span class="co">#covariate.table</span></span>
<span id="cb52-411"><a href="#cb52-411" aria-hidden="true" tabindex="-1"></a>covariate.table<span class="sc">$</span>Covariates <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(covariate.table<span class="sc">$</span>Covariates, <span class="st">"cos_t, sin_t"</span>, <span class="st">"Season"</span>)</span>
<span id="cb52-412"><a href="#cb52-412" aria-hidden="true" tabindex="-1"></a>covariate.table</span>
<span id="cb52-413"><a href="#cb52-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-414"><a href="#cb52-414" aria-hidden="true" tabindex="-1"></a><span class="co">#this will save our table that is generated so the whole thing doesn't need to</span></span>
<span id="cb52-415"><a href="#cb52-415" aria-hidden="true" tabindex="-1"></a><span class="co">#be re-run in the future (i hope)</span></span>
<span id="cb52-416"><a href="#cb52-416" aria-hidden="true" tabindex="-1"></a><span class="co">#saveRDS(covariate.table, "covariate_table.rds")</span></span>
<span id="cb52-417"><a href="#cb52-417" aria-hidden="true" tabindex="-1"></a><span class="co">#table &lt;- readRDS("covariate_table.rds")</span></span>
<span id="cb52-418"><a href="#cb52-418" aria-hidden="true" tabindex="-1"></a><span class="co">#table</span></span>
<span id="cb52-419"><a href="#cb52-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-420"><a href="#cb52-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-421"><a href="#cb52-421" aria-hidden="true" tabindex="-1"></a>We used the BFGS method to estimate the parameters for the best model as running the models without this method 1) took a very long time and 2) resulted in a lot of models failing to converge.</span>
<span id="cb52-422"><a href="#cb52-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-423"><a href="#cb52-423" aria-hidden="true" tabindex="-1"></a>To select the covariate combination that resulted in a model that fit the data the best, we held the R matrix at "diagonal and equal" and the number of latent states at three. Previously, we found these to be the best options when testing the global covariate model.</span>
<span id="cb52-424"><a href="#cb52-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-425"><a href="#cb52-425" aria-hidden="true" tabindex="-1"></a>We see that of the 15 combinations of Temperature, Total Phosphorus (TP), pH, and Season that the top model used *TP, pH and Season* as covariates. The second top model, based on AICc, was close but with fewer parameters we would expect it to be closer to 10 AICc points away if the models were equivalent.</span>
<span id="cb52-426"><a href="#cb52-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-427"><a href="#cb52-427" aria-hidden="true" tabindex="-1"></a>Thus, our top model has an R matrix that is diagonal and equal, three latent states, and uses TP, pH and Season as its covariates. The observation model and process model are written in matrix form below.</span>
<span id="cb52-428"><a href="#cb52-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-429"><a href="#cb52-429" aria-hidden="true" tabindex="-1"></a>Observation model:</span>
<span id="cb52-430"><a href="#cb52-430" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-431"><a href="#cb52-431" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-432"><a href="#cb52-432" aria-hidden="true" tabindex="-1"></a>y_1<span class="sc">\\</span></span>
<span id="cb52-433"><a href="#cb52-433" aria-hidden="true" tabindex="-1"></a>y_2<span class="sc">\\</span></span>
<span id="cb52-434"><a href="#cb52-434" aria-hidden="true" tabindex="-1"></a>y_3<span class="sc">\\</span></span>
<span id="cb52-435"><a href="#cb52-435" aria-hidden="true" tabindex="-1"></a>y_4<span class="sc">\\</span></span>
<span id="cb52-436"><a href="#cb52-436" aria-hidden="true" tabindex="-1"></a>y_5<span class="sc">\\</span></span>
<span id="cb52-437"><a href="#cb52-437" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t=</span>
<span id="cb52-438"><a href="#cb52-438" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-439"><a href="#cb52-439" aria-hidden="true" tabindex="-1"></a>0.394 &amp;  0.000 &amp;  0.000<span class="sc">\\</span></span>
<span id="cb52-440"><a href="#cb52-440" aria-hidden="true" tabindex="-1"></a>0.068 &amp;  0.361 &amp;  0.000<span class="sc">\\</span></span>
<span id="cb52-441"><a href="#cb52-441" aria-hidden="true" tabindex="-1"></a>0.317 &amp; -0.014 &amp; -0.233<span class="sc">\\</span></span>
<span id="cb52-442"><a href="#cb52-442" aria-hidden="true" tabindex="-1"></a>0.453 &amp;  0.196 &amp;  0.246<span class="sc">\\</span></span>
<span id="cb52-443"><a href="#cb52-443" aria-hidden="true" tabindex="-1"></a>0.429 &amp;  0.017 &amp;  0.158<span class="sc">\\</span></span>
<span id="cb52-444"><a href="#cb52-444" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-445"><a href="#cb52-445" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-446"><a href="#cb52-446" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-447"><a href="#cb52-447" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-448"><a href="#cb52-448" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-449"><a href="#cb52-449" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t+</span>
<span id="cb52-450"><a href="#cb52-450" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-451"><a href="#cb52-451" aria-hidden="true" tabindex="-1"></a>-0.234&amp;  0.088&amp; -0.285&amp; 0.409<span class="sc">\\</span></span>
<span id="cb52-452"><a href="#cb52-452" aria-hidden="true" tabindex="-1"></a>-0.134&amp; -0.076&amp; -0.389&amp; -0.206<span class="sc">\\</span></span>
<span id="cb52-453"><a href="#cb52-453" aria-hidden="true" tabindex="-1"></a>0.317&amp;  0.159&amp;  -0.381&amp; -0.259<span class="sc">\\</span></span>
<span id="cb52-454"><a href="#cb52-454" aria-hidden="true" tabindex="-1"></a>0.108&amp;  0.320&amp;  -0.259&amp; -0.011<span class="sc">\\</span></span>
<span id="cb52-455"><a href="#cb52-455" aria-hidden="true" tabindex="-1"></a>-0.017&amp; 0.228&amp;  -0.439&amp; -0.056<span class="sc">\\</span></span>
<span id="cb52-456"><a href="#cb52-456" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-457"><a href="#cb52-457" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-458"><a href="#cb52-458" aria-hidden="true" tabindex="-1"></a>d_{TP}<span class="sc">\\</span></span>
<span id="cb52-459"><a href="#cb52-459" aria-hidden="true" tabindex="-1"></a>d_{pH}<span class="sc">\\</span></span>
<span id="cb52-460"><a href="#cb52-460" aria-hidden="true" tabindex="-1"></a>d_{cos}<span class="sc">\\</span></span>
<span id="cb52-461"><a href="#cb52-461" aria-hidden="true" tabindex="-1"></a>d_{sin}<span class="sc">\\</span></span>
<span id="cb52-462"><a href="#cb52-462" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t+</span>
<span id="cb52-463"><a href="#cb52-463" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-464"><a href="#cb52-464" aria-hidden="true" tabindex="-1"></a>w_1<span class="sc">\\</span></span>
<span id="cb52-465"><a href="#cb52-465" aria-hidden="true" tabindex="-1"></a>w_2<span class="sc">\\</span></span>
<span id="cb52-466"><a href="#cb52-466" aria-hidden="true" tabindex="-1"></a>w_3<span class="sc">\\</span></span>
<span id="cb52-467"><a href="#cb52-467" aria-hidden="true" tabindex="-1"></a>w_4<span class="sc">\\</span></span>
<span id="cb52-468"><a href="#cb52-468" aria-hidden="true" tabindex="-1"></a>w_5<span class="sc">\\</span></span>
<span id="cb52-469"><a href="#cb52-469" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t</span>
<span id="cb52-470"><a href="#cb52-470" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-471"><a href="#cb52-471" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-472"><a href="#cb52-472" aria-hidden="true" tabindex="-1"></a>\text{Where }w_i \sim MVN</span>
<span id="cb52-473"><a href="#cb52-473" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb52-474"><a href="#cb52-474" aria-hidden="true" tabindex="-1"></a>\text{0,}\begin{bmatrix}</span>
<span id="cb52-475"><a href="#cb52-475" aria-hidden="true" tabindex="-1"></a>R&amp;0&amp;0&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-476"><a href="#cb52-476" aria-hidden="true" tabindex="-1"></a>0&amp;R&amp;0&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-477"><a href="#cb52-477" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;R&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-478"><a href="#cb52-478" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;0&amp;R&amp;0<span class="sc">\\</span></span>
<span id="cb52-479"><a href="#cb52-479" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;0&amp;0&amp;R<span class="sc">\\</span></span>
<span id="cb52-480"><a href="#cb52-480" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb52-481"><a href="#cb52-481" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb52-482"><a href="#cb52-482" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-483"><a href="#cb52-483" aria-hidden="true" tabindex="-1"></a>Process model:</span>
<span id="cb52-484"><a href="#cb52-484" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-485"><a href="#cb52-485" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-486"><a href="#cb52-486" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-487"><a href="#cb52-487" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-488"><a href="#cb52-488" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-489"><a href="#cb52-489" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t=</span>
<span id="cb52-490"><a href="#cb52-490" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-491"><a href="#cb52-491" aria-hidden="true" tabindex="-1"></a>1 &amp;  0 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-492"><a href="#cb52-492" aria-hidden="true" tabindex="-1"></a>0 &amp;  1 &amp;  0<span class="sc">\\</span></span>
<span id="cb52-493"><a href="#cb52-493" aria-hidden="true" tabindex="-1"></a>0 &amp; 0 &amp; 1<span class="sc">\\</span></span>
<span id="cb52-494"><a href="#cb52-494" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}*</span>
<span id="cb52-495"><a href="#cb52-495" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-496"><a href="#cb52-496" aria-hidden="true" tabindex="-1"></a>x_1<span class="sc">\\</span></span>
<span id="cb52-497"><a href="#cb52-497" aria-hidden="true" tabindex="-1"></a>x_2<span class="sc">\\</span></span>
<span id="cb52-498"><a href="#cb52-498" aria-hidden="true" tabindex="-1"></a>x_3<span class="sc">\\</span></span>
<span id="cb52-499"><a href="#cb52-499" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_{t-1}+</span>
<span id="cb52-500"><a href="#cb52-500" aria-hidden="true" tabindex="-1"></a>\begin{bmatrix}</span>
<span id="cb52-501"><a href="#cb52-501" aria-hidden="true" tabindex="-1"></a>v_1<span class="sc">\\</span></span>
<span id="cb52-502"><a href="#cb52-502" aria-hidden="true" tabindex="-1"></a>v_2<span class="sc">\\</span></span>
<span id="cb52-503"><a href="#cb52-503" aria-hidden="true" tabindex="-1"></a>v_3<span class="sc">\\</span></span>
<span id="cb52-504"><a href="#cb52-504" aria-hidden="true" tabindex="-1"></a>v_4<span class="sc">\\</span></span>
<span id="cb52-505"><a href="#cb52-505" aria-hidden="true" tabindex="-1"></a>v_5<span class="sc">\\</span></span>
<span id="cb52-506"><a href="#cb52-506" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}_t </span>
<span id="cb52-507"><a href="#cb52-507" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-508"><a href="#cb52-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-509"><a href="#cb52-509" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb52-510"><a href="#cb52-510" aria-hidden="true" tabindex="-1"></a>\text{Where }v_i \sim MVN</span>
<span id="cb52-511"><a href="#cb52-511" aria-hidden="true" tabindex="-1"></a>\begin{pmatrix}</span>
<span id="cb52-512"><a href="#cb52-512" aria-hidden="true" tabindex="-1"></a>\text{0,}\begin{bmatrix}</span>
<span id="cb52-513"><a href="#cb52-513" aria-hidden="true" tabindex="-1"></a>1&amp;0&amp;0<span class="sc">\\</span></span>
<span id="cb52-514"><a href="#cb52-514" aria-hidden="true" tabindex="-1"></a>0&amp;1&amp;0<span class="sc">\\</span></span>
<span id="cb52-515"><a href="#cb52-515" aria-hidden="true" tabindex="-1"></a>0&amp;0&amp;1<span class="sc">\\</span></span>
<span id="cb52-516"><a href="#cb52-516" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb52-517"><a href="#cb52-517" aria-hidden="true" tabindex="-1"></a>\end{pmatrix}</span>
<span id="cb52-518"><a href="#cb52-518" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb52-519"><a href="#cb52-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-520"><a href="#cb52-520" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results: Trends and individual loadings </span></span>
<span id="cb52-521"><a href="#cb52-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-522"><a href="#cb52-522" aria-hidden="true" tabindex="-1"></a>Now we can look at our top model which has Total Phosporus, pH, and season as covariates with an R matrix set to "diagonal and equal" and three latent states.</span>
<span id="cb52-523"><a href="#cb52-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-526"><a href="#cb52-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-527"><a href="#cb52-527" aria-hidden="true" tabindex="-1"></a><span class="co">#create an object of the top model</span></span>
<span id="cb52-528"><a href="#cb52-528" aria-hidden="true" tabindex="-1"></a>top.mod <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(plankton_z, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">R =</span> <span class="st">"diagonal and equal"</span>, <span class="at">m =</span> <span class="dv">3</span>,</span>
<span id="cb52-529"><a href="#cb52-529" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">A =</span> <span class="st">"zero"</span>), <span class="at">control =</span> cont_BFGS,</span>
<span id="cb52-530"><a href="#cb52-530" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">form =</span> <span class="st">"dfa"</span>, <span class="at">z.score =</span> <span class="cn">FALSE</span>, </span>
<span id="cb52-531"><a href="#cb52-531" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">covariates =</span> d[combo[[<span class="dv">15</span>]],])</span>
<span id="cb52-532"><a href="#cb52-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-533"><a href="#cb52-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-534"><a href="#cb52-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-537"><a href="#cb52-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-538"><a href="#cb52-538" aria-hidden="true" tabindex="-1"></a><span class="co">#plot to states and loadings of top model</span></span>
<span id="cb52-539"><a href="#cb52-539" aria-hidden="true" tabindex="-1"></a><span class="do">## get the estimated ZZ</span></span>
<span id="cb52-540"><a href="#cb52-540" aria-hidden="true" tabindex="-1"></a>Z_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb52-541"><a href="#cb52-541" aria-hidden="true" tabindex="-1"></a><span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb52-542"><a href="#cb52-542" aria-hidden="true" tabindex="-1"></a>H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(Z_est)<span class="sc">$</span>rotmat</span>
<span id="cb52-543"><a href="#cb52-543" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate factor loadings</span></span>
<span id="cb52-544"><a href="#cb52-544" aria-hidden="true" tabindex="-1"></a>Z_rot <span class="ot">=</span> Z_est <span class="sc">%*%</span> H_inv</span>
<span id="cb52-545"><a href="#cb52-545" aria-hidden="true" tabindex="-1"></a><span class="do">## rotate processes</span></span>
<span id="cb52-546"><a href="#cb52-546" aria-hidden="true" tabindex="-1"></a>proc_rot <span class="ot">=</span> <span class="fu">solve</span>(H_inv) <span class="sc">%*%</span> top.mod<span class="sc">$</span>states</span>
<span id="cb52-547"><a href="#cb52-547" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb52-548"><a href="#cb52-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-549"><a href="#cb52-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-550"><a href="#cb52-550" aria-hidden="true" tabindex="-1"></a><span class="co">#info needed for plotting for loops</span></span>
<span id="cb52-551"><a href="#cb52-551" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb52-552"><a href="#cb52-552" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb52-553"><a href="#cb52-553" aria-hidden="true" tabindex="-1"></a>yr_start <span class="ot">&lt;-</span> <span class="dv">1967</span></span>
<span id="cb52-554"><a href="#cb52-554" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb52-555"><a href="#cb52-555" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb52-556"><a href="#cb52-556" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb52-557"><a href="#cb52-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-558"><a href="#cb52-558" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>), mm, <span class="dv">2</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb52-559"><a href="#cb52-559" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb52-560"><a href="#cb52-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-561"><a href="#cb52-561" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the latent processes</span></span>
<span id="cb52-562"><a href="#cb52-562" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>mm) {</span>
<span id="cb52-563"><a href="#cb52-563" aria-hidden="true" tabindex="-1"></a>  ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(proc_rot[i, ]))</span>
<span id="cb52-564"><a href="#cb52-564" aria-hidden="true" tabindex="-1"></a>  <span class="do">## set up plot area</span></span>
<span id="cb52-565"><a href="#cb52-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts, proc_rot[i, ], <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">ylim =</span> ylm, </span>
<span id="cb52-566"><a href="#cb52-566" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb52-567"><a href="#cb52-567" aria-hidden="true" tabindex="-1"></a>  <span class="do">## draw zero-line</span></span>
<span id="cb52-568"><a href="#cb52-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb52-569"><a href="#cb52-569" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot trend line</span></span>
<span id="cb52-570"><a href="#cb52-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i, ], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb52-571"><a href="#cb52-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, proc_rot[i, ], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb52-572"><a href="#cb52-572" aria-hidden="true" tabindex="-1"></a>  <span class="do">## add panel labels</span></span>
<span id="cb52-573"><a href="#cb52-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"State"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb52-574"><a href="#cb52-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb52-575"><a href="#cb52-575" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-576"><a href="#cb52-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-577"><a href="#cb52-577" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the loadings</span></span>
<span id="cb52-578"><a href="#cb52-578" aria-hidden="true" tabindex="-1"></a>minZ <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb52-579"><a href="#cb52-579" aria-hidden="true" tabindex="-1"></a>ylm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_rot))</span>
<span id="cb52-580"><a href="#cb52-580" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>mm) {</span>
<span id="cb52-581"><a href="#cb52-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n_ts)[<span class="fu">abs</span>(Z_rot[, i]) <span class="sc">&gt;</span> minZ], <span class="fu">as.vector</span>(Z_rot[<span class="fu">abs</span>(Z_rot[, </span>
<span id="cb52-582"><a href="#cb52-582" aria-hidden="true" tabindex="-1"></a>                                                                    i]) <span class="sc">&gt;</span> minZ, i]), <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, </span>
<span id="cb52-583"><a href="#cb52-583" aria-hidden="true" tabindex="-1"></a>       <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">ylim =</span> ylm, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, n_ts <span class="sc">+</span> <span class="fl">0.5</span>), <span class="at">col =</span> clr)</span>
<span id="cb52-584"><a href="#cb52-584" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_ts) {</span>
<span id="cb52-585"><a href="#cb52-585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Z_rot[j, i] <span class="sc">&gt;</span> minZ) {</span>
<span id="cb52-586"><a href="#cb52-586" aria-hidden="true" tabindex="-1"></a>      <span class="fu">text</span>(j, <span class="sc">-</span><span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, </span>
<span id="cb52-587"><a href="#cb52-587" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> clr[j])</span>
<span id="cb52-588"><a href="#cb52-588" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-589"><a href="#cb52-589" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Z_rot[j, i] <span class="sc">&lt;</span> <span class="sc">-</span>minZ) {</span>
<span id="cb52-590"><a href="#cb52-590" aria-hidden="true" tabindex="-1"></a>      <span class="fu">text</span>(j, <span class="fl">0.03</span>, ylbl[j], <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, </span>
<span id="cb52-591"><a href="#cb52-591" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> clr[j])</span>
<span id="cb52-592"><a href="#cb52-592" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-593"><a href="#cb52-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb52-594"><a href="#cb52-594" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-595"><a href="#cb52-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtext</span>(<span class="fu">paste</span>(<span class="st">"Factor loadings on state"</span>, i), <span class="at">side =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="fl">0.5</span>)</span>
<span id="cb52-596"><a href="#cb52-596" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-597"><a href="#cb52-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-598"><a href="#cb52-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-601"><a href="#cb52-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-602"><a href="#cb52-602" aria-hidden="true" tabindex="-1"></a><span class="co">#display Z matrix</span></span>
<span id="cb52-603"><a href="#cb52-603" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb52-604"><a href="#cb52-604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-605"><a href="#cb52-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-608"><a href="#cb52-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-609"><a href="#cb52-609" aria-hidden="true" tabindex="-1"></a><span class="co">#display rotated z matrix that loadings come from</span></span>
<span id="cb52-610"><a href="#cb52-610" aria-hidden="true" tabindex="-1"></a>Z_rot</span>
<span id="cb52-611"><a href="#cb52-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-612"><a href="#cb52-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-613"><a href="#cb52-613" aria-hidden="true" tabindex="-1"></a>The plots show the loadings, or the weights, for each of the latent states. The loadings in the plots do not match with the values in the z matrix above because they must be rotated using the varimax function to produce the loading values we see plotted. Thus, the second table's values match with the loadings plot</span>
<span id="cb52-614"><a href="#cb52-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-615"><a href="#cb52-615" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results: Model fits and uncertainty </span></span>
<span id="cb52-616"><a href="#cb52-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-617"><a href="#cb52-617" aria-hidden="true" tabindex="-1"></a>The DFA fitting function comes from the lab notebook</span>
<span id="cb52-618"><a href="#cb52-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-621"><a href="#cb52-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-622"><a href="#cb52-622" aria-hidden="true" tabindex="-1"></a><span class="co">#this function was taken from the lab book</span></span>
<span id="cb52-623"><a href="#cb52-623" aria-hidden="true" tabindex="-1"></a><span class="co">#get model fits </span></span>
<span id="cb52-624"><a href="#cb52-624" aria-hidden="true" tabindex="-1"></a>get_DFA_fits <span class="ot">&lt;-</span> <span class="cf">function</span>(MLEobj, <span class="at">dd =</span> <span class="cn">NULL</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) {</span>
<span id="cb52-625"><a href="#cb52-625" aria-hidden="true" tabindex="-1"></a>  <span class="do">## empty list for results</span></span>
<span id="cb52-626"><a href="#cb52-626" aria-hidden="true" tabindex="-1"></a>  fits <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb52-627"><a href="#cb52-627" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extra stuff for var() calcs</span></span>
<span id="cb52-628"><a href="#cb52-628" aria-hidden="true" tabindex="-1"></a>  Ey <span class="ot">&lt;-</span> MARSS<span class="sc">:::</span><span class="fu">MARSShatyt</span>(MLEobj)</span>
<span id="cb52-629"><a href="#cb52-629" aria-hidden="true" tabindex="-1"></a>  <span class="do">## model params</span></span>
<span id="cb52-630"><a href="#cb52-630" aria-hidden="true" tabindex="-1"></a>  ZZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>Z</span>
<span id="cb52-631"><a href="#cb52-631" aria-hidden="true" tabindex="-1"></a>  <span class="do">## number of obs ts</span></span>
<span id="cb52-632"><a href="#cb52-632" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">1</span>]</span>
<span id="cb52-633"><a href="#cb52-633" aria-hidden="true" tabindex="-1"></a>  <span class="do">## number of time steps</span></span>
<span id="cb52-634"><a href="#cb52-634" aria-hidden="true" tabindex="-1"></a>  TT <span class="ot">&lt;-</span> <span class="fu">dim</span>(Ey<span class="sc">$</span>ytT)[<span class="dv">2</span>]</span>
<span id="cb52-635"><a href="#cb52-635" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get the inverse of the rotation matrix</span></span>
<span id="cb52-636"><a href="#cb52-636" aria-hidden="true" tabindex="-1"></a>  H_inv <span class="ot">&lt;-</span> <span class="fu">varimax</span>(ZZ)<span class="sc">$</span>rotmat</span>
<span id="cb52-637"><a href="#cb52-637" aria-hidden="true" tabindex="-1"></a>  <span class="do">## check for covars</span></span>
<span id="cb52-638"><a href="#cb52-638" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(dd)) {</span>
<span id="cb52-639"><a href="#cb52-639" aria-hidden="true" tabindex="-1"></a>    DD <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb52-640"><a href="#cb52-640" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model expectation</span></span>
<span id="cb52-641"><a href="#cb52-641" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states <span class="sc">+</span> DD <span class="sc">%*%</span> dd</span>
<span id="cb52-642"><a href="#cb52-642" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb52-643"><a href="#cb52-643" aria-hidden="true" tabindex="-1"></a>    <span class="do">## model expectation</span></span>
<span id="cb52-644"><a href="#cb52-644" aria-hidden="true" tabindex="-1"></a>    fits<span class="sc">$</span>ex <span class="ot">&lt;-</span> ZZ <span class="sc">%*%</span> H_inv <span class="sc">%*%</span> MLEobj<span class="sc">$</span>states</span>
<span id="cb52-645"><a href="#cb52-645" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-646"><a href="#cb52-646" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Var in model fits</span></span>
<span id="cb52-647"><a href="#cb52-647" aria-hidden="true" tabindex="-1"></a>  VtT <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(MLEobj)<span class="sc">$</span>VtT</span>
<span id="cb52-648"><a href="#cb52-648" aria-hidden="true" tabindex="-1"></a>  VV <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-649"><a href="#cb52-649" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tt <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb52-650"><a href="#cb52-650" aria-hidden="true" tabindex="-1"></a>    RZVZ <span class="ot">&lt;-</span> <span class="fu">coef</span>(MLEobj, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>R <span class="sc">-</span> ZZ <span class="sc">%*%</span> VtT[, </span>
<span id="cb52-651"><a href="#cb52-651" aria-hidden="true" tabindex="-1"></a>                                                         , tt] <span class="sc">%*%</span> <span class="fu">t</span>(ZZ)</span>
<span id="cb52-652"><a href="#cb52-652" aria-hidden="true" tabindex="-1"></a>    SS <span class="ot">&lt;-</span> Ey<span class="sc">$</span>yxtT[, , tt] <span class="sc">-</span> Ey<span class="sc">$</span>ytT[, tt, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> </span>
<span id="cb52-653"><a href="#cb52-653" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(MLEobj<span class="sc">$</span>states[, tt, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb52-654"><a href="#cb52-654" aria-hidden="true" tabindex="-1"></a>    VV <span class="ot">&lt;-</span> <span class="fu">cbind</span>(VV, <span class="fu">diag</span>(RZVZ <span class="sc">+</span> SS <span class="sc">%*%</span> <span class="fu">t</span>(ZZ) <span class="sc">+</span> ZZ <span class="sc">%*%</span> <span class="fu">t</span>(SS)))</span>
<span id="cb52-655"><a href="#cb52-655" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-656"><a href="#cb52-656" aria-hidden="true" tabindex="-1"></a>  SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(VV)</span>
<span id="cb52-657"><a href="#cb52-657" aria-hidden="true" tabindex="-1"></a>  <span class="do">## upper &amp; lower (1-alpha)% CI</span></span>
<span id="cb52-658"><a href="#cb52-658" aria-hidden="true" tabindex="-1"></a>  fits<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb52-659"><a href="#cb52-659" aria-hidden="true" tabindex="-1"></a>  fits<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> SE <span class="sc">+</span> fits<span class="sc">$</span>ex</span>
<span id="cb52-660"><a href="#cb52-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fits)</span>
<span id="cb52-661"><a href="#cb52-661" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-662"><a href="#cb52-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-663"><a href="#cb52-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-664"><a href="#cb52-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-665"><a href="#cb52-665" aria-hidden="true" tabindex="-1"></a>Plotting the model fits.</span>
<span id="cb52-666"><a href="#cb52-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-669"><a href="#cb52-669" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-670"><a href="#cb52-670" aria-hidden="true" tabindex="-1"></a><span class="co">#get model fit</span></span>
<span id="cb52-671"><a href="#cb52-671" aria-hidden="true" tabindex="-1"></a>top.fit <span class="ot">&lt;-</span> <span class="fu">get_DFA_fits</span>(top.mod, <span class="at">dd =</span> d[combo[[<span class="dv">15</span>]],])</span>
<span id="cb52-672"><a href="#cb52-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-673"><a href="#cb52-673" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the fit of the top model</span></span>
<span id="cb52-674"><a href="#cb52-674" aria-hidden="true" tabindex="-1"></a>ylbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb52-675"><a href="#cb52-675" aria-hidden="true" tabindex="-1"></a>w_ts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb52-676"><a href="#cb52-676" aria-hidden="true" tabindex="-1"></a>yr_start <span class="ot">&lt;-</span> <span class="dv">1967</span></span>
<span id="cb52-677"><a href="#cb52-677" aria-hidden="true" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Diatoms"</span>,<span class="st">"Greens"</span>,<span class="st">"Unicells"</span>,<span class="st">"Cyclops"</span>,<span class="st">"Rotifers"</span>)</span>
<span id="cb52-678"><a href="#cb52-678" aria-hidden="true" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"brown"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>, <span class="st">"purple"</span>)</span>
<span id="cb52-679"><a href="#cb52-679" aria-hidden="true" tabindex="-1"></a>cnt <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb52-680"><a href="#cb52-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-681"><a href="#cb52-681" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the fit</span></span>
<span id="cb52-682"><a href="#cb52-682" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(n_ts, <span class="dv">1</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb52-683"><a href="#cb52-683" aria-hidden="true" tabindex="-1"></a>                                                             <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb52-684"><a href="#cb52-684" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_ts) {</span>
<span id="cb52-685"><a href="#cb52-685" aria-hidden="true" tabindex="-1"></a>  up <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>up[i, ]</span>
<span id="cb52-686"><a href="#cb52-686" aria-hidden="true" tabindex="-1"></a>  mn <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>ex[i, ]</span>
<span id="cb52-687"><a href="#cb52-687" aria-hidden="true" tabindex="-1"></a>  lo <span class="ot">&lt;-</span> top.fit<span class="sc">$</span>lo[i, ]</span>
<span id="cb52-688"><a href="#cb52-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(w_ts, mn, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> ylbl[i], <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">type =</span> <span class="st">"n"</span>, </span>
<span id="cb52-689"><a href="#cb52-689" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(lo), <span class="fu">max</span>(up)))</span>
<span id="cb52-690"><a href="#cb52-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="dv">12</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span>, yr_start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">dim</span>(plankton_z)[<span class="dv">2</span>])</span>
<span id="cb52-691"><a href="#cb52-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(w_ts, plankton_z[i, ], <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> clr[i])</span>
<span id="cb52-692"><a href="#cb52-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, up, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb52-693"><a href="#cb52-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, mn, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb52-694"><a href="#cb52-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(w_ts, lo, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb52-695"><a href="#cb52-695" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-696"><a href="#cb52-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-697"><a href="#cb52-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-698"><a href="#cb52-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-699"><a href="#cb52-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-700"><a href="#cb52-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-701"><a href="#cb52-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-702"><a href="#cb52-702" aria-hidden="true" tabindex="-1"></a>The model fits look okay, but are not perfect for all time steps in some of the taxa (e.g., Diatoms, cylops, rotifers). This is probably because the plankton aren't perfectly synchronized through time and the three latent trends can't describe all of the variation across the five time series.</span>
<span id="cb52-703"><a href="#cb52-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-704"><a href="#cb52-704" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results: Covariate effects</span></span>
<span id="cb52-705"><a href="#cb52-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-708"><a href="#cb52-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-709"><a href="#cb52-709" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(top.mod<span class="sc">$</span>coef[<span class="dv">14</span><span class="sc">:</span><span class="dv">33</span>])</span>
<span id="cb52-710"><a href="#cb52-710" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coef)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"effect"</span></span>
<span id="cb52-711"><a href="#cb52-711" aria-hidden="true" tabindex="-1"></a>coef<span class="sc">$</span>covariate <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"TP"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"pH"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"cos_t"</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="st">"sin_t"</span>, <span class="dv">5</span>))</span>
<span id="cb52-712"><a href="#cb52-712" aria-hidden="true" tabindex="-1"></a>coef<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Diatoms'</span>, <span class="st">'Greens'</span>, <span class="st">'Unicells'</span>, <span class="st">'Cyclops'</span>, <span class="st">'Rotifers'</span>), <span class="dv">4</span>)</span>
<span id="cb52-713"><a href="#cb52-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-714"><a href="#cb52-714" aria-hidden="true" tabindex="-1"></a>effect_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(plot_object){</span>
<span id="cb52-715"><a href="#cb52-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_object, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> species, <span class="at">x =</span> effect, <span class="at">col =</span> species))<span class="sc">+</span></span>
<span id="cb52-716"><a href="#cb52-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">cex =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb52-717"><a href="#cb52-717" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb52-718"><a href="#cb52-718" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, </span>
<span id="cb52-719"><a href="#cb52-719" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">linewidth=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb52-720"><a href="#cb52-720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>,.<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb52-721"><a href="#cb52-721" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb52-722"><a href="#cb52-722" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-723"><a href="#cb52-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-724"><a href="#cb52-724" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"TP"</span>),] <span class="sc">%&gt;%</span></span>
<span id="cb52-725"><a href="#cb52-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb52-726"><a href="#cb52-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-727"><a href="#cb52-727" aria-hidden="true" tabindex="-1"></a>pH <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"pH"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb52-728"><a href="#cb52-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb52-729"><a href="#cb52-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-730"><a href="#cb52-730" aria-hidden="true" tabindex="-1"></a>cos <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"cos_t"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb52-731"><a href="#cb52-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb52-732"><a href="#cb52-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-733"><a href="#cb52-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-734"><a href="#cb52-734" aria-hidden="true" tabindex="-1"></a>sin <span class="ot">&lt;-</span> coef[<span class="fu">which</span>(coef<span class="sc">$</span>covariate<span class="sc">==</span><span class="st">"sin_t"</span>),]<span class="sc">%&gt;%</span></span>
<span id="cb52-735"><a href="#cb52-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">effect_plot</span>()</span>
<span id="cb52-736"><a href="#cb52-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-737"><a href="#cb52-737" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb52-738"><a href="#cb52-738" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ggarrange</span>(TP<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"TP"</span>),</span>
<span id="cb52-739"><a href="#cb52-739" aria-hidden="true" tabindex="-1"></a>                pH<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"pH"</span>),</span>
<span id="cb52-740"><a href="#cb52-740" aria-hidden="true" tabindex="-1"></a>                cos<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"cosine"</span>),</span>
<span id="cb52-741"><a href="#cb52-741" aria-hidden="true" tabindex="-1"></a>                sin<span class="sc">+</span><span class="fu">rremove</span>(<span class="st">"legend"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"sine"</span>),</span>
<span id="cb52-742"><a href="#cb52-742" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>))</span>
<span id="cb52-743"><a href="#cb52-743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-744"><a href="#cb52-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-747"><a href="#cb52-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-748"><a href="#cb52-748" aria-hidden="true" tabindex="-1"></a>D_mat <span class="ot">&lt;-</span> <span class="fu">coef</span>(top.mod, <span class="at">type =</span> <span class="st">"matrix"</span>)<span class="sc">$</span>D</span>
<span id="cb52-749"><a href="#cb52-749" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(D_mat) <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"TP"</span>,<span class="st">"pH"</span>,<span class="st">"cosine"</span>,<span class="st">"sine"</span>) </span>
<span id="cb52-750"><a href="#cb52-750" aria-hidden="true" tabindex="-1"></a>D_mat</span>
<span id="cb52-751"><a href="#cb52-751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-752"><a href="#cb52-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-753"><a href="#cb52-753" aria-hidden="true" tabindex="-1"></a>TP has a negative effect on diatoms and green algae, a positive effect on unicells and cylops, and no effect on rotifers. The effect of TP on diatoms and unicells tracks on with the literature-- increased P has been shown to increase the growth of bluegreen algae and dinoflagellates (unicells), decreasing the competitive availability of diatoms. Although not included in our analyses, we can see by looking at the raw data that during times of high phosphorus, cyanobacteria (bluegreen algae) bloomed. This likely influenced diatom and green algae populations through competitive exclusion processes.</span>
<span id="cb52-754"><a href="#cb52-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-755"><a href="#cb52-755" aria-hidden="true" tabindex="-1"></a>pH largely has a positive effect on all species of study, with the acceptance of green algal species. This suggests that greens do better under more acidic conditions (more carbon), whereas others are better suited to low CO2 (less acidic) levels.</span>
<span id="cb52-756"><a href="#cb52-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-757"><a href="#cb52-757" aria-hidden="true" tabindex="-1"></a>Our seasonality dummy variables (cosine and sine) represent winter (cosine) and springtime (sine) periods. During winter months when the curve is high, the effect of season on algal species is negative. The springtime curve has a negative effect on unicells, rotifers, and greens, a strong postive effect on diatoms, and no effect on cylops. This makes sense considering that spring algae blooms are generally dominated by diatoms.</span>
<span id="cb52-758"><a href="#cb52-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-759"><a href="#cb52-759" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model diagnostics</span></span>
<span id="cb52-760"><a href="#cb52-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-761"><a href="#cb52-761" aria-hidden="true" tabindex="-1"></a>Below we check our model residuals and plot the acfs.</span>
<span id="cb52-762"><a href="#cb52-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-765"><a href="#cb52-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-766"><a href="#cb52-766" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), <span class="at">mai =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>), <span class="at">omi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb52-767"><a href="#cb52-767" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">MARSSresiduals</span>(top.mod, <span class="at">type =</span> <span class="st">"tt1"</span>)</span>
<span id="cb52-768"><a href="#cb52-768" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb52-769"><a href="#cb52-769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(resids<span class="sc">$</span>model.residuals[i, ], <span class="at">ylab =</span> <span class="st">"model residuals"</span>, </span>
<span id="cb52-770"><a href="#cb52-770" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb52-771"><a href="#cb52-771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb52-772"><a href="#cb52-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="fu">rownames</span>(plankton_z)[i])</span>
<span id="cb52-773"><a href="#cb52-773" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-774"><a href="#cb52-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-775"><a href="#cb52-775" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(top.mod, <span class="at">plot.type =</span> <span class="st">"qqplot.std.model.resids.ytt1"</span>)</span>
<span id="cb52-776"><a href="#cb52-776" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(top.mod, <span class="at">plot.type =</span> <span class="st">"acf.std.model.resids.ytt1"</span>)</span>
<span id="cb52-777"><a href="#cb52-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-778"><a href="#cb52-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-779"><a href="#cb52-779" aria-hidden="true" tabindex="-1"></a>For the most part our model residuals look okay, with some potential residual pattern remaining in our Diatoms, Unicells, and Cyclops time series.</span>
<span id="cb52-780"><a href="#cb52-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-781"><a href="#cb52-781" aria-hidden="true" tabindex="-1"></a>Our data do appear to be normally distributed based on our qq-norm plots.</span>
<span id="cb52-782"><a href="#cb52-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-783"><a href="#cb52-783" aria-hidden="true" tabindex="-1"></a>The acf plots show some remaining auto-correlation in all of our algal time series with the exception of green algae. This suggests that there is some remaining variance not explained by our latent trends and model covariates. State 1 for example looks like it could maybe be some sort of oscillation (maybe). Future studies may want to consider some sort of larger climate variables that may influence algal abundance in Lake Washington.</span>
<span id="cb52-784"><a href="#cb52-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-785"><a href="#cb52-785" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb52-786"><a href="#cb52-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-787"><a href="#cb52-787" aria-hidden="true" tabindex="-1"></a>We z scored the response data and all of the covariates to help the MARSS models make better parameter estimations. We then found that the observed data was best explained by 3 latent states when we held the R matrix constant at Diagonal and equal and included all covariates. This was the maximum number of latent states that we tested and had we tested more latent states, a higher number would have won out over the rest. This is because a higher number of latent states would allow for more flexibility in the models to explain our data. A latent state for each of the individual species would likely have had the lowest AIC but our goal was to "reduce dimensions" and still be able to make predictions.</span>
<span id="cb52-788"><a href="#cb52-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-789"><a href="#cb52-789" aria-hidden="true" tabindex="-1"></a>This reduction in dimensions, explaining 5 observed datasets with 3 latent states, and the differences between the 5 species is why on areas of our fitted plots the predictions did not fit the data well.</span>
<span id="cb52-790"><a href="#cb52-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-791"><a href="#cb52-791" aria-hidden="true" tabindex="-1"></a>The direction of the effects of the covariates on each of the species made biological sense. We saw that the winter component of the season covariate strongly limited all of the species. The season covariate was present in a number of the top models and may have had enough predictive power to reduce the predictive value of temperature. We also saw that species capable of blooms, such as diatoms in the spring or dinoflagellates in the presence of high amounts of free phosphorus were capable of suppressing other populations. This could explain why the majority of species did not respond positively to the spring portion of the season covariate.</span>
<span id="cb52-792"><a href="#cb52-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-793"><a href="#cb52-793" aria-hidden="true" tabindex="-1"></a>Model diagnostics showed that the systematic form of our models may not have captured and removed all of the structure from the residuals. Future analyses could investigate other covariates like water turbidity which could affect the amount of light reaching into the water column which would be important for plankton species. Furthermore, another cyclical climatic variable may help reduce autocorrelation observed in the ACF plots. </span>
<span id="cb52-794"><a href="#cb52-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-795"><a href="#cb52-795" aria-hidden="true" tabindex="-1"></a><span class="fu"># Team contributions </span></span>
<span id="cb52-796"><a href="#cb52-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-797"><a href="#cb52-797" aria-hidden="true" tabindex="-1"></a>Both Dylan and Liz contributed code, interpretation, and discussion to this analysis.</span>
<span id="cb52-798"><a href="#cb52-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-799"><a href="#cb52-799" aria-hidden="true" tabindex="-1"></a>Outlined as general steps... </span>
<span id="cb52-800"><a href="#cb52-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-801"><a href="#cb52-801" aria-hidden="true" tabindex="-1"></a>1) Find the most parsimonious model among a set that examines the effects of environmental covariates and/or an indicator of seasonality (Dylan), varying numbers of trends (Liz), and different forms of variance-covariance matrices for the observation errors (Liz and Dylan).</span>
<span id="cb52-802"><a href="#cb52-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-803"><a href="#cb52-803" aria-hidden="true" tabindex="-1"></a>2)  Plot trends and individual loadings for the model identified in task (1) above. (Dylan)</span>
<span id="cb52-804"><a href="#cb52-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-805"><a href="#cb52-805" aria-hidden="true" tabindex="-1"></a>3)  Plot model fits and uncertainty intervals for the model identified in task (1) above. (Dylan)</span>
<span id="cb52-806"><a href="#cb52-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-807"><a href="#cb52-807" aria-hidden="true" tabindex="-1"></a>4)  Describe the effects of environmental or dummy variables on (possibly seasonal) patterns in the data. (Liz)</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>