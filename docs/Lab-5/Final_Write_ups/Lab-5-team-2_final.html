<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zoe Rand, Terrance Wang">
<meta name="dcterms.date" content="2023-05-11">

<title>24&nbsp; Team 2 - Lab 5 – Fish 550 Spring 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" rel="next">
<link href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-5/Lab-5-DLM.html">Dynamic Linear Models</a></li><li class="breadcrumb-item"><a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Lab-5-DLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Lab 5 - Dynamic Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Team 1 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#wrangle-the-data" id="toc-wrangle-the-data" class="nav-link" data-scroll-target="#wrangle-the-data">Wrangle the data</a></li>
  </ul></li>
  <li><a href="#general-tasks" id="toc-general-tasks" class="nav-link" data-scroll-target="#general-tasks">General tasks</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#reduced-ricker-model" id="toc-reduced-ricker-model" class="nav-link" data-scroll-target="#reduced-ricker-model">1. Reduced Ricker Model:</a>
  <ul class="collapse">
  <li><a href="#equations" id="toc-equations" class="nav-link" data-scroll-target="#equations">Equations:</a></li>
  <li><a href="#marss" id="toc-marss" class="nav-link" data-scroll-target="#marss">MARSS:</a></li>
  </ul></li>
  <li><a href="#full-ricker-model" id="toc-full-ricker-model" class="nav-link" data-scroll-target="#full-ricker-model">2. Full Ricker Model:</a>
  <ul class="collapse">
  <li><a href="#equations-1" id="toc-equations-1" class="nav-link" data-scroll-target="#equations-1">Equations:</a></li>
  <li><a href="#marss-1" id="toc-marss-1" class="nav-link" data-scroll-target="#marss-1">MARSS:</a></li>
  </ul></li>
  <li><a href="#full-ricker-model-with-summer-pdo" id="toc-full-ricker-model-with-summer-pdo" class="nav-link" data-scroll-target="#full-ricker-model-with-summer-pdo">3. Full Ricker Model with Summer PDO</a>
  <ul class="collapse">
  <li><a href="#equations-2" id="toc-equations-2" class="nav-link" data-scroll-target="#equations-2">Equations:</a></li>
  <li><a href="#marss-2" id="toc-marss-2" class="nav-link" data-scroll-target="#marss-2">MARSS:</a></li>
  </ul></li>
  <li><a href="#full-ricker-model-with-winter-pdo" id="toc-full-ricker-model-with-winter-pdo" class="nav-link" data-scroll-target="#full-ricker-model-with-winter-pdo">4. Full Ricker Model with Winter PDO</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#reduced-ricker-model-1" id="toc-reduced-ricker-model-1" class="nav-link" data-scroll-target="#reduced-ricker-model-1">1. Reduced Ricker Model</a></li>
  <li><a href="#full-ricker-model-1" id="toc-full-ricker-model-1" class="nav-link" data-scroll-target="#full-ricker-model-1">2. Full Ricker Model</a></li>
  <li><a href="#full-ricker-model-with-summer-pdo-1" id="toc-full-ricker-model-with-summer-pdo-1" class="nav-link" data-scroll-target="#full-ricker-model-with-summer-pdo-1">3. Full Ricker Model with Summer PDO</a></li>
  <li><a href="#full-ricker-model-with-winter-pdo-1" id="toc-full-ricker-model-with-winter-pdo-1" class="nav-link" data-scroll-target="#full-ricker-model-with-winter-pdo-1">4. Full Ricker Model with Winter PDO</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison">Model Comparison</a></li>
  <li><a href="#forecasting-with-reduced-ricker-model" id="toc-forecasting-with-reduced-ricker-model" class="nav-link" data-scroll-target="#forecasting-with-reduced-ricker-model">Forecasting with Reduced Ricker model</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#team-contributions" id="toc-team-contributions" class="nav-link" data-scroll-target="#team-contributions">Team contributions</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-5/Final_Write_ups/Lab-5-team-2_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-5/Final_Write_ups/Lab-5-team-2_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-5/Lab-5-DLM.html">Dynamic Linear Models</a></li><li class="breadcrumb-item"><a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Dynamic Linear Models (DLMs) - Time-varying productivity of salmon</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zoe Rand, Terrance Wang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 11, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<section id="data" class="level1">
<h1>Data</h1>
<p>Describe the salmon data and any environmental covariates you decide to examine.</p>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## library(devtools)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Windows users will likely need to set this</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Sys.setenv("R_REMOTES_NO_ERRORS_FROM_WARNINGS" = "true")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("nwfsc-timeseries/atsalibrary")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## get data</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(KvichakSockeye, <span class="at">package=</span><span class="st">"atsalibrary"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>SR_data <span class="ot">&lt;-</span> KvichakSockeye</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data are a dataframe with columns for brood year (<code>brood_year</code>), number of spawners (<code>spawners</code>), number of recruits (<code>recruits</code>) and PDO at year <span class="math inline">\(t-2\)</span> in summer (<code>pdo_summer_t2</code>) and in winter (<code>pdo_winter_t2</code>).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## head of data file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SR_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  brood_year spawners recruits pdo_summer_t2 pdo_winter_t2
1       1952       NA    20200         -2.79         -1.68
2       1953       NA      593         -1.20         -1.05
3       1954       NA      799         -1.85         -1.25
4       1955       NA     1500         -0.60         -0.68
5       1956     9440    39000         -0.50         -0.31
6       1957     2840     4090         -2.36         -1.78</code></pre>
</div>
</div>
</section>
<section id="wrangle-the-data" class="level2">
<h2 class="anchored" data-anchor-id="wrangle-the-data">Wrangle the data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#removing years with no spawner data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#creating log (recruits/spawners)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>SR_data<span class="ot">&lt;-</span>SR_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(spawners)) <span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">logSR =</span> <span class="fu">log</span>(recruits<span class="sc">/</span>spawners))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SR_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   brood_year [6]
  brood_year spawners recruits pdo_summer_t2 pdo_winter_t2   logSR
       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1       1956     9440    39000         -0.5          -0.31  1.42  
2       1957     2840     4090         -2.36         -1.78  0.365 
3       1958      535      289         -1.48         -2.14 -0.616 
4       1959      680      547          0.58          0    -0.218 
5       1960    14600    55300          1.05          0.68  1.33  
6       1961     3710     3500         -0.22          0.77 -0.0583</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(SR_data) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">y =</span> logSR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/wrangle_data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="general-tasks" class="level1">
<h1>General tasks</h1>
<p>Use the information and data in the previous section to answer the following questions. Note that if any model is not converging, then you will need to increase the <code>maxit</code> parameter in the <code>control</code> argument/list that gets passed to <code>MARSS()</code>. For example, you might try <code>control=list(maxit=2000)</code>.</p>
<ol type="1">
<li>Begin by fitting a reduced form of Ricker’s model that includes only a time-varying level (<span class="math inline">\(\alpha_t\)</span>) and observation error (<span class="math inline">\(v_t\)</span>). That is,</li>
</ol>
<span class="math display">\[\begin{align*}
\text{log}(R_t) &amp;= \alpha_t + \text{log}(S_t) + v_t \\
\text{log}(R_t/S_t) &amp;= \alpha_t + v_t
\end{align*}\]</span>
<p>This model assumes no density-dependent survival in that the number of recruits is an ascending function of spawners. Plot the ts of <span class="math inline">\(\alpha_t\)</span> and note the AICc for this model. Also plot appropriate model diagnostics.</p>
<ol start="2" type="1">
<li><p>Fit the full Ricker model with a time-varying intercept and a static effect of spawners. For this model, obtain the time series of <span class="math inline">\(\alpha_t\)</span>, which is an estimate of the stock productivity in the absence of density-dependent effects. How do these estimates of productivity compare to those from the previous question? Plot the ts of <span class="math inline">\(\alpha_t\)</span> and note the AICc for this model. Also plot appropriate model diagnostics. (<span class="math inline">\(Hint\)</span>: If you don’t want a parameter to vary with time, what does that say about its process variance?)</p></li>
<li><p>Fit the expanded model that includes the summer PDO index as the covariate (<code>pdo_summer_t2</code>). What is the mean level of productivity? Plot the ts of <span class="math inline">\(\delta_t\)</span> and note the AICc for this model. Also plot appropriate model diagnostics.</p></li>
<li><p>Fit the expanded model that includes the winter PDO index as the covariate (<code>pdo_winter_t2</code>). What is the mean level of productivity? Plot the ts of <span class="math inline">\(\delta_t\)</span> and note the AICc for this model. Also plot appropriate model diagnostics.</p></li>
<li><p>Based on AICc, which of the models above is the most parsimonious? Is it well behaved (i.e., are the model assumptions met)? Plot the model forecasts for the best model. Is this a good forecast model?</p></li>
<li><p>Consider other environmental factors that could influence the time-varying intrinsic productivity of these salmon. For example, are there other large-scale indices of ocean conditions (e.g., sea-surface temperature, El Niño Southern Oscillation)? You could also consider the possible influence of other salmon stocks such as those we examined in Lab 1.</p></li>
</ol>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>Please address the following in your methods:</p>
<ul>
<li><p>What environmental or dummy variables did you include and why?</p></li>
<li><p>What forms of models did you fit (ie, write them out in matrix form)?</p></li>
<li><p>What sort of model diagnostics did you use to examine model assumptions?</p></li>
</ul>
<section id="reduced-ricker-model" class="level2">
<h2 class="anchored" data-anchor-id="reduced-ricker-model">1. Reduced Ricker Model:</h2>
<section id="equations" class="level3">
<h3 class="anchored" data-anchor-id="equations">Equations:</h3>
<p><span class="math display">\[
\text{log}(R_t/S_t) = \alpha_t + v_t
\]</span></p>
<p><span class="math display">\[
\alpha_t = \alpha_{t-1} + w_t
\]</span></p>
<p>This is a MARSS model where <span class="math inline">\(Z = 1\)</span>, a random walk with observation error:</p>
<p>Set <span class="math inline">\(y_t = log(R_t/S_t)\)</span></p>
<p><span class="math display">\[
y_t = Zx_t + v_t
\]</span></p>
<p><span class="math display">\[
x_t = x_{t-1} + w_t
\]</span></p>
</section>
<section id="marss" class="level3">
<h3 class="anchored" data-anchor-id="marss">MARSS:</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MARSS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mod_list1<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> <span class="st">"identity"</span>, <span class="at">Z =</span> <span class="st">"identity"</span>, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fit model with MARSS:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 26 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 26 iterations. 
Log-likelihood: -51.87353 
AIC: 109.7471   AICc: 110.3625   
 
      Estimate
R.r      0.213
Q.q      0.301
x0.x0    0.998
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model diagnostics</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="full-ricker-model" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model">2. Full Ricker Model:</h2>
<section id="equations-1" class="level3">
<h3 class="anchored" data-anchor-id="equations-1">Equations:</h3>
<p><span class="math display">\[
\text{log}(R_t/S_t) = \alpha_t - bS_t +  v_t
\]</span></p>
<p><span class="math display">\[
\alpha_t = \alpha_{t-1} + w_t
\]</span></p>
</section>
<section id="marss-1" class="level3">
<h3 class="anchored" data-anchor-id="marss-1">MARSS:</h3>
<p><span class="math display">\[
y_t = Zx_t + v_t
\]</span></p>
<p><span class="math display">\[
v_t \sim N(0, r)
\]</span></p>
<p><span class="math display">\[
x_t = Bx_{t-1} + w_t
\]</span></p>
<p><span class="math display">\[
w_t \sim N(0, \begin{bmatrix} q &amp; 0 \\ 0 &amp; 0 \end{bmatrix})
\]</span></p>
<p>where <span class="math inline">\(B = \begin{bmatrix}1 &amp; 0\\0 &amp; 1\end{bmatrix}\)</span>, <span class="math inline">\(x_t = \begin{bmatrix} \alpha_t \\ b \end{bmatrix}\)</span>, <span class="math inline">\(Z = \begin{bmatrix} 1 &amp; S_t \end{bmatrix}\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, TT))  </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>SR_data<span class="sc">$</span>spawners <span class="co">#St</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>mod_list2<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list2, <span class="at">inits =</span> inits_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Success! abstol and log-log tests passed at 29 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 29 iterations. 
Log-likelihood: -51.81022 
AIC: 111.6204   AICc: 112.6731   
 
      Estimate
R.r   2.19e-01
Q.q   2.92e-01
x0.X1 9.35e-01
x0.X2 7.02e-06
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model diagnostics</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="full-ricker-model-with-summer-pdo" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model-with-summer-pdo">3. Full Ricker Model with Summer PDO</h2>
<section id="equations-2" class="level3">
<h3 class="anchored" data-anchor-id="equations-2">Equations:</h3>
<p><span class="math display">\[
\text{log}(R_t/S_t) = \alpha_t + \delta_t X_t - bS_t +  v_t
\]</span></p>
<p><span class="math display">\[
\alpha_t = \alpha_{t-1} + w_t
\]</span></p>
<p><span class="math display">\[
\delta_t = \delta_{t-1} + w_t
\]</span></p>
</section>
<section id="marss-2" class="level3">
<h3 class="anchored" data-anchor-id="marss-2">MARSS:</h3>
<p><span class="math display">\[
y_t = Zx_t + v_t
\]</span></p>
<p><span class="math display">\[
v_t \sim N(0, r)
\]</span></p>
<p><span class="math display">\[
x_t = Bx_{t-1} + w_t
\]</span></p>
<p><span class="math display">\[
w_t \sim N(0, \begin{bmatrix} q_\alpha &amp; 0 &amp; 0\\ 0 &amp; q_\delta &amp; 0 \\ 0 &amp; 0 &amp; 0 \end{bmatrix})
\]</span></p>
<p>where <span class="math inline">\(B = \begin{bmatrix}1 &amp; 0 &amp; 0 \\0 &amp; 1 &amp; 0 \\ 0&amp;0&amp;1\end{bmatrix}\)</span>, <span class="math inline">\(x_t = \begin{bmatrix} \alpha_t \\ \delta_t \\ b \end{bmatrix}\)</span>, <span class="math inline">\(Z = \begin{bmatrix} 1 &amp; X_t &amp; S_t \end{bmatrix}\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, TT))  </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>pdo_summer_t2) <span class="co">#summer PDO</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">3</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>spawners) <span class="co">#St</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q_alpha"</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"q_delta"</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>mod_list3<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list3, <span class="at">inits =</span> inits_list,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>,<span class="at">allow.degen=</span>F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=1000) reached before log-log convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=1000) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -51.81633 
AIC: 115.6327   AICc: 117.966   
 
          Estimate
R.r       2.00e-01
Q.q_alpha 3.16e-01
Q.q_delta 7.04e-05
x0.X1     1.02e+00
x0.X2     3.03e-02
x0.X3     5.48e-06
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  Q.q_delta  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
</div>
</section>
</section>
<section id="full-ricker-model-with-winter-pdo" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model-with-winter-pdo">4. Full Ricker Model with Winter PDO</h2>
<p>The equations for #4 are identical with #3, with the exception of Winter PDO as <span class="math inline">\(X_t\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, TT))  </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>pdo_winter_t2) <span class="co">#summer PDO</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">3</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>spawners) <span class="co">#St</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q_alpha"</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"q_delta"</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>mod_list3<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list3, <span class="at">inits =</span> inits_list,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>,<span class="at">allow.degen=</span>F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Warning! Abstol convergence only. Maxit (=1000) reached before log-log convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
WARNING: Abstol convergence only no log-log convergence.
 maxit (=1000) reached before log-log convergence.
 The likelihood and params might not be at the ML values.
 Try setting control$maxit higher.
Log-likelihood: -51.44443 
AIC: 114.8889   AICc: 117.2222   
 
          Estimate
R.r       1.97e-01
Q.q_alpha 3.11e-01
Q.q_delta 2.27e-04
x0.X1     1.13e+00
x0.X2     1.54e-01
x0.X3     1.38e-06
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.

Convergence warnings
 Warning: the  Q.q_delta  parameter value has not converged.
 Type MARSSinfo("convergence") for more info on this warning.</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="reduced-ricker-model-1" class="level2">
<h2 class="anchored" data-anchor-id="reduced-ricker-model-1">1. Reduced Ricker Model</h2>
<p>Plot of model fit (time series of <span class="math inline">\(\alpha_t\)</span>)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SR_data) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">y =</span> logSR), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">ymin =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>fit1<span class="sc">$</span>states.se), <span class="at">ymax =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fit1<span class="sc">$</span>states.se)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">y =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states)), <span class="at">color =</span> <span class="st">'blue'</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="full-ricker-model-1" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model-1">2. Full Ricker Model</h2>
<p>Time series of regression parameters</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#slope results</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states.se[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean:  7.01979994813666e-06"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SE:  0"</code></pre>
</div>
</div>
</section>
<section id="full-ricker-model-with-summer-pdo-1" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model-with-summer-pdo-1">3. Full Ricker Model with Summer PDO</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summer pdo slope results</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">2</span>,]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">2</span>,]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> slp_mn<span class="dv">-2</span><span class="sc">*</span>slp_se, <span class="at">ymax =</span> slp_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>slp_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> slp_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"delta_t (SummerPDO)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Time-varying <span class="math inline">\(\delta_t\)</span> seems unnecessary given its constant nature and very low value.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spawner slope results</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean:  5.47724897779201e-06"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SE:  0"</code></pre>
</div>
</div>
<p>Time-varying <span class="math inline">\(\delta_t\)</span> seems unnecessary given its constant nature and very low value.</p>
</section>
<section id="full-ricker-model-with-winter-pdo-1" class="level2">
<h2 class="anchored" data-anchor-id="full-ricker-model-with-winter-pdo-1">4. Full Ricker Model with Winter PDO</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#winter pdo slope results</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">2</span>,]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">2</span>,]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> slp_mn<span class="dv">-2</span><span class="sc">*</span>slp_se, <span class="at">ymax =</span> slp_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>slp_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> slp_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"delta_t (WinterPDO)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spawner slope results</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean:  1.38299313195267e-06"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SE:  0"</code></pre>
</div>
</div>
<p>Time-varying <span class="math inline">\(\delta_t\)</span> seems unnecessary given its constant nature and very low value.</p>
</section>
<section id="model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison">Model Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>AIC_tab<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="st">"Model"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Reduced Ricker"</span>, <span class="st">"Full Ricker"</span>, <span class="st">"Full w/ Summer PDO"</span>, <span class="st">"Full w/ Winter PDO"</span>), <span class="st">"AICc"</span> <span class="ot">=</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>AIC_tab<span class="ot">&lt;-</span> AIC_tab <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">DeltaAIC =</span> AICc<span class="sc">-</span><span class="fu">min</span>(AICc))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>AIC_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Model               AICc DeltaAIC
  &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;
1 Reduced Ricker      110.     0   
2 Full Ricker         113.     2.31
3 Full w/ Summer PDO  118.     7.60
4 Full w/ Winter PDO  117.     6.86</code></pre>
</div>
</div>
<p>Reduced ricker is the best model, which makes sense since the estimate for the b parameter is essentially 0 in the other 3 models. Additionally the covariate parameters for Summer and PDO are both very low as well. All models are basically the same except the full ricker, and full ricker w/ covariates have extra parameter(s).</p>
</section>
<section id="forecasting-with-reduced-ricker-model" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-with-reduced-ricker-model">Forecasting with Reduced Ricker model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">## get list of Kalman filter output</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>kf_out <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(fit1)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="do">## forecasts of regr parameters; 2xT matrix</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> kf_out<span class="sc">$</span>xtt1</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>mod_list1<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> <span class="st">"identity"</span>, <span class="at">Z =</span> <span class="st">"identity"</span>, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, TT))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>Z[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ts of E(forecasts)</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>fore_mean <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  fore_mean[t] <span class="ot">&lt;-</span> Z[,t] <span class="sc">%*%</span> eta[, t, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="do">## variance of regr parameters; 1x2xT array</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>Phi <span class="ot">&lt;-</span> kf_out<span class="sc">$</span>Vtt1</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="do">## obs variance; 1x1 matrix</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>R_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>R</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="do">## ts of Var(forecasts)</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>fore_var <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  tZ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Z[,t], <span class="dv">1</span>, <span class="dv">1</span>) <span class="do">## transpose of Z</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  fore_var[t] <span class="ot">&lt;-</span> Z[, t] <span class="sc">%*%</span> Phi[,,t] <span class="sc">%*%</span> tZ <span class="sc">+</span> R_est</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span>fore_mean)) <span class="sc">+</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> fore_mean<span class="dv">-2</span><span class="sc">*</span>fore_var, <span class="at">ymax =</span> fore_mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fore_var), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span>SR_data<span class="sc">$</span>logSR),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"Log(R/S)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span><span class="fu">exp</span>(fore_mean))) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> <span class="fu">exp</span>(fore_mean<span class="dv">-2</span><span class="sc">*</span>fore_var), <span class="at">ymax =</span> <span class="fu">exp</span>(fore_mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fore_var)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span><span class="fu">exp</span>(SR_data<span class="sc">$</span>logSR)),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"R/S"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-5-team-2_final_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Observed values almost all fall within the prediction intervals. This is a reasonably well fitting model, however there is an AR1 lag between prediction and observation. This AR1 lag seems to be common throughout most time series prediction models.</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We found that Kvichak sockeye recruitment/spawner ratio can be explained well by the simplest Ricker spawner-recruit model with only a time-varying level and observation error, essentially a simple random walk process. Based on the AICc, the best performing model was the simplest model without any density-dependent or PDO information. This is somewhat surprising, as we expected density dependence or conditions in the environment to have an effect. There may be environmental factors besides PDO that we did not account for this model that might influence productivity, including ENSO, SST, and sea surface air pressure (Ovando et al.&nbsp;2022).</p>
</section>
<section id="team-contributions" class="level1">
<h1>Team contributions</h1>
<p>ZR did the data wrangling and wrote the methods, code, and results for the first two models (reduced and full Ricker). TW wrote the methods, code, and results for the models with covariates and the forecasting. Both team members contributed to the discussion.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/atsa-es\.github\.io\/fish550-2023\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" class="pagination-link" aria-label="Team 1 - Lab 5">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Team 1 - Lab 5</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" class="pagination-link" aria-label="Team 3 - Lab 5">
        <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb48" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Team 2 - Lab 5"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Dynamic Linear Models (DLMs) - Time-varying productivity of salmon"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Zoe Rand, Terrance Wang"</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> May 11, 2023</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="in">options(dplyr.summarise.inform = FALSE)</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>Describe the salmon data and any environmental covariates you decide to examine.</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the data</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dlm-load-atsa, eval=TRUE}</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="in">## library(devtools)</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="in">## Windows users will likely need to set this</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="in">## Sys.setenv("R_REMOTES_NO_ERRORS_FROM_WARNINGS" = "true")</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="in">#devtools::install_github("nwfsc-timeseries/atsalibrary")</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="in">## get data</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="in">data(KvichakSockeye, package="atsalibrary")</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="in">SR_data &lt;- KvichakSockeye</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>The data are a dataframe with columns for brood year (<span class="in">`brood_year`</span>), number of spawners (<span class="in">`spawners`</span>), number of recruits (<span class="in">`recruits`</span>) and PDO at year $t-2$ in summer (<span class="in">`pdo_summer_t2`</span>) and in winter (<span class="in">`pdo_winter_t2`</span>).</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dlm-data-head}</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="in">## head of data file</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="in">head(SR_data)</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wrangle the data</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE}</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wrangle_data}</span></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a><span class="in">#removing years with no spawner data</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="in">#creating log (recruits/spawners)</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="in">SR_data&lt;-SR_data %&gt;% filter(!is.na(spawners)) %&gt;%mutate(logSR = log(recruits/spawners))</span></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a><span class="in">head(SR_data)</span></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(SR_data) + geom_line(aes(x = brood_year, y = logSR))</span></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="fu"># General tasks</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>Use the information and data in the previous section to answer the following questions. Note that if any model is not converging, then you will need to increase the <span class="in">`maxit`</span> parameter in the <span class="in">`control`</span> argument/list that gets passed to <span class="in">`MARSS()`</span>. For example, you might try <span class="in">`control=list(maxit=2000)`</span>.</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Begin by fitting a reduced form of Ricker's model that includes only a time-varying level ($\alpha_t$) and observation error ($v_t$). That is,</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{=tex}</span></span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{align*}</span></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="in">\text{log}(R_t) &amp;= \alpha_t + \text{log}(S_t) + v_t \\</span></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="in">\text{log}(R_t/S_t) &amp;= \alpha_t + v_t</span></span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a><span class="in">\end{align*}</span></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>This model assumes no density-dependent survival in that the number of recruits is an ascending function of spawners. Plot the ts of $\alpha_t$ and note the AICc for this model. Also plot appropriate model diagnostics.</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Fit the full Ricker model with a time-varying intercept and a static effect of spawners. For this model, obtain the time series of $\alpha_t$, which is an estimate of the stock productivity in the absence of density-dependent effects. How do these estimates of productivity compare to those from the previous question? Plot the ts of $\alpha_t$ and note the AICc for this model. Also plot appropriate model diagnostics. ($Hint$: If you don't want a parameter to vary with time, what does that say about its process variance?)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Fit the expanded model that includes the summer PDO index as the covariate (<span class="in">`pdo_summer_t2`</span>). What is the mean level of productivity? Plot the ts of $\delta_t$ and note the AICc for this model. Also plot appropriate model diagnostics.</span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Fit the expanded model that includes the winter PDO index as the covariate (<span class="in">`pdo_winter_t2`</span>). What is the mean level of productivity? Plot the ts of $\delta_t$ and note the AICc for this model. Also plot appropriate model diagnostics.</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Based on AICc, which of the models above is the most parsimonious? Is it well behaved (i.e., are the model assumptions met)? Plot the model forecasts for the best model. Is this a good forecast model?</span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Consider other environmental factors that could influence the time-varying intrinsic productivity of these salmon. For example, are there other large-scale indices of ocean conditions (e.g., sea-surface temperature, El Niño Southern Oscillation)? You could also consider the possible influence of other salmon stocks such as those we examined in Lab 1.</span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a>Please address the following in your methods:</span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What environmental or dummy variables did you include and why?</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What forms of models did you fit (ie, write them out in matrix form)?</span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What sort of model diagnostics did you use to examine model assumptions?</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Reduced Ricker Model:</span></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a><span class="fu">### Equations:</span></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a>\text{log}(R_t/S_t) = \alpha_t + v_t</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a>\alpha_t = \alpha_{t-1} + w_t</span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a>This is a MARSS model where $Z = 1$, a random walk with observation error:</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a>Set $y_t = log(R_t/S_t)$</span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>y_t = Zx_t + v_t</span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-110"><a href="#cb48-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-111"><a href="#cb48-111" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-112"><a href="#cb48-112" aria-hidden="true" tabindex="-1"></a>x_t = x_{t-1} + w_t</span>
<span id="cb48-113"><a href="#cb48-113" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-114"><a href="#cb48-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-115"><a href="#cb48-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### MARSS:</span></span>
<span id="cb48-116"><a href="#cb48-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-117"><a href="#cb48-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE}</span></span>
<span id="cb48-118"><a href="#cb48-118" aria-hidden="true" tabindex="-1"></a><span class="in">library(MARSS)</span></span>
<span id="cb48-119"><a href="#cb48-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-120"><a href="#cb48-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-123"><a href="#cb48-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-124"><a href="#cb48-124" aria-hidden="true" tabindex="-1"></a>mod_list1<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> <span class="st">"identity"</span>, <span class="at">Z =</span> <span class="st">"identity"</span>, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb48-125"><a href="#cb48-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-126"><a href="#cb48-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-129"><a href="#cb48-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-130"><a href="#cb48-130" aria-hidden="true" tabindex="-1"></a><span class="co">#fit model with MARSS:</span></span>
<span id="cb48-131"><a href="#cb48-131" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list1)</span>
<span id="cb48-132"><a href="#cb48-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-133"><a href="#cb48-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-136"><a href="#cb48-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-137"><a href="#cb48-137" aria-hidden="true" tabindex="-1"></a><span class="co">#model diagnostics</span></span>
<span id="cb48-138"><a href="#cb48-138" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit1, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb48-139"><a href="#cb48-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-140"><a href="#cb48-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-141"><a href="#cb48-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Full Ricker Model:</span></span>
<span id="cb48-142"><a href="#cb48-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-143"><a href="#cb48-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### Equations:</span></span>
<span id="cb48-144"><a href="#cb48-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-145"><a href="#cb48-145" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-146"><a href="#cb48-146" aria-hidden="true" tabindex="-1"></a>\text{log}(R_t/S_t) = \alpha_t - bS_t +  v_t</span>
<span id="cb48-147"><a href="#cb48-147" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-148"><a href="#cb48-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-149"><a href="#cb48-149" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-150"><a href="#cb48-150" aria-hidden="true" tabindex="-1"></a>\alpha_t = \alpha_{t-1} + w_t</span>
<span id="cb48-151"><a href="#cb48-151" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-152"><a href="#cb48-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-153"><a href="#cb48-153" aria-hidden="true" tabindex="-1"></a><span class="fu">### MARSS:</span></span>
<span id="cb48-154"><a href="#cb48-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-155"><a href="#cb48-155" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-156"><a href="#cb48-156" aria-hidden="true" tabindex="-1"></a>y_t = Zx_t + v_t</span>
<span id="cb48-157"><a href="#cb48-157" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-158"><a href="#cb48-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-159"><a href="#cb48-159" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-160"><a href="#cb48-160" aria-hidden="true" tabindex="-1"></a>v_t \sim N(0, r)</span>
<span id="cb48-161"><a href="#cb48-161" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-162"><a href="#cb48-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-163"><a href="#cb48-163" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-164"><a href="#cb48-164" aria-hidden="true" tabindex="-1"></a>x_t = Bx_{t-1} + w_t</span>
<span id="cb48-165"><a href="#cb48-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-166"><a href="#cb48-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-167"><a href="#cb48-167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-168"><a href="#cb48-168" aria-hidden="true" tabindex="-1"></a>w_t \sim N(0, \begin{bmatrix} q &amp; 0 <span class="sc">\\</span> 0 &amp; 0 \end{bmatrix})</span>
<span id="cb48-169"><a href="#cb48-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-170"><a href="#cb48-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-171"><a href="#cb48-171" aria-hidden="true" tabindex="-1"></a>where $B = \begin{bmatrix}1 &amp; 0<span class="sc">\\</span>0 &amp; 1\end{bmatrix}$, $x_t = \begin{bmatrix} \alpha_t <span class="sc">\\</span> b \end{bmatrix}$, $Z = \begin{bmatrix} 1 &amp; S_t \end{bmatrix}$</span>
<span id="cb48-172"><a href="#cb48-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-175"><a href="#cb48-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-176"><a href="#cb48-176" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb48-177"><a href="#cb48-177" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-178"><a href="#cb48-178" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb48-179"><a href="#cb48-179" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, TT))  </span>
<span id="cb48-180"><a href="#cb48-180" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb48-181"><a href="#cb48-181" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>SR_data<span class="sc">$</span>spawners <span class="co">#St</span></span>
<span id="cb48-182"><a href="#cb48-182" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb48-183"><a href="#cb48-183" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q"</span></span>
<span id="cb48-184"><a href="#cb48-184" aria-hidden="true" tabindex="-1"></a>mod_list2<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb48-185"><a href="#cb48-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-186"><a href="#cb48-186" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">2</span>))</span>
<span id="cb48-187"><a href="#cb48-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-188"><a href="#cb48-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-191"><a href="#cb48-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-192"><a href="#cb48-192" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list2, <span class="at">inits =</span> inits_list)</span>
<span id="cb48-193"><a href="#cb48-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-194"><a href="#cb48-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-197"><a href="#cb48-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-198"><a href="#cb48-198" aria-hidden="true" tabindex="-1"></a><span class="co">#model diagnostics</span></span>
<span id="cb48-199"><a href="#cb48-199" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit2, <span class="at">plot.type=</span><span class="st">"fitted.ytT"</span>)</span>
<span id="cb48-200"><a href="#cb48-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-201"><a href="#cb48-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-202"><a href="#cb48-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Full Ricker Model with Summer PDO</span></span>
<span id="cb48-203"><a href="#cb48-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-204"><a href="#cb48-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### Equations:</span></span>
<span id="cb48-205"><a href="#cb48-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-206"><a href="#cb48-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-207"><a href="#cb48-207" aria-hidden="true" tabindex="-1"></a>\text{log}(R_t/S_t) = \alpha_t + \delta_t X_t - bS_t +  v_t</span>
<span id="cb48-208"><a href="#cb48-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-209"><a href="#cb48-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-210"><a href="#cb48-210" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-211"><a href="#cb48-211" aria-hidden="true" tabindex="-1"></a>\alpha_t = \alpha_{t-1} + w_t</span>
<span id="cb48-212"><a href="#cb48-212" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-213"><a href="#cb48-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-214"><a href="#cb48-214" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-215"><a href="#cb48-215" aria-hidden="true" tabindex="-1"></a>\delta_t = \delta_{t-1} + w_t</span>
<span id="cb48-216"><a href="#cb48-216" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-217"><a href="#cb48-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-218"><a href="#cb48-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### MARSS:</span></span>
<span id="cb48-219"><a href="#cb48-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-220"><a href="#cb48-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-221"><a href="#cb48-221" aria-hidden="true" tabindex="-1"></a>y_t = Zx_t + v_t</span>
<span id="cb48-222"><a href="#cb48-222" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-223"><a href="#cb48-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-224"><a href="#cb48-224" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-225"><a href="#cb48-225" aria-hidden="true" tabindex="-1"></a>v_t \sim N(0, r)</span>
<span id="cb48-226"><a href="#cb48-226" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-227"><a href="#cb48-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-228"><a href="#cb48-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-229"><a href="#cb48-229" aria-hidden="true" tabindex="-1"></a>x_t = Bx_{t-1} + w_t</span>
<span id="cb48-230"><a href="#cb48-230" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-231"><a href="#cb48-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-232"><a href="#cb48-232" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-233"><a href="#cb48-233" aria-hidden="true" tabindex="-1"></a>w_t \sim N(0, \begin{bmatrix} q_\alpha &amp; 0 &amp; 0<span class="sc">\\</span> 0 &amp; q_\delta &amp; 0 <span class="sc">\\</span> 0 &amp; 0 &amp; 0 \end{bmatrix})</span>
<span id="cb48-234"><a href="#cb48-234" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb48-235"><a href="#cb48-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-236"><a href="#cb48-236" aria-hidden="true" tabindex="-1"></a>where $B = \begin{bmatrix}1 &amp; 0 &amp; 0 <span class="sc">\\</span>0 &amp; 1 &amp; 0 <span class="sc">\\</span> 0&amp;0&amp;1\end{bmatrix}$, $x_t = \begin{bmatrix} \alpha_t <span class="sc">\\</span> \delta_t <span class="sc">\\</span> b \end{bmatrix}$, $Z = \begin{bmatrix} 1 &amp; X_t &amp; S_t \end{bmatrix}$</span>
<span id="cb48-237"><a href="#cb48-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-240"><a href="#cb48-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-241"><a href="#cb48-241" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb48-242"><a href="#cb48-242" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-243"><a href="#cb48-243" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb48-244"><a href="#cb48-244" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, TT))  </span>
<span id="cb48-245"><a href="#cb48-245" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb48-246"><a href="#cb48-246" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>pdo_summer_t2) <span class="co">#summer PDO</span></span>
<span id="cb48-247"><a href="#cb48-247" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">3</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>spawners) <span class="co">#St</span></span>
<span id="cb48-248"><a href="#cb48-248" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb48-249"><a href="#cb48-249" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q_alpha"</span></span>
<span id="cb48-250"><a href="#cb48-250" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"q_delta"</span></span>
<span id="cb48-251"><a href="#cb48-251" aria-hidden="true" tabindex="-1"></a>mod_list3<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb48-252"><a href="#cb48-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-253"><a href="#cb48-253" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span>
<span id="cb48-254"><a href="#cb48-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-255"><a href="#cb48-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-258"><a href="#cb48-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-259"><a href="#cb48-259" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list3, <span class="at">inits =</span> inits_list,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>,<span class="at">allow.degen=</span>F))</span>
<span id="cb48-260"><a href="#cb48-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-261"><a href="#cb48-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-262"><a href="#cb48-262" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Full Ricker Model with Winter PDO</span></span>
<span id="cb48-263"><a href="#cb48-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-264"><a href="#cb48-264" aria-hidden="true" tabindex="-1"></a>The equations for #4 are identical with #3, with the exception of Winter PDO as $X_t$</span>
<span id="cb48-265"><a href="#cb48-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-268"><a href="#cb48-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-269"><a href="#cb48-269" aria-hidden="true" tabindex="-1"></a><span class="co">#setting up model</span></span>
<span id="cb48-270"><a href="#cb48-270" aria-hidden="true" tabindex="-1"></a>Bmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-271"><a href="#cb48-271" aria-hidden="true" tabindex="-1"></a>TT<span class="ot">&lt;-</span><span class="fu">nrow</span>(SR_data)</span>
<span id="cb48-272"><a href="#cb48-272" aria-hidden="true" tabindex="-1"></a>ZZ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, TT))  </span>
<span id="cb48-273"><a href="#cb48-273" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) <span class="co">#intercept</span></span>
<span id="cb48-274"><a href="#cb48-274" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">2</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>pdo_winter_t2) <span class="co">#summer PDO</span></span>
<span id="cb48-275"><a href="#cb48-275" aria-hidden="true" tabindex="-1"></a>ZZ[<span class="dv">1</span>,<span class="dv">3</span>,]<span class="ot">&lt;-</span>(SR_data<span class="sc">$</span>spawners) <span class="co">#St</span></span>
<span id="cb48-276"><a href="#cb48-276" aria-hidden="true" tabindex="-1"></a>QQ<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>), <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb48-277"><a href="#cb48-277" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="st">"q_alpha"</span></span>
<span id="cb48-278"><a href="#cb48-278" aria-hidden="true" tabindex="-1"></a>QQ[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"q_delta"</span></span>
<span id="cb48-279"><a href="#cb48-279" aria-hidden="true" tabindex="-1"></a>mod_list3<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> Bmat, <span class="at">Z =</span> ZZ, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> QQ, <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb48-280"><a href="#cb48-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-281"><a href="#cb48-281" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x0 =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>))</span>
<span id="cb48-282"><a href="#cb48-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-283"><a href="#cb48-283" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">&lt;-</span><span class="fu">MARSS</span>(SR_data<span class="sc">$</span>logSR, mod_list3, <span class="at">inits =</span> inits_list,<span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>,<span class="at">allow.degen=</span>F))</span>
<span id="cb48-284"><a href="#cb48-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-285"><a href="#cb48-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-286"><a href="#cb48-286" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb48-287"><a href="#cb48-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-288"><a href="#cb48-288" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Reduced Ricker Model</span></span>
<span id="cb48-289"><a href="#cb48-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-290"><a href="#cb48-290" aria-hidden="true" tabindex="-1"></a>Plot of model fit (time series of $\alpha_t$)</span>
<span id="cb48-291"><a href="#cb48-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-294"><a href="#cb48-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-295"><a href="#cb48-295" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SR_data) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">y =</span> logSR), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">ymin =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>fit1<span class="sc">$</span>states.se), <span class="at">ymax =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fit1<span class="sc">$</span>states.se)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> brood_year, <span class="at">y =</span> <span class="fu">t</span>(fit1<span class="sc">$</span>states)), <span class="at">color =</span> <span class="st">'blue'</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span>
<span id="cb48-296"><a href="#cb48-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-297"><a href="#cb48-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-298"><a href="#cb48-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Full Ricker Model</span></span>
<span id="cb48-299"><a href="#cb48-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-300"><a href="#cb48-300" aria-hidden="true" tabindex="-1"></a>Time series of regression parameters</span>
<span id="cb48-301"><a href="#cb48-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-304"><a href="#cb48-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-305"><a href="#cb48-305" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb48-306"><a href="#cb48-306" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb48-307"><a href="#cb48-307" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb48-308"><a href="#cb48-308" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span>
<span id="cb48-309"><a href="#cb48-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-310"><a href="#cb48-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-313"><a href="#cb48-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-314"><a href="#cb48-314" aria-hidden="true" tabindex="-1"></a><span class="co">#slope results</span></span>
<span id="cb48-315"><a href="#cb48-315" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb48-316"><a href="#cb48-316" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit2<span class="sc">$</span>states.se[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb48-317"><a href="#cb48-317" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span>
<span id="cb48-318"><a href="#cb48-318" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span>
<span id="cb48-319"><a href="#cb48-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-320"><a href="#cb48-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-321"><a href="#cb48-321" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Full Ricker Model with Summer PDO</span></span>
<span id="cb48-322"><a href="#cb48-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-325"><a href="#cb48-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-326"><a href="#cb48-326" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb48-327"><a href="#cb48-327" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb48-328"><a href="#cb48-328" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb48-329"><a href="#cb48-329" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span>
<span id="cb48-330"><a href="#cb48-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-331"><a href="#cb48-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-334"><a href="#cb48-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-335"><a href="#cb48-335" aria-hidden="true" tabindex="-1"></a><span class="co">#summer pdo slope results</span></span>
<span id="cb48-336"><a href="#cb48-336" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">2</span>,]</span>
<span id="cb48-337"><a href="#cb48-337" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">2</span>,]</span>
<span id="cb48-338"><a href="#cb48-338" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> slp_mn<span class="dv">-2</span><span class="sc">*</span>slp_se, <span class="at">ymax =</span> slp_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>slp_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> slp_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"delta_t (SummerPDO)"</span>)</span>
<span id="cb48-339"><a href="#cb48-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-340"><a href="#cb48-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-341"><a href="#cb48-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-342"><a href="#cb48-342" aria-hidden="true" tabindex="-1"></a>Time-varying $\delta_t$ seems unnecessary given its constant nature and very low value.</span>
<span id="cb48-343"><a href="#cb48-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-346"><a href="#cb48-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-347"><a href="#cb48-347" aria-hidden="true" tabindex="-1"></a><span class="co"># spawner slope results</span></span>
<span id="cb48-348"><a href="#cb48-348" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb48-349"><a href="#cb48-349" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit3<span class="sc">$</span>states.se[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb48-350"><a href="#cb48-350" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span>
<span id="cb48-351"><a href="#cb48-351" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span>
<span id="cb48-352"><a href="#cb48-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-353"><a href="#cb48-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-354"><a href="#cb48-354" aria-hidden="true" tabindex="-1"></a>Time-varying $\delta_t$ seems unnecessary given its constant nature and very low value.</span>
<span id="cb48-355"><a href="#cb48-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-356"><a href="#cb48-356" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Full Ricker Model with Winter PDO</span></span>
<span id="cb48-357"><a href="#cb48-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-360"><a href="#cb48-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-361"><a href="#cb48-361" aria-hidden="true" tabindex="-1"></a><span class="co">#intercept</span></span>
<span id="cb48-362"><a href="#cb48-362" aria-hidden="true" tabindex="-1"></a>int_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">1</span>,]</span>
<span id="cb48-363"><a href="#cb48-363" aria-hidden="true" tabindex="-1"></a>int_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">1</span>,]</span>
<span id="cb48-364"><a href="#cb48-364" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> int_mn<span class="dv">-2</span><span class="sc">*</span>int_se, <span class="at">ymax =</span> int_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>int_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> int_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"alpha_t"</span>)</span>
<span id="cb48-365"><a href="#cb48-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-366"><a href="#cb48-366" aria-hidden="true" tabindex="-1"></a><span class="co">#winter pdo slope results</span></span>
<span id="cb48-367"><a href="#cb48-367" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">2</span>,]</span>
<span id="cb48-368"><a href="#cb48-368" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">2</span>,]</span>
<span id="cb48-369"><a href="#cb48-369" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> slp_mn<span class="dv">-2</span><span class="sc">*</span>slp_se, <span class="at">ymax =</span> slp_mn <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>slp_se), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y =</span> slp_mn), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Brood Year"</span>, <span class="at">y =</span> <span class="st">"delta_t (WinterPDO)"</span>)</span>
<span id="cb48-370"><a href="#cb48-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-371"><a href="#cb48-371" aria-hidden="true" tabindex="-1"></a><span class="co"># spawner slope results</span></span>
<span id="cb48-372"><a href="#cb48-372" aria-hidden="true" tabindex="-1"></a>slp_mn<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb48-373"><a href="#cb48-373" aria-hidden="true" tabindex="-1"></a>slp_se<span class="ot">&lt;-</span>fit4<span class="sc">$</span>states.se[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb48-374"><a href="#cb48-374" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Mean: "</span>, slp_mn))</span>
<span id="cb48-375"><a href="#cb48-375" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"SE: "</span>, slp_se))</span>
<span id="cb48-376"><a href="#cb48-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-377"><a href="#cb48-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-378"><a href="#cb48-378" aria-hidden="true" tabindex="-1"></a>Time-varying $\delta_t$ seems unnecessary given its constant nature and very low value.</span>
<span id="cb48-379"><a href="#cb48-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-380"><a href="#cb48-380" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Comparison</span></span>
<span id="cb48-381"><a href="#cb48-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-384"><a href="#cb48-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-385"><a href="#cb48-385" aria-hidden="true" tabindex="-1"></a>AIC_tab<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="st">"Model"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Reduced Ricker"</span>, <span class="st">"Full Ricker"</span>, <span class="st">"Full w/ Summer PDO"</span>, <span class="st">"Full w/ Winter PDO"</span>), <span class="st">"AICc"</span> <span class="ot">=</span> <span class="fu">c</span>(fit1<span class="sc">$</span>AICc, fit2<span class="sc">$</span>AICc, fit3<span class="sc">$</span>AICc, fit4<span class="sc">$</span>AICc))</span>
<span id="cb48-386"><a href="#cb48-386" aria-hidden="true" tabindex="-1"></a>AIC_tab<span class="ot">&lt;-</span> AIC_tab <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">DeltaAIC =</span> AICc<span class="sc">-</span><span class="fu">min</span>(AICc))</span>
<span id="cb48-387"><a href="#cb48-387" aria-hidden="true" tabindex="-1"></a>AIC_tab</span>
<span id="cb48-388"><a href="#cb48-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-389"><a href="#cb48-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-390"><a href="#cb48-390" aria-hidden="true" tabindex="-1"></a>Reduced ricker is the best model, which makes sense since the estimate for the b parameter is essentially 0 in the other 3 models. Additionally the covariate parameters for Summer and PDO are both very low as well. All models are basically the same except the full ricker, and full ricker w/ covariates have extra parameter(s).</span>
<span id="cb48-391"><a href="#cb48-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-392"><a href="#cb48-392" aria-hidden="true" tabindex="-1"></a><span class="fu">## Forecasting with Reduced Ricker model</span></span>
<span id="cb48-393"><a href="#cb48-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-396"><a href="#cb48-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb48-397"><a href="#cb48-397" aria-hidden="true" tabindex="-1"></a><span class="do">## get list of Kalman filter output</span></span>
<span id="cb48-398"><a href="#cb48-398" aria-hidden="true" tabindex="-1"></a>kf_out <span class="ot">&lt;-</span> <span class="fu">MARSSkfss</span>(fit1)</span>
<span id="cb48-399"><a href="#cb48-399" aria-hidden="true" tabindex="-1"></a><span class="do">## forecasts of regr parameters; 2xT matrix</span></span>
<span id="cb48-400"><a href="#cb48-400" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> kf_out<span class="sc">$</span>xtt1</span>
<span id="cb48-401"><a href="#cb48-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-402"><a href="#cb48-402" aria-hidden="true" tabindex="-1"></a>mod_list1<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="at">B =</span> <span class="st">"identity"</span>, <span class="at">Z =</span> <span class="st">"identity"</span>, <span class="at">U =</span> <span class="st">"zero"</span>, <span class="at">A =</span> <span class="st">"zero"</span>, <span class="at">Q =</span> <span class="fu">matrix</span>(<span class="st">"q"</span>), <span class="at">R =</span> <span class="fu">matrix</span>(<span class="st">"r"</span>))</span>
<span id="cb48-403"><a href="#cb48-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-404"><a href="#cb48-404" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">c</span>(<span class="dv">1</span>, TT))</span>
<span id="cb48-405"><a href="#cb48-405" aria-hidden="true" tabindex="-1"></a>Z[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, TT) </span>
<span id="cb48-406"><a href="#cb48-406" aria-hidden="true" tabindex="-1"></a><span class="do">## ts of E(forecasts)</span></span>
<span id="cb48-407"><a href="#cb48-407" aria-hidden="true" tabindex="-1"></a>fore_mean <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb48-408"><a href="#cb48-408" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb48-409"><a href="#cb48-409" aria-hidden="true" tabindex="-1"></a>  fore_mean[t] <span class="ot">&lt;-</span> Z[,t] <span class="sc">%*%</span> eta[, t, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb48-410"><a href="#cb48-410" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-411"><a href="#cb48-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-412"><a href="#cb48-412" aria-hidden="true" tabindex="-1"></a><span class="do">## variance of regr parameters; 1x2xT array</span></span>
<span id="cb48-413"><a href="#cb48-413" aria-hidden="true" tabindex="-1"></a>Phi <span class="ot">&lt;-</span> kf_out<span class="sc">$</span>Vtt1</span>
<span id="cb48-414"><a href="#cb48-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-415"><a href="#cb48-415" aria-hidden="true" tabindex="-1"></a><span class="do">## obs variance; 1x1 matrix</span></span>
<span id="cb48-416"><a href="#cb48-416" aria-hidden="true" tabindex="-1"></a>R_est <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1, <span class="at">type=</span><span class="st">"matrix"</span>)<span class="sc">$</span>R</span>
<span id="cb48-417"><a href="#cb48-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-418"><a href="#cb48-418" aria-hidden="true" tabindex="-1"></a><span class="do">## ts of Var(forecasts)</span></span>
<span id="cb48-419"><a href="#cb48-419" aria-hidden="true" tabindex="-1"></a>fore_var <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb48-420"><a href="#cb48-420" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>TT) {</span>
<span id="cb48-421"><a href="#cb48-421" aria-hidden="true" tabindex="-1"></a>  tZ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(Z[,t], <span class="dv">1</span>, <span class="dv">1</span>) <span class="do">## transpose of Z</span></span>
<span id="cb48-422"><a href="#cb48-422" aria-hidden="true" tabindex="-1"></a>  fore_var[t] <span class="ot">&lt;-</span> Z[, t] <span class="sc">%*%</span> Phi[,,t] <span class="sc">%*%</span> tZ <span class="sc">+</span> R_est</span>
<span id="cb48-423"><a href="#cb48-423" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-424"><a href="#cb48-424" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span>fore_mean)) <span class="sc">+</span></span>
<span id="cb48-425"><a href="#cb48-425" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> fore_mean<span class="dv">-2</span><span class="sc">*</span>fore_var, <span class="at">ymax =</span> fore_mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fore_var), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span>SR_data<span class="sc">$</span>logSR),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"Log(R/S)"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb48-426"><a href="#cb48-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-427"><a href="#cb48-427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span><span class="fu">exp</span>(fore_mean))) <span class="sc">+</span></span>
<span id="cb48-428"><a href="#cb48-428" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> SR_data<span class="sc">$</span>brood_year, <span class="at">ymin =</span> <span class="fu">exp</span>(fore_mean<span class="dv">-2</span><span class="sc">*</span>fore_var), <span class="at">ymax =</span> <span class="fu">exp</span>(fore_mean <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>fore_var)), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>SR_data<span class="sc">$</span>brood_year, <span class="at">y=</span><span class="fu">exp</span>(SR_data<span class="sc">$</span>logSR)),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,<span class="at">y=</span><span class="st">"R/S"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">25</span>)</span>
<span id="cb48-429"><a href="#cb48-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-430"><a href="#cb48-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb48-431"><a href="#cb48-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-432"><a href="#cb48-432" aria-hidden="true" tabindex="-1"></a>Observed values almost all fall within the prediction intervals. This is a reasonably well fitting model, however there is an AR1 lag between prediction and observation. This AR1 lag seems to be common throughout most time series prediction models.</span>
<span id="cb48-433"><a href="#cb48-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-434"><a href="#cb48-434" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb48-435"><a href="#cb48-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-436"><a href="#cb48-436" aria-hidden="true" tabindex="-1"></a>We found that Kvichak sockeye recruitment/spawner ratio can be explained well by the simplest Ricker spawner-recruit model with only a time-varying level and observation error, essentially a simple random walk process. Based on the AICc, the best performing model was the simplest model without any density-dependent or PDO information. This is somewhat surprising, as we expected density dependence or conditions in the environment to have an effect. There may be environmental factors besides PDO that we did not account for this model that might influence productivity, including ENSO, SST, and sea surface air pressure (Ovando et al. 2022).</span>
<span id="cb48-437"><a href="#cb48-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-438"><a href="#cb48-438" aria-hidden="true" tabindex="-1"></a><span class="fu"># Team contributions</span></span>
<span id="cb48-439"><a href="#cb48-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-440"><a href="#cb48-440" aria-hidden="true" tabindex="-1"></a>ZR did the data wrangling and wrote the methods, code, and results for the first two models (reduced and full Ricker). TW wrote the methods, code, and results for the models with covariates and the forecasting. Both team members contributed to the discussion.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-5/Final_Write_ups/Lab-5-team-2_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-5/Final_Write_ups/Lab-5-team-2_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>