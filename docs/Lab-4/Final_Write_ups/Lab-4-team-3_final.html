<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nick Chambers, Madison Shipley, Karl Veggerby">
<meta name="dcterms.date" content="2023-05-09">

<title>20&nbsp; Team 3 - Lab 4 – Fish 550 Spring 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" rel="next">
<link href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-4/Lab-4-HMM.html">Hidden Markov Models</a></li><li class="breadcrumb-item"><a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fish 550 Spring 2023</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/atsa-es/fish550-2023" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Labs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Forecasting with ARIMA models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Lab1-ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Team 1 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Team 2 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Team 3 - Lab 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-1/Final_Write_ups/Lab-1-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Team 4 - Lab 1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Analyzing multivariate salmon data with MARSS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Lab2-MARSS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Team 1 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Team 2 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Team 3 - Lab 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-2/Final_Write_ups/Lab-2-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Team 4 - Lab 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Factor Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Lab-3-DFA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Team 1 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Team 2 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Team 3 - Lab 3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-3/Final_Write_ups/Lab-3-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Team 4 - Lab 3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Hidden Markov Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Lab-4-HMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Lab Intro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Team 1 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Dynamic Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Lab-5-DLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Lab 5 - Dynamic Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-1_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Team 1 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-2_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Team 2 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-3_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Lab-5/Final_Write_ups/Lab-5-team-4_final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Team 3 - Lab 5</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-set" id="toc-data-set" class="nav-link active" data-scroll-target="#data-set">Data set</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">Load the data</a></li>
  <li><a href="#wrangle-the-data" id="toc-wrangle-the-data" class="nav-link" data-scroll-target="#wrangle-the-data">Wrangle the data</a></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data Visualization</a>
  <ul class="collapse">
  <li><a href="#objective-tips" id="toc-objective-tips" class="nav-link" data-scroll-target="#objective-tips">Objective tips</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#general-tasks" id="toc-general-tasks" class="nav-link" data-scroll-target="#general-tasks">General tasks</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model-1-copepods-only-2-states" id="toc-model-1-copepods-only-2-states" class="nav-link" data-scroll-target="#model-1-copepods-only-2-states">Model 1 Copepods only: 2 states</a></li>
  <li><a href="#model-2-copepods-only-3-states" id="toc-model-2-copepods-only-3-states" class="nav-link" data-scroll-target="#model-2-copepods-only-3-states">Model 2 Copepods only: 3 states</a></li>
  <li><a href="#model-3-copepods-and-pdo" id="toc-model-3-copepods-and-pdo" class="nav-link" data-scroll-target="#model-3-copepods-and-pdo">Model 3 Copepods and PDO</a></li>
  <li><a href="#model-4-copepods-and-pdo-with-transition-informed-by-pdo" id="toc-model-4-copepods-and-pdo-with-transition-informed-by-pdo" class="nav-link" data-scroll-target="#model-4-copepods-and-pdo-with-transition-informed-by-pdo">Model 4 Copepods and PDO with transition informed by PDO</a></li>
  <li><a href="#model-5-copepods-informed-by-pdo" id="toc-model-5-copepods-informed-by-pdo" class="nav-link" data-scroll-target="#model-5-copepods-informed-by-pdo">Model 5 Copepods informed by PDO</a></li>
  <li><a href="#model-6-copepods-informed-by-pdo-with-pdo-informing-transition" id="toc-model-6-copepods-informed-by-pdo-with-pdo-informing-transition" class="nav-link" data-scroll-target="#model-6-copepods-informed-by-pdo-with-pdo-informing-transition">Model 6 Copepods informed by PDO with PDO informing transition</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#model-selection-with-aic" id="toc-model-selection-with-aic" class="nav-link" data-scroll-target="#model-selection-with-aic">Model Selection with AIC</a></li>
  <li><a href="#more-model-diagnostics" id="toc-more-model-diagnostics" class="nav-link" data-scroll-target="#more-model-diagnostics">More Model Diagnostics</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#what-were-still-confused-about" id="toc-what-were-still-confused-about" class="nav-link" data-scroll-target="#what-were-still-confused-about">What we’re still confused about</a></li>
  </ul></li>
  <li><a href="#team-contributions" id="toc-team-contributions" class="nav-link" data-scroll-target="#team-contributions">Team contributions</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-4/Final_Write_ups/Lab-4-team-3_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-4/Final_Write_ups/Lab-4-team-3_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Lab-4/Lab-4-HMM.html">Hidden Markov Models</a></li><li class="breadcrumb-item"><a href="../../Lab-4/Final_Write_ups/Lab-4-team-3_final.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Team 3 - Lab 4</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Hidden Markov Models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nick Chambers, Madison Shipley, Karl Veggerby </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="data-set" class="level1">
<h1>Data set</h1>
<p>In this lab, we’re looking at ecological indicators and exploring hidden Markov models and probabilities of shifting between underlying states.</p>
<section id="load-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-data">Load the data</h2>
<p>We explored the <code>stoplight.csv</code> dataset for this week. One of the columns divides indicators into groups (e.g.&nbsp;Climate, Local Physical, Local Biological, etc) and we wanted to look at some biological indicators and climate/physical indicators.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>stoplight <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Lab-4"</span>, <span class="st">"stoplight.csv"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stoplight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Ecosystem.Indicators           Type X1998 X1999 X2000 X2001 X2002 X2003 X2004
1         PDO_DecMarch        Climate  5.07 -1.75 -4.17  1.86 -1.73  7.45  1.85
2         PDO_MaySept)        Climate -0.37 -5.13 -3.58 -4.22 -0.26  3.42  2.96
3                  ONI        Climate  1.12 -1.07 -1.07 -0.40  0.18  0.27  0.20
4                  SST Local Physical 13.77 13.20 13.33 12.98 13.05 13.56 14.68
5     Upper_20m_NovMar Local Physical 12.30 10.31 10.12 10.22 10.08 10.70 10.86
6    Upper_20m_MaySept Local Physical 10.35 10.07 10.16  9.76  8.99  9.62 11.31
  X2005 X2006 X2007 X2008 X2009 X2010 X2011 X2012 X2013 X2014 X2015 X2016 X2017
1  2.44  1.94 -0.17 -3.06 -5.41  2.17 -3.65 -5.07 -1.67  1.24  9.26  6.69  3.38
2  3.48  0.28  0.91 -7.63 -1.11 -3.53 -6.45 -7.79 -3.47  5.07  8.08  6.60  2.18
3  0.47 -0.30  0.08 -0.98 -0.23  0.55 -0.72 -0.43 -0.30 -0.28  0.67  1.22  0.13
4 13.58 12.73 13.64 12.45 13.44 12.76 13.23 13.34 13.72 14.03 13.89 13.83 13.59
5 10.61 10.59 10.04  9.33 10.19 11.01 10.02  9.62 10.12  9.62 12.73 12.03 11.47
6 10.73  9.97 10.07  9.30  9.90 10.42  9.95  9.92 10.43 10.95 10.69 10.32 10.14
  X2018 X2019 X2020 X2021
1  1.52  2.01 -0.76 -2.77
2  0.45  3.94 -1.35 -6.64
3 -0.45  0.72  0.28 -0.72
4 13.71 14.68 13.40 12.95
5 10.63 10.99  9.37 10.12
6 10.34 11.31 10.87  9.85</code></pre>
</div>
</div>
</section>
<section id="wrangle-the-data" class="level2">
<h2 class="anchored" data-anchor-id="wrangle-the-data">Wrangle the data</h2>
<p>We initially selected the Pacific Decadal Osculation (PDO) for the Dec/March period, sea surface temperature (SST), and copepod richness and ichthy communitiy index, which we assumed was comperable to copepod richness (though maybe not).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ecosystem indicators</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>stoplight[,<span class="dv">1</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "PDO_DecMarch"                                          
 [2] "PDO_MaySept)"                                          
 [3] "ONI"                                                   
 [4] "SST"                                                   
 [5] "Upper_20m_NovMar"                                      
 [6] "Upper_20m_MaySept"                                     
 [7] "Deep_temperature"                                      
 [8] "Deep_salinity"                                         
 [9] "Copepod_richness"                                      
[10] "N_copepod"                                             
[11] "S_copepod"                                             
[12] "Biological_transition"                                 
[13] "Nearshore_Ichthyoplankton"                             
[14] "Ichthy_community_index"                                
[15] "Chinook_salmon_juv"                                    
[16] "Coho_salmon_juv"                                       
[17] "Principal Component scores (PC1)"                      
[18] "Principal Component scores (PC2)"                      
[19] "Physical Spring Trans.\nUI based (day of year)"        
[20] "Physical Spring Trans. Hydrographic (day of year)"     
[21] "Upwelling Anomaly\n(Sum April-May)"                    
[22] "Length of Upwelling Season\nUI based (days)"           
[23] "Copepod Community Index\n(MDS axis 1 scores; May-Sept)"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>years<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1998</span>,<span class="dv">2021</span>,<span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ecosystem indicators to pull</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>PDO_DecMarch<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>SST<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">4</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Copepod_richness<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">9</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>Ichthy_community_index<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">14</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>]))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">length</span>(years), <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">1</span>]<span class="ot">&lt;-</span>years</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">2</span>]<span class="ot">&lt;-</span>PDO_DecMarch</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">3</span>]<span class="ot">&lt;-</span>SST</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">4</span>]<span class="ot">&lt;-</span>Copepod_richness</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">5</span>]<span class="ot">&lt;-</span>Ichthy_community_index</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dat)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"years"</span>,<span class="st">"PDO"</span>, <span class="st">"SST"</span>, <span class="st">"CopeRich"</span>, <span class="st">"FishInx"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat)<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">1</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(dat)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  years   PDO   SST CopeRich FishInx
1  1998  5.07 13.77     4.54   -9.47
2  1999 -1.75 13.20    -2.58  -20.44
3  2000 -4.17 13.33    -3.41  -28.90
4  2001  1.86 12.98    -1.03  -14.48
5  2002 -1.73 13.05    -1.12  -13.98
6  2003  7.45 13.56     1.99   -2.29</code></pre>
</div>
</div>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data Visualization</h2>
<p>The first rule of science is to plot your data! We started with looking at all our data together.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting all</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> SST, <span class="at">color =</span> <span class="st">"SST"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> FishInx, <span class="at">color =</span> <span class="st">"FishInx"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Sea surface temperature stats pretty consistent, while the fish index had a significant range, possibly following PDO if you squint, but was not immediatly compelling. We narrowed it down and decided to focus on copepod richness and PDO, which seemed to be incredibly correlated, and plotted the time series and their relationship to each other. In a positive PDO index, there is a positive correlation with copepod index.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Coperich and env cov</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#CopeRichness tracks very closely with PDO</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SST seems to have a negligible correlation </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> PDO, <span class="at">y =</span> CopeRich, <span class="at">color =</span> CopeRich <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> PDO, <span class="at">y =</span> CopeRich)) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Above 0"</span>, <span class="st">"Below 0"</span>)) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PDO"</span>, <span class="at">y =</span> <span class="st">"CopeRich"</span>) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#fish index is all over the place, let's not use it. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also wanted to think about our possible hidden states, and while there seems to be a clear two-state sytem with PDO in a negative or positive index, we wondered if there was a third state “weak” index.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PDO states </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">2.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="objective-tips" class="level3">
<h3 class="anchored" data-anchor-id="objective-tips">Objective tips</h3>
<p>Our primary objectives for this lab were to gain a better understanding of hmm options and getting some practice with interpretation by exploring different model options considering copepod richness and PDO. While there was much more we could have done, we decided to explore model specification, and interpretation of AIC for these types of models, which can be misleading depending on the ecological assumptions being made.</p>
</section>
</section>
</section>
<section id="general-tasks" class="level1">
<h1>General tasks</h1>
<ul>
<li>Please pick a type of indicators, and develop a 2- or 3-state multivariate HMM.</li>
</ul>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>We fit models with different either two or three states to determine whether copepod richness and/or PDO seems to have 2 or 3 states. It’s unclear if there is a ‘neutral’ state that modulates copepod richness in addition to the hot and cool phases.</p>
<p>We also explored the transition option, by assuming either that there is no covariate informing the transition, or that PDO informed the transition.</p>
<p>We assumed the familys were gaussian for all models tested.</p>
<p>We plotted the fit of all models to copepod richness and PDO data from the stoplight dataset. We then also compared model fits with AIC in an attempt to select the best model.</p>
<p>Note that in the report we give probabilities of transitioning to and from states, but these models are very sensitive to starting conditions, so we iterate over many set seeds for each model to find the best fit. That being said, some of the values written in this report may be different upon knitting.</p>
<section id="model-1-copepods-only-2-states" class="level2">
<h2 class="anchored" data-anchor-id="model-1-copepods-only-2-states">Model 1 Copepods only: 2 states</h2>
<p>We started with a very simple model, with copepod richness as the intercept and no covariates informing the transition. We started by assuming a two state system.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">depmix</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>dat)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>fitmod1 <span class="ot">=</span> <span class="fu">fit</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 16 with logLik: -54.68034 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>best1 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>best_model1 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  fitmod1 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod1)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod1)<span class="sc">&lt;</span> best1){</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    best_model1 <span class="ot">&lt;-</span> fitmod1</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    best1 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod1)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 20 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 16 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 31 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 26 with logLik: -54.68034 
converged at iteration 23 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 25 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 23 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 27 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 24 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 16 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 24 with logLik: -54.68034 
converged at iteration 14 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 16 with logLik: -54.68034 
converged at iteration 14 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 23 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 22 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 23 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 25 with logLik: -54.68034 
converged at iteration 11 with logLik: -54.68034 
converged at iteration 21 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 15 with logLik: -54.68034 
converged at iteration 14 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 28 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 18 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 16 with logLik: -54.68034 
converged at iteration 17 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 
converged at iteration 19 with logLik: -54.68034 
converged at iteration 20 with logLik: -54.68034 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.598 0.402
fromS2 0.246 0.754

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1           3.504  2.552
St2          -1.414  1.050</code></pre>
</div>
</div>
<p>We see that there is a ~75% probability of state one staying in state one, and ~60% of state two staying in state two, with ~25% and 40% probability for transitioning from state 1 to state 2 and state 2 to state 1 respectively, showing that the system generally is more stable in state one.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model1, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior Probability of Changing States"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>prstates <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">posterior</span>(best_model1)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">summary</span>(best_model1)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.598 0.402
fromS2 0.246 0.754

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1           3.504  2.552
St2          -1.414  1.050</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#predicted values</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>pred1<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred1, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 1 - Two States"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Model 1 produces a reasonably good fit to the data.</p>
</section>
<section id="model-2-copepods-only-3-states" class="level2">
<h2 class="anchored" data-anchor-id="model-2-copepods-only-3-states">Model 2 Copepods only: 3 states</h2>
<p>We continued by using the same simple model from above, and assuming 3 states.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">depmix</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nstates =</span> <span class="dv">3</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>dat)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>fitmod2 <span class="ot">=</span> <span class="fu">fit</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 46 with logLik: -52.30002 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>best2 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>best_model2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  fitmod2 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod2)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod2)<span class="sc">&lt;</span> best2){</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    best_model2 <span class="ot">&lt;-</span> fitmod2</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    best2 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod2)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 34 with logLik: -51.04047 
converged at iteration 85 with logLik: -53.46158 
converged at iteration 29 with logLik: -48.60721 
converged at iteration 38 with logLik: -52.30002 
converged at iteration 39 with logLik: -51.04047 
converged at iteration 36 with logLik: -52.30002 
converged at iteration 50 with logLik: -51.1154 
converged at iteration 26 with logLik: -48.60721 
converged at iteration 34 with logLik: -51.04047 
converged at iteration 34 with logLik: -51.04047 
converged at iteration 78 with logLik: -53.46158 
converged at iteration 73 with logLik: -53.46158 
converged at iteration 34 with logLik: -51.04047 
converged at iteration 39 with logLik: -52.30002 
converged at iteration 33 with logLik: -52.30002 
converged at iteration 53 with logLik: -51.1154 
converged at iteration 31 with logLik: -52.30002 
converged at iteration 30 with logLik: -52.30002 
converged at iteration 33 with logLik: -52.30002 
converged at iteration 50 with logLik: -52.30002 
converged at iteration 35 with logLik: -52.30002 
converged at iteration 37 with logLik: -51.04047 
converged at iteration 48 with logLik: -52.30002 
converged at iteration 37 with logLik: -51.04047 
converged at iteration 64 with logLik: -53.46158 
converged at iteration 43 with logLik: -51.04047 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 81 with logLik: -53.46158 
converged at iteration 35 with logLik: -51.04047 
converged at iteration 63 with logLik: -53.46158 
converged at iteration 67 with logLik: -53.46158 
converged at iteration 51 with logLik: -52.30002 
converged at iteration 35 with logLik: -52.30002 
converged at iteration 36 with logLik: -51.04047 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 39 with logLik: -52.30002 
converged at iteration 41 with logLik: -51.1154 
converged at iteration 64 with logLik: -52.30002 
converged at iteration 20 with logLik: -48.60721 
converged at iteration 35 with logLik: -52.30002 
converged at iteration 39 with logLik: -51.04047 
converged at iteration 40 with logLik: -52.30002 
converged at iteration 34 with logLik: -52.30002 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 33 with logLik: -52.30002 
converged at iteration 37 with logLik: -52.30002 
converged at iteration 26 with logLik: -48.60721 
converged at iteration 42 with logLik: -52.30002 
converged at iteration 30 with logLik: -52.30002 
converged at iteration 96 with logLik: -53.46158 
converged at iteration 38 with logLik: -52.30002 
converged at iteration 62 with logLik: -53.46158 
converged at iteration 56 with logLik: -53.46158 
converged at iteration 40 with logLik: -52.30002 
converged at iteration 63 with logLik: -53.46158 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 47 with logLik: -51.04047 
converged at iteration 58 with logLik: -53.46158 
converged at iteration 33 with logLik: -51.04047 
converged at iteration 34 with logLik: -51.04047 
converged at iteration 34 with logLik: -52.30002 
converged at iteration 34 with logLik: -51.04047 
converged at iteration 33 with logLik: -52.30002 
converged at iteration 34 with logLik: -52.30002 
converged at iteration 33 with logLik: -48.60721 
converged at iteration 37 with logLik: -52.30002 
converged at iteration 62 with logLik: -53.46158 
converged at iteration 37 with logLik: -51.04047 
converged at iteration 45 with logLik: -52.30002 
converged at iteration 38 with logLik: -52.30002 
converged at iteration 34 with logLik: -52.30002 
converged at iteration 36 with logLik: -52.30002 
converged at iteration 89 with logLik: -52.30002 
converged at iteration 52 with logLik: -51.1154 
converged at iteration 36 with logLik: -51.1154 
converged at iteration 71 with logLik: -53.46158 
converged at iteration 45 with logLik: -52.30002 
converged at iteration 30 with logLik: -52.30002 
converged at iteration 48 with logLik: -51.03809 
converged at iteration 95 with logLik: -53.46158 
converged at iteration 43 with logLik: -52.30002 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 62 with logLik: -51.1154 
converged at iteration 37 with logLik: -52.30002 
converged at iteration 33 with logLik: -48.60721 
converged at iteration 31 with logLik: -52.30002 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 38 with logLik: -52.30002 
converged at iteration 31 with logLik: -52.30002 
converged at iteration 32 with logLik: -51.04047 
converged at iteration 42 with logLik: -52.30002 
converged at iteration 48 with logLik: -52.30002 
converged at iteration 32 with logLik: -52.30002 
converged at iteration 41 with logLik: -52.30002 
converged at iteration 25 with logLik: -48.60721 
converged at iteration 88 with logLik: -53.46158 
converged at iteration 29 with logLik: -48.60721 
converged at iteration 31 with logLik: -52.30002 
converged at iteration 76 with logLik: -53.46158 
converged at iteration 35 with logLik: -51.04047 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 pr3 
  0   0   1 

Transition matrix 
        toS1  toS2  toS3
fromS1 0.500 0.000 0.500
fromS2 0.072 0.781 0.147
fromS3 0.000 0.573 0.427

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1           7.785  0.365
St2          -1.329  1.079
St3           2.947  1.124</code></pre>
</div>
</div>
<p>This transition matrix is a little trickier to interpret, but the likelihood of transitioning to state three was low, ~7% for state one and 0% of transitioning from 2 to 3. This may not be a great specification.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(ts(posterior(best_model1, type="smoothing")[,1], start=c(2003,5), deltat=1/12),ylab="probability",</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#      main="Posterior probability of state 1 (copepods good?).",</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#      frame=FALSE)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>prstates <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">posterior</span>(best_model2)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">summary</span>(best_model2)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 pr3 
  0   0   1 

Transition matrix 
        toS1  toS2  toS3
fromS1 0.500 0.000 0.500
fromS2 0.072 0.781 0.147
fromS3 0.000 0.573 0.427

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1           7.785  0.365
St2          -1.329  1.079
St3           2.947  1.124</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#predicted values</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> pred <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred2, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 2 - Three States"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Compared to model 1, model 2 produces a poor visual fit to the data, with a narrower peak later in the timeseries. Because of this we assumed 2 states in the other models we tested.</p>
</section>
<section id="model-3-copepods-and-pdo" class="level2">
<h2 class="anchored" data-anchor-id="model-3-copepods-and-pdo">Model 3 Copepods and PDO</h2>
<p>Because Copepods and PDO have such a clear relationship visually, we started by looking at a model considering both copepod richness and PDO as intercepts, with no covariates informing the transition.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods and PDO as intercepts </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>, PDO<span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(),<span class="fu">gaussian</span>()),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>dat)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>fitmod3 <span class="ot">=</span> <span class="fu">fit</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 29 with logLik: -110.5438 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>best3 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>best_model3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  fitmod3 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod3)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod3)<span class="sc">&lt;</span> best3){</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    best_model3 <span class="ot">&lt;-</span> fitmod3</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    best3 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod3)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 29 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 30 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 31 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 23 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 23 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 32 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 18 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 30 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 26 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 31 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 24 with logLik: -110.5438 
converged at iteration 30 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 23 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 27 with logLik: -110.5438 
converged at iteration 25 with logLik: -110.5438 
converged at iteration 28 with logLik: -110.5438 
converged at iteration 29 with logLik: -110.5438 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.614 0.386
fromS2 0.250 0.750

Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1           3.460  2.482           4.030  2.625
St2          -1.502  0.989          -1.946  2.262</code></pre>
</div>
</div>
<p>This model still preferred state one, with a ~75% probability of staying in one and ~25% chance of transitioning to two. There was a ~61% change of state two to stay in state two and a ~39% chance to transition back to state one. Note there are values for the intercepts and sd for Re1 (coperich) and Re2 (PDO) in this model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model3, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model3)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model3)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.614 0.386
fromS2 0.250 0.750

Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1           3.460  2.482           4.030  2.625
St2          -1.502  0.989          -1.946  2.262</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mu3<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model3)[,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.614 0.386
fromS2 0.250 0.750

Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1           3.460  2.482           4.030  2.625
St2          -1.502  0.989          -1.946  2.262</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates],<span class="st">"PDO"</span> <span class="ot">=</span> mu3[prstates])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>pred3<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Covariates"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred3, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Fit, <span class="at">group =</span> Covariates, <span class="at">color =</span> Covariates)) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span>  <span class="co"># Assign distinct colors for each line in pred3</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model 3 - Transition ~ 1"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-4-copepods-and-pdo-with-transition-informed-by-pdo" class="level2">
<h2 class="anchored" data-anchor-id="model-4-copepods-and-pdo-with-transition-informed-by-pdo">Model 4 Copepods and PDO with transition informed by PDO</h2>
<p>Next we wanted to look at copepod richness and PDO with the transition informed by the PDO.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods and PDO as intercepts where the transition is informed by PDO</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>, PDO<span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span>PDO, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(),<span class="fu">gaussian</span>()),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>fitmod4 <span class="ot">=</span> <span class="fu">fit</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 15 with logLik: -109.5888 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>best4 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>best_model4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  fitmod4 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod4)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod4)<span class="sc">&lt;</span> best4){</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    best_model4 <span class="ot">&lt;-</span> fitmod4</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    best4 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod4)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 16 with logLik: -109.5888 
converged at iteration 13 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 8 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 22 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 11 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 13 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 20 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 13 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 11 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 13 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 19 with logLik: -109.5888 
converged at iteration 7 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 10 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 11 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 11 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 18 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 17 with logLik: -109.5888 
converged at iteration 10 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 24 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 15 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 19 with logLik: -109.5888 
converged at iteration 14 with logLik: -109.5888 
converged at iteration 9 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 19 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 
converged at iteration 13 with logLik: -109.5888 
converged at iteration 16 with logLik: -109.5888 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1         St2
(Intercept)   0 -1.29578981
PDO           0 -0.07649563
Probalities at zero values of the covariates.
0.7851256 0.2148744 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1        St2
(Intercept)   0 -1.1892398
PDO           0  0.4097314
Probalities at zero values of the covariates.
0.7666051 0.2333949 


Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1          -1.438  1.019          -1.803  2.325
St2           3.650  2.414           4.168  2.628</code></pre>
</div>
</div>
<p>This transition matrix isn’t interpretable as is, but we’ll come back to that later. One question is whether or not this is appropriate, to model PDO as an intercept and use it also as a covariate. Is this confounding? Poor practice?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model4, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model4)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model4)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1         St2
(Intercept)   0 -1.29578981
PDO           0 -0.07649563
Probalities at zero values of the covariates.
0.7851256 0.2148744 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1        St2
(Intercept)   0 -1.1892398
PDO           0  0.4097314
Probalities at zero values of the covariates.
0.7666051 0.2333949 


Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1          -1.438  1.019          -1.803  2.325
St2           3.650  2.414           4.168  2.628</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mu4<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model4)[,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1         St2
(Intercept)   0 -1.29578981
PDO           0 -0.07649563
Probalities at zero values of the covariates.
0.7851256 0.2148744 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1        St2
(Intercept)   0 -1.1892398
PDO           0  0.4097314
Probalities at zero values of the covariates.
0.7666051 0.2333949 


Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1          -1.438  1.019          -1.803  2.325
St2           3.650  2.414           4.168  2.628</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates],<span class="st">"PDO"</span> <span class="ot">=</span> mu4[prstates])</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>pred4<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Covariates"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred4, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Fit, <span class="at">group =</span> Covariates, <span class="at">color =</span> Covariates)) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span>  <span class="co"># Assign distinct colors for each line in pred3</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 4 - Transition ~ PDO"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Models 3 and 4 produce similar fits to the data, the only obvious difference is that model 4 spends less time in the higher state than model 3.</p>
</section>
<section id="model-5-copepods-informed-by-pdo" class="level2">
<h2 class="anchored" data-anchor-id="model-5-copepods-informed-by-pdo">Model 5 Copepods informed by PDO</h2>
<p>In this model, we wanted to relate copepod richness to PDO directly, with no transtion.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods as they relate to PDO</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span>PDO),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>()),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>fitmod5 <span class="ot">=</span> <span class="fu">fit</span>(mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 43 with logLik: -41.20702 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>best5 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>best_model5 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  fitmod5 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod5)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod5)<span class="sc">&lt;</span> best5){</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    best_model5 <span class="ot">&lt;-</span> fitmod5</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    best5 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod5)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 38 with logLik: -41.20702 
converged at iteration 44 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 46 with logLik: -41.20702 
converged at iteration 23 with logLik: -39.88307 
converged at iteration 38 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 30 with logLik: -39.88307 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 22 with logLik: -39.88307 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 39 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 49 with logLik: -41.20702 
converged at iteration 46 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 43 with logLik: -43.79142 
converged at iteration 28 with logLik: -39.88307 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 43 with logLik: -43.79142 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 44 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 39 with logLik: -41.20702 
converged at iteration 38 with logLik: -41.20702 
converged at iteration 25 with logLik: -39.88307 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 26 with logLik: -39.88307 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 48 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 28 with logLik: -44.05687 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 22 with logLik: -39.88307 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 34 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 47 with logLik: -41.20702 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 22 with logLik: -39.88307 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 44 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 51 with logLik: -43.79142 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 44 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 51 with logLik: -41.20702 
converged at iteration 39 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 21 with logLik: -39.88307 
converged at iteration 51 with logLik: -41.20702 
converged at iteration 48 with logLik: -41.20702 
converged at iteration 44 with logLik: -41.20702 
converged at iteration 40 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 24 with logLik: -39.88307 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 42 with logLik: -41.20702 
converged at iteration 39 with logLik: -43.79142 
converged at iteration 21 with logLik: -39.88307 
converged at iteration 43 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 49 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 41 with logLik: -41.20702 
converged at iteration 46 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 45 with logLik: -41.20702 
converged at iteration 20 with logLik: -39.88307 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition matrix 
        toS1  toS2
fromS1 0.730 0.270
fromS2 0.269 0.731

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1          -1.184   0.463  0.534
St2           1.344   0.684  1.219</code></pre>
</div>
</div>
<p>This model has an interpreatable transition matrix, where the probability of staying or leaving each respective state is about ~70-30. Note that we now have PDO as informing our copepod richness in the response parameters.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model5, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model5)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model5)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition matrix 
        toS1  toS2
fromS1 0.730 0.270
fromS2 0.269 0.731

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1          -1.184   0.463  0.534
St2           1.344   0.684  1.219</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>pred5<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred5, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 5 - Copepod Richness ~ PDO , Transition ~1"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Copepod richness and PDO data have the closest correlation, and it seemed reasonable to relate them to each other and model the variation of Copepod Richness as a function of PDO. Admittedly, we are not sure if this is a appropriate entry to the <code>depmix()</code> function but the results for models 5 and 6 were interesting so we included them.</p>
</section>
<section id="model-6-copepods-informed-by-pdo-with-pdo-informing-transition" class="level2">
<h2 class="anchored" data-anchor-id="model-6-copepods-informed-by-pdo-with-pdo-informing-transition">Model 6 Copepods informed by PDO with PDO informing transition</h2>
<p>This model is the same as model 5, but using PDO as a covariate for transition, which could be inappropriate for hmm model specification. But, we wanted to explore it.</p>
<p>For the intercept we chose to model Copepod Richness ~ PDO. These data sets have the closest correlation and so this was done to test of the fit could be improved by modeling the variation of Copepod Richness as a function of PDO. Admittedly, we are not sure if this is a appropriate entry to the <code>depmix()</code> function but the results for models 5 and 6 were interesting so we included them.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods as they relate to PDO where the transition is informed by PDO</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>mod6 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span>PDO),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span>PDO, </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>()),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>fitmod6 <span class="ot">=</span> <span class="fu">fit</span>(mod6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 26 with logLik: -36.69908 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>best6 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>best_model6 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  fitmod6 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod6)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod6)<span class="sc">&lt;</span> best6){</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    best_model6 <span class="ot">&lt;-</span> fitmod6</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    best6 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod6)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>converged at iteration 27 with logLik: -36.69921 
converged at iteration 30 with logLik: -36.69921 
converged at iteration 28 with logLik: -36.69923 
converged at iteration 31 with logLik: -36.6992 
converged at iteration 29 with logLik: -36.69921 
converged at iteration 26 with logLik: -36.69944 
converged at iteration 27 with logLik: -36.69907 
converged at iteration 30 with logLik: -36.69923 
converged at iteration 30 with logLik: -36.69923 
converged at iteration 31 with logLik: -36.69907 
converged at iteration 28 with logLik: -36.6992 
converged at iteration 28 with logLik: -36.69907 
converged at iteration 30 with logLik: -36.69921 
converged at iteration 30 with logLik: -36.69907 
converged at iteration 29 with logLik: -36.69943 
converged at iteration 16 with logLik: -38.06323 
converged at iteration 30 with logLik: -36.69908 
converged at iteration 28 with logLik: -36.69922 
converged at iteration 32 with logLik: -36.69923 
converged at iteration 31 with logLik: -36.69908 
converged at iteration 29 with logLik: -36.69922 
converged at iteration 29 with logLik: -36.69908 
converged at iteration 27 with logLik: -36.69918 
converged at iteration 28 with logLik: -36.69922 
converged at iteration 30 with logLik: -36.69922 
converged at iteration 27 with logLik: -36.6992 
converged at iteration 29 with logLik: -36.69921 
converged at iteration 27 with logLik: -36.69922 
converged at iteration 33 with logLik: -36.69921 
converged at iteration 34 with logLik: -36.69907 
converged at iteration 27 with logLik: -36.69907 
converged at iteration 13 with logLik: -38.06323 
converged at iteration 31 with logLik: -36.69921 
converged at iteration 28 with logLik: -36.69923 
converged at iteration 25 with logLik: -36.6992 
converged at iteration 29 with logLik: -36.69907 
converged at iteration 26 with logLik: -36.69922 
converged at iteration 26 with logLik: -36.6992 
converged at iteration 26 with logLik: -36.69912 
converged at iteration 29 with logLik: -36.69923 
converged at iteration 26 with logLik: -36.69944 
converged at iteration 26 with logLik: -36.69922 
converged at iteration 28 with logLik: -36.69908 
converged at iteration 26 with logLik: -36.69922 
converged at iteration 26 with logLik: -36.69912 
converged at iteration 34 with logLik: -36.69909 
converged at iteration 64 with logLik: -41.46754 
converged at iteration 31 with logLik: -36.69907 
converged at iteration 29 with logLik: -36.69919 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 28 with logLik: -36.69907 
converged at iteration 26 with logLik: -36.69908 
converged at iteration 29 with logLik: -36.6992 
converged at iteration 16 with logLik: -38.06323 
converged at iteration 26 with logLik: -36.69921 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 30 with logLik: -36.69907 
converged at iteration 29 with logLik: -36.69907 
converged at iteration 31 with logLik: -36.6992 
converged at iteration 32 with logLik: -36.6992 
converged at iteration 27 with logLik: -36.69921 
converged at iteration 29 with logLik: -36.69908 
converged at iteration 27 with logLik: -36.6992 
converged at iteration 27 with logLik: -36.6992 
converged at iteration 28 with logLik: -36.6992 
converged at iteration 27 with logLik: -36.69907 
converged at iteration 27 with logLik: -36.69908 
converged at iteration 28 with logLik: -36.6992 
converged at iteration 30 with logLik: -36.69907 
converged at iteration 28 with logLik: -36.69908 
converged at iteration 28 with logLik: -36.6992 
converged at iteration 26 with logLik: -36.6992 
converged at iteration 27 with logLik: -36.69921 
converged at iteration 26 with logLik: -36.69923 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 29 with logLik: -36.69923 
converged at iteration 28 with logLik: -36.69919 
converged at iteration 29 with logLik: -36.6992 
converged at iteration 28 with logLik: -36.69907 
converged at iteration 28 with logLik: -36.69944 
converged at iteration 29 with logLik: -36.69907 
converged at iteration 27 with logLik: -36.69922 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 31 with logLik: -36.69922 
converged at iteration 29 with logLik: -36.69907 
converged at iteration 32 with logLik: -36.6992 
converged at iteration 16 with logLik: -38.06323 
converged at iteration 27 with logLik: -36.69907 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 25 with logLik: -36.69919 
converged at iteration 27 with logLik: -36.69913 
converged at iteration 31 with logLik: -36.69922 
converged at iteration 28 with logLik: -36.69922 
converged at iteration 28 with logLik: -36.69921 
converged at iteration 31 with logLik: -36.69912 
converged at iteration 31 with logLik: -36.69921 
converged at iteration 27 with logLik: -36.69922 
converged at iteration 30 with logLik: -36.69923 
converged at iteration 27 with logLik: -36.69944 
converged at iteration 26 with logLik: -36.69921 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1       St2
(Intercept)   0 12.511030
PDO           0 -0.150226
Probalities at zero values of the covariates.
3.685761e-06 0.9999963 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1      St2
(Intercept)   0 6.846489
PDO           0 4.202840
Probalities at zero values of the covariates.
0.001062053 0.9989379 


Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1          -0.220   0.199  0.704
St2           0.136   0.892  1.151</code></pre>
</div>
</div>
<p>Again, given that we included PDO as a transition covariate, the matrix was not interpretable as is in the model summary, but we address this in the More Model Diagnostics Section.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model6, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model6)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .local(object, ...): Argument 'type' not specified and will default
to 'viterbi'. This default may change in future releases of depmixS4. Please
see ?posterior for alternative options.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model6)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1       St2
(Intercept)   0 12.511030
PDO           0 -0.150226
Probalities at zero values of the covariates.
3.685761e-06 0.9999963 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1      St2
(Intercept)   0 6.846489
PDO           0 4.202840
Probalities at zero values of the covariates.
0.001062053 0.9989379 


Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1          -0.220   0.199  0.704
St2           0.136   0.892  1.151</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>pred6<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred6, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 6 - Copepod Richness ~ PDO, Transition ~ PDO"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab-4-team-3_final_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Visually, model 6 produced the worst fit to the data. This model suggests there is a dominant state near the mean of the data and the second state is only marginally different. The dampening of the oscillation must be from the transition being informed directly by PDO.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>Summarize the model you’ve created. Specifically,</p>
<ul>
<li>Does it converge?</li>
</ul>
<p>All the models converged even when running the for loop over various seeds, however visual inspection of model fits revealed that several fits were quite poor, including our top model ranked by AICc.</p>
<ul>
<li>How many states seem to be most supported?</li>
</ul>
<p>Compared to model 1, model two with 3 states produced a poor visual fit to the data. Because of this we assumed 2 states in the other models we tested. This aligned with our visual estimates of two states.</p>
<ul>
<li>Plot the time series of estimated states. What does this mean?</li>
</ul>
<p>The plots of estimated states show the underlying pattern that may exist if there is in fact a shift between states. The variation in the data from this pattern would be related to unexplained error related to covariates other than the underlying states. Visually there appears to be good support for two underlying states, however, as shown below, the estimated states in our top AICc ranked model do not appear to fit the data well, indicating that AICc may not be the best metric to use here. It definitely highlights the dangers of blindly trusting AIC without further model checks.</p>
<section id="model-selection-with-aic" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-with-aic">Model Selection with AIC</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>,<span class="st">"6"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">AIC</span>(best_model1), <span class="fu">AIC</span>(best_model2), <span class="fu">AIC</span>(best_model3), <span class="fu">AIC</span>(best_model4), <span class="fu">AIC</span>(best_model5),<span class="fu">AIC</span>(best_model6))</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>delta.aic <span class="ot">&lt;-</span> aic<span class="sc">-</span><span class="fu">min</span>(aic)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(mods, aic, delta.aic)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  mods       aic  delta.aic
1    1 123.36068  27.962542
2    2 125.21442  29.816290
3    3 243.08766 147.689531
4    4 245.17760 149.779466
5    5  97.76613   2.367998
6    6  95.39813   0.000000</code></pre>
</div>
</div>
<p>AIC tells us that the best model would be model 6, although it is just marginally better than model 5 with a delta AIC of just over 2. The delta AIC values are only about 2 different between models 1-2 and 3-4 and 5-6 respectively. Each set of models are the most similar to each other within the models tested and these AIC values indicate little to no support for one approach within each group to be significantly better than the other. AIC values do indicate significantly better performance between these sets of models, however this support is not supported by looking at visual fits of the data. The two best models, 5 and 6, produce the worst visual fits to the data of any models tested. It is unclear why AIC is selecting these models as the best, but it does seem that AIC favors the simple models with only one intercept rather than models with two intercepts. Because of the apparent poor fit of models 5 and 6, it seems other methods of model selection such as Cross Validation or leave One Out may be more appropriate here than AIC.</p>
</section>
<section id="more-model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="more-model-diagnostics">More Model Diagnostics</h2>
<p>The following function allows us to interpret the transition matrix when there is a covariate informing the transition.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a funciton to help build transition matrices</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>convert_probs <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, <span class="at">coef_value =</span> <span class="dv">0</span>) {</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract coefficients</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> fit<span class="sc">@</span>transition[[<span class="dv">1</span>]]<span class="sc">@</span>parameters<span class="sc">$</span>coefficients</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> fit<span class="sc">@</span>transition[[<span class="dv">2</span>]]<span class="sc">@</span>parameters<span class="sc">$</span>coefficients</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assemble transition matrix in mlogit space</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">1</span>,] <span class="ot">&lt;-</span> p1[<span class="dv">1</span>,] <span class="sc">+</span> p1[<span class="dv">2</span>,] <span class="sc">*</span> coef_value <span class="co">#intercept + slope * coefficient</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">2</span>,] <span class="ot">&lt;-</span> p2[<span class="dv">1</span>,] <span class="sc">+</span> p2[<span class="dv">2</span>,] <span class="sc">*</span> coef_value</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exponentiate</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">exp</span>(m)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">1</span>,] <span class="ot">&lt;-</span> m[<span class="dv">1</span>,] <span class="sc">/</span> <span class="fu">sum</span>(m[<span class="dv">1</span>,])</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">2</span>,] <span class="ot">&lt;-</span> m[<span class="dv">2</span>,] <span class="sc">/</span> <span class="fu">sum</span>(m[<span class="dv">2</span>,])</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(m)</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look at all the models together. Note that the above function was applied to models 4 and 6, which did not have an interpretable transition matrix.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Look at the transition matrices and variance</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition matrix 
        toS1  toS2
fromS1 0.754 0.246
fromS2 0.402 0.598

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1          -1.414  1.050
St2           3.504  2.552</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 pr3 
  1   0   0 

Transition matrix 
        toS1  toS2  toS3
fromS1 0.000 1.000 0.000
fromS2 0.067 0.779 0.154
fromS3 0.411 0.000 0.589

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.sd
St1           3.268  0.754
St2          -1.320  1.101
St3           4.431  2.951</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition matrix 
        toS1  toS2
fromS1 0.750 0.250
fromS2 0.386 0.614

Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1          -1.502  0.990          -1.945  2.262
St2           3.460  2.482           4.030  2.625</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod4) <span class="co"># no transition matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1        St2
(Intercept)   0  1.1898714
PDO           0 -0.4098372
Probalities at zero values of the covariates.
0.2332819 0.7667181 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1        St2
(Intercept)   0 1.29650280
PDO           0 0.07664089
Probalities at zero values of the covariates.
0.2147542 0.7852458 


Response parameters 
Resp 1 : gaussian 
Resp 2 : gaussian 
    Re1.(Intercept) Re1.sd Re2.(Intercept) Re2.sd
St1           3.650  2.414           4.168  2.628
St2          -1.438  1.019          -1.803  2.325</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  1   0 

Transition matrix 
        toS1  toS2
fromS1 0.731 0.269
fromS2 0.270 0.730

Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1           1.344   0.684  1.219
St2          -1.184   0.463  0.534</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod6) <span class="co"># no transition matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Initial state probabilities model 
pr1 pr2 
  0   1 

Transition model for state (component) 1 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1         St2
(Intercept)   0 10.22711258
PDO           0 -0.03208095
Probalities at zero values of the covariates.
3.617477e-05 0.9999638 

Transition model for state (component) 2 
Model of type multinomial (mlogit), formula: ~PDO
Coefficients: 
            St1      St2
(Intercept)   0 6.846492
PDO           0 4.202830
Probalities at zero values of the covariates.
0.00106205 0.9989379 


Response parameters 
Resp 1 : gaussian 
    Re1.(Intercept) Re1.PDO Re1.sd
St1          -0.220   0.199  0.704
St2           0.136   0.892  1.151</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get the transition matrices</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_probs</span>(fitmod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]      [,2]
[1,] 0.2332819 0.7667181
[2,] 0.2147542 0.7852458</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_probs</span>(fitmod6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]      [,2]
[1,] 3.617477e-05 0.9999638
[2,] 1.062050e-03 0.9989379</code></pre>
</div>
</div>
<p>State 3 in model 2 appears to be fairly unstable as its state 3 to state 3 transition probability is 0, and it has a fairly low probability of other states transitioning to state 3, outside of state 2 to state 3. Our best model run did not generate any observations in state 3 so it is unclear if this is a middle state as we hypothesized or not.</p>
<p>The state 1 transition probabilities in models 3 and 4 showed an opposite pattern, yet produced very similar fits to the data. The difference appeared to only be shown in the most recent years, where in model 4 there was a more rapid shift out of the higher state. This aligns with what we would expect with the change in transition probabilities from state 1 to state 2.</p>
<p>Model 5 appeared to have smaller intercept values which makes sense as the predicted states were closer to 0 than in the other models.</p>
<p>The transition matrix for model 6 was the most unique with a high likelihood that the model will transition to and stay in state 2. This is another good indication that the model is a poor fit to the data as the data visually appears to have at least two states, and the other models produced good visual fits with a two state approach.</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>PDO is an index of ocean conditions that is generally thought to act as a driver for abundance and richness of organisms in the North Pacific. Here we predicted that PDO would be a driver of copepod richness. The two time series of data appear to closely co-vary and seem to show a pattern of a high and low state with rapid swings between the two. Our models using 2 states produced good visual fits and we found little support for three states. AIC appears to be a relatively poor choice for model selection in this instance although it is unclear if that is specific to HMM models or if there was a programming error. Other types of model selection would likely increase our understanding of model performance. We saw no obvious difference between a rapid shift in states , <code>transition = ~1</code> and a shift proportional to the PDO data set. This suggests that there is in fact a very rapid shift between states, which aligns with our expected result based on the general lack of observations near neutral conditions.</p>
<section id="what-were-still-confused-about" class="level2">
<h2 class="anchored" data-anchor-id="what-were-still-confused-about">What we’re still confused about</h2>
<p>One question we had is that our ‘best’ model based on AIC values did not appear to be a good fit to the data visually. When this is the case, what should our next steps be? Visually confirming model fit seems to overrule AIC values when those diagnostics are contradictory, is this true?</p>
<p>We didn’t have a good handle on how the ‘nstates’ and ‘transitions’ inputs to the models interacted and what type of model diagnostics would help us quantify underlying relationships. After we were in pretty deep we realized having PDO in both the model list (related to copepod richness or as an independent intercept) and as a covarate for transition may be inappropriate, but are unsure and would like more information.</p>
<p>PDO has a very strong correlative pattern with copepod richness. We ran several combinations of model to examine the strength of this relationship. We produced some models with decent looking fits, but these models were not as highly ranked by AIC as other, seemingly less well fitting models. Is AIC a poor choice? We have a suspicion this question will be answered in the next lecture(s)…</p>
</section>
</section>
<section id="team-contributions" class="level1">
<h1>Team contributions</h1>
<p>Madison took point on coding, Nick helped with coding and compiled it into the final rmd, and Nick and Karl did writing and Madison proofread and organized the .Rmd document.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/atsa-es\.github\.io\/fish550-2023\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsa-es/fish550-2023" data-repo-id="R_kgDOJGNymQ" data-category="General" data-category-id="DIC_kwDOJGNymc4CUsbe" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Lab-4/Final_Write_ups/Lab-4-team-2_final.html" class="pagination-link" aria-label="Team 2 - Lab 4">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Team 2 - Lab 4</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Lab-4/Final_Write_ups/Lab-4-team-4_final.html" class="pagination-link" aria-label="Team 4 - Lab 4">
        <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Team 4 - Lab 4</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb107" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Team 3 - Lab 4"</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Hidden Markov Models"</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Nick Chambers, Madison Shipley, Karl Veggerby"</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> May 9, 2023</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-folding: true</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include = FALSE}</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="in">options(dplyr.summarise.inform = FALSE)</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(depmixS4)</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(hmmTMB)</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(depmixS4)</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data set </span></span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>In this lab, we're looking at ecological indicators and exploring hidden Markov models and probabilities of shifting between underlying states. </span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load the data</span></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>We explored the <span class="in">`stoplight.csv`</span> dataset for this week. One of the columns divides indicators into groups (e.g. Climate, Local Physical, Local Biological, etc) and we wanted to look at some biological indicators and climate/physical indicators. </span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data}</span></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="in">stoplight &lt;- read.csv(here::here("Lab-4", "stoplight.csv"))</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a><span class="in">head(stoplight)</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-35"><a href="#cb107-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-36"><a href="#cb107-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wrangle the data</span></span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a>We initially selected the Pacific Decadal Osculation (PDO) for the Dec/March period, sea surface temperature (SST), and copepod richness and ichthy communitiy index, which we assumed was comperable to copepod richness (though maybe not).</span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a><span class="co">#ecosystem indicators</span></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a>stoplight[,<span class="dv">1</span>]  </span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>years<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1998</span>,<span class="dv">2021</span>,<span class="dv">1</span>)</span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a><span class="co">#ecosystem indicators to pull</span></span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a>PDO_DecMarch<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a>SST<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">4</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb107-49"><a href="#cb107-49" aria-hidden="true" tabindex="-1"></a>Copepod_richness<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">9</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>])) </span>
<span id="cb107-50"><a href="#cb107-50" aria-hidden="true" tabindex="-1"></a>Ichthy_community_index<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">as.vector</span>(stoplight[<span class="dv">14</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">26</span>]))</span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">length</span>(years), <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">1</span>]<span class="ot">&lt;-</span>years</span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">2</span>]<span class="ot">&lt;-</span>PDO_DecMarch</span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">3</span>]<span class="ot">&lt;-</span>SST</span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">4</span>]<span class="ot">&lt;-</span>Copepod_richness</span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a>dat[,<span class="dv">5</span>]<span class="ot">&lt;-</span>Ichthy_community_index</span>
<span id="cb107-58"><a href="#cb107-58" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dat)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"years"</span>,<span class="st">"PDO"</span>, <span class="st">"SST"</span>, <span class="st">"CopeRich"</span>, <span class="st">"FishInx"</span>)</span>
<span id="cb107-59"><a href="#cb107-59" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat)<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">1</span>)</span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(dat)</span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Visualization</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a>The first rule of science is to plot your data! We started with looking at all our data together. </span>
<span id="cb107-68"><a href="#cb107-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting all</span></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> SST, <span class="at">color =</span> <span class="st">"SST"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> FishInx, <span class="at">color =</span> <span class="st">"FishInx"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb107-76"><a href="#cb107-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-77"><a href="#cb107-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a>Sea surface temperature stats pretty consistent, while the fish index had a significant range, possibly following PDO if you squint, but was not immediatly compelling. We narrowed it down and decided to focus on copepod richness and PDO, which seemed to be incredibly correlated, and plotted the time series and their relationship to each other. In a positive PDO index, there is a positive correlation with copepod index. </span>
<span id="cb107-82"><a href="#cb107-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-83"><a href="#cb107-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Coperich and env cov</span></span>
<span id="cb107-84"><a href="#cb107-84" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb107-85"><a href="#cb107-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-86"><a href="#cb107-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-87"><a href="#cb107-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb107-88"><a href="#cb107-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-89"><a href="#cb107-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-90"><a href="#cb107-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-91"><a href="#cb107-91" aria-hidden="true" tabindex="-1"></a><span class="co">#CopeRichness tracks very closely with PDO</span></span>
<span id="cb107-92"><a href="#cb107-92" aria-hidden="true" tabindex="-1"></a><span class="co">#SST seems to have a negligible correlation </span></span>
<span id="cb107-93"><a href="#cb107-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-94"><a href="#cb107-94" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> PDO, <span class="at">y =</span> CopeRich, <span class="at">color =</span> CopeRich <span class="sc">&lt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-95"><a href="#cb107-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb107-96"><a href="#cb107-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> PDO, <span class="at">y =</span> CopeRich)) <span class="sc">+</span></span>
<span id="cb107-97"><a href="#cb107-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb107-98"><a href="#cb107-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb107-99"><a href="#cb107-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Above 0"</span>, <span class="st">"Below 0"</span>)) <span class="sc">+</span></span>
<span id="cb107-100"><a href="#cb107-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PDO"</span>, <span class="at">y =</span> <span class="st">"CopeRich"</span>) <span class="sc">+</span></span>
<span id="cb107-101"><a href="#cb107-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-102"><a href="#cb107-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-103"><a href="#cb107-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-104"><a href="#cb107-104" aria-hidden="true" tabindex="-1"></a><span class="co">#fish index is all over the place, let's not use it. </span></span>
<span id="cb107-105"><a href="#cb107-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-106"><a href="#cb107-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-107"><a href="#cb107-107" aria-hidden="true" tabindex="-1"></a>We also wanted to think about our possible hidden states, and while there seems to be a clear two-state sytem with PDO in a negative or positive index, we wondered if there was a third state "weak" index. </span>
<span id="cb107-110"><a href="#cb107-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-111"><a href="#cb107-111" aria-hidden="true" tabindex="-1"></a><span class="co"># PDO states </span></span>
<span id="cb107-112"><a href="#cb107-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> years)) <span class="sc">+</span></span>
<span id="cb107-113"><a href="#cb107-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> PDO, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-114"><a href="#cb107-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>, <span class="at">FishInx =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb107-115"><a href="#cb107-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-116"><a href="#cb107-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb107-117"><a href="#cb107-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">2.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb107-118"><a href="#cb107-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb107-119"><a href="#cb107-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-120"><a href="#cb107-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-121"><a href="#cb107-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-122"><a href="#cb107-122" aria-hidden="true" tabindex="-1"></a><span class="fu">### Objective tips </span></span>
<span id="cb107-123"><a href="#cb107-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-124"><a href="#cb107-124" aria-hidden="true" tabindex="-1"></a>Our primary objectives for this lab were to gain a better understanding of hmm options and getting some practice with interpretation by exploring different model options considering copepod richness and PDO. While there was much more we could have done, we decided to explore model specification, and interpretation of AIC for these types of models, which can be misleading depending on the ecological assumptions being made. </span>
<span id="cb107-125"><a href="#cb107-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-126"><a href="#cb107-126" aria-hidden="true" tabindex="-1"></a><span class="fu"># General tasks</span></span>
<span id="cb107-127"><a href="#cb107-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-128"><a href="#cb107-128" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Please pick a type of indicators, and develop a 2- or 3-state multivariate HMM. </span>
<span id="cb107-129"><a href="#cb107-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-130"><a href="#cb107-130" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb107-131"><a href="#cb107-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-132"><a href="#cb107-132" aria-hidden="true" tabindex="-1"></a>We fit models with different either two or three states to determine whether copepod richness and/or PDO seems to have 2 or 3 states. It's unclear if there is a 'neutral' state that modulates copepod richness in addition to the hot and cool phases. </span>
<span id="cb107-133"><a href="#cb107-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-134"><a href="#cb107-134" aria-hidden="true" tabindex="-1"></a>We also explored the transition option, by assuming either that there is no covariate informing the transition, or that PDO informed the transition.</span>
<span id="cb107-135"><a href="#cb107-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-136"><a href="#cb107-136" aria-hidden="true" tabindex="-1"></a>We assumed the familys were gaussian for all models tested. </span>
<span id="cb107-137"><a href="#cb107-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-138"><a href="#cb107-138" aria-hidden="true" tabindex="-1"></a>We plotted the fit of all models to copepod richness and PDO data from the stoplight dataset. We then also compared model fits with AIC in an attempt to select the best model. </span>
<span id="cb107-139"><a href="#cb107-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-140"><a href="#cb107-140" aria-hidden="true" tabindex="-1"></a>Note that in the report we give probabilities of transitioning to and from states, but these models are very sensitive to starting conditions, so we iterate over many set seeds for each model to find the best fit. That being said, some of the values written in this report may be different upon knitting. </span>
<span id="cb107-141"><a href="#cb107-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-142"><a href="#cb107-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 1 Copepods only: 2 states  </span></span>
<span id="cb107-143"><a href="#cb107-143" aria-hidden="true" tabindex="-1"></a>We started with a very simple model, with copepod richness as the intercept and no covariates informing the transition. We started by assuming a two state system.  </span>
<span id="cb107-146"><a href="#cb107-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-147"><a href="#cb107-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1</span></span>
<span id="cb107-148"><a href="#cb107-148" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">depmix</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb107-149"><a href="#cb107-149" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb107-150"><a href="#cb107-150" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb107-151"><a href="#cb107-151" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb107-152"><a href="#cb107-152" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>dat)</span>
<span id="cb107-153"><a href="#cb107-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-154"><a href="#cb107-154" aria-hidden="true" tabindex="-1"></a>fitmod1 <span class="ot">=</span> <span class="fu">fit</span>(mod1)</span>
<span id="cb107-155"><a href="#cb107-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-156"><a href="#cb107-156" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-157"><a href="#cb107-157" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-158"><a href="#cb107-158" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-159"><a href="#cb107-159" aria-hidden="true" tabindex="-1"></a>best1 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-160"><a href="#cb107-160" aria-hidden="true" tabindex="-1"></a>best_model1 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-161"><a href="#cb107-161" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-162"><a href="#cb107-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-163"><a href="#cb107-163" aria-hidden="true" tabindex="-1"></a>  fitmod1 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod1)</span>
<span id="cb107-164"><a href="#cb107-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod1)<span class="sc">&lt;</span> best1){</span>
<span id="cb107-165"><a href="#cb107-165" aria-hidden="true" tabindex="-1"></a>    best_model1 <span class="ot">&lt;-</span> fitmod1</span>
<span id="cb107-166"><a href="#cb107-166" aria-hidden="true" tabindex="-1"></a>    best1 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod1)</span>
<span id="cb107-167"><a href="#cb107-167" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-168"><a href="#cb107-168" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-169"><a href="#cb107-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-170"><a href="#cb107-170" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model1)</span>
<span id="cb107-171"><a href="#cb107-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-172"><a href="#cb107-172" aria-hidden="true" tabindex="-1"></a>We see that there is a ~75% probability of state one staying in state one, and ~60% of state two staying in state two, with ~25% and 40% probability for transitioning from state 1 to state 2 and state 2 to state 1 respectively, showing that the system generally is more stable in state one.</span>
<span id="cb107-175"><a href="#cb107-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-176"><a href="#cb107-176" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model1, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb107-177"><a href="#cb107-177" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior Probability of Changing States"</span>,</span>
<span id="cb107-178"><a href="#cb107-178" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb107-179"><a href="#cb107-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-180"><a href="#cb107-180" aria-hidden="true" tabindex="-1"></a>prstates <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">posterior</span>(best_model1)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-181"><a href="#cb107-181" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">summary</span>(best_model1)[,<span class="dv">1</span>]</span>
<span id="cb107-182"><a href="#cb107-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-183"><a href="#cb107-183" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb107-184"><a href="#cb107-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-185"><a href="#cb107-185" aria-hidden="true" tabindex="-1"></a><span class="co">#predicted values</span></span>
<span id="cb107-186"><a href="#cb107-186" aria-hidden="true" tabindex="-1"></a>pred1<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> </span>
<span id="cb107-187"><a href="#cb107-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-188"><a href="#cb107-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-189"><a href="#cb107-189" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-190"><a href="#cb107-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred1, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-191"><a href="#cb107-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-192"><a href="#cb107-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb107-193"><a href="#cb107-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb107-194"><a href="#cb107-194" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb107-195"><a href="#cb107-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 1 - Two States"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-196"><a href="#cb107-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-197"><a href="#cb107-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-198"><a href="#cb107-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-199"><a href="#cb107-199" aria-hidden="true" tabindex="-1"></a>Model 1 produces a reasonably good fit to the data. </span>
<span id="cb107-200"><a href="#cb107-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-201"><a href="#cb107-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 2 Copepods only: 3 states </span></span>
<span id="cb107-202"><a href="#cb107-202" aria-hidden="true" tabindex="-1"></a>We continued by using the same simple model from above, and assuming 3 states. </span>
<span id="cb107-205"><a href="#cb107-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-206"><a href="#cb107-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2</span></span>
<span id="cb107-207"><a href="#cb107-207" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">depmix</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb107-208"><a href="#cb107-208" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nstates =</span> <span class="dv">3</span>, </span>
<span id="cb107-209"><a href="#cb107-209" aria-hidden="true" tabindex="-1"></a>                   <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb107-210"><a href="#cb107-210" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb107-211"><a href="#cb107-211" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>dat)</span>
<span id="cb107-212"><a href="#cb107-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-213"><a href="#cb107-213" aria-hidden="true" tabindex="-1"></a>fitmod2 <span class="ot">=</span> <span class="fu">fit</span>(mod2)</span>
<span id="cb107-214"><a href="#cb107-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-215"><a href="#cb107-215" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-216"><a href="#cb107-216" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-217"><a href="#cb107-217" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-218"><a href="#cb107-218" aria-hidden="true" tabindex="-1"></a>best2 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-219"><a href="#cb107-219" aria-hidden="true" tabindex="-1"></a>best_model2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-220"><a href="#cb107-220" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-221"><a href="#cb107-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-222"><a href="#cb107-222" aria-hidden="true" tabindex="-1"></a>  fitmod2 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod2)</span>
<span id="cb107-223"><a href="#cb107-223" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod2)<span class="sc">&lt;</span> best2){</span>
<span id="cb107-224"><a href="#cb107-224" aria-hidden="true" tabindex="-1"></a>    best_model2 <span class="ot">&lt;-</span> fitmod2</span>
<span id="cb107-225"><a href="#cb107-225" aria-hidden="true" tabindex="-1"></a>    best2 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod2)</span>
<span id="cb107-226"><a href="#cb107-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-227"><a href="#cb107-227" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-228"><a href="#cb107-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-229"><a href="#cb107-229" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model2)</span>
<span id="cb107-230"><a href="#cb107-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-231"><a href="#cb107-231" aria-hidden="true" tabindex="-1"></a>This transition matrix is a little trickier to interpret, but the likelihood of transitioning to state three was low, ~7% for state one and 0% of transitioning from 2 to 3. This may not be a great specification. </span>
<span id="cb107-232"><a href="#cb107-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-235"><a href="#cb107-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-236"><a href="#cb107-236" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(ts(posterior(best_model1, type="smoothing")[,1], start=c(2003,5), deltat=1/12),ylab="probability",</span></span>
<span id="cb107-237"><a href="#cb107-237" aria-hidden="true" tabindex="-1"></a><span class="co">#      main="Posterior probability of state 1 (copepods good?).",</span></span>
<span id="cb107-238"><a href="#cb107-238" aria-hidden="true" tabindex="-1"></a><span class="co">#      frame=FALSE)</span></span>
<span id="cb107-239"><a href="#cb107-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-240"><a href="#cb107-240" aria-hidden="true" tabindex="-1"></a>prstates <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">posterior</span>(best_model2)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-241"><a href="#cb107-241" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">summary</span>(best_model2)[,<span class="dv">1</span>]</span>
<span id="cb107-242"><a href="#cb107-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-243"><a href="#cb107-243" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb107-244"><a href="#cb107-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-245"><a href="#cb107-245" aria-hidden="true" tabindex="-1"></a><span class="co">#predicted values</span></span>
<span id="cb107-246"><a href="#cb107-246" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> pred <span class="sc">%&gt;%</span> </span>
<span id="cb107-247"><a href="#cb107-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-248"><a href="#cb107-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-249"><a href="#cb107-249" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-250"><a href="#cb107-250" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred2, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-251"><a href="#cb107-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-252"><a href="#cb107-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb107-253"><a href="#cb107-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb107-254"><a href="#cb107-254" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb107-255"><a href="#cb107-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 2 - Three States"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-256"><a href="#cb107-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-257"><a href="#cb107-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-258"><a href="#cb107-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-259"><a href="#cb107-259" aria-hidden="true" tabindex="-1"></a>Compared to model 1, model 2 produces a poor visual fit to the data, with a narrower peak later in the timeseries. Because of this we assumed 2 states in the other models we tested. </span>
<span id="cb107-260"><a href="#cb107-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-261"><a href="#cb107-261" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 3 Copepods and PDO </span></span>
<span id="cb107-262"><a href="#cb107-262" aria-hidden="true" tabindex="-1"></a>Because Copepods and PDO have such a clear relationship visually, we started by looking at a model considering both copepod richness and PDO as intercepts, with no covariates informing the transition.</span>
<span id="cb107-265"><a href="#cb107-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-266"><a href="#cb107-266" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods and PDO as intercepts </span></span>
<span id="cb107-267"><a href="#cb107-267" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>, PDO<span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb107-268"><a href="#cb107-268" aria-hidden="true" tabindex="-1"></a>             <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb107-269"><a href="#cb107-269" aria-hidden="true" tabindex="-1"></a>             <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb107-270"><a href="#cb107-270" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(),<span class="fu">gaussian</span>()),</span>
<span id="cb107-271"><a href="#cb107-271" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>dat)</span>
<span id="cb107-272"><a href="#cb107-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-273"><a href="#cb107-273" aria-hidden="true" tabindex="-1"></a>fitmod3 <span class="ot">=</span> <span class="fu">fit</span>(mod3)</span>
<span id="cb107-274"><a href="#cb107-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-275"><a href="#cb107-275" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-276"><a href="#cb107-276" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-277"><a href="#cb107-277" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-278"><a href="#cb107-278" aria-hidden="true" tabindex="-1"></a>best3 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-279"><a href="#cb107-279" aria-hidden="true" tabindex="-1"></a>best_model3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-280"><a href="#cb107-280" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-281"><a href="#cb107-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-282"><a href="#cb107-282" aria-hidden="true" tabindex="-1"></a>  fitmod3 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod3)</span>
<span id="cb107-283"><a href="#cb107-283" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod3)<span class="sc">&lt;</span> best3){</span>
<span id="cb107-284"><a href="#cb107-284" aria-hidden="true" tabindex="-1"></a>    best_model3 <span class="ot">&lt;-</span> fitmod3</span>
<span id="cb107-285"><a href="#cb107-285" aria-hidden="true" tabindex="-1"></a>    best3 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod3)</span>
<span id="cb107-286"><a href="#cb107-286" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-287"><a href="#cb107-287" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-288"><a href="#cb107-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-289"><a href="#cb107-289" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model3)</span>
<span id="cb107-290"><a href="#cb107-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-291"><a href="#cb107-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-292"><a href="#cb107-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-293"><a href="#cb107-293" aria-hidden="true" tabindex="-1"></a>This model still preferred state one, with a ~75% probability of staying in one and ~25% chance of transitioning to two. There was a ~61% change of state two to stay in state two and a ~39% chance to transition back to state one. Note there are values for the intercepts and sd for Re1 (coperich) and Re2 (PDO) in this model. </span>
<span id="cb107-294"><a href="#cb107-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-297"><a href="#cb107-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-298"><a href="#cb107-298" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model3, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb107-299"><a href="#cb107-299" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb107-300"><a href="#cb107-300" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb107-301"><a href="#cb107-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-302"><a href="#cb107-302" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model3)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-303"><a href="#cb107-303" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model3)[,<span class="dv">1</span>]</span>
<span id="cb107-304"><a href="#cb107-304" aria-hidden="true" tabindex="-1"></a>mu3<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model3)[,<span class="dv">3</span>]</span>
<span id="cb107-305"><a href="#cb107-305" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates],<span class="st">"PDO"</span> <span class="ot">=</span> mu3[prstates])</span>
<span id="cb107-306"><a href="#cb107-306" aria-hidden="true" tabindex="-1"></a>pred3<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Covariates"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-307"><a href="#cb107-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-308"><a href="#cb107-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-309"><a href="#cb107-309" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-310"><a href="#cb107-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred3, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Fit, <span class="at">group =</span> Covariates, <span class="at">color =</span> Covariates)) <span class="sc">+</span></span>
<span id="cb107-311"><a href="#cb107-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-312"><a href="#cb107-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-313"><a href="#cb107-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span>  <span class="co"># Assign distinct colors for each line in pred3</span></span>
<span id="cb107-314"><a href="#cb107-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model 3 - Transition ~ 1"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-315"><a href="#cb107-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-316"><a href="#cb107-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-317"><a href="#cb107-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-318"><a href="#cb107-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-319"><a href="#cb107-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 4 Copepods and PDO with transition informed by PDO </span></span>
<span id="cb107-320"><a href="#cb107-320" aria-hidden="true" tabindex="-1"></a>Next we wanted to look at copepod richness and PDO with the transition informed by the PDO.</span>
<span id="cb107-323"><a href="#cb107-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-324"><a href="#cb107-324" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods and PDO as intercepts where the transition is informed by PDO</span></span>
<span id="cb107-325"><a href="#cb107-325" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span><span class="dv">1</span>, PDO<span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb107-326"><a href="#cb107-326" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb107-327"><a href="#cb107-327" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span>PDO, </span>
<span id="cb107-328"><a href="#cb107-328" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>(),<span class="fu">gaussian</span>()),</span>
<span id="cb107-329"><a href="#cb107-329" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb107-330"><a href="#cb107-330" aria-hidden="true" tabindex="-1"></a>fitmod4 <span class="ot">=</span> <span class="fu">fit</span>(mod4)</span>
<span id="cb107-331"><a href="#cb107-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-332"><a href="#cb107-332" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-333"><a href="#cb107-333" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-334"><a href="#cb107-334" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-335"><a href="#cb107-335" aria-hidden="true" tabindex="-1"></a>best4 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-336"><a href="#cb107-336" aria-hidden="true" tabindex="-1"></a>best_model4 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-337"><a href="#cb107-337" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-338"><a href="#cb107-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-339"><a href="#cb107-339" aria-hidden="true" tabindex="-1"></a>  fitmod4 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod4)</span>
<span id="cb107-340"><a href="#cb107-340" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod4)<span class="sc">&lt;</span> best4){</span>
<span id="cb107-341"><a href="#cb107-341" aria-hidden="true" tabindex="-1"></a>    best_model4 <span class="ot">&lt;-</span> fitmod4</span>
<span id="cb107-342"><a href="#cb107-342" aria-hidden="true" tabindex="-1"></a>    best4 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod4)</span>
<span id="cb107-343"><a href="#cb107-343" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-344"><a href="#cb107-344" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-345"><a href="#cb107-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-346"><a href="#cb107-346" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model4)</span>
<span id="cb107-347"><a href="#cb107-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-348"><a href="#cb107-348" aria-hidden="true" tabindex="-1"></a>This transition matrix isn't interpretable as is, but we'll come back to that later. One question is whether or not this is appropriate, to model PDO as an intercept and use it also as a covariate. Is this confounding? Poor practice? </span>
<span id="cb107-351"><a href="#cb107-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-352"><a href="#cb107-352" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model4, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb107-353"><a href="#cb107-353" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb107-354"><a href="#cb107-354" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb107-355"><a href="#cb107-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-356"><a href="#cb107-356" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model4)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-357"><a href="#cb107-357" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model4)[,<span class="dv">1</span>]</span>
<span id="cb107-358"><a href="#cb107-358" aria-hidden="true" tabindex="-1"></a>mu4<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model4)[,<span class="dv">3</span>]</span>
<span id="cb107-359"><a href="#cb107-359" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates],<span class="st">"PDO"</span> <span class="ot">=</span> mu4[prstates])</span>
<span id="cb107-360"><a href="#cb107-360" aria-hidden="true" tabindex="-1"></a>pred4<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Covariates"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-361"><a href="#cb107-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-362"><a href="#cb107-362" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-363"><a href="#cb107-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred4, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Fit, <span class="at">group =</span> Covariates, <span class="at">color =</span> Covariates)) <span class="sc">+</span></span>
<span id="cb107-364"><a href="#cb107-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-365"><a href="#cb107-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-366"><a href="#cb107-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"lightgreen"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span>  <span class="co"># Assign distinct colors for each line in pred3</span></span>
<span id="cb107-367"><a href="#cb107-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 4 - Transition ~ PDO"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-368"><a href="#cb107-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-369"><a href="#cb107-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-370"><a href="#cb107-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-371"><a href="#cb107-371" aria-hidden="true" tabindex="-1"></a>Models 3 and 4 produce similar fits to the data, the only obvious difference is that model 4 spends less time in the higher state than model 3. </span>
<span id="cb107-372"><a href="#cb107-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-373"><a href="#cb107-373" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 5 Copepods informed by PDO </span></span>
<span id="cb107-374"><a href="#cb107-374" aria-hidden="true" tabindex="-1"></a>In this model, we wanted to relate copepod richness to PDO directly, with no transtion. </span>
<span id="cb107-377"><a href="#cb107-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-378"><a href="#cb107-378" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods as they relate to PDO</span></span>
<span id="cb107-379"><a href="#cb107-379" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span>PDO),</span>
<span id="cb107-380"><a href="#cb107-380" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb107-381"><a href="#cb107-381" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb107-382"><a href="#cb107-382" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>()),</span>
<span id="cb107-383"><a href="#cb107-383" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb107-384"><a href="#cb107-384" aria-hidden="true" tabindex="-1"></a>fitmod5 <span class="ot">=</span> <span class="fu">fit</span>(mod5)</span>
<span id="cb107-385"><a href="#cb107-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-386"><a href="#cb107-386" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-387"><a href="#cb107-387" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-388"><a href="#cb107-388" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-389"><a href="#cb107-389" aria-hidden="true" tabindex="-1"></a>best5 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-390"><a href="#cb107-390" aria-hidden="true" tabindex="-1"></a>best_model5 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-391"><a href="#cb107-391" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-392"><a href="#cb107-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-393"><a href="#cb107-393" aria-hidden="true" tabindex="-1"></a>  fitmod5 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod5)</span>
<span id="cb107-394"><a href="#cb107-394" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod5)<span class="sc">&lt;</span> best5){</span>
<span id="cb107-395"><a href="#cb107-395" aria-hidden="true" tabindex="-1"></a>    best_model5 <span class="ot">&lt;-</span> fitmod5</span>
<span id="cb107-396"><a href="#cb107-396" aria-hidden="true" tabindex="-1"></a>    best5 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod5)</span>
<span id="cb107-397"><a href="#cb107-397" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-398"><a href="#cb107-398" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-399"><a href="#cb107-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-400"><a href="#cb107-400" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model5)</span>
<span id="cb107-401"><a href="#cb107-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-402"><a href="#cb107-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-403"><a href="#cb107-403" aria-hidden="true" tabindex="-1"></a>This model has an interpreatable transition matrix, where the probability of staying or leaving each respective state is about ~70-30. Note that we now have PDO as informing our copepod richness in the response parameters. </span>
<span id="cb107-404"><a href="#cb107-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-407"><a href="#cb107-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-408"><a href="#cb107-408" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model5, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb107-409"><a href="#cb107-409" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb107-410"><a href="#cb107-410" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb107-411"><a href="#cb107-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-412"><a href="#cb107-412" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model5)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-413"><a href="#cb107-413" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model5)[,<span class="dv">1</span>]</span>
<span id="cb107-414"><a href="#cb107-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-415"><a href="#cb107-415" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb107-416"><a href="#cb107-416" aria-hidden="true" tabindex="-1"></a>pred5<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-417"><a href="#cb107-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-418"><a href="#cb107-418" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-419"><a href="#cb107-419" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred5, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-420"><a href="#cb107-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-421"><a href="#cb107-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb107-422"><a href="#cb107-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb107-423"><a href="#cb107-423" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb107-424"><a href="#cb107-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 5 - Copepod Richness ~ PDO , Transition ~1"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-425"><a href="#cb107-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-426"><a href="#cb107-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-427"><a href="#cb107-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-428"><a href="#cb107-428" aria-hidden="true" tabindex="-1"></a>Copepod richness and PDO data have the closest correlation, and it seemed reasonable to relate them to each other and model the variation of Copepod Richness as a function of PDO. Admittedly, we are not sure if this is a appropriate entry to the <span class="in">`depmix()`</span> function but the results for models 5 and 6 were interesting so we included them. </span>
<span id="cb107-429"><a href="#cb107-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-430"><a href="#cb107-430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model 6 Copepods informed by PDO with PDO informing transition</span></span>
<span id="cb107-431"><a href="#cb107-431" aria-hidden="true" tabindex="-1"></a>This model is the same as model 5, but using PDO as a covariate for transition, which could be inappropriate for hmm model specification. But, we wanted to explore it. </span>
<span id="cb107-432"><a href="#cb107-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-433"><a href="#cb107-433" aria-hidden="true" tabindex="-1"></a>For the intercept we chose to model Copepod Richness ~ PDO. These data sets have the closest correlation and so this was done to test of the fit could be improved by modeling the variation of Copepod Richness as a function of PDO. Admittedly, we are not sure if this is a appropriate entry to the <span class="in">`depmix()`</span> function but the results for models 5 and 6 were interesting so we included them. </span>
<span id="cb107-434"><a href="#cb107-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-435"><a href="#cb107-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-438"><a href="#cb107-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-439"><a href="#cb107-439" aria-hidden="true" tabindex="-1"></a><span class="co">#Copepods as they relate to PDO where the transition is informed by PDO</span></span>
<span id="cb107-440"><a href="#cb107-440" aria-hidden="true" tabindex="-1"></a>mod6 <span class="ot">=</span> <span class="fu">depmix</span>(<span class="fu">list</span>(CopeRich <span class="sc">~</span>PDO),</span>
<span id="cb107-441"><a href="#cb107-441" aria-hidden="true" tabindex="-1"></a>              <span class="at">nstates =</span> <span class="dv">2</span>, </span>
<span id="cb107-442"><a href="#cb107-442" aria-hidden="true" tabindex="-1"></a>              <span class="at">transition =</span> <span class="sc">~</span>PDO, </span>
<span id="cb107-443"><a href="#cb107-443" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">list</span>(<span class="fu">gaussian</span>()),</span>
<span id="cb107-444"><a href="#cb107-444" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>dat)</span>
<span id="cb107-445"><a href="#cb107-445" aria-hidden="true" tabindex="-1"></a>fitmod6 <span class="ot">=</span> <span class="fu">fit</span>(mod6)</span>
<span id="cb107-446"><a href="#cb107-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-447"><a href="#cb107-447" aria-hidden="true" tabindex="-1"></a><span class="co">#Find best fit </span></span>
<span id="cb107-448"><a href="#cb107-448" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb107-449"><a href="#cb107-449" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">size =</span> iter, <span class="at">replace =</span> F)</span>
<span id="cb107-450"><a href="#cb107-450" aria-hidden="true" tabindex="-1"></a>best6 <span class="ot">&lt;-</span> <span class="fl">1e10</span></span>
<span id="cb107-451"><a href="#cb107-451" aria-hidden="true" tabindex="-1"></a>best_model6 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb107-452"><a href="#cb107-452" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter){</span>
<span id="cb107-453"><a href="#cb107-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb107-454"><a href="#cb107-454" aria-hidden="true" tabindex="-1"></a>  fitmod6 <span class="ot">&lt;-</span> <span class="fu">fit</span>(mod6)</span>
<span id="cb107-455"><a href="#cb107-455" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">AIC</span>(fitmod6)<span class="sc">&lt;</span> best6){</span>
<span id="cb107-456"><a href="#cb107-456" aria-hidden="true" tabindex="-1"></a>    best_model6 <span class="ot">&lt;-</span> fitmod6</span>
<span id="cb107-457"><a href="#cb107-457" aria-hidden="true" tabindex="-1"></a>    best6 <span class="ot">&lt;-</span> <span class="fu">AIC</span>(fitmod6)</span>
<span id="cb107-458"><a href="#cb107-458" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-459"><a href="#cb107-459" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-460"><a href="#cb107-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-461"><a href="#cb107-461" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(best_model6)</span>
<span id="cb107-462"><a href="#cb107-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-463"><a href="#cb107-463" aria-hidden="true" tabindex="-1"></a>Again, given that we included PDO as a transition covariate, the matrix was not interpretable as is in the model summary, but we address this in the More Model Diagnostics Section.</span>
<span id="cb107-466"><a href="#cb107-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-467"><a href="#cb107-467" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ts</span>(<span class="fu">posterior</span>(best_model6, <span class="at">type=</span><span class="st">"smoothing"</span>)[,<span class="dv">1</span>], <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">5</span>), <span class="at">deltat=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>),<span class="at">ylab=</span><span class="st">"probability"</span>,</span>
<span id="cb107-468"><a href="#cb107-468" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Posterior probability of state 1 (copepods good?)."</span>,</span>
<span id="cb107-469"><a href="#cb107-469" aria-hidden="true" tabindex="-1"></a>     <span class="at">frame=</span><span class="cn">FALSE</span>)</span>
<span id="cb107-470"><a href="#cb107-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-471"><a href="#cb107-471" aria-hidden="true" tabindex="-1"></a>prstates<span class="ot">&lt;-</span><span class="fu">apply</span>(<span class="fu">posterior</span>(best_model6)[,<span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>)],<span class="dv">1</span>, which.max)</span>
<span id="cb107-472"><a href="#cb107-472" aria-hidden="true" tabindex="-1"></a>mu<span class="ot">&lt;-</span><span class="fu">summary</span>(best_model6)[,<span class="dv">1</span>]</span>
<span id="cb107-473"><a href="#cb107-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-474"><a href="#cb107-474" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Year"</span> <span class="ot">=</span> dat<span class="sc">$</span>years, <span class="st">"Copepod Richness"</span> <span class="ot">=</span> mu[prstates])</span>
<span id="cb107-475"><a href="#cb107-475" aria-hidden="true" tabindex="-1"></a>pred6<span class="ot">&lt;-</span>pred <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Copepod Richness"</span>, <span class="at">values_to =</span> <span class="st">"Fit"</span>)</span>
<span id="cb107-476"><a href="#cb107-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-477"><a href="#cb107-477" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-478"><a href="#cb107-478" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data =</span> pred6, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> Fit, <span class="at">color =</span> <span class="st">"predicted_states"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-479"><a href="#cb107-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> CopeRich, <span class="at">color =</span> <span class="st">"CopeRich"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-480"><a href="#cb107-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> years, <span class="at">y =</span> PDO_DecMarch, <span class="at">color =</span> <span class="st">"PDO"</span> ), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb107-481"><a href="#cb107-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">PDO =</span> <span class="st">"blue"</span>, <span class="at">SST =</span> <span class="st">"red"</span>, <span class="at">CopeRich =</span> <span class="st">"green"</span>,</span>
<span id="cb107-482"><a href="#cb107-482" aria-hidden="true" tabindex="-1"></a>                                <span class="at">FishInx =</span> <span class="st">"purple"</span>, <span class="at">predicted_states =</span> <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb107-483"><a href="#cb107-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">" Model 6 - Copepod Richness ~ PDO, Transition ~ PDO"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">color =</span> <span class="st">"Variable"</span>) <span class="sc">+</span></span>
<span id="cb107-484"><a href="#cb107-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb107-485"><a href="#cb107-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-486"><a href="#cb107-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-487"><a href="#cb107-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-488"><a href="#cb107-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-489"><a href="#cb107-489" aria-hidden="true" tabindex="-1"></a>Visually, model 6 produced the worst fit to the data. This model suggests there is a dominant state near the mean of the data and the second state is only marginally different. The dampening of the oscillation must be from the transition being informed directly by PDO. </span>
<span id="cb107-490"><a href="#cb107-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-491"><a href="#cb107-491" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb107-492"><a href="#cb107-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-493"><a href="#cb107-493" aria-hidden="true" tabindex="-1"></a>Summarize the model you've created. Specifically,</span>
<span id="cb107-494"><a href="#cb107-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-495"><a href="#cb107-495" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Does it converge?</span>
<span id="cb107-496"><a href="#cb107-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-497"><a href="#cb107-497" aria-hidden="true" tabindex="-1"></a>All the models converged even when running the for loop over various seeds, however visual inspection of model fits revealed that several fits were quite poor, including our top model ranked by AICc.</span>
<span id="cb107-498"><a href="#cb107-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-499"><a href="#cb107-499" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How many states seem to be most supported?</span>
<span id="cb107-500"><a href="#cb107-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-501"><a href="#cb107-501" aria-hidden="true" tabindex="-1"></a>Compared to model 1, model two with 3 states produced a poor visual fit to the data. Because of this we assumed 2 states in the other models we tested. This aligned with our visual estimates of two states.</span>
<span id="cb107-502"><a href="#cb107-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-503"><a href="#cb107-503" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Plot the time series of estimated states. What does this mean?</span>
<span id="cb107-504"><a href="#cb107-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-505"><a href="#cb107-505" aria-hidden="true" tabindex="-1"></a>The plots of estimated states show the underlying pattern that may exist if there is in fact a shift between states. The variation in the data from this pattern would be related to unexplained error related to covariates other than the underlying states. Visually there appears to be good support for two underlying states, however, as shown below, the estimated states in our top AICc ranked model do not appear to fit the data well, indicating that AICc may not be the best metric to use here. It definitely highlights the dangers of blindly trusting AIC without further model checks.</span>
<span id="cb107-506"><a href="#cb107-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-507"><a href="#cb107-507" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Selection with AIC</span></span>
<span id="cb107-510"><a href="#cb107-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-511"><a href="#cb107-511" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span>,<span class="st">"4"</span>,<span class="st">"5"</span>,<span class="st">"6"</span>)</span>
<span id="cb107-512"><a href="#cb107-512" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">AIC</span>(best_model1), <span class="fu">AIC</span>(best_model2), <span class="fu">AIC</span>(best_model3), <span class="fu">AIC</span>(best_model4), <span class="fu">AIC</span>(best_model5),<span class="fu">AIC</span>(best_model6))</span>
<span id="cb107-513"><a href="#cb107-513" aria-hidden="true" tabindex="-1"></a>delta.aic <span class="ot">&lt;-</span> aic<span class="sc">-</span><span class="fu">min</span>(aic)</span>
<span id="cb107-514"><a href="#cb107-514" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(mods, aic, delta.aic)</span>
<span id="cb107-515"><a href="#cb107-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-516"><a href="#cb107-516" aria-hidden="true" tabindex="-1"></a>tab</span>
<span id="cb107-517"><a href="#cb107-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-518"><a href="#cb107-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-519"><a href="#cb107-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-520"><a href="#cb107-520" aria-hidden="true" tabindex="-1"></a>AIC tells us that the best model would be model 6, although it is just marginally better than model 5 with a delta AIC of just over 2. The delta AIC values are only about 2 different between models 1-2 and 3-4 and 5-6 respectively. Each set of models are the most similar to each other within the models tested and these AIC values indicate little to no support for one approach within each group to be significantly better than the other. AIC values do indicate significantly better performance between these sets of models, however this support is not supported by looking at visual fits of the data. The two best models, 5 and 6, produce the worst visual fits to the data of any models tested. It is unclear why AIC is selecting these models as the best, but it does seem that AIC favors the simple models with only one intercept rather than models with two intercepts. Because of the apparent poor fit of models 5 and 6, it seems other methods of model selection such as Cross Validation or leave One Out may be more appropriate here than AIC. </span>
<span id="cb107-521"><a href="#cb107-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-522"><a href="#cb107-522" aria-hidden="true" tabindex="-1"></a><span class="fu">## More Model Diagnostics</span></span>
<span id="cb107-523"><a href="#cb107-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-524"><a href="#cb107-524" aria-hidden="true" tabindex="-1"></a>The following function allows us to interpret the transition matrix when there is a covariate informing the transition. </span>
<span id="cb107-525"><a href="#cb107-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-528"><a href="#cb107-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-529"><a href="#cb107-529" aria-hidden="true" tabindex="-1"></a><span class="co">#create a funciton to help build transition matrices</span></span>
<span id="cb107-530"><a href="#cb107-530" aria-hidden="true" tabindex="-1"></a>convert_probs <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, <span class="at">coef_value =</span> <span class="dv">0</span>) {</span>
<span id="cb107-531"><a href="#cb107-531" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract coefficients</span></span>
<span id="cb107-532"><a href="#cb107-532" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> fit<span class="sc">@</span>transition[[<span class="dv">1</span>]]<span class="sc">@</span>parameters<span class="sc">$</span>coefficients</span>
<span id="cb107-533"><a href="#cb107-533" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> fit<span class="sc">@</span>transition[[<span class="dv">2</span>]]<span class="sc">@</span>parameters<span class="sc">$</span>coefficients</span>
<span id="cb107-534"><a href="#cb107-534" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-535"><a href="#cb107-535" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assemble transition matrix in mlogit space</span></span>
<span id="cb107-536"><a href="#cb107-536" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb107-537"><a href="#cb107-537" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">1</span>,] <span class="ot">&lt;-</span> p1[<span class="dv">1</span>,] <span class="sc">+</span> p1[<span class="dv">2</span>,] <span class="sc">*</span> coef_value <span class="co">#intercept + slope * coefficient</span></span>
<span id="cb107-538"><a href="#cb107-538" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">2</span>,] <span class="ot">&lt;-</span> p2[<span class="dv">1</span>,] <span class="sc">+</span> p2[<span class="dv">2</span>,] <span class="sc">*</span> coef_value</span>
<span id="cb107-539"><a href="#cb107-539" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-540"><a href="#cb107-540" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exponentiate</span></span>
<span id="cb107-541"><a href="#cb107-541" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">exp</span>(m)</span>
<span id="cb107-542"><a href="#cb107-542" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-543"><a href="#cb107-543" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize</span></span>
<span id="cb107-544"><a href="#cb107-544" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">1</span>,] <span class="ot">&lt;-</span> m[<span class="dv">1</span>,] <span class="sc">/</span> <span class="fu">sum</span>(m[<span class="dv">1</span>,])</span>
<span id="cb107-545"><a href="#cb107-545" aria-hidden="true" tabindex="-1"></a>  m[<span class="dv">2</span>,] <span class="ot">&lt;-</span> m[<span class="dv">2</span>,] <span class="sc">/</span> <span class="fu">sum</span>(m[<span class="dv">2</span>,])</span>
<span id="cb107-546"><a href="#cb107-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(m)</span>
<span id="cb107-547"><a href="#cb107-547" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-548"><a href="#cb107-548" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-549"><a href="#cb107-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-550"><a href="#cb107-550" aria-hidden="true" tabindex="-1"></a>Let's look at all the models together. Note that the above function was applied to models 4 and 6, which did not have an interpretable transition matrix. </span>
<span id="cb107-551"><a href="#cb107-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-554"><a href="#cb107-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-555"><a href="#cb107-555" aria-hidden="true" tabindex="-1"></a><span class="co">#Look at the transition matrices and variance</span></span>
<span id="cb107-556"><a href="#cb107-556" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod1)</span>
<span id="cb107-557"><a href="#cb107-557" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod2)</span>
<span id="cb107-558"><a href="#cb107-558" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod3)</span>
<span id="cb107-559"><a href="#cb107-559" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod4) <span class="co"># no transition matrix</span></span>
<span id="cb107-560"><a href="#cb107-560" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod5)</span>
<span id="cb107-561"><a href="#cb107-561" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitmod6) <span class="co"># no transition matrix</span></span>
<span id="cb107-562"><a href="#cb107-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-563"><a href="#cb107-563" aria-hidden="true" tabindex="-1"></a><span class="co">#get the transition matrices</span></span>
<span id="cb107-564"><a href="#cb107-564" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_probs</span>(fitmod4)</span>
<span id="cb107-565"><a href="#cb107-565" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_probs</span>(fitmod6)</span>
<span id="cb107-566"><a href="#cb107-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-567"><a href="#cb107-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-568"><a href="#cb107-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-569"><a href="#cb107-569" aria-hidden="true" tabindex="-1"></a>State 3 in model 2 appears to be fairly unstable as its state 3 to state 3 transition probability is 0, and it has a fairly low probability of other states transitioning to state 3, outside of state 2 to state 3. Our best model run did not generate any observations in state 3 so it is unclear if this is a middle state as we hypothesized or not. </span>
<span id="cb107-570"><a href="#cb107-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-571"><a href="#cb107-571" aria-hidden="true" tabindex="-1"></a>The state 1 transition probabilities in models 3 and 4 showed an opposite pattern, yet produced very similar fits to the data. The difference appeared to only be shown in the most recent years, where in model 4 there was a more rapid shift out of the higher state. This aligns with what we would expect with the change in transition probabilities from state 1 to state 2. </span>
<span id="cb107-572"><a href="#cb107-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-573"><a href="#cb107-573" aria-hidden="true" tabindex="-1"></a>Model 5 appeared to have smaller intercept values which makes sense as the predicted states were closer to 0 than in the other models. </span>
<span id="cb107-574"><a href="#cb107-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-575"><a href="#cb107-575" aria-hidden="true" tabindex="-1"></a>The transition matrix for model 6 was the most unique with a high likelihood that the model will transition to and stay in state 2. This is another good indication that the model is a poor fit to the data as the data visually appears to have at least two states, and the other models produced good visual fits with a two state approach.</span>
<span id="cb107-576"><a href="#cb107-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-577"><a href="#cb107-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-578"><a href="#cb107-578" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb107-579"><a href="#cb107-579" aria-hidden="true" tabindex="-1"></a>PDO is an index of ocean conditions that is generally thought to act as a driver for abundance and richness of organisms in the North Pacific. Here we predicted that PDO would be a driver of copepod richness. The two time series of data appear to closely co-vary and seem to show a pattern of a high and low state with rapid swings between the two. Our models using 2 states produced good visual fits and we found little support for three states. AIC appears to be a relatively poor choice for model selection in this instance although it is unclear if that is specific to HMM models or if there was a programming error. Other types of model selection would likely increase our understanding of model performance. We saw no obvious difference between a rapid shift in states , <span class="in">`transition = ~1`</span> and a shift proportional to the PDO data set. This suggests that there is in fact a very rapid shift between states, which aligns with our expected result based on the general lack of observations near neutral conditions. </span>
<span id="cb107-580"><a href="#cb107-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-581"><a href="#cb107-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-582"><a href="#cb107-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## What we're still confused about</span></span>
<span id="cb107-583"><a href="#cb107-583" aria-hidden="true" tabindex="-1"></a>One question we had is that our 'best' model based on AIC values did not appear to be a good fit to the data visually. When this is the case, what should our next steps be? Visually confirming model fit seems to overrule AIC values when those diagnostics are contradictory, is this true?</span>
<span id="cb107-584"><a href="#cb107-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-585"><a href="#cb107-585" aria-hidden="true" tabindex="-1"></a>We didn't have a good handle on how the 'nstates' and 'transitions' inputs to the models interacted and what type of model diagnostics would help us quantify underlying relationships. After we were in pretty deep we realized having PDO in both the model list (related to copepod richness or as an independent intercept) and as a covarate for transition may be inappropriate, but are unsure and would like more information. </span>
<span id="cb107-586"><a href="#cb107-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-587"><a href="#cb107-587" aria-hidden="true" tabindex="-1"></a>PDO has a very strong correlative pattern with copepod richness. We ran several combinations of model to examine the strength of this relationship. We produced some models with decent looking fits, but these models were not as highly ranked by AIC as other, seemingly less well fitting models. Is AIC a poor choice? We have a suspicion this question will be answered in the next lecture(s)...</span>
<span id="cb107-588"><a href="#cb107-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-589"><a href="#cb107-589" aria-hidden="true" tabindex="-1"></a><span class="fu"># Team contributions</span></span>
<span id="cb107-590"><a href="#cb107-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-591"><a href="#cb107-591" aria-hidden="true" tabindex="-1"></a>Madison took point on coding, Nick helped with coding and compiled it into the final rmd, and Nick and Karl did writing and Madison proofread and organized the .Rmd document. </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/atsa-es/fish550-2023/edit/main/Lab-4/Final_Write_ups/Lab-4-team-3_final.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/atsa-es/fish550-2023/blob/main/Lab-4/Final_Write_ups/Lab-4-team-3_final.Rmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/atsa-es/fish550-2023/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>